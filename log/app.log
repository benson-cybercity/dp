2017-03-13 09:58:41,078 = __main__ - INFO - Creating server
2017-03-13 09:58:41,079 = __main__ - INFO - Created server
2017-03-13 09:58:41,079 = __main__ - INFO - Listening on port 8080
2017-03-13 09:58:41,080 = __main__ - INFO - Starting event loop
2017-03-13 09:58:44,366 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/10000/-------------------
2017-03-13 09:58:44,367 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-13 09:58:44,367 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 13/03/2017 09:58:44
2017-03-13 09:58:44,367 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-13 09:58:44,367 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-13 09:58:44,368 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = d4eb8d345d424aae96afd8b88c5a6c63
2017-03-13 09:58:44,368 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-13 09:58:44,368 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-13 09:58:44,368 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>13/03/2017 09:58:44</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>d4eb8d345d424aae96afd8b88c5a6c63</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-13 09:58:44,368 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-13 09:58:44,369 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-13 09:58:44,369 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>13/03/2017 09:58:44</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>d4eb8d345d424aae96afd8b88c5a6c63</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-13 09:58:44,369 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-13 09:59:38,681 = tornado.application - ERROR - Uncaught exception
Traceback (most recent call last):
  File "/usr/local/lib/python2.7/dist-packages/tornado/http1connection.py", line 238, in _read_message
    delegate.finish()
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpserver.py", line 289, in finish
    self.delegate.finish()
  File "/usr/local/lib/python2.7/dist-packages/tornado/web.py", line 2047, in finish
    self.execute()
  File "/usr/local/lib/python2.7/dist-packages/tornado/web.py", line 2080, in execute
    **self.path_kwargs)
  File "/usr/local/lib/python2.7/dist-packages/tornado/gen.py", line 285, in wrapper
    yielded = next(result)
  File "/usr/local/lib/python2.7/dist-packages/tornado/web.py", line 1467, in _execute
    result = method(*self.path_args, **self.path_kwargs)
  File "/usr/local/lib/python2.7/dist-packages/tornado/gen.py", line 270, in wrapper
    result = func(*args, **kwargs)
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 79, in post
    r=self.purchase_airtime(xml,url,msisdn_2,amount,user_id,receipt_number)
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 181, in purchase_airtime
    r=requests.get(url, headers=headers)
  File "/usr/lib/python2.7/dist-packages/requests/api.py", line 55, in get
    return request('get', url, **kwargs)
  File "/usr/lib/python2.7/dist-packages/requests/api.py", line 44, in request
    return session.request(method=method, url=url, **kwargs)
  File "/usr/lib/python2.7/dist-packages/requests/sessions.py", line 455, in request
    resp = self.send(prep, **send_kwargs)
  File "/usr/lib/python2.7/dist-packages/requests/sessions.py", line 558, in send
    r = adapter.send(request, **kwargs)
  File "/usr/lib/python2.7/dist-packages/requests/adapters.py", line 330, in send
    timeout=timeout
  File "/usr/lib/python2.7/dist-packages/urllib3/connectionpool.py", line 562, in urlopen
    body=body, headers=headers)
  File "/usr/lib/python2.7/dist-packages/urllib3/connectionpool.py", line 387, in _make_request
    conn.request(method, url, **httplib_request_kw)
  File "/usr/lib/python2.7/httplib.py", line 1017, in request
    self._send_request(method, url, body, headers)
  File "/usr/lib/python2.7/httplib.py", line 1051, in _send_request
    self.endheaders(body)
  File "/usr/lib/python2.7/httplib.py", line 1013, in endheaders
    self._send_output(message_body)
  File "/usr/lib/python2.7/httplib.py", line 864, in _send_output
    self.send(msg)
  File "/usr/lib/python2.7/httplib.py", line 826, in send
    self.connect()
  File "/usr/lib/python2.7/httplib.py", line 807, in connect
    self.timeout, self.source_address)
  File "/usr/lib/python2.7/socket.py", line 562, in create_connection
    sock.connect(sa)
  File "/usr/lib/python2.7/socket.py", line 224, in meth
    return getattr(self._sock,name)(*args)
KeyboardInterrupt
2017-03-13 09:59:51,020 = __main__ - INFO - Creating server
2017-03-13 09:59:51,021 = __main__ - INFO - Created server
2017-03-13 09:59:51,021 = __main__ - INFO - Listening on port 8080
2017-03-13 09:59:51,022 = __main__ - INFO - Starting event loop
2017-03-13 09:59:55,084 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/10000/-------------------
2017-03-13 09:59:55,084 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-13 09:59:55,085 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 13/03/2017 09:59:55
2017-03-13 09:59:55,085 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-13 09:59:55,085 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-13 09:59:55,085 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 715485cfcd404a5ba2ee635afd703087
2017-03-13 09:59:55,086 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-13 09:59:55,086 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-13 09:59:55,086 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>13/03/2017 09:59:55</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>715485cfcd404a5ba2ee635afd703087</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-13 09:59:55,086 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-13 09:59:55,086 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-13 09:59:55,087 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>13/03/2017 09:59:55</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>715485cfcd404a5ba2ee635afd703087</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-13 09:59:55,087 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-13 10:02:05,356 = handlers.result_handler.AirtimeHandler - ERROR - HTTPConnectionPool(host='196.201.214.53', port=5660): Max retries exceeded with url: /?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=%3C?xml%20version=%221.0%22?%3E%3Cns0:COMMAND%20xmlns:ns0=%22http://safaricom.co.ke/Pinless/keyaccounts/%22%3E%3Cns0:TYPE%3EEXRCTRFREQ%3C/ns0:TYPE%3E%3Cns0:DATE%3E13/03/2017%2009:59:55%3C/ns0:DATE%3E%3Cns0:EXTNWCODE%3ESA%3C/ns0:EXTNWCODE%3E%3Cns0:MSISDN%3E700945099%3C/ns0:MSISDN%3E%3Cns0:PIN%3E4370%3C/ns0:PIN%3E%3Cns0:LOGINID%3ED-C101%3C/ns0:LOGINID%3E%3Cns0:PASSWORD%3EC3HrucQT%3C/ns0:PASSWORD%3E%3Cns0:EXTCODE%3ED-C101%3C/ns0:EXTCODE%3E%3Cns0:EXTREFNUM%3E715485cfcd404a5ba2ee635afd703087%3C/ns0:EXTREFNUM%3E%3Cns0:MSISDN2%3E0721799582%3C/ns0:MSISDN2%3E%3Cns0:AMOUNT%3E10000%3C/ns0:AMOUNT%3E%3Cns0:LANGUAGE1%3E%3C/ns0:LANGUAGE1%3E%3Cns0:LANGUAGE2%3E%3C/ns0:LANGUAGE2%3E%3Cns0:SELECTOR%3E%3C/ns0:SELECTOR%3E%3C/ns0:COMMAND%3E (Caused by <class 'socket.error'>: [Errno 110] Connection timed out)
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 79, in post
    r=self.purchase_airtime(xml,url,msisdn_2,amount,user_id,receipt_number)
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 181, in purchase_airtime
    r=requests.get(url, headers=headers)
  File "/usr/lib/python2.7/dist-packages/requests/api.py", line 55, in get
    return request('get', url, **kwargs)
  File "/usr/lib/python2.7/dist-packages/requests/api.py", line 44, in request
    return session.request(method=method, url=url, **kwargs)
  File "/usr/lib/python2.7/dist-packages/requests/sessions.py", line 455, in request
    resp = self.send(prep, **send_kwargs)
  File "/usr/lib/python2.7/dist-packages/requests/sessions.py", line 558, in send
    r = adapter.send(request, **kwargs)
  File "/usr/lib/python2.7/dist-packages/requests/adapters.py", line 378, in send
    raise ConnectionError(e)
ConnectionError: HTTPConnectionPool(host='196.201.214.53', port=5660): Max retries exceeded with url: /?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=%3C?xml%20version=%221.0%22?%3E%3Cns0:COMMAND%20xmlns:ns0=%22http://safaricom.co.ke/Pinless/keyaccounts/%22%3E%3Cns0:TYPE%3EEXRCTRFREQ%3C/ns0:TYPE%3E%3Cns0:DATE%3E13/03/2017%2009:59:55%3C/ns0:DATE%3E%3Cns0:EXTNWCODE%3ESA%3C/ns0:EXTNWCODE%3E%3Cns0:MSISDN%3E700945099%3C/ns0:MSISDN%3E%3Cns0:PIN%3E4370%3C/ns0:PIN%3E%3Cns0:LOGINID%3ED-C101%3C/ns0:LOGINID%3E%3Cns0:PASSWORD%3EC3HrucQT%3C/ns0:PASSWORD%3E%3Cns0:EXTCODE%3ED-C101%3C/ns0:EXTCODE%3E%3Cns0:EXTREFNUM%3E715485cfcd404a5ba2ee635afd703087%3C/ns0:EXTREFNUM%3E%3Cns0:MSISDN2%3E0721799582%3C/ns0:MSISDN2%3E%3Cns0:AMOUNT%3E10000%3C/ns0:AMOUNT%3E%3Cns0:LANGUAGE1%3E%3C/ns0:LANGUAGE1%3E%3Cns0:LANGUAGE2%3E%3C/ns0:LANGUAGE2%3E%3Cns0:SELECTOR%3E%3C/ns0:SELECTOR%3E%3C/ns0:COMMAND%3E (Caused by <class 'socket.error'>: [Errno 110] Connection timed out)
2017-03-13 10:02:05,359 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 130275.83ms
2017-03-14 10:21:53,333 = __main__ - INFO - Creating server
2017-03-14 10:21:53,335 = __main__ - INFO - Created server
2017-03-14 10:21:53,335 = __main__ - INFO - Listening on port 8080
2017-03-14 10:21:53,336 = __main__ - INFO - Starting event loop
/opt/saiba/ke-safaricom-airtime-integration/app/common/database.py:8: SyntaxWarning: import * only allowed at module level
  def conn():
2017-03-14 10:22:17,604 = __main__ - INFO - Creating server
2017-03-14 10:22:17,604 = __main__ - INFO - Creating server
2017-03-14 10:22:17,604 = __main__ - INFO - Created server
2017-03-14 10:22:17,604 = __main__ - INFO - Created server
2017-03-14 10:22:17,605 = __main__ - INFO - Listening on port 8080
2017-03-14 10:22:17,605 = __main__ - INFO - Listening on port 8080
2017-03-14 10:22:17,606 = __main__ - INFO - Starting event loop
2017-03-14 10:22:17,606 = __main__ - INFO - Starting event loop
2017-03-14 10:22:22,927 = __main__ - INFO - Creating server
2017-03-14 10:22:22,927 = __main__ - INFO - Created server
2017-03-14 10:22:22,928 = __main__ - INFO - Listening on port 8080
2017-03-14 10:23:24,190 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-14 10:23:24,190 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-14 10:23:24,190 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-14 10:23:24,191 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 10:23:24
2017-03-14 10:23:24,190 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-14 10:23:24,191 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 10:23:24
2017-03-14 10:23:24,191 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 14/03/2017 10:23:24
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-14 10:23:24,191 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-14 10:23:24,191 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-14 10:23:24,191 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-14 10:23:24,192 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 3fdf77c0ddd54c388b194d804dff6302
2017-03-14 10:23:24,192 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 3fdf77c0ddd54c388b194d804dff6302
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 3fdf77c0ddd54c388b194d804dff6302
2017-03-14 10:23:24,192 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-14 10:23:24,192 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-14 10:23:24,192 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-14 10:23:24,192 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-14 10:23:24,192 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 10:23:24</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3fdf77c0ddd54c388b194d804dff6302</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 10:23:24,192 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 10:23:24</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3fdf77c0ddd54c388b194d804dff6302</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 10:23:24,193 = handlers.result_handler.AirtimeHandler - INFO - Built XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 10:23:24</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3fdf77c0ddd54c388b194d804dff6302</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-14 10:23:24,193 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-14 10:23:24,193 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-14 10:23:24,193 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-14 10:23:24,193 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 10:23:24</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3fdf77c0ddd54c388b194d804dff6302</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-14 10:23:24,193 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-14 10:23:24,193 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 10:23:24</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3fdf77c0ddd54c388b194d804dff6302</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 10:23:24,193 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 10:23:24</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3fdf77c0ddd54c388b194d804dff6302</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-14 10:23:24,836 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 10:23:24,836 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 10:23:24,836 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>14/03/17 10:20:48</ns0:DATE><ns0:EXTREFNUM>3fdf77c0ddd54c388b194d804dff6302</ns0:EXTREFNUM><ns0:TXNID>R170314.1020.140055</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>14/03/17 10:20:48</ns0:DATE><ns0:EXTREFNUM>3fdf77c0ddd54c388b194d804dff6302</ns0:EXTREFNUM><ns0:TXNID>R170314.1020.140055</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-14 10:23:24,836 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>14/03/17 10:20:48</ns0:DATE><ns0:EXTREFNUM>3fdf77c0ddd54c388b194d804dff6302</ns0:EXTREFNUM><ns0:TXNID>R170314.1020.140055</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-14 10:23:24,837 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-14 10:23:24,837 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-14 10:23:24,837 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-14 10:23:24,837 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
send_notification() takes exactly 3 arguments (2 given)
2017-03-14 10:23:24,838 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 649.44ms
2017-03-14 10:23:24,838 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 649.44ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 649.44ms
2017-03-14 10:24:47,977 = __main__ - INFO - Creating server
2017-03-14 10:24:47,977 = __main__ - INFO - Creating server
2017-03-14 10:24:47,977 = __main__ - INFO - Created server
2017-03-14 10:24:47,977 = __main__ - INFO - Created server
2017-03-14 10:24:47,978 = __main__ - INFO - Listening on port 8080
2017-03-14 10:24:47,978 = __main__ - INFO - Listening on port 8080
2017-03-14 10:24:47,979 = __main__ - INFO - Starting event loop
2017-03-14 10:24:47,979 = __main__ - INFO - Starting event loop
2017-03-14 10:24:57,626 = __main__ - INFO - Creating server
2017-03-14 10:24:57,628 = __main__ - INFO - Created server
2017-03-14 10:24:57,628 = __main__ - INFO - Listening on port 8080
2017-03-14 10:25:26,056 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-14 10:25:26,056 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-14 10:25:26,057 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-14 10:25:26,057 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-14 10:25:26,057 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 10:25:26
2017-03-14 10:25:26,057 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 10:25:26
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 14/03/2017 10:25:26
2017-03-14 10:25:26,057 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-14 10:25:26,057 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-14 10:25:26,058 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-14 10:25:26,058 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-14 10:25:26,058 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 95009ca014734cc196df8bcfd3890f7b
2017-03-14 10:25:26,058 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 95009ca014734cc196df8bcfd3890f7b
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 95009ca014734cc196df8bcfd3890f7b
2017-03-14 10:25:26,059 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-14 10:25:26,059 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-14 10:25:26,059 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-14 10:25:26,059 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-14 10:25:26,059 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 10:25:26</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>95009ca014734cc196df8bcfd3890f7b</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 10:25:26,059 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 10:25:26</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>95009ca014734cc196df8bcfd3890f7b</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 10:25:26</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>95009ca014734cc196df8bcfd3890f7b</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 10:25:26,060 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-14 10:25:26,060 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-14 10:25:26,060 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-14 10:25:26,060 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-14 10:25:26,061 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 10:25:26</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>95009ca014734cc196df8bcfd3890f7b</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 10:25:26,061 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 10:25:26</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>95009ca014734cc196df8bcfd3890f7b</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 10:25:26</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>95009ca014734cc196df8bcfd3890f7b</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 10:25:26,061 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-14 10:25:26,061 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-14 10:25:26,999 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 10:25:26,999 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-14 10:25:26,999 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>14/03/17 10:22:50</ns0:DATE><ns0:EXTREFNUM>95009ca014734cc196df8bcfd3890f7b</ns0:EXTREFNUM><ns0:TXNID>R170314.1022.140067</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 3410</ns0:MESSAGE></ns0:COMMAND>

2017-03-14 10:25:26,999 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>14/03/17 10:22:50</ns0:DATE><ns0:EXTREFNUM>95009ca014734cc196df8bcfd3890f7b</ns0:EXTREFNUM><ns0:TXNID>R170314.1022.140067</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 3410</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>14/03/17 10:22:50</ns0:DATE><ns0:EXTREFNUM>95009ca014734cc196df8bcfd3890f7b</ns0:EXTREFNUM><ns0:TXNID>R170314.1022.140067</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 3410</ns0:MESSAGE></ns0:COMMAND>

2017-03-14 10:25:27,000 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-14 10:25:27,000 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-14 10:25:27,001 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-14 10:25:27,001 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
2017-03-14 10:25:27,001 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-14 10:25:27,001 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-14 10:25:27,001 = handlers.result_handler.AirtimeHandler - DEBUG - 14/03/17 10:22:50
2017-03-14 10:25:27,001 = handlers.result_handler.AirtimeHandler - DEBUG - 14/03/17 10:22:50
DEBUG:handlers.result_handler.AirtimeHandler:14/03/17 10:22:50
2017-03-14 10:25:27,002 = handlers.result_handler.AirtimeHandler - DEBUG - 95009ca014734cc196df8bcfd3890f7b
2017-03-14 10:25:27,002 = handlers.result_handler.AirtimeHandler - DEBUG - 95009ca014734cc196df8bcfd3890f7b
DEBUG:handlers.result_handler.AirtimeHandler:95009ca014734cc196df8bcfd3890f7b
2017-03-14 10:25:27,002 = handlers.result_handler.AirtimeHandler - DEBUG - R170314.1022.140067
2017-03-14 10:25:27,002 = handlers.result_handler.AirtimeHandler - DEBUG - R170314.1022.140067
DEBUG:handlers.result_handler.AirtimeHandler:R170314.1022.140067
2017-03-14 10:25:27,003 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'14/03/17 10:22:50', 'amount': '10', 'external_ref': u'R170314.1022.140067', 'msisdn_2': u'0721799582', 'internal_ref': u'95009ca014734cc196df8bcfd3890f7b'}
2017-03-14 10:25:27,003 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'14/03/17 10:22:50', 'amount': '10', 'external_ref': u'R170314.1022.140067', 'msisdn_2': u'0721799582', 'internal_ref': u'95009ca014734cc196df8bcfd3890f7b'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'14/03/17 10:22:50', 'amount': '10', 'external_ref': u'R170314.1022.140067', 'msisdn_2': u'0721799582', 'internal_ref': u'95009ca014734cc196df8bcfd3890f7b'}
2017-03-14 10:25:27,003 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-14 10:25:27,003 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-14 10:25:27,102 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-14 10:25:27,103 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-14 10:25:27,106 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-14 10:25:27,106 INFO sqlalchemy.engine.base.Engine {'table_oid': 20800}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 20800}
2017-03-14 10:25:27,109 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-14 10:25:27,109 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-14 10:25:27,111 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-14 10:25:27,111 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-14 10:25:27,117 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 20800}
2017-03-14 10:25:27,117 INFO sqlalchemy.engine.base.Engine {'table_oid': 20800}
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-14 10:25:27,119 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 20800}
2017-03-14 10:25:27,119 INFO sqlalchemy.engine.base.Engine {'table_oid': 20800}
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-14 10:25:27,122 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-14 10:25:27,123 INFO sqlalchemy.engine.base.Engine {'table': 20800}
INFO:sqlalchemy.engine.base.Engine:{'table': 20800}
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-14 10:25:27,124 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-14 10:25:27,124 INFO sqlalchemy.engine.base.Engine {'table_oid': 20800}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 20800}
2017-03-14 10:25:27,128 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 20800}
2017-03-14 10:25:27,128 INFO sqlalchemy.engine.base.Engine {'table_oid': 20800}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-14 10:25:27,129 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-14 10:25:27,129 INFO sqlalchemy.engine.base.Engine {'table_oid': 20800}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 20800}
2017-03-14 10:25:27,134 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-14 10:25:27,135 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7fc817cdad90>
2017-03-14 10:25:27,134 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-14 10:25:27,135 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-14 10:25:27,135 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 0721799582
2017-03-14 10:25:27,135 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 0721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 0721799582
2017-03-14 10:25:27,136 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-14 10:25:27,136 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-14 10:25:27,136 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 3
2017-03-14 10:25:27,136 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 3
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 3
2017-03-14 10:25:27,136 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-14 10:25:27,136 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-14 10:25:27,137 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-14 10:25:27,137 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-14 10:25:27,137 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-14 10:25:27,137 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-14 10:25:28,351 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":101,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-14T07:22:52.295525Z"}
2017-03-14 10:25:28,351 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":101,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-14T07:22:52.295525Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":101,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-14T07:22:52.295525Z"}
2017-03-14 10:25:28,352 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-14 10:25:28,352 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-14 10:25:28,352 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":101,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-14T07:22:52.295525Z"}
2017-03-14 10:25:28,352 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":101,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-14T07:22:52.295525Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":101,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-14T07:22:52.295525Z"}
2017-03-14 10:25:28,353 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-14 10:25:28,353 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-14 10:25:28,353 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-14 10:25:28,353 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-14 10:25:28,353 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-14 10:25:28,353 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-14 10:25:28,354 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-14 10:25:28,354 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-14 10:25:28,354 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "", "destination_mobile_number": "0721799582", "user": 3, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-14 10:25:28,354 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "", "destination_mobile_number": "0721799582", "user": 3, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-14 10:25:28,354 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "", "destination_mobile_number": "0721799582", "user": 3, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-14 10:25:28,354 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-14 10:25:29,451 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-14 10:25:29,452 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":76,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"0721799582","request":null,"amount":1000.0,"payment_method":1,"note":"","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-14 10:25:29,452 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-14 10:25:29,451 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-14 10:25:29,452 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":76,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"0721799582","request":null,"amount":1000.0,"payment_method":1,"note":"","bundle":null,"account_number":null}
2017-03-14 10:25:29,452 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-14 10:25:29,453 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:{"id":76,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"0721799582","request":null,"amount":1000.0,"payment_method":1,"note":"","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-14 10:25:29,453 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-14 10:25:29,454 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3398.61ms
2017-03-14 10:25:29,454 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3398.61ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3398.61ms
2017-03-14 11:05:50,386 = __main__ - INFO - Creating server
2017-03-14 11:05:50,387 = __main__ - INFO - Created server
2017-03-14 11:05:50,387 = __main__ - INFO - Listening on port 8080
2017-03-14 11:06:11,179 = __main__ - INFO - Creating server
2017-03-14 11:06:11,179 = __main__ - INFO - Creating server
2017-03-14 11:06:11,180 = __main__ - INFO - Created server
2017-03-14 11:06:11,180 = __main__ - INFO - Created server
2017-03-14 11:06:11,180 = __main__ - INFO - Listening on port 8080
2017-03-14 11:06:11,180 = __main__ - INFO - Listening on port 8080
2017-03-14 11:06:11,181 = __main__ - INFO - Starting event loop
2017-03-14 11:06:11,181 = __main__ - INFO - Starting event loop
2017-03-14 11:21:29,945 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-14 11:21:29,945 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-14 11:21:29,946 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-14 11:21:29,946 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-14 11:21:29,946 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 11:21:29
2017-03-14 11:21:29,946 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 11:21:29
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 14/03/2017 11:21:29
2017-03-14 11:21:29,946 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-14 11:21:29,946 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-14 11:21:29,947 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-14 11:21:29,947 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-14 11:21:29,947 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 52eae35fa5694f869c486c41a1f2040d
2017-03-14 11:21:29,947 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 52eae35fa5694f869c486c41a1f2040d
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 52eae35fa5694f869c486c41a1f2040d
2017-03-14 11:21:29,948 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-14 11:21:29,948 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-14 11:21:29,948 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-14 11:21:29,948 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-14 11:21:29,948 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 11:21:29</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>52eae35fa5694f869c486c41a1f2040d</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 11:21:29,948 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 11:21:29</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>52eae35fa5694f869c486c41a1f2040d</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 11:21:29</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>52eae35fa5694f869c486c41a1f2040d</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 11:21:29,949 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-14 11:21:29,949 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-14 11:21:29,949 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-14 11:21:29,949 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-14 11:21:29,949 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 11:21:29</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>52eae35fa5694f869c486c41a1f2040d</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 11:21:29,949 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 11:21:29</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>52eae35fa5694f869c486c41a1f2040d</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 11:21:29</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>52eae35fa5694f869c486c41a1f2040d</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 11:21:29,950 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-14 11:21:29,950 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-14 11:21:30,894 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 11:21:30,895 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>14/03/17 11:18:54</ns0:DATE><ns0:EXTREFNUM>52eae35fa5694f869c486c41a1f2040d</ns0:EXTREFNUM><ns0:TXNID>R170314.1118.140069</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 3400</ns0:MESSAGE></ns0:COMMAND>

2017-03-14 11:21:30,895 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-14 11:21:30,896 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-14 11:21:30,896 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>14/03/17 11:18:54</ns0:DATE><ns0:EXTREFNUM>52eae35fa5694f869c486c41a1f2040d</ns0:EXTREFNUM><ns0:TXNID>R170314.1118.140069</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 3400</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-14 11:21:30,894 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 11:21:30,895 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>14/03/17 11:18:54</ns0:DATE><ns0:EXTREFNUM>52eae35fa5694f869c486c41a1f2040d</ns0:EXTREFNUM><ns0:TXNID>R170314.1118.140069</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 3400</ns0:MESSAGE></ns0:COMMAND>

2017-03-14 11:21:30,895 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-14 11:21:30,896 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-14 11:21:30,896 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-14 11:21:30,897 = handlers.result_handler.AirtimeHandler - DEBUG - 14/03/17 11:18:54
DEBUG:handlers.result_handler.AirtimeHandler:14/03/17 11:18:54
2017-03-14 11:21:30,897 = handlers.result_handler.AirtimeHandler - DEBUG - 14/03/17 11:18:54
2017-03-14 11:21:30,897 = handlers.result_handler.AirtimeHandler - DEBUG - 52eae35fa5694f869c486c41a1f2040d
2017-03-14 11:21:30,897 = handlers.result_handler.AirtimeHandler - DEBUG - 52eae35fa5694f869c486c41a1f2040d
DEBUG:handlers.result_handler.AirtimeHandler:52eae35fa5694f869c486c41a1f2040d
2017-03-14 11:21:30,897 = handlers.result_handler.AirtimeHandler - DEBUG - R170314.1118.140069
2017-03-14 11:21:30,897 = handlers.result_handler.AirtimeHandler - DEBUG - R170314.1118.140069
DEBUG:handlers.result_handler.AirtimeHandler:R170314.1118.140069
2017-03-14 11:21:30,898 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'14/03/17 11:18:54', 'amount': '10', 'external_ref': u'R170314.1118.140069', 'msisdn_2': u'0721799582', 'internal_ref': u'52eae35fa5694f869c486c41a1f2040d'}
2017-03-14 11:21:30,898 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'14/03/17 11:18:54', 'amount': '10', 'external_ref': u'R170314.1118.140069', 'msisdn_2': u'0721799582', 'internal_ref': u'52eae35fa5694f869c486c41a1f2040d'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'14/03/17 11:18:54', 'amount': '10', 'external_ref': u'R170314.1118.140069', 'msisdn_2': u'0721799582', 'internal_ref': u'52eae35fa5694f869c486c41a1f2040d'}
2017-03-14 11:21:30,898 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-14 11:21:30,898 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-14 11:21:31,046 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-14 11:21:31,046 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-14 11:21:31,050 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23403}
2017-03-14 11:21:31,050 INFO sqlalchemy.engine.base.Engine {'table_oid': 23403}
2017-03-14 11:21:31,054 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-14 11:21:31,056 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-14 11:21:31,061 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-14 11:21:31,063 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-14 11:21:31,072 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-14 11:21:31,074 INFO sqlalchemy.engine.base.Engine {'table_oid': 23403}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23403}
2017-03-14 11:21:31,077 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23403}
2017-03-14 11:21:31,077 INFO sqlalchemy.engine.base.Engine {'table_oid': 23403}
2017-03-14 11:21:31,081 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23403}
2017-03-14 11:21:31,081 INFO sqlalchemy.engine.base.Engine {'table': 23403}
2017-03-14 11:21:31,084 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23403}
2017-03-14 11:21:31,084 INFO sqlalchemy.engine.base.Engine {'table_oid': 23403}
2017-03-14 11:21:31,088 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23403}
2017-03-14 11:21:31,088 INFO sqlalchemy.engine.base.Engine {'table_oid': 23403}
2017-03-14 11:21:31,090 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23403}
2017-03-14 11:21:31,090 INFO sqlalchemy.engine.base.Engine {'table_oid': 23403}
2017-03-14 11:21:31,099 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f5c1e2bdd90>
2017-03-14 11:21:31,099 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-14 11:21:31,099 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-14 11:21:31,099 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-14 11:21:31,099 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 0721799582
2017-03-14 11:21:31,099 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 0721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 0721799582
2017-03-14 11:21:31,100 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-14 11:21:31,100 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-14 11:21:31,100 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 3
2017-03-14 11:21:31,100 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 3
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 3
2017-03-14 11:21:31,100 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-14 11:21:31,100 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-14 11:21:31,100 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-14 11:21:31,100 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-14 11:21:31,101 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-14 11:21:31,101 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-14 11:21:32,201 = handlers.result_handler.AirtimeHandler - WARNING - [Errno 111] Connection refused
2017-03-14 11:21:32,201 = handlers.result_handler.AirtimeHandler - WARNING - [Errno 111] Connection refused
WARNING:handlers.result_handler.AirtimeHandler:[Errno 111] Connection refused
2017-03-14 11:21:32,201 = handlers.result_handler.AirtimeHandler - ERROR - [Errno 111] Connection refused
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 248, in send_notification
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
error: [Errno 111] Connection refused
2017-03-14 11:21:32,201 = handlers.result_handler.AirtimeHandler - ERROR - [Errno 111] Connection refused
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 248, in send_notification
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
error: [Errno 111] Connection refused
2017-03-14 11:21:32,202 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-14 11:21:32,202 = handlers.result_handler.AirtimeHandler - DEBUG - [Errno 111] Connection refused
ERROR:handlers.result_handler.AirtimeHandler:[Errno 111] Connection refused
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 248, in send_notification
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
error: [Errno 111] Connection refused
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:[Errno 111] Connection refused
2017-03-14 11:21:32,202 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-14 11:21:32,202 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-14 11:21:32,202 = handlers.result_handler.AirtimeHandler - DEBUG - [Errno 111] Connection refused
2017-03-14 11:21:32,202 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-14 11:21:32,203 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-14 11:21:32,203 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-14 11:21:32,203 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-14 11:21:32,203 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-14 11:21:32,203 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-14 11:21:32,203 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-14 11:21:32,204 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "", "destination_mobile_number": "0721799582", "user": 3, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-14 11:21:32,204 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "", "destination_mobile_number": "0721799582", "user": 3, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-14 11:21:32,204 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "", "destination_mobile_number": "0721799582", "user": 3, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-14 11:21:32,204 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-14 11:21:33,336 = handlers.result_handler.AirtimeHandler - ERROR - [Errno 111] Connection refused
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 275, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
error: [Errno 111] Connection refused
2017-03-14 11:21:33,336 = handlers.result_handler.AirtimeHandler - ERROR - [Errno 111] Connection refused
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 275, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
error: [Errno 111] Connection refused
ERROR:handlers.result_handler.AirtimeHandler:[Errno 111] Connection refused
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 275, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
error: [Errno 111] Connection refused
2017-03-14 11:21:33,337 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-14 11:21:33,337 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-14 11:21:33,338 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3393.95ms
2017-03-14 11:21:33,338 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3393.95ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3393.95ms
2017-03-14 11:34:30,443 = __main__ - INFO - Creating server
2017-03-14 11:34:30,444 = __main__ - INFO - Created server
2017-03-14 11:34:30,444 = __main__ - INFO - Listening on port 8080
2017-03-14 11:35:03,194 = __main__ - INFO - Creating server
2017-03-14 11:35:03,195 = __main__ - INFO - Created server
2017-03-14 11:35:03,195 = __main__ - INFO - Listening on port 8080
2017-03-14 11:35:03,196 = __main__ - INFO - Starting event loop
2017-03-14 11:35:11,543 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-14 11:35:11,544 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-14 11:35:11,544 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 11:35:11
2017-03-14 11:35:11,545 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-14 11:35:11,546 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-14 11:35:11,547 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = a29aa745dcae4789b5d6a355fb93005c
2017-03-14 11:35:11,548 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-14 11:35:11,548 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-14 11:35:11,549 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 11:35:11</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a29aa745dcae4789b5d6a355fb93005c</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 11:35:11,549 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-14 11:35:11,549 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-14 11:35:11,550 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 11:35:11</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a29aa745dcae4789b5d6a355fb93005c</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 11:35:11,550 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-14 11:35:12,465 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 11:35:12,466 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>14/03/17 11:32:36</ns0:DATE><ns0:EXTREFNUM>a29aa745dcae4789b5d6a355fb93005c</ns0:EXTREFNUM><ns0:TXNID>R170314.1132.140096</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 3390</ns0:MESSAGE></ns0:COMMAND>

2017-03-14 11:35:12,466 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-14 11:35:12,467 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-14 11:35:12,467 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-14 11:35:12,468 = handlers.result_handler.AirtimeHandler - DEBUG - 14/03/17 11:32:36
2017-03-14 11:35:12,468 = handlers.result_handler.AirtimeHandler - DEBUG - a29aa745dcae4789b5d6a355fb93005c
2017-03-14 11:35:12,469 = handlers.result_handler.AirtimeHandler - DEBUG - R170314.1132.140096
2017-03-14 11:35:12,469 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'14/03/17 11:32:36', 'amount': '10', 'external_ref': u'R170314.1132.140096', 'msisdn_2': u'0721799582', 'internal_ref': u'a29aa745dcae4789b5d6a355fb93005c'}
2017-03-14 11:35:12,470 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-14 11:35:12,661 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-14 11:35:12,661 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-14 11:35:12,662 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 0721799582
2017-03-14 11:35:12,662 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-14 11:35:12,662 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 3
2017-03-14 11:35:12,663 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-14 11:35:12,663 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-14 11:35:12,664 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-14 11:35:13,889 = handlers.result_handler.AirtimeHandler - WARNING - HTTP 401: Unauthorized
2017-03-14 11:35:13,889 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 401: Unauthorized
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 249, in send_notification
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 401: Unauthorized
2017-03-14 11:35:13,891 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-14 11:35:13,892 = handlers.result_handler.AirtimeHandler - DEBUG - HTTP 401: Unauthorized
2017-03-14 11:35:13,892 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-14 11:35:13,892 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-14 11:35:13,893 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-14 11:35:13,893 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-14 11:35:13,893 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "", "destination_mobile_number": "0721799582", "user": 3, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-14 11:35:13,894 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-14 11:35:15,012 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 401: Unauthorized
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 276, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 401: Unauthorized
2017-03-14 11:35:15,012 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-14 11:35:15,014 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3472.51ms
2017-03-14 11:43:32,916 = __main__ - INFO - Creating server
2017-03-14 11:43:32,916 = __main__ - INFO - Created server
2017-03-14 11:43:32,917 = __main__ - INFO - Listening on port 8080
2017-03-14 11:43:32,918 = __main__ - INFO - Starting event loop
2017-03-14 11:43:58,525 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-14 11:43:58,525 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-14 11:43:58,526 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 11:43:58
2017-03-14 11:43:58,526 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-14 11:43:58,526 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-14 11:43:58,527 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 4ec5d2c3585b487bb73eeb92d18b4976
2017-03-14 11:43:58,527 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-14 11:43:58,527 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-14 11:43:58,527 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 11:43:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>4ec5d2c3585b487bb73eeb92d18b4976</ns0:EXTREFNUM><ns0:MSISDN2>0731799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 11:43:58,528 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-14 11:43:58,528 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-14 11:43:58,529 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 11:43:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>4ec5d2c3585b487bb73eeb92d18b4976</ns0:EXTREFNUM><ns0:MSISDN2>0731799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 11:43:58,529 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-14 11:43:59,410 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 11:43:59,411 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>221</ns0:TXNSTATUS><ns0:DATE>14/03/17 11:41:23</ns0:DATE><ns0:EXTREFNUM>4ec5d2c3585b487bb73eeb92d18b4976</ns0:EXTREFNUM><ns0:TXNID>R170314.1141.140020</ns0:TXNID><ns0:MESSAGE>Your account has been credited back for failed transaction number 10 to transfer KSH R170314.1141.140020 to 731799582. Your current balance is KSH 3380 </ns0:MESSAGE></ns0:COMMAND>

2017-03-14 11:43:59,412 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-14 11:43:59,412 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-14 11:43:59,413 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-14 11:43:59,413 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 3
2017-03-14 11:43:59,414 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "3", "title": "Safaricom  Airtime"}
2017-03-14 11:43:59,414 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-14 11:43:59,414 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
2017-03-14 11:44:00,616 = handlers.result_handler.AirtimeHandler - WARNING - HTTP 403: Forbidden
2017-03-14 11:44:00,617 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 403: Forbidden
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 249, in send_notification
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 403: Forbidden
2017-03-14 11:44:00,619 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2095.40ms
2017-03-14 11:46:27,242 = __main__ - INFO - Creating server
2017-03-14 11:46:27,243 = __main__ - INFO - Created server
2017-03-14 11:46:27,244 = __main__ - INFO - Listening on port 8080
2017-03-14 11:46:27,245 = __main__ - INFO - Starting event loop
2017-03-14 11:46:30,169 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-14 11:46:30,169 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-14 11:46:30,170 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 11:46:30
2017-03-14 11:46:30,171 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-14 11:46:30,171 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-14 11:46:30,172 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 95ff0b75e3814ff4a0f783cfb1b1efc5
2017-03-14 11:46:30,172 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-14 11:46:30,173 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-14 11:46:30,173 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 11:46:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>95ff0b75e3814ff4a0f783cfb1b1efc5</ns0:EXTREFNUM><ns0:MSISDN2>0731799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 11:46:30,174 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-14 11:46:30,174 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-14 11:46:30,174 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 11:46:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>95ff0b75e3814ff4a0f783cfb1b1efc5</ns0:EXTREFNUM><ns0:MSISDN2>0731799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 11:46:30,175 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-14 11:46:31,125 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 11:46:31,126 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>221</ns0:TXNSTATUS><ns0:DATE>14/03/17 11:43:54</ns0:DATE><ns0:EXTREFNUM>95ff0b75e3814ff4a0f783cfb1b1efc5</ns0:EXTREFNUM><ns0:TXNID>R170314.1143.140068</ns0:TXNID><ns0:MESSAGE>Your account has been credited back for failed transaction number 10 to transfer KSH R170314.1143.140068 to 731799582. Your current balance is KSH 3380 </ns0:MESSAGE></ns0:COMMAND>

2017-03-14 11:46:31,126 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-14 11:46:31,127 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-14 11:46:31,127 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-14 11:46:31,128 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 3
2017-03-14 11:46:31,128 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "3", "title": "Safaricom  Airtime"}
2017-03-14 11:46:31,128 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-14 11:46:31,129 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
2017-03-14 11:46:31,178 = handlers.result_handler.AirtimeHandler - WARNING - HTTP 403: Forbidden
2017-03-14 11:46:31,179 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 403: Forbidden
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 249, in send_notification
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 403: Forbidden
2017-03-14 11:46:31,181 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 1013.56ms
2017-03-14 11:47:31,053 = __main__ - INFO - Creating server
2017-03-14 11:47:31,054 = __main__ - INFO - Created server
2017-03-14 11:47:31,055 = __main__ - INFO - Listening on port 8080
2017-03-14 11:47:31,056 = __main__ - INFO - Starting event loop
2017-03-14 11:47:35,400 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-14 11:47:35,400 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-14 11:47:35,400 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 11:47:35
2017-03-14 11:47:35,401 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-14 11:47:35,401 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-14 11:47:35,401 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 63a0f3eca9dc48bc9e1a47230478599f
2017-03-14 11:47:35,401 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-14 11:47:35,402 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-14 11:47:35,402 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 11:47:35</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>63a0f3eca9dc48bc9e1a47230478599f</ns0:EXTREFNUM><ns0:MSISDN2>0731799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 11:47:35,402 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-14 11:47:35,402 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-14 11:47:35,403 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 11:47:35</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>63a0f3eca9dc48bc9e1a47230478599f</ns0:EXTREFNUM><ns0:MSISDN2>0731799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 11:47:35,403 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-14 11:47:36,301 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 11:47:36,302 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>221</ns0:TXNSTATUS><ns0:DATE>14/03/17 11:45:00</ns0:DATE><ns0:EXTREFNUM>63a0f3eca9dc48bc9e1a47230478599f</ns0:EXTREFNUM><ns0:TXNID>R170314.1144.140060</ns0:TXNID><ns0:MESSAGE>Your account has been credited back for failed transaction number 10 to transfer KSH R170314.1144.140060 to 731799582. Your current balance is KSH 3380 </ns0:MESSAGE></ns0:COMMAND>

2017-03-14 11:47:36,302 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-14 11:47:36,303 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-14 11:47:36,303 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-14 11:47:36,303 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 3
2017-03-14 11:47:36,304 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "3", "title": "Safaricom  Airtime"}
2017-03-14 11:47:36,304 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-14 11:47:36,305 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
2017-03-14 11:47:36,345 = handlers.result_handler.AirtimeHandler - WARNING - HTTP 403: Forbidden
2017-03-14 11:47:36,346 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 403: Forbidden
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 249, in send_notification
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 403: Forbidden
2017-03-14 11:47:36,348 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-14 11:47:36,348 = handlers.result_handler.AirtimeHandler - DEBUG - https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-14 11:47:36,349 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token b9d30f778501df2e3af8797fb931cee7820671e3'}
2017-03-14 11:47:36,349 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "1000", "user": 3, "user_credit_type": 1, "debit": ""}
2017-03-14 11:47:37,457 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 403: Forbidden
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 298, in add_credits
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 403: Forbidden
2017-03-14 11:47:37,459 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-14 11:47:37,460 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2060.61ms
2017-03-14 12:17:46,447 = __main__ - INFO - Creating server
2017-03-14 12:17:46,448 = __main__ - INFO - Created server
2017-03-14 12:17:46,448 = __main__ - INFO - Listening on port 8080
2017-03-14 12:17:46,449 = __main__ - INFO - Starting event loop
2017-03-14 12:19:34,425 = __main__ - INFO - Creating server
2017-03-14 12:19:34,427 = __main__ - INFO - Created server
2017-03-14 12:19:34,427 = __main__ - INFO - Listening on port 8080
2017-03-14 12:19:34,428 = __main__ - INFO - Starting event loop
2017-03-14 12:19:37,433 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-14 12:19:37,434 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-14 12:19:37,434 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 12:19:37
2017-03-14 12:19:37,434 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-14 12:19:37,435 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-14 12:19:37,436 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 4609540e90664f1981999d8f90de1f55
2017-03-14 12:19:37,436 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-14 12:19:37,436 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-14 12:19:37,437 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 12:19:37</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>4609540e90664f1981999d8f90de1f55</ns0:EXTREFNUM><ns0:MSISDN2>0731799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 12:19:37,437 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-14 12:19:37,437 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-14 12:19:37,438 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 12:19:37</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>4609540e90664f1981999d8f90de1f55</ns0:EXTREFNUM><ns0:MSISDN2>0731799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 12:19:37,438 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-14 12:19:38,409 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 12:19:38,410 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>221</ns0:TXNSTATUS><ns0:DATE>14/03/17 12:17:02</ns0:DATE><ns0:EXTREFNUM>4609540e90664f1981999d8f90de1f55</ns0:EXTREFNUM><ns0:TXNID>R170314.1217.140002</ns0:TXNID><ns0:MESSAGE>Your account has been credited back for failed transaction number 10 to transfer KSH R170314.1217.140002 to 731799582. Your current balance is KSH 3380 </ns0:MESSAGE></ns0:COMMAND>

2017-03-14 12:19:38,410 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-14 12:19:38,411 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-14 12:19:38,412 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-14 12:19:38,412 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 3
2017-03-14 12:19:38,412 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "3", "title": "Safaricom  Airtime"}
2017-03-14 12:19:38,413 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-14 12:19:38,413 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
2017-03-14 12:19:39,836 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":104,"user":3,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-14T09:17:03.547847Z"}
2017-03-14 12:19:39,845 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-14 12:19:39,846 = handlers.result_handler.AirtimeHandler - DEBUG - https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-14 12:19:39,846 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token b9d30f778501df2e3af8797fb931cee7820671e3'}
2017-03-14 12:19:39,847 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "1000", "user": 3, "user_credit_type": 1, "debit": ""}
2017-03-14 12:19:41,093 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 320, in add_credits
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-14 12:19:41,096 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-14 12:19:41,098 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3665.70ms
2017-03-14 12:26:43,682 = __main__ - INFO - Creating server
2017-03-14 12:26:43,682 = __main__ - INFO - Created server
2017-03-14 12:26:43,683 = __main__ - INFO - Listening on port 8080
2017-03-14 12:26:43,684 = __main__ - INFO - Starting event loop
2017-03-14 12:26:47,475 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-14 12:26:47,476 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-14 12:26:47,476 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 12:26:47
2017-03-14 12:26:47,476 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-14 12:26:47,476 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-14 12:26:47,477 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = c11946b99b384be4aade2675b45c5920
2017-03-14 12:26:47,477 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-14 12:26:47,477 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-14 12:26:47,477 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 12:26:47</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c11946b99b384be4aade2675b45c5920</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 12:26:47,478 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-14 12:26:47,478 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-14 12:26:47,478 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 12:26:47</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c11946b99b384be4aade2675b45c5920</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 12:26:47,479 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-14 12:26:48,390 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 12:26:48,390 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>14/03/17 12:24:12</ns0:DATE><ns0:EXTREFNUM>c11946b99b384be4aade2675b45c5920</ns0:EXTREFNUM><ns0:TXNID>R170314.1224.140019</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 3380</ns0:MESSAGE></ns0:COMMAND>

2017-03-14 12:26:48,391 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-14 12:26:48,392 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-14 12:26:48,392 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-14 12:26:48,393 = handlers.result_handler.AirtimeHandler - DEBUG - 14/03/17 12:24:12
2017-03-14 12:26:48,393 = handlers.result_handler.AirtimeHandler - DEBUG - c11946b99b384be4aade2675b45c5920
2017-03-14 12:26:48,394 = handlers.result_handler.AirtimeHandler - DEBUG - R170314.1224.140019
2017-03-14 12:26:48,394 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'14/03/17 12:24:12', 'amount': '10', 'external_ref': u'R170314.1224.140019', 'msisdn_2': u'0721799582', 'internal_ref': u'c11946b99b384be4aade2675b45c5920'}
2017-03-14 12:26:48,394 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-14 12:26:48,593 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-14 12:26:48,594 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-14 12:26:48,594 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 0721799582
2017-03-14 12:26:48,594 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-14 12:26:48,595 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 3
2017-03-14 12:26:48,595 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-14 12:26:48,596 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-14 12:26:48,596 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-14 12:26:49,865 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":105,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-14T09:24:13.577204Z"}
2017-03-14 12:26:49,866 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-14 12:26:49,866 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":105,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-14T09:24:13.577204Z"}
2017-03-14 12:26:49,867 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-14 12:26:49,867 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-14 12:26:49,867 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-14 12:26:49,868 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-14 12:26:49,868 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "", "destination_mobile_number": "0721799582", "user": 3, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-14 12:26:49,869 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-14 12:26:50,197 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-14 12:26:50,198 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":79,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"0721799582","request":null,"amount":1000.0,"payment_method":1,"note":"","bundle":null,"account_number":null}
2017-03-14 12:26:50,198 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-14 12:26:50,199 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
2017-03-14 12:26:50,199 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload, headers=headers)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-14 12:26:50,200 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-14 12:26:50,201 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2726.63ms
2017-03-14 12:27:31,401 = __main__ - INFO - Creating server
2017-03-14 12:27:31,401 = __main__ - INFO - Creating server
2017-03-14 12:27:31,402 = __main__ - INFO - Created server
2017-03-14 12:27:31,402 = __main__ - INFO - Created server
2017-03-14 12:27:31,402 = __main__ - INFO - Listening on port 8080
2017-03-14 12:27:31,402 = __main__ - INFO - Listening on port 8080
2017-03-14 12:27:31,403 = __main__ - INFO - Starting event loop
2017-03-14 12:27:31,403 = __main__ - INFO - Starting event loop
2017-03-14 12:27:36,572 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-14 12:27:36,572 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/5000/-------------------
2017-03-14 12:27:36,573 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-14 12:27:36,573 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-14 12:27:36,573 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 12:27:36
2017-03-14 12:27:36,573 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 12:27:36
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 14/03/2017 12:27:36
2017-03-14 12:27:36,574 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-14 12:27:36,574 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-14 12:27:36,574 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-14 12:27:36,574 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-14 12:27:36,574 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 8781dc48375446faa1a32705ac8430c3
2017-03-14 12:27:36,574 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 8781dc48375446faa1a32705ac8430c3
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 8781dc48375446faa1a32705ac8430c3
2017-03-14 12:27:36,574 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-14 12:27:36,574 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-14 12:27:36,575 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-14 12:27:36,575 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-14 12:27:36,575 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 12:27:36</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8781dc48375446faa1a32705ac8430c3</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 12:27:36,575 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 12:27:36</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8781dc48375446faa1a32705ac8430c3</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 12:27:36</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8781dc48375446faa1a32705ac8430c3</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 12:27:36,575 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-14 12:27:36,575 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-14 12:27:36,575 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-14 12:27:36,575 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-14 12:27:36,575 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 12:27:36</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8781dc48375446faa1a32705ac8430c3</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 12:27:36,575 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 12:27:36</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8781dc48375446faa1a32705ac8430c3</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 12:27:36</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8781dc48375446faa1a32705ac8430c3</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 12:27:36,576 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-14 12:27:36,576 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-14 12:27:37,221 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 12:27:37,221 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 12:27:37,222 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>14/03/17 12:25:00</ns0:DATE><ns0:EXTREFNUM>8781dc48375446faa1a32705ac8430c3</ns0:EXTREFNUM><ns0:TXNID>R170314.1225.140001</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-14 12:27:37,222 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>14/03/17 12:25:00</ns0:DATE><ns0:EXTREFNUM>8781dc48375446faa1a32705ac8430c3</ns0:EXTREFNUM><ns0:TXNID>R170314.1225.140001</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-14 12:27:37,222 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>14/03/17 12:25:00</ns0:DATE><ns0:EXTREFNUM>8781dc48375446faa1a32705ac8430c3</ns0:EXTREFNUM><ns0:TXNID>R170314.1225.140001</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-14 12:27:37,222 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-14 12:27:37,223 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-14 12:27:37,223 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-14 12:27:37,223 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-14 12:27:37,223 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 3
2017-03-14 12:27:37,223 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-14 12:27:37,223 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 3
DEBUG:handlers.result_handler.AirtimeHandler:sending message could not complete your request at this time please try again later to 3
2017-03-14 12:27:37,223 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "3", "title": "Safaricom  Airtime"}
2017-03-14 12:27:37,223 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "3", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "could not complete your request at this time please try again later", "user": "3", "title": "Safaricom  Airtime"}
2017-03-14 12:27:37,223 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-14 12:27:37,223 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-14 12:27:37,224 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-14 12:27:37,224 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
DEBUG:handlers.result_handler.AirtimeHandler:could not complete your request at this time please try again later
2017-03-14 12:27:37,264 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":106,"user":3,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-14T09:25:00.977695Z"}
2017-03-14 12:27:37,264 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":106,"user":3,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-14T09:25:00.977695Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":106,"user":3,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-14T09:25:00.977695Z"}
2017-03-14 12:27:37,264 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-14 12:27:37,264 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-14 12:27:37,264 = handlers.result_handler.AirtimeHandler - DEBUG - https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-14 12:27:37,264 = handlers.result_handler.AirtimeHandler - DEBUG - https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-14 12:27:37,265 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token b9d30f778501df2e3af8797fb931cee7820671e3'}
DEBUG:handlers.result_handler.AirtimeHandler:https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-14 12:27:37,265 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token b9d30f778501df2e3af8797fb931cee7820671e3'}
2017-03-14 12:27:37,265 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5000", "user": 3, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token b9d30f778501df2e3af8797fb931cee7820671e3'}
2017-03-14 12:27:37,265 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5000", "user": 3, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "5000", "user": 3, "user_credit_type": 1, "debit": "0"}
2017-03-14 12:27:37,306 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-14 12:27:37,306 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-14 12:27:37,306 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":3,"user_credit_type":1,"debit":0.0,"credit":5000.0,"balance":6400.0}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-14 12:27:37,306 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":3,"user_credit_type":1,"debit":0.0,"credit":5000.0,"balance":6400.0}
2017-03-14 12:27:37,306 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:{"user":3,"user_credit_type":1,"debit":0.0,"credit":5000.0,"balance":6400.0}
{"user":3,"user_credit_type":1,"debit":0.0,"credit":5000.0,"balance":6400.0}
2017-03-14 12:27:37,306 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-14 12:27:37,307 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-14 12:27:37,307 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-14 12:27:37,308 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 735.89ms
2017-03-14 12:27:37,308 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 735.89ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 735.89ms
2017-03-14 12:27:46,554 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-14 12:27:46,554 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/5000/-------------------
2017-03-14 12:27:46,555 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-14 12:27:46,555 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-14 12:27:46,555 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 12:27:46
2017-03-14 12:27:46,555 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 12:27:46
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 14/03/2017 12:27:46
2017-03-14 12:27:46,556 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-14 12:27:46,556 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-14 12:27:46,556 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-14 12:27:46,556 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-14 12:27:46,556 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = cfb63eb52aa24bf69cbd4f68b06cf67c
2017-03-14 12:27:46,556 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = cfb63eb52aa24bf69cbd4f68b06cf67c
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = cfb63eb52aa24bf69cbd4f68b06cf67c
2017-03-14 12:27:46,557 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-14 12:27:46,557 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-14 12:27:46,557 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-14 12:27:46,557 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-14 12:27:46,557 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 12:27:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>cfb63eb52aa24bf69cbd4f68b06cf67c</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 12:27:46,557 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 12:27:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>cfb63eb52aa24bf69cbd4f68b06cf67c</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 12:27:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>cfb63eb52aa24bf69cbd4f68b06cf67c</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 12:27:46,558 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-14 12:27:46,558 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-14 12:27:46,558 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-14 12:27:46,558 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-14 12:27:46,558 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 12:27:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>cfb63eb52aa24bf69cbd4f68b06cf67c</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 12:27:46,558 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 12:27:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>cfb63eb52aa24bf69cbd4f68b06cf67c</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 12:27:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>cfb63eb52aa24bf69cbd4f68b06cf67c</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 12:27:46,559 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-14 12:27:46,559 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-14 12:27:47,164 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 12:27:47,164 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>14/03/17 12:25:10</ns0:DATE><ns0:EXTREFNUM>cfb63eb52aa24bf69cbd4f68b06cf67c</ns0:EXTREFNUM><ns0:TXNID>R170314.1225.140012</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-14 12:27:47,165 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-14 12:27:47,165 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-14 12:27:47,165 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-14 12:27:47,165 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 3
2017-03-14 12:27:47,166 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "3", "title": "Safaricom  Airtime"}
2017-03-14 12:27:47,166 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-14 12:27:47,166 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>14/03/17 12:25:10</ns0:DATE><ns0:EXTREFNUM>cfb63eb52aa24bf69cbd4f68b06cf67c</ns0:EXTREFNUM><ns0:TXNID>R170314.1225.140012</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending message could not complete your request at this time please try again later to 3
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "could not complete your request at this time please try again later", "user": "3", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:could not complete your request at this time please try again later
2017-03-14 12:27:47,164 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 12:27:47,164 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>14/03/17 12:25:10</ns0:DATE><ns0:EXTREFNUM>cfb63eb52aa24bf69cbd4f68b06cf67c</ns0:EXTREFNUM><ns0:TXNID>R170314.1225.140012</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-14 12:27:47,165 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-14 12:27:47,165 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-14 12:27:47,165 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-14 12:27:47,165 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 3
2017-03-14 12:27:47,166 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "3", "title": "Safaricom  Airtime"}
2017-03-14 12:27:47,166 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-14 12:27:47,166 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
2017-03-14 12:27:48,321 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":107,"user":3,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-14T09:25:12.036182Z"}
2017-03-14 12:27:48,321 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":107,"user":3,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-14T09:25:12.036182Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":107,"user":3,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-14T09:25:12.036182Z"}
2017-03-14 12:27:48,322 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-14 12:27:48,322 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-14 12:27:48,322 = handlers.result_handler.AirtimeHandler - DEBUG - https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-14 12:27:48,322 = handlers.result_handler.AirtimeHandler - DEBUG - https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-14 12:27:48,322 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token b9d30f778501df2e3af8797fb931cee7820671e3'}
DEBUG:handlers.result_handler.AirtimeHandler:https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-14 12:27:48,322 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token b9d30f778501df2e3af8797fb931cee7820671e3'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token b9d30f778501df2e3af8797fb931cee7820671e3'}
2017-03-14 12:27:48,323 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5000", "user": 3, "user_credit_type": 1, "debit": "0"}
2017-03-14 12:27:48,323 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5000", "user": 3, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "5000", "user": 3, "user_credit_type": 1, "debit": "0"}
2017-03-14 12:27:48,367 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-14 12:27:48,367 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":3,"user_credit_type":1,"debit":0.0,"credit":5000.0,"balance":11400.0}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-14 12:27:48,367 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-14 12:27:48,367 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":3,"user_credit_type":1,"debit":0.0,"credit":5000.0,"balance":11400.0}
2017-03-14 12:27:48,368 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:{"user":3,"user_credit_type":1,"debit":0.0,"credit":5000.0,"balance":11400.0}
{"user":3,"user_credit_type":1,"debit":0.0,"credit":5000.0,"balance":11400.0}
2017-03-14 12:27:48,368 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-14 12:27:48,368 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-14 12:27:48,368 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-14 12:27:48,369 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 1815.56ms
2017-03-14 12:27:48,369 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 1815.56ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 1815.56ms
2017-03-14 12:28:25,861 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-14 12:28:25,861 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-14 12:28:25,861 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 12:28:25
2017-03-14 12:28:25,862 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-14 12:28:25,862 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-14 12:28:25,862 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 3fe81176830146779480253f8c6eaca4
2017-03-14 12:28:25,863 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-14 12:28:25,863 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-14 12:28:25,863 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 12:28:25</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3fe81176830146779480253f8c6eaca4</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 12:28:25,863 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-14 12:28:25,864 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-14 12:28:25,864 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 12:28:25</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3fe81176830146779480253f8c6eaca4</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 12:28:25,864 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/5000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 14/03/2017 12:28:25
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 3fe81176830146779480253f8c6eaca4
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 12:28:25</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3fe81176830146779480253f8c6eaca4</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 12:28:25</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3fe81176830146779480253f8c6eaca4</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-14 12:28:25,861 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-14 12:28:25,861 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-14 12:28:25,861 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 12:28:25
2017-03-14 12:28:25,862 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-14 12:28:25,862 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-14 12:28:25,862 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 3fe81176830146779480253f8c6eaca4
2017-03-14 12:28:25,863 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-14 12:28:25,863 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-14 12:28:25,863 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 12:28:25</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3fe81176830146779480253f8c6eaca4</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 12:28:25,863 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-14 12:28:25,864 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-14 12:28:25,864 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 12:28:25</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3fe81176830146779480253f8c6eaca4</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 12:28:25,864 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-14 12:28:26,491 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 12:28:26,491 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-14 12:28:26,492 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>14/03/17 12:25:50</ns0:DATE><ns0:EXTREFNUM>3fe81176830146779480253f8c6eaca4</ns0:EXTREFNUM><ns0:TXNID>R170314.1225.140064</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-14 12:28:26,492 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>14/03/17 12:25:50</ns0:DATE><ns0:EXTREFNUM>3fe81176830146779480253f8c6eaca4</ns0:EXTREFNUM><ns0:TXNID>R170314.1225.140064</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>14/03/17 12:25:50</ns0:DATE><ns0:EXTREFNUM>3fe81176830146779480253f8c6eaca4</ns0:EXTREFNUM><ns0:TXNID>R170314.1225.140064</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-14 12:28:26,492 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-14 12:28:26,492 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-14 12:28:26,492 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-14 12:28:26,492 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-14 12:28:26,493 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-14 12:28:26,493 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-14 12:28:26,493 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 3
2017-03-14 12:28:26,493 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 3
DEBUG:handlers.result_handler.AirtimeHandler:sending message could not complete your request at this time please try again later to 3
2017-03-14 12:28:26,493 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "3", "title": "Safaricom  Airtime"}
2017-03-14 12:28:26,493 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "3", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "could not complete your request at this time please try again later", "user": "3", "title": "Safaricom  Airtime"}
2017-03-14 12:28:26,494 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-14 12:28:26,494 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
2017-03-14 12:28:26,494 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-14 12:28:26,494 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
DEBUG:handlers.result_handler.AirtimeHandler:could not complete your request at this time please try again later
2017-03-14 12:28:26,537 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":108,"user":3,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-14T09:25:50.251204Z"}
2017-03-14 12:28:26,537 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":108,"user":3,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-14T09:25:50.251204Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":108,"user":3,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-14T09:25:50.251204Z"}
2017-03-14 12:28:26,538 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-14 12:28:26,538 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-14 12:28:26,538 = handlers.result_handler.AirtimeHandler - DEBUG - https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-14 12:28:26,538 = handlers.result_handler.AirtimeHandler - DEBUG - https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-14 12:28:26,538 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token b9d30f778501df2e3af8797fb931cee7820671e3'}
2017-03-14 12:28:26,538 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token b9d30f778501df2e3af8797fb931cee7820671e3'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token b9d30f778501df2e3af8797fb931cee7820671e3'}
2017-03-14 12:28:26,538 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5000", "user": 3, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "5000", "user": 3, "user_credit_type": 1, "debit": "0"}
2017-03-14 12:28:26,538 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5000", "user": 3, "user_credit_type": 1, "debit": "0"}
2017-03-14 12:28:26,616 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-14 12:28:26,616 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-14 12:28:26,617 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":3,"user_credit_type":1,"debit":0.0,"credit":5000.0,"balance":16400.0}
2017-03-14 12:28:26,617 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":3,"user_credit_type":1,"debit":0.0,"credit":5000.0,"balance":16400.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":3,"user_credit_type":1,"debit":0.0,"credit":5000.0,"balance":16400.0}
{"user":3,"user_credit_type":1,"debit":0.0,"credit":5000.0,"balance":16400.0}
2017-03-14 12:28:26,617 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-14 12:28:26,617 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-14 12:28:26,618 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-14 12:28:26,618 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-14 12:28:26,619 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 758.82ms
2017-03-14 12:28:26,619 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 758.82ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 758.82ms
2017-03-14 12:45:36,514 = __main__ - INFO - Creating server
2017-03-14 12:45:36,514 = __main__ - INFO - Creating server
2017-03-14 12:45:36,515 = __main__ - INFO - Created server
2017-03-14 12:45:36,515 = __main__ - INFO - Created server
2017-03-14 12:45:36,515 = __main__ - INFO - Listening on port 8080
2017-03-14 12:45:36,515 = __main__ - INFO - Listening on port 8080
2017-03-14 12:45:36,516 = __main__ - INFO - Starting event loop
2017-03-14 12:45:36,516 = __main__ - INFO - Starting event loop
2017-03-14 12:45:40,470 = __main__ - INFO - Creating server
2017-03-14 12:45:40,471 = __main__ - INFO - Created server
2017-03-14 12:45:40,471 = __main__ - INFO - Listening on port 8080
2017-03-14 13:28:07,633 = tornado.access - WARNING - 404 GET / (46.231.79.222) 0.97ms
2017-03-14 13:28:07,633 = tornado.access - WARNING - 404 GET / (46.231.79.222) 0.97ms
2017-03-14 14:41:04,359 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.70ms
2017-03-14 14:41:04,359 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.70ms
2017-03-14 15:14:49,223 = tornado.access - WARNING - 404 GET /script (61.147.247.125) 0.55ms
2017-03-14 15:14:49,223 = tornado.access - WARNING - 404 GET /script (61.147.247.125) 0.55ms
2017-03-14 16:04:25,355 = __main__ - INFO - Creating server
2017-03-14 16:04:25,356 = __main__ - INFO - Created server
2017-03-14 16:04:25,356 = __main__ - INFO - Listening on port 8080
2017-03-14 16:20:35,712 = __main__ - INFO - Creating server
2017-03-14 16:20:35,713 = __main__ - INFO - Created server
2017-03-14 16:20:35,714 = __main__ - INFO - Listening on port 8080
2017-03-14 16:22:26,271 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-14 16:22:26,271 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-14 16:22:26,271 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-14 16:22:26,271 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-14 16:22:26,272 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 16:22:26
2017-03-14 16:22:26,272 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 16:22:26
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 14/03/2017 16:22:26
2017-03-14 16:22:26,272 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-14 16:22:26,272 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-14 16:22:26,273 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-14 16:22:26,273 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-14 16:22:26,273 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = f386fa9c035f435c9d41a0e556d8d112
2017-03-14 16:22:26,273 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = f386fa9c035f435c9d41a0e556d8d112
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = f386fa9c035f435c9d41a0e556d8d112
2017-03-14 16:22:26,274 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-14 16:22:26,274 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-14 16:22:26,274 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-14 16:22:26,274 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-14 16:22:26,275 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 16:22:26</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f386fa9c035f435c9d41a0e556d8d112</ns0:EXTREFNUM><ns0:MSISDN2>721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 16:22:26,275 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 16:22:26</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f386fa9c035f435c9d41a0e556d8d112</ns0:EXTREFNUM><ns0:MSISDN2>721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 16:22:26</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f386fa9c035f435c9d41a0e556d8d112</ns0:EXTREFNUM><ns0:MSISDN2>721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 16:22:26,275 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-14 16:22:26,275 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-14 16:22:26,276 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-14 16:22:26,276 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-14 16:22:26,276 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 16:22:26</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f386fa9c035f435c9d41a0e556d8d112</ns0:EXTREFNUM><ns0:MSISDN2>721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 16:22:26,276 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 16:22:26</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f386fa9c035f435c9d41a0e556d8d112</ns0:EXTREFNUM><ns0:MSISDN2>721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 16:22:26</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f386fa9c035f435c9d41a0e556d8d112</ns0:EXTREFNUM><ns0:MSISDN2>721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 16:22:26,276 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-14 16:22:26,276 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-14 16:22:27,152 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 16:22:27,153 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>14/03/17 16:19:50</ns0:DATE><ns0:EXTREFNUM>f386fa9c035f435c9d41a0e556d8d112</ns0:EXTREFNUM><ns0:TXNID>R170314.1619.140056</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 3370</ns0:MESSAGE></ns0:COMMAND>

2017-03-14 16:22:27,153 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-14 16:22:27,154 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>14/03/17 16:19:50</ns0:DATE><ns0:EXTREFNUM>f386fa9c035f435c9d41a0e556d8d112</ns0:EXTREFNUM><ns0:TXNID>R170314.1619.140056</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 3370</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
2017-03-14 16:22:27,154 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-14 16:22:27,152 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 16:22:27,153 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>14/03/17 16:19:50</ns0:DATE><ns0:EXTREFNUM>f386fa9c035f435c9d41a0e556d8d112</ns0:EXTREFNUM><ns0:TXNID>R170314.1619.140056</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 3370</ns0:MESSAGE></ns0:COMMAND>

2017-03-14 16:22:27,153 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-14 16:22:27,154 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-14 16:22:27,154 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-14 16:22:27,155 = handlers.result_handler.AirtimeHandler - DEBUG - 14/03/17 16:19:50
2017-03-14 16:22:27,155 = handlers.result_handler.AirtimeHandler - DEBUG - f386fa9c035f435c9d41a0e556d8d112
DEBUG:handlers.result_handler.AirtimeHandler:14/03/17 16:19:50
DEBUG:handlers.result_handler.AirtimeHandler:f386fa9c035f435c9d41a0e556d8d112
2017-03-14 16:22:27,155 = handlers.result_handler.AirtimeHandler - DEBUG - 14/03/17 16:19:50
2017-03-14 16:22:27,155 = handlers.result_handler.AirtimeHandler - DEBUG - f386fa9c035f435c9d41a0e556d8d112
2017-03-14 16:22:27,156 = handlers.result_handler.AirtimeHandler - DEBUG - R170314.1619.140056
DEBUG:handlers.result_handler.AirtimeHandler:R170314.1619.140056
2017-03-14 16:22:27,156 = handlers.result_handler.AirtimeHandler - DEBUG - R170314.1619.140056
2017-03-14 16:22:27,156 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'14/03/17 16:19:50', 'amount': '10', 'external_ref': u'R170314.1619.140056', 'msisdn_2': u'721799582', 'internal_ref': u'f386fa9c035f435c9d41a0e556d8d112'}
2017-03-14 16:22:27,156 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'14/03/17 16:19:50', 'amount': '10', 'external_ref': u'R170314.1619.140056', 'msisdn_2': u'721799582', 'internal_ref': u'f386fa9c035f435c9d41a0e556d8d112'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'14/03/17 16:19:50', 'amount': '10', 'external_ref': u'R170314.1619.140056', 'msisdn_2': u'721799582', 'internal_ref': u'f386fa9c035f435c9d41a0e556d8d112'}
2017-03-14 16:22:27,156 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-14 16:22:27,156 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-14 16:22:27,267 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-14 16:22:27,267 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-14 16:22:27,270 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-14 16:22:27,270 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-14 16:22:27,273 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-14 16:22:27,274 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-14 16:22:27,275 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-14 16:22:27,276 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-14 16:22:27,279 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-14 16:22:27,280 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-14 16:22:27,283 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-14 16:22:27,283 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-14 16:22:27,286 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-14 16:22:27,286 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-14 16:22:27,289 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-14 16:22:27,289 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-14 16:22:27,293 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-14 16:22:27,293 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-14 16:22:27,295 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-14 16:22:27,295 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-14 16:22:27,301 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f9ffb853190>
2017-03-14 16:22:27,301 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-14 16:22:27,301 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-14 16:22:27,301 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 721799582
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-14 16:22:27,301 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-14 16:22:27,301 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-14 16:22:27,301 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 721799582
2017-03-14 16:22:27,301 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-14 16:22:27,301 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 3
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 3
2017-03-14 16:22:27,302 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-14 16:22:27,301 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 3
2017-03-14 16:22:27,302 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-14 16:22:27,302 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-14 16:22:27,302 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-14 16:22:27,302 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-14 16:22:27,302 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-14 16:22:28,589 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":119,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-14T13:19:51.860002Z"}
2017-03-14 16:22:28,589 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":119,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-14T13:19:51.860002Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":119,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-14T13:19:51.860002Z"}
2017-03-14 16:22:28,589 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-14 16:22:28,589 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-14 16:22:28,590 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":119,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-14T13:19:51.860002Z"}
2017-03-14 16:22:28,590 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":119,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-14T13:19:51.860002Z"}
2017-03-14 16:22:28,590 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:{"id":119,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-14T13:19:51.860002Z"}
2017-03-14 16:22:28,590 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-14 16:22:28,590 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-14 16:22:28,590 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-14 16:22:28,591 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-14 16:22:28,591 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-14 16:22:28,591 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-14 16:22:28,591 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-14 16:22:28,591 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "", "destination_mobile_number": "721799582", "user": 3, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-14 16:22:28,591 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "", "destination_mobile_number": "721799582", "user": 3, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "", "destination_mobile_number": "721799582", "user": 3, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-14 16:22:28,592 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-14 16:22:28,592 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-14 16:22:29,669 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-14 16:22:29,669 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-14 16:22:29,670 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":89,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":1000.0,"payment_method":1,"note":"","bundle":null,"account_number":null}
2017-03-14 16:22:29,670 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"id":89,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":1000.0,"payment_method":1,"note":"","bundle":null,"account_number":null}
2017-03-14 16:22:29,670 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":89,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":1000.0,"payment_method":1,"note":"","bundle":null,"account_number":null}
2017-03-14 16:22:29,670 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-14 16:22:29,670 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
2017-03-14 16:22:29,670 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": "LC323322"}
2017-03-14 16:22:30,814 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-14 16:22:30,814 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-14 16:22:30,815 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
2017-03-14 16:22:30,815 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-14 16:22:30,816 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-14 16:22:30,816 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4546.79ms
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"status": 1, "message": "Transaction not found"}
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 4546.79ms
2017-03-14 16:22:30,815 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
{"status": 1, "message": "Transaction not found"}
2017-03-14 16:22:30,815 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-14 16:22:30,816 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-14 16:22:30,816 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4546.79ms
2017-03-14 16:45:23,784 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.76ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.76ms
2017-03-14 16:45:23,784 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.76ms
2017-03-14 18:16:33,632 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.45ms
WARNING:tornado.access:404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.45ms
2017-03-14 18:16:33,632 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.45ms
2017-03-14 18:34:32,496 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.45ms
WARNING:tornado.access:404 GET http://www.google.com/ (91.236.75.4) 0.45ms
2017-03-14 18:34:32,496 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.45ms
2017-03-14 18:55:07,978 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/10000/-------------------
2017-03-14 18:55:07,978 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-14 18:55:07,979 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 18:55:07
2017-03-14 18:55:07,979 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-14 18:55:07,979 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-14 18:55:07,979 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 96415fc460ca4d018fb9259da732597a
2017-03-14 18:55:07,979 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-14 18:55:07,980 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-14 18:55:07,980 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 18:55:07</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>96415fc460ca4d018fb9259da732597a</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 18:55:07,980 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-14 18:55:07,980 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-14 18:55:07,981 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 18:55:07</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>96415fc460ca4d018fb9259da732597a</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 18:55:07,981 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/10000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 14/03/2017 18:55:07
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 96415fc460ca4d018fb9259da732597a
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 18:55:07</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>96415fc460ca4d018fb9259da732597a</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 18:55:07</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>96415fc460ca4d018fb9259da732597a</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-14 18:55:07,978 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/10000/-------------------
2017-03-14 18:55:07,978 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-14 18:55:07,979 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 18:55:07
2017-03-14 18:55:07,979 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-14 18:55:07,979 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-14 18:55:07,979 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 96415fc460ca4d018fb9259da732597a
2017-03-14 18:55:07,979 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-14 18:55:07,980 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-14 18:55:07,980 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 18:55:07</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>96415fc460ca4d018fb9259da732597a</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 18:55:07,980 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-14 18:55:07,980 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-14 18:55:07,981 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 18:55:07</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>96415fc460ca4d018fb9259da732597a</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 18:55:07,981 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-14 18:55:11,888 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 18:55:11,888 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-14 18:55:11,889 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>14/03/17 18:52:34</ns0:DATE><ns0:EXTREFNUM>96415fc460ca4d018fb9259da732597a</ns0:EXTREFNUM><ns0:TXNID>R170314.1852.140043</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 100 to 720384396 is successful. Your new balance is KSH 3270</ns0:MESSAGE></ns0:COMMAND>

2017-03-14 18:55:11,889 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>14/03/17 18:52:34</ns0:DATE><ns0:EXTREFNUM>96415fc460ca4d018fb9259da732597a</ns0:EXTREFNUM><ns0:TXNID>R170314.1852.140043</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 100 to 720384396 is successful. Your new balance is KSH 3270</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>14/03/17 18:52:34</ns0:DATE><ns0:EXTREFNUM>96415fc460ca4d018fb9259da732597a</ns0:EXTREFNUM><ns0:TXNID>R170314.1852.140043</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 100 to 720384396 is successful. Your new balance is KSH 3270</ns0:MESSAGE></ns0:COMMAND>

2017-03-14 18:55:11,890 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-14 18:55:11,890 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-14 18:55:11,891 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------100-----------------------
2017-03-14 18:55:11,891 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------100-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------100-----------------------
2017-03-14 18:55:11,892 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-14 18:55:11,892 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-14 18:55:11,893 = handlers.result_handler.AirtimeHandler - DEBUG - 14/03/17 18:52:34
2017-03-14 18:55:11,893 = handlers.result_handler.AirtimeHandler - DEBUG - 14/03/17 18:52:34
DEBUG:handlers.result_handler.AirtimeHandler:14/03/17 18:52:34
2017-03-14 18:55:11,893 = handlers.result_handler.AirtimeHandler - DEBUG - 96415fc460ca4d018fb9259da732597a
2017-03-14 18:55:11,893 = handlers.result_handler.AirtimeHandler - DEBUG - 96415fc460ca4d018fb9259da732597a
DEBUG:handlers.result_handler.AirtimeHandler:96415fc460ca4d018fb9259da732597a
2017-03-14 18:55:11,894 = handlers.result_handler.AirtimeHandler - DEBUG - R170314.1852.140043
2017-03-14 18:55:11,894 = handlers.result_handler.AirtimeHandler - DEBUG - R170314.1852.140043
DEBUG:handlers.result_handler.AirtimeHandler:R170314.1852.140043
2017-03-14 18:55:11,895 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'14/03/17 18:52:34', 'amount': '100', 'external_ref': u'R170314.1852.140043', 'msisdn_2': u'254720384396', 'internal_ref': u'96415fc460ca4d018fb9259da732597a'}
2017-03-14 18:55:11,895 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'14/03/17 18:52:34', 'amount': '100', 'external_ref': u'R170314.1852.140043', 'msisdn_2': u'254720384396', 'internal_ref': u'96415fc460ca4d018fb9259da732597a'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'14/03/17 18:52:34', 'amount': '100', 'external_ref': u'R170314.1852.140043', 'msisdn_2': u'254720384396', 'internal_ref': u'96415fc460ca4d018fb9259da732597a'}
2017-03-14 18:55:11,895 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-14 18:55:11,895 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-14 18:55:11,946 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-14 18:55:11,947 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-14 18:55:11,953 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-14 18:55:11,953 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-14 18:55:11,959 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-14 18:55:11,959 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-14 18:55:11,963 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-14 18:55:11,963 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-14 18:55:11,968 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-14 18:55:11,969 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-14 18:55:11,973 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-14 18:55:11,973 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-14 18:55:11,976 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-14 18:55:11,976 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-14 18:55:11,979 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-14 18:55:11,979 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-14 18:55:11,984 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-14 18:55:11,985 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-14 18:55:11,987 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-14 18:55:11,987 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f9ffb80a550>
2017-03-14 18:55:11,996 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-14 18:55:11,996 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-14 18:55:11,997 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-14 18:55:11,997 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-14 18:55:11,998 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 100 of airtime from Saiba  to 254720384396
2017-03-14 18:55:11,998 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 100 of airtime from Saiba  to 254720384396
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 100 of airtime from Saiba  to 254720384396
2017-03-14 18:55:11,999 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-14 18:55:11,999 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-14 18:55:11,999 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 100 of airtime from Saiba  to 8
2017-03-14 18:55:11,999 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 100 of airtime from Saiba  to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 100 of airtime from Saiba  to 8
2017-03-14 18:55:12,000 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 100 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-14 18:55:12,000 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 100 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 100 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-14 18:55:12,000 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-14 18:55:12,000 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-14 18:55:12,001 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 100 of airtime from Saiba 
2017-03-14 18:55:12,001 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 100 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 100 of airtime from Saiba 
2017-03-14 18:55:13,200 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":129,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 100 of airtime from Saiba","image_url":"","date":"2017-03-14T15:52:36.180083Z"}
2017-03-14 18:55:13,200 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":129,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 100 of airtime from Saiba","image_url":"","date":"2017-03-14T15:52:36.180083Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":129,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 100 of airtime from Saiba","image_url":"","date":"2017-03-14T15:52:36.180083Z"}
2017-03-14 18:55:13,201 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-14 18:55:13,201 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-14 18:55:13,201 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":129,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 100 of airtime from Saiba","image_url":"","date":"2017-03-14T15:52:36.180083Z"}
2017-03-14 18:55:13,201 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":129,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 100 of airtime from Saiba","image_url":"","date":"2017-03-14T15:52:36.180083Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":129,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 100 of airtime from Saiba","image_url":"","date":"2017-03-14T15:52:36.180083Z"}
2017-03-14 18:55:13,202 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-14 18:55:13,202 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-14 18:55:13,202 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-14 18:55:13,202 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-14 18:55:13,203 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-14 18:55:13,203 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-14 18:55:13,203 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-14 18:55:13,203 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-14 18:55:13,204 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "Buying for myself", "destination_mobile_number": "254720384396", "user": 8, "transaction_status": 1, "payment_method": 4, "receipt_number": "null", "service_type_id": 1, "amount": "10000", "service_provider_id": 1}
2017-03-14 18:55:13,204 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "Buying for myself", "destination_mobile_number": "254720384396", "user": 8, "transaction_status": 1, "payment_method": 4, "receipt_number": "null", "service_type_id": 1, "amount": "10000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "Buying for myself", "destination_mobile_number": "254720384396", "user": 8, "transaction_status": 1, "payment_method": 4, "receipt_number": "null", "service_type_id": 1, "amount": "10000", "service_provider_id": 1}
2017-03-14 18:55:13,205 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-14 18:55:13,205 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-14 18:55:14,444 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-14 18:55:14,444 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-14 18:55:14,446 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-14 18:55:14,446 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-14 18:55:14,446 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-14 18:55:14,446 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-14 18:55:14,447 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-14 18:55:14,447 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-14 18:55:14,448 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 6470.11ms
2017-03-14 18:55:14,448 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 6470.11ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 6470.11ms
2017-03-14 18:56:22,867 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/10000/-------------------
2017-03-14 18:56:22,867 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/10000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/10000/-------------------
2017-03-14 18:56:22,868 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-14 18:56:22,868 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-14 18:56:22,868 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 18:56:22
2017-03-14 18:56:22,868 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 18:56:22
2017-03-14 18:56:22,868 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-14 18:56:22,869 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-14 18:56:22,869 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 650901af2ef649f09879355553ddf14e
2017-03-14 18:56:22,869 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 14/03/2017 18:56:22
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 650901af2ef649f09879355553ddf14e
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-14 18:56:22,868 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-14 18:56:22,869 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-14 18:56:22,869 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 650901af2ef649f09879355553ddf14e
2017-03-14 18:56:22,869 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-14 18:56:22,870 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-14 18:56:22,870 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 18:56:22</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>650901af2ef649f09879355553ddf14e</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 18:56:22,871 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-14 18:56:22,871 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-14 18:56:22,871 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 18:56:22</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>650901af2ef649f09879355553ddf14e</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 18:56:22,872 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 18:56:22</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>650901af2ef649f09879355553ddf14e</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 18:56:22</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>650901af2ef649f09879355553ddf14e</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-14 18:56:22,870 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-14 18:56:22,870 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 18:56:22</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>650901af2ef649f09879355553ddf14e</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 18:56:22,871 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-14 18:56:22,871 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-14 18:56:22,871 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 18:56:22</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>650901af2ef649f09879355553ddf14e</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 18:56:22,872 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-14 18:56:23,466 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 18:56:23,466 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 18:56:23,467 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>14/03/17 18:53:46</ns0:DATE><ns0:EXTREFNUM>650901af2ef649f09879355553ddf14e</ns0:EXTREFNUM><ns0:TXNID>R170314.1853.140057</ns0:TXNID><ns0:MESSAGE>The mobile number 720384396 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-14 18:56:23,467 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>14/03/17 18:53:46</ns0:DATE><ns0:EXTREFNUM>650901af2ef649f09879355553ddf14e</ns0:EXTREFNUM><ns0:TXNID>R170314.1853.140057</ns0:TXNID><ns0:MESSAGE>The mobile number 720384396 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-14 18:56:23,467 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>14/03/17 18:53:46</ns0:DATE><ns0:EXTREFNUM>650901af2ef649f09879355553ddf14e</ns0:EXTREFNUM><ns0:TXNID>R170314.1853.140057</ns0:TXNID><ns0:MESSAGE>The mobile number 720384396 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-14 18:56:23,467 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-14 18:56:23,467 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-14 18:56:23,467 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-14 18:56:23,467 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-14 18:56:23,467 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-14 18:56:23,468 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-14 18:56:23,468 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 8
2017-03-14 18:56:23,468 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:sending message could not complete your request at this time please try again later to 8
2017-03-14 18:56:23,468 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "8", "title": "Safaricom  Airtime"}
2017-03-14 18:56:23,468 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "could not complete your request at this time please try again later", "user": "8", "title": "Safaricom  Airtime"}
2017-03-14 18:56:23,468 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-14 18:56:23,468 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-14 18:56:23,468 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
DEBUG:handlers.result_handler.AirtimeHandler:could not complete your request at this time please try again later
2017-03-14 18:56:24,580 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":130,"user":8,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-14T15:53:47.562227Z"}
2017-03-14 18:56:24,580 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":130,"user":8,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-14T15:53:47.562227Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":130,"user":8,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-14T15:53:47.562227Z"}
2017-03-14 18:56:24,580 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-14 18:56:24,580 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-14 18:56:24,581 = handlers.result_handler.AirtimeHandler - DEBUG - https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-14 18:56:24,581 = handlers.result_handler.AirtimeHandler - DEBUG - https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-14 18:56:24,581 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token b9d30f778501df2e3af8797fb931cee7820671e3'}
2017-03-14 18:56:24,581 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token b9d30f778501df2e3af8797fb931cee7820671e3'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token b9d30f778501df2e3af8797fb931cee7820671e3'}
2017-03-14 18:56:24,581 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "10000", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-14 18:56:24,581 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "10000", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "10000", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-14 18:56:24,634 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-14 18:56:24,634 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-14 18:56:24,634 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":10000.0,"balance":10000.0}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"user":8,"user_credit_type":1,"debit":0.0,"credit":10000.0,"balance":10000.0}
2017-03-14 18:56:24,634 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-14 18:56:24,634 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":10000.0,"balance":10000.0}
{"user":8,"user_credit_type":1,"debit":0.0,"credit":10000.0,"balance":10000.0}
2017-03-14 18:56:24,634 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-14 18:56:24,634 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-14 18:56:24,634 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-14 18:56:24,635 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 1768.77ms
2017-03-14 18:56:24,635 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 1768.77ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 1768.77ms
2017-03-14 19:03:13,138 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-14 19:03:13,139 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-14 19:03:13,139 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 19:03:13
2017-03-14 19:03:13,138 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-14 19:03:13,139 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-14 19:03:13,139 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/5000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 14/03/2017 19:03:13
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-14 19:03:13,140 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = db6e7329a51c4c87bff2e4f2752d228d
2017-03-14 19:03:13,139 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-14 19:03:13,139 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 19:03:13
2017-03-14 19:03:13,139 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-14 19:03:13,139 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-14 19:03:13,140 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = db6e7329a51c4c87bff2e4f2752d228d
2017-03-14 19:03:13,140 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-14 19:03:13,140 = handlers.result_handler.AirtimeHandler - INFO - Building XML
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = db6e7329a51c4c87bff2e4f2752d228d
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-14 19:03:13,140 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-14 19:03:13,140 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-14 19:03:13,140 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 19:03:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>db6e7329a51c4c87bff2e4f2752d228d</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 19:03:13,140 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 19:03:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>db6e7329a51c4c87bff2e4f2752d228d</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 19:03:13,141 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 19:03:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>db6e7329a51c4c87bff2e4f2752d228d</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-14 19:03:13,141 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-14 19:03:13,141 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 19:03:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>db6e7329a51c4c87bff2e4f2752d228d</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 19:03:13,141 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-14 19:03:13,141 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-14 19:03:13,141 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 19:03:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>db6e7329a51c4c87bff2e4f2752d228d</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 19:03:13,141 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 19:03:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>db6e7329a51c4c87bff2e4f2752d228d</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-14 19:03:13,141 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-14 19:03:14,043 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 19:03:14,043 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 19:03:14,043 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>14/03/17 19:00:36</ns0:DATE><ns0:EXTREFNUM>db6e7329a51c4c87bff2e4f2752d228d</ns0:EXTREFNUM><ns0:TXNID>R170314.1900.140043</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 702935200 is successful. Your new balance is KSH 3220</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-14 19:03:14,044 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-14 19:03:14,043 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>14/03/17 19:00:36</ns0:DATE><ns0:EXTREFNUM>db6e7329a51c4c87bff2e4f2752d228d</ns0:EXTREFNUM><ns0:TXNID>R170314.1900.140043</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 702935200 is successful. Your new balance is KSH 3220</ns0:MESSAGE></ns0:COMMAND>

2017-03-14 19:03:14,044 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-14 19:03:14,044 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>14/03/17 19:00:36</ns0:DATE><ns0:EXTREFNUM>db6e7329a51c4c87bff2e4f2752d228d</ns0:EXTREFNUM><ns0:TXNID>R170314.1900.140043</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 702935200 is successful. Your new balance is KSH 3220</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-14 19:03:14,044 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-14 19:03:14,044 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
2017-03-14 19:03:14,044 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------50-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-14 19:03:14,045 = handlers.result_handler.AirtimeHandler - DEBUG - 14/03/17 19:00:36
2017-03-14 19:03:14,045 = handlers.result_handler.AirtimeHandler - DEBUG - 14/03/17 19:00:36
2017-03-14 19:03:14,045 = handlers.result_handler.AirtimeHandler - DEBUG - db6e7329a51c4c87bff2e4f2752d228d
DEBUG:handlers.result_handler.AirtimeHandler:14/03/17 19:00:36
DEBUG:handlers.result_handler.AirtimeHandler:db6e7329a51c4c87bff2e4f2752d228d
2017-03-14 19:03:14,045 = handlers.result_handler.AirtimeHandler - DEBUG - db6e7329a51c4c87bff2e4f2752d228d
2017-03-14 19:03:14,045 = handlers.result_handler.AirtimeHandler - DEBUG - R170314.1900.140043
2017-03-14 19:03:14,045 = handlers.result_handler.AirtimeHandler - DEBUG - R170314.1900.140043
DEBUG:handlers.result_handler.AirtimeHandler:R170314.1900.140043
2017-03-14 19:03:14,046 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'14/03/17 19:00:36', 'amount': '50', 'external_ref': u'R170314.1900.140043', 'msisdn_2': u'254702935200', 'internal_ref': u'db6e7329a51c4c87bff2e4f2752d228d'}
2017-03-14 19:03:14,046 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'14/03/17 19:00:36', 'amount': '50', 'external_ref': u'R170314.1900.140043', 'msisdn_2': u'254702935200', 'internal_ref': u'db6e7329a51c4c87bff2e4f2752d228d'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'14/03/17 19:00:36', 'amount': '50', 'external_ref': u'R170314.1900.140043', 'msisdn_2': u'254702935200', 'internal_ref': u'db6e7329a51c4c87bff2e4f2752d228d'}
2017-03-14 19:03:14,046 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-14 19:03:14,046 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-14 19:03:14,090 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-14 19:03:14,091 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-14 19:03:14,094 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-14 19:03:14,095 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-14 19:03:14,099 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-14 19:03:14,100 INFO sqlalchemy.engine.base.Engine {}
2017-03-14 19:03:14,102 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-14 19:03:14,102 INFO sqlalchemy.engine.base.Engine {}
2017-03-14 19:03:14,106 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-14 19:03:14,107 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-14 19:03:14,109 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-14 19:03:14,109 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-14 19:03:14,111 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-14 19:03:14,111 INFO sqlalchemy.engine.base.Engine {'table': 23559}
2017-03-14 19:03:14,114 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-14 19:03:14,114 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-14 19:03:14,118 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-14 19:03:14,118 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-14 19:03:14,120 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-14 19:03:14,120 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f9ffb5b6910>
2017-03-14 19:03:14,126 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-14 19:03:14,126 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-14 19:03:14,126 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-14 19:03:14,126 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-14 19:03:14,127 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254702935200
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-14 19:03:14,127 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254702935200
2017-03-14 19:03:14,127 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254702935200
2017-03-14 19:03:14,127 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-14 19:03:14,127 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-14 19:03:14,127 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 8
2017-03-14 19:03:14,128 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-14 19:03:14,128 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 8
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-14 19:03:14,128 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-14 19:03:14,128 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-14 19:03:14,128 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 50 of airtime from Saiba 
2017-03-14 19:03:14,128 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 50 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 50 of airtime from Saiba 
2017-03-14 19:03:15,088 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":133,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-14T16:00:38.054081Z"}
2017-03-14 19:03:15,088 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":133,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-14T16:00:38.054081Z"}
2017-03-14 19:03:15,094 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:{"id":133,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-14T16:00:38.054081Z"}
2017-03-14 19:03:15,094 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-14 19:03:15,094 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":133,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-14T16:00:38.054081Z"}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:{"id":133,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-14T16:00:38.054081Z"}
2017-03-14 19:03:15,095 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-14 19:03:15,094 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":133,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-14T16:00:38.054081Z"}
2017-03-14 19:03:15,095 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-14 19:03:15,095 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-14 19:03:15,095 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-14 19:03:15,095 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-14 19:03:15,095 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-14 19:03:15,095 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-14 19:03:15,095 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-14 19:03:15,095 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254702935200", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
2017-03-14 19:03:15,096 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:null
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:{"note": null, "destination_mobile_number": "254702935200", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
2017-03-14 19:03:15,095 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254702935200", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
2017-03-14 19:03:15,096 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-14 19:03:16,321 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-14 19:03:16,322 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-14 19:03:16,321 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-14 19:03:16,322 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-14 19:03:16,323 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-14 19:03:16,323 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-14 19:03:16,323 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-14 19:03:16,323 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-14 19:03:16,324 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3186.48ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3186.48ms
2017-03-14 19:03:16,324 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3186.48ms
2017-03-14 19:17:31,349 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-14 19:17:31,349 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/2000/-------------------
2017-03-14 19:17:31,350 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-14 19:17:31,350 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-14 19:17:31,350 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 19:17:31
2017-03-14 19:17:31,350 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 14/03/2017 19:17:31
2017-03-14 19:17:31,350 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-14 19:17:31,351 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-14 19:17:31,351 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 5d614e189c434739b52f2f6c2c9a5aaf
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 14/03/2017 19:17:31
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 5d614e189c434739b52f2f6c2c9a5aaf
2017-03-14 19:17:31,350 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-14 19:17:31,351 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-14 19:17:31,351 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 5d614e189c434739b52f2f6c2c9a5aaf
2017-03-14 19:17:31,351 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-14 19:17:31,352 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-14 19:17:31,353 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 19:17:31</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5d614e189c434739b52f2f6c2c9a5aaf</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 19:17:31,353 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-14 19:17:31,353 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-14 19:17:31,353 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 19:17:31</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5d614e189c434739b52f2f6c2c9a5aaf</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 19:17:31,354 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 19:17:31</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5d614e189c434739b52f2f6c2c9a5aaf</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 19:17:31</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5d614e189c434739b52f2f6c2c9a5aaf</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-14 19:17:31,351 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-14 19:17:31,352 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-14 19:17:31,353 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 19:17:31</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5d614e189c434739b52f2f6c2c9a5aaf</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 19:17:31,353 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-14 19:17:31,353 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-14 19:17:31,353 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>14/03/2017 19:17:31</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5d614e189c434739b52f2f6c2c9a5aaf</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-14 19:17:31,354 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-14 19:17:32,244 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 19:17:32,244 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>14/03/17 19:14:55</ns0:DATE><ns0:EXTREFNUM>5d614e189c434739b52f2f6c2c9a5aaf</ns0:EXTREFNUM><ns0:TXNID>R170314.1914.140066</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 702935200 is successful. Your new balance is KSH 3200</ns0:MESSAGE></ns0:COMMAND>

2017-03-14 19:17:32,245 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-14 19:17:32,245 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------20-----------------------
2017-03-14 19:17:32,245 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-14 19:17:32,246 = handlers.result_handler.AirtimeHandler - DEBUG - 14/03/17 19:14:55
2017-03-14 19:17:32,246 = handlers.result_handler.AirtimeHandler - DEBUG - 5d614e189c434739b52f2f6c2c9a5aaf
2017-03-14 19:17:32,246 = handlers.result_handler.AirtimeHandler - DEBUG - R170314.1914.140066
2017-03-14 19:17:32,247 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'14/03/17 19:14:55', 'amount': '20', 'external_ref': u'R170314.1914.140066', 'msisdn_2': u'254702935200', 'internal_ref': u'5d614e189c434739b52f2f6c2c9a5aaf'}
2017-03-14 19:17:32,247 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>14/03/17 19:14:55</ns0:DATE><ns0:EXTREFNUM>5d614e189c434739b52f2f6c2c9a5aaf</ns0:EXTREFNUM><ns0:TXNID>R170314.1914.140066</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 702935200 is successful. Your new balance is KSH 3200</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------20-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:14/03/17 19:14:55
DEBUG:handlers.result_handler.AirtimeHandler:5d614e189c434739b52f2f6c2c9a5aaf
DEBUG:handlers.result_handler.AirtimeHandler:R170314.1914.140066
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'14/03/17 19:14:55', 'amount': '20', 'external_ref': u'R170314.1914.140066', 'msisdn_2': u'254702935200', 'internal_ref': u'5d614e189c434739b52f2f6c2c9a5aaf'}
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-14 19:17:32,244 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-14 19:17:32,244 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>14/03/17 19:14:55</ns0:DATE><ns0:EXTREFNUM>5d614e189c434739b52f2f6c2c9a5aaf</ns0:EXTREFNUM><ns0:TXNID>R170314.1914.140066</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 702935200 is successful. Your new balance is KSH 3200</ns0:MESSAGE></ns0:COMMAND>

2017-03-14 19:17:32,245 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-14 19:17:32,245 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------20-----------------------
2017-03-14 19:17:32,245 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-14 19:17:32,246 = handlers.result_handler.AirtimeHandler - DEBUG - 14/03/17 19:14:55
2017-03-14 19:17:32,246 = handlers.result_handler.AirtimeHandler - DEBUG - 5d614e189c434739b52f2f6c2c9a5aaf
2017-03-14 19:17:32,246 = handlers.result_handler.AirtimeHandler - DEBUG - R170314.1914.140066
2017-03-14 19:17:32,247 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'14/03/17 19:14:55', 'amount': '20', 'external_ref': u'R170314.1914.140066', 'msisdn_2': u'254702935200', 'internal_ref': u'5d614e189c434739b52f2f6c2c9a5aaf'}
2017-03-14 19:17:32,247 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-14 19:17:32,303 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-14 19:17:32,304 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-14 19:17:32,308 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-14 19:17:32,308 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-14 19:17:32,312 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-14 19:17:32,314 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-14 19:17:32,319 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-14 19:17:32,321 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-14 19:17:32,327 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-14 19:17:32,328 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-14 19:17:32,331 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-14 19:17:32,332 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-14 19:17:32,335 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-14 19:17:32,336 INFO sqlalchemy.engine.base.Engine {'table': 23559}
2017-03-14 19:17:32,339 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-14 19:17:32,339 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-14 19:17:32,343 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-14 19:17:32,343 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-14 19:17:32,345 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-14 19:17:32,345 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-14 19:17:32,353 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f9ffb5c4310>
2017-03-14 19:17:32,353 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-14 19:17:32,353 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-14 19:17:32,353 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-14 19:17:32,354 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 20 of airtime from Saiba  to 254702935200
2017-03-14 19:17:32,354 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 20 of airtime from Saiba  to 254702935200
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 20 of airtime from Saiba  to 254702935200
2017-03-14 19:17:32,354 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-14 19:17:32,354 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-14 19:17:32,355 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 20 of airtime from Saiba  to 8
2017-03-14 19:17:32,355 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 20 of airtime from Saiba  to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 20 of airtime from Saiba  to 8
2017-03-14 19:17:32,355 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 20 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-14 19:17:32,355 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 20 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 20 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-14 19:17:32,355 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-14 19:17:32,355 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-14 19:17:32,355 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 20 of airtime from Saiba 
2017-03-14 19:17:32,355 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 20 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 20 of airtime from Saiba 
2017-03-14 19:17:33,552 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":139,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-14T16:14:56.492675Z"}
2017-03-14 19:17:33,552 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":139,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-14T16:14:56.492675Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":139,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-14T16:14:56.492675Z"}
2017-03-14 19:17:33,555 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-14 19:17:33,555 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-14 19:17:33,556 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":139,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-14T16:14:56.492675Z"}
2017-03-14 19:17:33,556 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":139,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-14T16:14:56.492675Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":139,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-14T16:14:56.492675Z"}
2017-03-14 19:17:33,556 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-14 19:17:33,556 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-14 19:17:33,556 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-14 19:17:33,556 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-14 19:17:33,557 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-14 19:17:33,557 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-14 19:17:33,557 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-14 19:17:33,557 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-14 19:17:33,557 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254702935200", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "2000", "service_provider_id": 1}
2017-03-14 19:17:33,557 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254702935200", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "2000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": null, "destination_mobile_number": "254702935200", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "2000", "service_provider_id": 1}
2017-03-14 19:17:33,558 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-14 19:17:33,558 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-14 19:17:34,783 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
2017-03-14 19:17:34,783 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-14 19:17:34,784 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-14 19:17:34,784 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-14 19:17:34,784 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-14 19:17:34,784 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-14 19:17:34,785 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-14 19:17:34,785 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-14 19:17:34,786 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3436.79ms
2017-03-14 19:17:34,786 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3436.79ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3436.79ms
2017-03-14 19:50:16,779 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.52ms
2017-03-14 19:50:16,779 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.52ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.52ms
2017-03-14 19:52:29,023 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.77ms
2017-03-14 19:52:29,023 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.77ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.77ms
2017-03-14 20:15:04,945 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (180.150.187.155) 0.48ms
WARNING:tornado.access:404 GET http://www.baidu.com/favicon.ico (180.150.187.155) 0.48ms
2017-03-14 20:15:04,945 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (180.150.187.155) 0.48ms
2017-03-14 23:34:19,541 = tornado.access - WARNING - 404 GET / (203.109.205.82) 0.49ms
WARNING:tornado.access:404 GET / (203.109.205.82) 0.49ms
2017-03-14 23:34:19,541 = tornado.access - WARNING - 404 GET / (203.109.205.82) 0.49ms
2017-03-15 01:49:21,190 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (103.37.145.235) 0.63ms
WARNING:tornado.access:404 GET http://www.baidu.com/favicon.ico (103.37.145.235) 0.63ms
2017-03-15 01:49:21,190 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (103.37.145.235) 0.63ms
2017-03-15 03:24:11,854 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.83.40) 0.54ms
WARNING:tornado.access:404 GET http://www.baidu.com/favicon.ico (123.59.83.40) 0.54ms
2017-03-15 03:24:11,854 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.83.40) 0.54ms
2017-03-15 04:19:41,381 = tornado.access - WARNING - 404 GET / (81.215.198.127) 0.49ms
WARNING:tornado.access:404 GET / (81.215.198.127) 0.49ms
2017-03-15 04:19:41,381 = tornado.access - WARNING - 404 GET / (81.215.198.127) 0.49ms
2017-03-15 04:37:19,500 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.45ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.45ms
2017-03-15 04:37:19,500 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.45ms
2017-03-15 10:19:19,581 = tornado.access - WARNING - 404 GET / (27.105.104.2) 0.71ms
WARNING:tornado.access:404 GET / (27.105.104.2) 0.71ms
2017-03-15 10:19:19,581 = tornado.access - WARNING - 404 GET / (27.105.104.2) 0.71ms
2017-03-15 10:32:54,936 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-15 10:32:54,936 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-15 10:32:54,937 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 15/03/2017 10:32:54
2017-03-15 10:32:54,937 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-15 10:32:54,937 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-15 10:32:54,938 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = eaa22a3e170d4f40a935602285b794fb
2017-03-15 10:32:54,938 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-15 10:32:54,938 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-15 10:32:54,938 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 10:32:54</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>eaa22a3e170d4f40a935602285b794fb</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 10:32:54,939 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-15 10:32:54,939 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-15 10:32:54,939 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 10:32:54</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>eaa22a3e170d4f40a935602285b794fb</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 10:32:54,939 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/5000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 15/03/2017 10:32:54
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = eaa22a3e170d4f40a935602285b794fb
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 10:32:54</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>eaa22a3e170d4f40a935602285b794fb</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 10:32:54</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>eaa22a3e170d4f40a935602285b794fb</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-15 10:32:54,936 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-15 10:32:54,936 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-15 10:32:54,937 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 15/03/2017 10:32:54
2017-03-15 10:32:54,937 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-15 10:32:54,937 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-15 10:32:54,938 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = eaa22a3e170d4f40a935602285b794fb
2017-03-15 10:32:54,938 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-15 10:32:54,938 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-15 10:32:54,938 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 10:32:54</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>eaa22a3e170d4f40a935602285b794fb</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 10:32:54,939 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-15 10:32:54,939 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-15 10:32:54,939 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 10:32:54</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>eaa22a3e170d4f40a935602285b794fb</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 10:32:54,939 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-15 10:32:56,264 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-15 10:32:56,265 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>15/03/17 10:30:16</ns0:DATE><ns0:EXTREFNUM>eaa22a3e170d4f40a935602285b794fb</ns0:EXTREFNUM><ns0:TXNID>R170315.1030.140018</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 720384396 is successful. Your new balance is KSH 3150</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>15/03/17 10:30:16</ns0:DATE><ns0:EXTREFNUM>eaa22a3e170d4f40a935602285b794fb</ns0:EXTREFNUM><ns0:TXNID>R170315.1030.140018</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 720384396 is successful. Your new balance is KSH 3150</ns0:MESSAGE></ns0:COMMAND>

2017-03-15 10:32:56,264 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-15 10:32:56,265 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>15/03/17 10:30:16</ns0:DATE><ns0:EXTREFNUM>eaa22a3e170d4f40a935602285b794fb</ns0:EXTREFNUM><ns0:TXNID>R170315.1030.140018</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 720384396 is successful. Your new balance is KSH 3150</ns0:MESSAGE></ns0:COMMAND>

2017-03-15 10:32:56,265 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-15 10:32:56,265 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
2017-03-15 10:32:56,266 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-15 10:32:56,266 = handlers.result_handler.AirtimeHandler - DEBUG - 15/03/17 10:30:16
2017-03-15 10:32:56,266 = handlers.result_handler.AirtimeHandler - DEBUG - eaa22a3e170d4f40a935602285b794fb
2017-03-15 10:32:56,266 = handlers.result_handler.AirtimeHandler - DEBUG - R170315.1030.140018
2017-03-15 10:32:56,266 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'15/03/17 10:30:16', 'amount': '50', 'external_ref': u'R170315.1030.140018', 'msisdn_2': u'254720384396', 'internal_ref': u'eaa22a3e170d4f40a935602285b794fb'}
2017-03-15 10:32:56,267 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------50-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:15/03/17 10:30:16
DEBUG:handlers.result_handler.AirtimeHandler:eaa22a3e170d4f40a935602285b794fb
DEBUG:handlers.result_handler.AirtimeHandler:R170315.1030.140018
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'15/03/17 10:30:16', 'amount': '50', 'external_ref': u'R170315.1030.140018', 'msisdn_2': u'254720384396', 'internal_ref': u'eaa22a3e170d4f40a935602285b794fb'}
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-15 10:32:56,265 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-15 10:32:56,265 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
2017-03-15 10:32:56,266 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-15 10:32:56,266 = handlers.result_handler.AirtimeHandler - DEBUG - 15/03/17 10:30:16
2017-03-15 10:32:56,266 = handlers.result_handler.AirtimeHandler - DEBUG - eaa22a3e170d4f40a935602285b794fb
2017-03-15 10:32:56,266 = handlers.result_handler.AirtimeHandler - DEBUG - R170315.1030.140018
2017-03-15 10:32:56,266 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'15/03/17 10:30:16', 'amount': '50', 'external_ref': u'R170315.1030.140018', 'msisdn_2': u'254720384396', 'internal_ref': u'eaa22a3e170d4f40a935602285b794fb'}
2017-03-15 10:32:56,267 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-15 10:32:56,310 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-15 10:32:56,310 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-15 10:32:56,315 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-15 10:32:56,316 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 10:32:56,322 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-15 10:32:56,323 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-15 10:32:56,326 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-15 10:32:56,326 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-15 10:32:56,331 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-15 10:32:56,332 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 10:32:56,335 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-15 10:32:56,335 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 10:32:56,338 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-15 10:32:56,338 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-15 10:32:56,341 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-15 10:32:56,341 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 10:32:56,346 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-15 10:32:56,347 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 10:32:56,349 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-15 10:32:56,349 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f9ffb7f8ad0>
2017-03-15 10:32:56,357 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-15 10:32:56,357 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-15 10:32:56,358 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-15 10:32:56,358 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-15 10:32:56,359 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254720384396
2017-03-15 10:32:56,359 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254720384396
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254720384396
2017-03-15 10:32:56,359 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-15 10:32:56,359 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-15 10:32:56,360 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 15
2017-03-15 10:32:56,360 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 15
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 15
2017-03-15 10:32:56,360 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "15", "title": "Safaricom  Airtime"}
2017-03-15 10:32:56,360 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "15", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "15", "title": "Safaricom  Airtime"}
2017-03-15 10:32:56,361 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-15 10:32:56,361 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-15 10:32:56,361 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 50 of airtime from Saiba 
2017-03-15 10:32:56,361 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 50 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 50 of airtime from Saiba 
2017-03-15 10:32:58,042 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":154,"user":15,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T10:30:19.252729+03:00"}
2017-03-15 10:32:58,042 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":154,"user":15,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T10:30:19.252729+03:00"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":154,"user":15,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T10:30:19.252729+03:00"}
2017-03-15 10:32:58,043 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-15 10:32:58,043 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-15 10:32:58,044 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":154,"user":15,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T10:30:19.252729+03:00"}
2017-03-15 10:32:58,044 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":154,"user":15,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T10:30:19.252729+03:00"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":154,"user":15,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T10:30:19.252729+03:00"}
2017-03-15 10:32:58,044 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-15 10:32:58,044 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-15 10:32:58,045 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-15 10:32:58,045 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-15 10:32:58,045 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-15 10:32:58,045 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-15 10:32:58,046 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-15 10:32:58,046 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-15 10:32:58,046 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254720384396", "user": 15, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
2017-03-15 10:32:58,046 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254720384396", "user": 15, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": null, "destination_mobile_number": "254720384396", "user": 15, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
2017-03-15 10:32:58,046 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-15 10:32:58,046 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-15 10:32:59,181 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
2017-03-15 10:32:59,181 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-15 10:32:59,182 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-15 10:32:59,182 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-15 10:32:59,184 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-15 10:32:59,184 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-15 10:32:59,185 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-15 10:32:59,185 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-15 10:32:59,186 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4250.75ms
2017-03-15 10:32:59,186 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4250.75ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 4250.75ms
2017-03-15 11:02:53,818 = tornado.access - WARNING - 404 GET /phpmyadmin (113.200.200.40) 0.64ms
WARNING:tornado.access:404 GET /phpmyadmin (113.200.200.40) 0.64ms
2017-03-15 11:02:53,818 = tornado.access - WARNING - 404 GET /phpmyadmin (113.200.200.40) 0.64ms
2017-03-15 11:03:46,461 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-15 11:03:46,461 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/5000/-------------------
2017-03-15 11:03:46,461 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-15 11:03:46,461 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-15 11:03:46,462 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 15/03/2017 11:03:46
2017-03-15 11:03:46,462 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 15/03/2017 11:03:46
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 15/03/2017 11:03:46
2017-03-15 11:03:46,462 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-15 11:03:46,462 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-15 11:03:46,462 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-15 11:03:46,462 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-15 11:03:46,463 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 2ce6b9dcc5594f7c933bade2bf84d376
2017-03-15 11:03:46,463 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 2ce6b9dcc5594f7c933bade2bf84d376
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 2ce6b9dcc5594f7c933bade2bf84d376
2017-03-15 11:03:46,463 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-15 11:03:46,463 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-15 11:03:46,463 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-15 11:03:46,463 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-15 11:03:46,463 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 11:03:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2ce6b9dcc5594f7c933bade2bf84d376</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 11:03:46,463 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 11:03:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2ce6b9dcc5594f7c933bade2bf84d376</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 11:03:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2ce6b9dcc5594f7c933bade2bf84d376</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 11:03:46,464 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-15 11:03:46,464 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-15 11:03:46,464 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-15 11:03:46,464 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-15 11:03:46,464 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 11:03:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2ce6b9dcc5594f7c933bade2bf84d376</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 11:03:46,464 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 11:03:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2ce6b9dcc5594f7c933bade2bf84d376</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 11:03:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2ce6b9dcc5594f7c933bade2bf84d376</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 11:03:46,464 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-15 11:03:46,464 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-15 11:03:49,876 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-15 11:03:49,877 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>15/03/17 11:01:10</ns0:DATE><ns0:EXTREFNUM>2ce6b9dcc5594f7c933bade2bf84d376</ns0:EXTREFNUM><ns0:TXNID>R170315.1101.140010</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 721799582 is successful. Your new balance is KSH 3100</ns0:MESSAGE></ns0:COMMAND>

2017-03-15 11:03:49,877 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-15 11:03:49,878 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>15/03/17 11:01:10</ns0:DATE><ns0:EXTREFNUM>2ce6b9dcc5594f7c933bade2bf84d376</ns0:EXTREFNUM><ns0:TXNID>R170315.1101.140010</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 721799582 is successful. Your new balance is KSH 3100</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-15 11:03:49,876 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-15 11:03:49,877 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>15/03/17 11:01:10</ns0:DATE><ns0:EXTREFNUM>2ce6b9dcc5594f7c933bade2bf84d376</ns0:EXTREFNUM><ns0:TXNID>R170315.1101.140010</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 721799582 is successful. Your new balance is KSH 3100</ns0:MESSAGE></ns0:COMMAND>

2017-03-15 11:03:49,877 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-15 11:03:49,878 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
2017-03-15 11:03:49,879 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-15 11:03:49,879 = handlers.result_handler.AirtimeHandler - DEBUG - 15/03/17 11:01:10
2017-03-15 11:03:49,879 = handlers.result_handler.AirtimeHandler - DEBUG - 2ce6b9dcc5594f7c933bade2bf84d376
2017-03-15 11:03:49,880 = handlers.result_handler.AirtimeHandler - DEBUG - R170315.1101.140010
2017-03-15 11:03:49,880 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'15/03/17 11:01:10', 'amount': '50', 'external_ref': u'R170315.1101.140010', 'msisdn_2': u'0721799582', 'internal_ref': u'2ce6b9dcc5594f7c933bade2bf84d376'}
2017-03-15 11:03:49,880 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------50-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:15/03/17 11:01:10
DEBUG:handlers.result_handler.AirtimeHandler:2ce6b9dcc5594f7c933bade2bf84d376
DEBUG:handlers.result_handler.AirtimeHandler:R170315.1101.140010
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'15/03/17 11:01:10', 'amount': '50', 'external_ref': u'R170315.1101.140010', 'msisdn_2': u'0721799582', 'internal_ref': u'2ce6b9dcc5594f7c933bade2bf84d376'}
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-15 11:03:49,879 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-15 11:03:49,879 = handlers.result_handler.AirtimeHandler - DEBUG - 15/03/17 11:01:10
2017-03-15 11:03:49,879 = handlers.result_handler.AirtimeHandler - DEBUG - 2ce6b9dcc5594f7c933bade2bf84d376
2017-03-15 11:03:49,880 = handlers.result_handler.AirtimeHandler - DEBUG - R170315.1101.140010
2017-03-15 11:03:49,880 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'15/03/17 11:01:10', 'amount': '50', 'external_ref': u'R170315.1101.140010', 'msisdn_2': u'0721799582', 'internal_ref': u'2ce6b9dcc5594f7c933bade2bf84d376'}
2017-03-15 11:03:49,880 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-15 11:03:49,926 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-15 11:03:49,927 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-15 11:03:49,931 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-15 11:03:49,932 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 11:03:49,936 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-15 11:03:49,937 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-15 11:03:49,939 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-15 11:03:49,939 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-15 11:03:49,944 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-15 11:03:49,945 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 11:03:49,947 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-15 11:03:49,948 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 11:03:49,950 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-15 11:03:49,951 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-15 11:03:49,953 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-15 11:03:49,954 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 11:03:49,958 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-15 11:03:49,958 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 11:03:49,961 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-15 11:03:49,961 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f9ffb5e27d0>
2017-03-15 11:03:49,968 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-15 11:03:49,968 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-15 11:03:49,969 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-15 11:03:49,969 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-15 11:03:49,969 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 0721799582
2017-03-15 11:03:49,969 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 0721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 0721799582
2017-03-15 11:03:49,970 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-15 11:03:49,970 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-15 11:03:49,971 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 3
2017-03-15 11:03:49,971 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 3
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 3
2017-03-15 11:03:49,972 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-15 11:03:49,972 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-15 11:03:49,972 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-15 11:03:49,972 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-15 11:03:49,973 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 50 of airtime from Saiba 
2017-03-15 11:03:49,973 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 50 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 50 of airtime from Saiba 
2017-03-15 11:03:51,259 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":155,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T11:01:12.411189+03:00"}
2017-03-15 11:03:51,259 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":155,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T11:01:12.411189+03:00"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":155,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T11:01:12.411189+03:00"}
2017-03-15 11:03:51,260 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-15 11:03:51,260 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-15 11:03:51,260 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":155,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T11:01:12.411189+03:00"}
2017-03-15 11:03:51,260 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":155,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T11:01:12.411189+03:00"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":155,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T11:01:12.411189+03:00"}
2017-03-15 11:03:51,261 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-15 11:03:51,261 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-15 11:03:51,261 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-15 11:03:51,261 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-15 11:03:51,262 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-15 11:03:51,262 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-15 11:03:51,262 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-15 11:03:51,262 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-15 11:03:51,263 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "", "destination_mobile_number": "0721799582", "user": 3, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
2017-03-15 11:03:51,263 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "", "destination_mobile_number": "0721799582", "user": 3, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "", "destination_mobile_number": "0721799582", "user": 3, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
2017-03-15 11:03:51,263 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-15 11:03:51,263 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-15 11:03:52,426 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-15 11:03:52,426 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-15 11:03:52,427 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":105,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"0721799582","request":null,"amount":5000.0,"payment_method":1,"note":"","bundle":null,"account_number":null}
2017-03-15 11:03:52,427 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":105,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"0721799582","request":null,"amount":5000.0,"payment_method":1,"note":"","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":105,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"0721799582","request":null,"amount":5000.0,"payment_method":1,"note":"","bundle":null,"account_number":null}
2017-03-15 11:03:52,428 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-15 11:03:52,428 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-15 11:03:52,428 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
2017-03-15 11:03:52,428 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": "LC323322"}
2017-03-15 11:03:53,576 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-15 11:03:53,576 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-15 11:03:53,577 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
2017-03-15 11:03:53,577 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
DEBUG:handlers.result_handler.AirtimeHandler:{"status": 1, "message": "Transaction not found"}
{"status": 1, "message": "Transaction not found"}
2017-03-15 11:03:53,577 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-15 11:03:53,577 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-15 11:03:53,578 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-15 11:03:53,578 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-15 11:03:53,579 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 7118.93ms
2017-03-15 11:03:53,579 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 7118.93ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 7118.93ms
2017-03-15 11:07:11,480 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.76ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.76ms
2017-03-15 11:07:11,480 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.76ms
2017-03-15 12:11:34,440 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-15 12:11:34,441 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-15 12:11:34,441 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 15/03/2017 12:11:34
2017-03-15 12:11:34,441 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-15 12:11:34,442 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-15 12:11:34,442 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 18069746fc25415b9cd0740760e7f963
2017-03-15 12:11:34,442 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-15 12:11:34,442 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-15 12:11:34,442 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 12:11:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>18069746fc25415b9cd0740760e7f963</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 12:11:34,443 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-15 12:11:34,443 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-15 12:11:34,443 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 12:11:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>18069746fc25415b9cd0740760e7f963</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 12:11:34,443 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 15/03/2017 12:11:34
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 18069746fc25415b9cd0740760e7f963
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 12:11:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>18069746fc25415b9cd0740760e7f963</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 12:11:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>18069746fc25415b9cd0740760e7f963</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-15 12:11:34,440 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-15 12:11:34,441 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-15 12:11:34,441 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 15/03/2017 12:11:34
2017-03-15 12:11:34,441 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-15 12:11:34,442 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-15 12:11:34,442 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 18069746fc25415b9cd0740760e7f963
2017-03-15 12:11:34,442 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-15 12:11:34,442 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-15 12:11:34,442 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 12:11:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>18069746fc25415b9cd0740760e7f963</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 12:11:34,443 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-15 12:11:34,443 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-15 12:11:34,443 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 12:11:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>18069746fc25415b9cd0740760e7f963</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 12:11:34,443 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-15 12:11:36,686 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-15 12:11:36,686 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>15/03/17 12:08:57</ns0:DATE><ns0:EXTREFNUM>18069746fc25415b9cd0740760e7f963</ns0:EXTREFNUM><ns0:TXNID>R170315.1208.140049</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 721799582 is successful. Your new balance is KSH 3095</ns0:MESSAGE></ns0:COMMAND>

2017-03-15 12:11:36,686 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-15 12:11:36,687 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
2017-03-15 12:11:36,687 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-15 12:11:36,687 = handlers.result_handler.AirtimeHandler - DEBUG - 15/03/17 12:08:57
2017-03-15 12:11:36,687 = handlers.result_handler.AirtimeHandler - DEBUG - 18069746fc25415b9cd0740760e7f963
2017-03-15 12:11:36,687 = handlers.result_handler.AirtimeHandler - DEBUG - R170315.1208.140049
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>15/03/17 12:08:57</ns0:DATE><ns0:EXTREFNUM>18069746fc25415b9cd0740760e7f963</ns0:EXTREFNUM><ns0:TXNID>R170315.1208.140049</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 721799582 is successful. Your new balance is KSH 3095</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------5-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:15/03/17 12:08:57
DEBUG:handlers.result_handler.AirtimeHandler:18069746fc25415b9cd0740760e7f963
DEBUG:handlers.result_handler.AirtimeHandler:R170315.1208.140049
2017-03-15 12:11:36,686 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-15 12:11:36,686 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>15/03/17 12:08:57</ns0:DATE><ns0:EXTREFNUM>18069746fc25415b9cd0740760e7f963</ns0:EXTREFNUM><ns0:TXNID>R170315.1208.140049</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 721799582 is successful. Your new balance is KSH 3095</ns0:MESSAGE></ns0:COMMAND>

2017-03-15 12:11:36,686 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-15 12:11:36,687 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
2017-03-15 12:11:36,687 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-15 12:11:36,687 = handlers.result_handler.AirtimeHandler - DEBUG - 15/03/17 12:08:57
2017-03-15 12:11:36,687 = handlers.result_handler.AirtimeHandler - DEBUG - 18069746fc25415b9cd0740760e7f963
2017-03-15 12:11:36,687 = handlers.result_handler.AirtimeHandler - DEBUG - R170315.1208.140049
2017-03-15 12:11:36,688 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'15/03/17 12:08:57', 'amount': '5', 'external_ref': u'R170315.1208.140049', 'msisdn_2': u'0721799582', 'internal_ref': u'18069746fc25415b9cd0740760e7f963'}
2017-03-15 12:11:36,688 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'15/03/17 12:08:57', 'amount': '5', 'external_ref': u'R170315.1208.140049', 'msisdn_2': u'0721799582', 'internal_ref': u'18069746fc25415b9cd0740760e7f963'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'15/03/17 12:08:57', 'amount': '5', 'external_ref': u'R170315.1208.140049', 'msisdn_2': u'0721799582', 'internal_ref': u'18069746fc25415b9cd0740760e7f963'}
2017-03-15 12:11:36,689 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-15 12:11:36,689 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-15 12:11:36,729 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-15 12:11:36,729 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-15 12:11:36,734 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-15 12:11:36,735 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 12:11:36,739 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-15 12:11:36,740 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-15 12:11:36,742 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-15 12:11:36,743 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-15 12:11:36,747 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-15 12:11:36,747 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 12:11:36,750 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-15 12:11:36,751 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 12:11:36,753 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-15 12:11:36,754 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-15 12:11:36,756 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-15 12:11:36,757 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 12:11:36,761 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-15 12:11:36,761 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 12:11:36,763 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-15 12:11:36,763 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f9ffb5d4850>
2017-03-15 12:11:36,769 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-15 12:11:36,769 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-15 12:11:36,770 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-15 12:11:36,770 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-15 12:11:36,770 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 5 of airtime from Saiba  to 0721799582
2017-03-15 12:11:36,770 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 5 of airtime from Saiba  to 0721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 5 of airtime from Saiba  to 0721799582
2017-03-15 12:11:36,771 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-15 12:11:36,771 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-15 12:11:36,771 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 5 of airtime from Saiba  to 3
2017-03-15 12:11:36,771 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 5 of airtime from Saiba  to 3
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 5 of airtime from Saiba  to 3
2017-03-15 12:11:36,771 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 5 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-15 12:11:36,771 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 5 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 5 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-15 12:11:36,772 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-15 12:11:36,772 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-15 12:11:36,772 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 5 of airtime from Saiba 
2017-03-15 12:11:36,772 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 5 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 5 of airtime from Saiba 
2017-03-15 12:11:38,007 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":160,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-15T12:08:59.025762Z"}
2017-03-15 12:11:38,007 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":160,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-15T12:08:59.025762Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":160,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-15T12:08:59.025762Z"}
2017-03-15 12:11:38,008 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-15 12:11:38,008 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-15 12:11:38,009 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":160,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-15T12:08:59.025762Z"}
2017-03-15 12:11:38,009 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":160,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-15T12:08:59.025762Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":160,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-15T12:08:59.025762Z"}
2017-03-15 12:11:38,009 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-15 12:11:38,009 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-15 12:11:38,010 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-15 12:11:38,010 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-15 12:11:38,011 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-15 12:11:38,011 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-15 12:11:38,011 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-15 12:11:38,011 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-15 12:11:38,012 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "", "destination_mobile_number": "0721799582", "user": 3, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "500", "service_provider_id": 1}
2017-03-15 12:11:38,012 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "", "destination_mobile_number": "0721799582", "user": 3, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "500", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "", "destination_mobile_number": "0721799582", "user": 3, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "500", "service_provider_id": 1}
2017-03-15 12:11:38,013 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-15 12:11:38,013 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-15 12:11:38,090 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-15 12:11:38,090 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-15 12:11:38,092 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":106,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"0721799582","request":null,"amount":500.0,"payment_method":1,"note":"","bundle":null,"account_number":null}
2017-03-15 12:11:38,092 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":106,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"0721799582","request":null,"amount":500.0,"payment_method":1,"note":"","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":106,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"0721799582","request":null,"amount":500.0,"payment_method":1,"note":"","bundle":null,"account_number":null}
2017-03-15 12:11:38,092 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-15 12:11:38,092 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-15 12:11:38,093 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
2017-03-15 12:11:38,093 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": "LC323322"}
2017-03-15 12:11:39,430 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 500: Internal Server Error
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 297, in nullify_transaction_number
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 500: Internal Server Error
2017-03-15 12:11:39,430 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 500: Internal Server Error
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 297, in nullify_transaction_number
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 500: Internal Server Error
ERROR:handlers.result_handler.AirtimeHandler:HTTP 500: Internal Server Error
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 297, in nullify_transaction_number
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 500: Internal Server Error
2017-03-15 12:11:39,431 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-15 12:11:39,431 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-15 12:11:39,432 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4992.56ms
2017-03-15 12:11:39,432 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4992.56ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 4992.56ms
2017-03-15 12:15:33,046 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-15 12:15:33,046 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-15 12:15:33,046 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 15/03/2017 12:15:33
2017-03-15 12:15:33,047 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-15 12:15:33,047 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/5000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 15/03/2017 12:15:33
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-15 12:15:33,046 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-15 12:15:33,046 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-15 12:15:33,046 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 15/03/2017 12:15:33
2017-03-15 12:15:33,047 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-15 12:15:33,047 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-15 12:15:33,047 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 723e374930294031a547e79645938825
2017-03-15 12:15:33,047 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 723e374930294031a547e79645938825
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 723e374930294031a547e79645938825
2017-03-15 12:15:33,048 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-15 12:15:33,048 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-15 12:15:33,048 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-15 12:15:33,048 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-15 12:15:33,048 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 12:15:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>723e374930294031a547e79645938825</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 12:15:33,048 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 12:15:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>723e374930294031a547e79645938825</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 12:15:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>723e374930294031a547e79645938825</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 12:15:33,049 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-15 12:15:33,049 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-15 12:15:33,049 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-15 12:15:33,049 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-15 12:15:33,049 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 12:15:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>723e374930294031a547e79645938825</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 12:15:33,049 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 12:15:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>723e374930294031a547e79645938825</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 12:15:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>723e374930294031a547e79645938825</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 12:15:33,049 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-15 12:15:33,049 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-15 12:15:33,997 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-15 12:15:33,997 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-15 12:15:33,998 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>15/03/17 12:12:54</ns0:DATE><ns0:EXTREFNUM>723e374930294031a547e79645938825</ns0:EXTREFNUM><ns0:TXNID>R170315.1212.140058</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 720384396 is successful. Your new balance is KSH 3045</ns0:MESSAGE></ns0:COMMAND>

2017-03-15 12:15:33,998 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>15/03/17 12:12:54</ns0:DATE><ns0:EXTREFNUM>723e374930294031a547e79645938825</ns0:EXTREFNUM><ns0:TXNID>R170315.1212.140058</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 720384396 is successful. Your new balance is KSH 3045</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>15/03/17 12:12:54</ns0:DATE><ns0:EXTREFNUM>723e374930294031a547e79645938825</ns0:EXTREFNUM><ns0:TXNID>R170315.1212.140058</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 720384396 is successful. Your new balance is KSH 3045</ns0:MESSAGE></ns0:COMMAND>

2017-03-15 12:15:33,998 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-15 12:15:33,998 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-15 12:15:33,998 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
2017-03-15 12:15:33,998 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------50-----------------------
2017-03-15 12:15:33,999 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-15 12:15:33,999 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-15 12:15:33,999 = handlers.result_handler.AirtimeHandler - DEBUG - 15/03/17 12:12:54
2017-03-15 12:15:33,999 = handlers.result_handler.AirtimeHandler - DEBUG - 15/03/17 12:12:54
DEBUG:handlers.result_handler.AirtimeHandler:15/03/17 12:12:54
2017-03-15 12:15:33,999 = handlers.result_handler.AirtimeHandler - DEBUG - 723e374930294031a547e79645938825
2017-03-15 12:15:33,999 = handlers.result_handler.AirtimeHandler - DEBUG - 723e374930294031a547e79645938825
DEBUG:handlers.result_handler.AirtimeHandler:723e374930294031a547e79645938825
2017-03-15 12:15:33,999 = handlers.result_handler.AirtimeHandler - DEBUG - R170315.1212.140058
2017-03-15 12:15:33,999 = handlers.result_handler.AirtimeHandler - DEBUG - R170315.1212.140058
DEBUG:handlers.result_handler.AirtimeHandler:R170315.1212.140058
2017-03-15 12:15:33,999 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'15/03/17 12:12:54', 'amount': '50', 'external_ref': u'R170315.1212.140058', 'msisdn_2': u'254720384396', 'internal_ref': u'723e374930294031a547e79645938825'}
2017-03-15 12:15:33,999 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'15/03/17 12:12:54', 'amount': '50', 'external_ref': u'R170315.1212.140058', 'msisdn_2': u'254720384396', 'internal_ref': u'723e374930294031a547e79645938825'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'15/03/17 12:12:54', 'amount': '50', 'external_ref': u'R170315.1212.140058', 'msisdn_2': u'254720384396', 'internal_ref': u'723e374930294031a547e79645938825'}
2017-03-15 12:15:34,000 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-15 12:15:34,000 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-15 12:15:34,039 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-15 12:15:34,039 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-15 12:15:34,042 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 12:15:34,043 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-15 12:15:34,049 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-15 12:15:34,050 INFO sqlalchemy.engine.base.Engine {}
2017-03-15 12:15:34,053 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-15 12:15:34,053 INFO sqlalchemy.engine.base.Engine {}
2017-03-15 12:15:34,057 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-15 12:15:34,057 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 12:15:34,059 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-15 12:15:34,059 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 12:15:34,061 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-15 12:15:34,061 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-15 12:15:34,064 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 12:15:34,064 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-15 12:15:34,068 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-15 12:15:34,068 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 12:15:34,070 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-15 12:15:34,071 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 12:15:34,077 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-15 12:15:34,077 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-15 12:15:34,078 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254720384396
2017-03-15 12:15:34,078 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-15 12:15:34,078 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 13
2017-03-15 12:15:34,078 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "13", "title": "Safaricom  Airtime"}
2017-03-15 12:15:34,079 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-15 12:15:34,079 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 50 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254720384396
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 13
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "13", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 50 of airtime from Saiba 
<sqlalchemy.engine.result.ResultProxy object at 0x7f9ffb5d4210>
2017-03-15 12:15:34,077 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-15 12:15:34,077 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-15 12:15:34,078 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254720384396
2017-03-15 12:15:34,078 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-15 12:15:34,078 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 13
2017-03-15 12:15:34,078 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "13", "title": "Safaricom  Airtime"}
2017-03-15 12:15:34,079 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-15 12:15:34,079 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 50 of airtime from Saiba 
2017-03-15 12:15:34,131 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":161,"user":13,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T12:12:55.141779Z"}
2017-03-15 12:15:34,131 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":161,"user":13,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T12:12:55.141779Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":161,"user":13,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T12:12:55.141779Z"}
2017-03-15 12:15:34,131 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-15 12:15:34,131 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-15 12:15:34,132 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":161,"user":13,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T12:12:55.141779Z"}
2017-03-15 12:15:34,132 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":161,"user":13,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T12:12:55.141779Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":161,"user":13,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T12:12:55.141779Z"}
2017-03-15 12:15:34,132 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-15 12:15:34,132 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-15 12:15:34,132 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-15 12:15:34,132 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-15 12:15:34,132 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-15 12:15:34,132 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-15 12:15:34,133 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-15 12:15:34,133 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-15 12:15:34,133 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254720384396", "user": 13, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
2017-03-15 12:15:34,133 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254720384396", "user": 13, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": null, "destination_mobile_number": "254720384396", "user": 13, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
2017-03-15 12:15:34,133 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-15 12:15:34,133 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-15 12:15:34,204 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
2017-03-15 12:15:34,204 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-15 12:15:34,205 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-15 12:15:34,205 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-15 12:15:34,205 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-15 12:15:34,205 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-15 12:15:34,205 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-15 12:15:34,205 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-15 12:15:34,206 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 1160.86ms
2017-03-15 12:15:34,206 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 1160.86ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 1160.86ms
2017-03-15 12:15:50,800 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-15 12:15:50,800 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-15 12:15:50,800 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-15 12:15:50,800 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-15 12:15:50,800 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 15/03/2017 12:15:50
2017-03-15 12:15:50,800 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 15/03/2017 12:15:50
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 15/03/2017 12:15:50
2017-03-15 12:15:50,801 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-15 12:15:50,801 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-15 12:15:50,801 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-15 12:15:50,801 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-15 12:15:50,801 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 1dae8458dc624453a91e3a0ded178e05
2017-03-15 12:15:50,801 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 1dae8458dc624453a91e3a0ded178e05
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 1dae8458dc624453a91e3a0ded178e05
2017-03-15 12:15:50,802 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-15 12:15:50,802 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-15 12:15:50,802 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-15 12:15:50,802 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-15 12:15:50,802 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 12:15:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1dae8458dc624453a91e3a0ded178e05</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 12:15:50,802 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 12:15:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1dae8458dc624453a91e3a0ded178e05</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 12:15:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1dae8458dc624453a91e3a0ded178e05</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 12:15:50,802 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-15 12:15:50,802 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-15 12:15:50,803 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-15 12:15:50,803 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-15 12:15:50,803 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 12:15:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1dae8458dc624453a91e3a0ded178e05</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 12:15:50,803 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 12:15:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1dae8458dc624453a91e3a0ded178e05</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 12:15:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1dae8458dc624453a91e3a0ded178e05</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 12:15:50,803 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-15 12:15:50,803 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-15 12:15:51,440 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-15 12:15:51,440 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-15 12:15:51,441 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>15/03/17 12:13:12</ns0:DATE><ns0:EXTREFNUM>1dae8458dc624453a91e3a0ded178e05</ns0:EXTREFNUM><ns0:TXNID>R170315.1213.140015</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-15 12:15:51,441 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>15/03/17 12:13:12</ns0:DATE><ns0:EXTREFNUM>1dae8458dc624453a91e3a0ded178e05</ns0:EXTREFNUM><ns0:TXNID>R170315.1213.140015</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-15 12:15:51,441 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>15/03/17 12:13:12</ns0:DATE><ns0:EXTREFNUM>1dae8458dc624453a91e3a0ded178e05</ns0:EXTREFNUM><ns0:TXNID>R170315.1213.140015</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-15 12:15:51,441 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-15 12:15:51,441 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-15 12:15:51,441 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-15 12:15:51,442 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-15 12:15:51,442 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-15 12:15:51,442 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 3
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-15 12:15:51,442 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 3
2017-03-15 12:15:51,442 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "3", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:sending message could not complete your request at this time please try again later to 3
2017-03-15 12:15:51,442 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "3", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "could not complete your request at this time please try again later", "user": "3", "title": "Safaricom  Airtime"}
2017-03-15 12:15:51,442 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-15 12:15:51,442 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-15 12:15:51,442 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
2017-03-15 12:15:51,442 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
DEBUG:handlers.result_handler.AirtimeHandler:could not complete your request at this time please try again later
2017-03-15 12:15:51,619 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":162,"user":3,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-15T12:13:12.634354Z"}
2017-03-15 12:15:51,619 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":162,"user":3,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-15T12:13:12.634354Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":162,"user":3,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-15T12:13:12.634354Z"}
2017-03-15 12:15:51,619 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-15 12:15:51,619 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-15 12:15:51,620 = handlers.result_handler.AirtimeHandler - DEBUG - https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-15 12:15:51,620 = handlers.result_handler.AirtimeHandler - DEBUG - https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-15 12:15:51,620 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token b9d30f778501df2e3af8797fb931cee7820671e3'}
2017-03-15 12:15:51,620 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token b9d30f778501df2e3af8797fb931cee7820671e3'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token b9d30f778501df2e3af8797fb931cee7820671e3'}
2017-03-15 12:15:51,620 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "1000", "user": 3, "user_credit_type": 1, "debit": "0"}
2017-03-15 12:15:51,620 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "1000", "user": 3, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "1000", "user": 3, "user_credit_type": 1, "debit": "0"}
2017-03-15 12:15:51,662 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-15 12:15:51,662 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-15 12:15:51,662 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":3,"user_credit_type":1,"debit":0.0,"credit":1000.0,"balance":19685.0}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"user":3,"user_credit_type":1,"debit":0.0,"credit":1000.0,"balance":19685.0}
2017-03-15 12:15:51,662 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-15 12:15:51,662 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":3,"user_credit_type":1,"debit":0.0,"credit":1000.0,"balance":19685.0}
{"user":3,"user_credit_type":1,"debit":0.0,"credit":1000.0,"balance":19685.0}
2017-03-15 12:15:51,662 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-15 12:15:51,662 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-15 12:15:51,662 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-15 12:15:51,663 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 864.20ms
2017-03-15 12:15:51,663 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 864.20ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 864.20ms
2017-03-15 12:29:11,182 = tornado.access - WARNING - 404 GET / (189.238.151.120) 0.71ms
2017-03-15 12:29:11,182 = tornado.access - WARNING - 404 GET / (189.238.151.120) 0.71ms
WARNING:tornado.access:404 GET / (189.238.151.120) 0.71ms
2017-03-15 13:30:46,809 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/10000/-------------------
2017-03-15 13:30:46,809 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-15 13:30:46,810 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 15/03/2017 13:30:46
2017-03-15 13:30:46,810 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-15 13:30:46,810 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-15 13:30:46,811 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = d82e331593eb4b0191b307a5f5cba346
2017-03-15 13:30:46,811 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-15 13:30:46,811 = handlers.result_handler.AirtimeHandler - INFO - Building XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/10000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 15/03/2017 13:30:46
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = d82e331593eb4b0191b307a5f5cba346
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-15 13:30:46,809 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/10000/-------------------
2017-03-15 13:30:46,809 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-15 13:30:46,810 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 15/03/2017 13:30:46
2017-03-15 13:30:46,810 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-15 13:30:46,810 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-15 13:30:46,811 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = d82e331593eb4b0191b307a5f5cba346
2017-03-15 13:30:46,811 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-15 13:30:46,811 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-15 13:30:46,813 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 13:30:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>d82e331593eb4b0191b307a5f5cba346</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 13:30:46,813 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 13:30:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>d82e331593eb4b0191b307a5f5cba346</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 13:30:46,814 = handlers.result_handler.AirtimeHandler - INFO - Built XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 13:30:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>d82e331593eb4b0191b307a5f5cba346</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 13:30:46,814 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-15 13:30:46,815 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-15 13:30:46,815 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-15 13:30:46,815 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 13:30:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>d82e331593eb4b0191b307a5f5cba346</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 13:30:46,815 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 13:30:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>d82e331593eb4b0191b307a5f5cba346</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 13:30:46,816 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 13:30:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>d82e331593eb4b0191b307a5f5cba346</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 13:30:46,816 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-15 13:30:47,673 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-15 13:30:47,673 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-15 13:30:47,673 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>15/03/17 13:28:08</ns0:DATE><ns0:EXTREFNUM>d82e331593eb4b0191b307a5f5cba346</ns0:EXTREFNUM><ns0:TXNID>R170315.1328.140005</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 100 to 720384396 is successful. Your new balance is KSH 2945</ns0:MESSAGE></ns0:COMMAND>

2017-03-15 13:30:47,673 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>15/03/17 13:28:08</ns0:DATE><ns0:EXTREFNUM>d82e331593eb4b0191b307a5f5cba346</ns0:EXTREFNUM><ns0:TXNID>R170315.1328.140005</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 100 to 720384396 is successful. Your new balance is KSH 2945</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>15/03/17 13:28:08</ns0:DATE><ns0:EXTREFNUM>d82e331593eb4b0191b307a5f5cba346</ns0:EXTREFNUM><ns0:TXNID>R170315.1328.140005</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 100 to 720384396 is successful. Your new balance is KSH 2945</ns0:MESSAGE></ns0:COMMAND>

2017-03-15 13:30:47,674 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-15 13:30:47,674 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-15 13:30:47,674 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------100-----------------------
2017-03-15 13:30:47,675 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-15 13:30:47,675 = handlers.result_handler.AirtimeHandler - DEBUG - 15/03/17 13:28:08
2017-03-15 13:30:47,675 = handlers.result_handler.AirtimeHandler - DEBUG - d82e331593eb4b0191b307a5f5cba346
2017-03-15 13:30:47,675 = handlers.result_handler.AirtimeHandler - DEBUG - R170315.1328.140005
2017-03-15 13:30:47,676 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'15/03/17 13:28:08', 'amount': '100', 'external_ref': u'R170315.1328.140005', 'msisdn_2': u'254720384396', 'internal_ref': u'd82e331593eb4b0191b307a5f5cba346'}
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------100-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:15/03/17 13:28:08
DEBUG:handlers.result_handler.AirtimeHandler:d82e331593eb4b0191b307a5f5cba346
DEBUG:handlers.result_handler.AirtimeHandler:R170315.1328.140005
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'15/03/17 13:28:08', 'amount': '100', 'external_ref': u'R170315.1328.140005', 'msisdn_2': u'254720384396', 'internal_ref': u'd82e331593eb4b0191b307a5f5cba346'}
2017-03-15 13:30:47,674 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------100-----------------------
2017-03-15 13:30:47,675 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-15 13:30:47,675 = handlers.result_handler.AirtimeHandler - DEBUG - 15/03/17 13:28:08
2017-03-15 13:30:47,675 = handlers.result_handler.AirtimeHandler - DEBUG - d82e331593eb4b0191b307a5f5cba346
2017-03-15 13:30:47,675 = handlers.result_handler.AirtimeHandler - DEBUG - R170315.1328.140005
2017-03-15 13:30:47,676 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'15/03/17 13:28:08', 'amount': '100', 'external_ref': u'R170315.1328.140005', 'msisdn_2': u'254720384396', 'internal_ref': u'd82e331593eb4b0191b307a5f5cba346'}
2017-03-15 13:30:47,676 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-15 13:30:47,676 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-15 13:30:47,732 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-15 13:30:47,732 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-15 13:30:47,736 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 13:30:47,736 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-15 13:30:47,742 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-15 13:30:47,742 INFO sqlalchemy.engine.base.Engine {}
2017-03-15 13:30:47,745 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-15 13:30:47,745 INFO sqlalchemy.engine.base.Engine {}
2017-03-15 13:30:47,750 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 13:30:47,750 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-15 13:30:47,753 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 13:30:47,753 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-15 13:30:47,755 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-15 13:30:47,756 INFO sqlalchemy.engine.base.Engine {'table': 23559}
2017-03-15 13:30:47,758 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 13:30:47,759 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-15 13:30:47,762 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 13:30:47,763 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-15 13:30:47,764 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-15 13:30:47,765 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 13:30:47,771 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f9ffb5e2210>
2017-03-15 13:30:47,771 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-15 13:30:47,772 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-15 13:30:47,772 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-15 13:30:47,772 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 100 of airtime from Saiba  to 254720384396
2017-03-15 13:30:47,772 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 100 of airtime from Saiba  to 254720384396
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 100 of airtime from Saiba  to 254720384396
2017-03-15 13:30:47,773 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-15 13:30:47,773 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-15 13:30:47,773 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 100 of airtime from Saiba  to 8
2017-03-15 13:30:47,773 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 100 of airtime from Saiba  to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 100 of airtime from Saiba  to 8
2017-03-15 13:30:47,773 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 100 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-15 13:30:47,773 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 100 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 100 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-15 13:30:47,774 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-15 13:30:47,774 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-15 13:30:47,774 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 100 of airtime from Saiba 
2017-03-15 13:30:47,774 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 100 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 100 of airtime from Saiba 
2017-03-15 13:30:49,146 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":165,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 100 of airtime from Saiba","image_url":"","date":"2017-03-15T13:28:10.015888Z"}
2017-03-15 13:30:49,146 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":165,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 100 of airtime from Saiba","image_url":"","date":"2017-03-15T13:28:10.015888Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":165,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 100 of airtime from Saiba","image_url":"","date":"2017-03-15T13:28:10.015888Z"}
2017-03-15 13:30:49,146 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-15 13:30:49,146 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-15 13:30:49,147 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":165,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 100 of airtime from Saiba","image_url":"","date":"2017-03-15T13:28:10.015888Z"}
2017-03-15 13:30:49,147 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":165,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 100 of airtime from Saiba","image_url":"","date":"2017-03-15T13:28:10.015888Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":165,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 100 of airtime from Saiba","image_url":"","date":"2017-03-15T13:28:10.015888Z"}
2017-03-15 13:30:49,148 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-15 13:30:49,148 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-15 13:30:49,149 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-15 13:30:49,149 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-15 13:30:49,150 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-15 13:30:49,150 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-15 13:30:49,150 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-15 13:30:49,150 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-15 13:30:49,150 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254720384396", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10000", "service_provider_id": 1}
2017-03-15 13:30:49,150 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254720384396", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": null, "destination_mobile_number": "254720384396", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10000", "service_provider_id": 1}
2017-03-15 13:30:49,151 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-15 13:30:49,151 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-15 13:30:50,240 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
2017-03-15 13:30:50,240 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-15 13:30:50,241 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-15 13:30:50,241 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-15 13:30:50,242 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-15 13:30:50,242 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-15 13:30:50,242 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-15 13:30:50,242 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-15 13:30:50,243 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3434.86ms
2017-03-15 13:30:50,243 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3434.86ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3434.86ms
2017-03-15 13:32:23,665 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-15 13:32:23,665 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-15 13:32:23,665 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/5000/-------------------
2017-03-15 13:32:23,665 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-15 13:32:23,666 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 15/03/2017 13:32:23
2017-03-15 13:32:23,666 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 15/03/2017 13:32:23
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 15/03/2017 13:32:23
2017-03-15 13:32:23,666 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-15 13:32:23,666 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-15 13:32:23,666 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-15 13:32:23,666 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-15 13:32:23,667 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 51fb9109d3bf4370abd92983e0bbc873
2017-03-15 13:32:23,667 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 51fb9109d3bf4370abd92983e0bbc873
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 51fb9109d3bf4370abd92983e0bbc873
2017-03-15 13:32:23,667 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-15 13:32:23,667 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-15 13:32:23,667 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-15 13:32:23,667 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-15 13:32:23,668 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 13:32:23</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>51fb9109d3bf4370abd92983e0bbc873</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 13:32:23,668 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 13:32:23</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>51fb9109d3bf4370abd92983e0bbc873</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 13:32:23</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>51fb9109d3bf4370abd92983e0bbc873</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 13:32:23,668 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-15 13:32:23,668 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-15 13:32:23,668 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-15 13:32:23,668 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-15 13:32:23,669 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 13:32:23</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>51fb9109d3bf4370abd92983e0bbc873</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 13:32:23,669 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 13:32:23</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>51fb9109d3bf4370abd92983e0bbc873</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 13:32:23</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>51fb9109d3bf4370abd92983e0bbc873</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 13:32:23,669 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-15 13:32:23,669 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-15 13:32:24,645 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-15 13:32:24,645 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-15 13:32:24,646 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>15/03/17 13:29:45</ns0:DATE><ns0:EXTREFNUM>51fb9109d3bf4370abd92983e0bbc873</ns0:EXTREFNUM><ns0:TXNID>R170315.1329.140038</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 702935200 is successful. Your new balance is KSH 2895</ns0:MESSAGE></ns0:COMMAND>

2017-03-15 13:32:24,646 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>15/03/17 13:29:45</ns0:DATE><ns0:EXTREFNUM>51fb9109d3bf4370abd92983e0bbc873</ns0:EXTREFNUM><ns0:TXNID>R170315.1329.140038</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 702935200 is successful. Your new balance is KSH 2895</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>15/03/17 13:29:45</ns0:DATE><ns0:EXTREFNUM>51fb9109d3bf4370abd92983e0bbc873</ns0:EXTREFNUM><ns0:TXNID>R170315.1329.140038</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 702935200 is successful. Your new balance is KSH 2895</ns0:MESSAGE></ns0:COMMAND>

2017-03-15 13:32:24,646 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-15 13:32:24,646 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-15 13:32:24,646 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
2017-03-15 13:32:24,646 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------50-----------------------
2017-03-15 13:32:24,647 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-15 13:32:24,647 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-15 13:32:24,647 = handlers.result_handler.AirtimeHandler - DEBUG - 15/03/17 13:29:45
2017-03-15 13:32:24,647 = handlers.result_handler.AirtimeHandler - DEBUG - 15/03/17 13:29:45
DEBUG:handlers.result_handler.AirtimeHandler:15/03/17 13:29:45
2017-03-15 13:32:24,647 = handlers.result_handler.AirtimeHandler - DEBUG - 51fb9109d3bf4370abd92983e0bbc873
2017-03-15 13:32:24,647 = handlers.result_handler.AirtimeHandler - DEBUG - 51fb9109d3bf4370abd92983e0bbc873
DEBUG:handlers.result_handler.AirtimeHandler:51fb9109d3bf4370abd92983e0bbc873
2017-03-15 13:32:24,648 = handlers.result_handler.AirtimeHandler - DEBUG - R170315.1329.140038
2017-03-15 13:32:24,648 = handlers.result_handler.AirtimeHandler - DEBUG - R170315.1329.140038
DEBUG:handlers.result_handler.AirtimeHandler:R170315.1329.140038
2017-03-15 13:32:24,648 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'15/03/17 13:29:45', 'amount': '50', 'external_ref': u'R170315.1329.140038', 'msisdn_2': u'254702935200', 'internal_ref': u'51fb9109d3bf4370abd92983e0bbc873'}
2017-03-15 13:32:24,648 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'15/03/17 13:29:45', 'amount': '50', 'external_ref': u'R170315.1329.140038', 'msisdn_2': u'254702935200', 'internal_ref': u'51fb9109d3bf4370abd92983e0bbc873'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'15/03/17 13:29:45', 'amount': '50', 'external_ref': u'R170315.1329.140038', 'msisdn_2': u'254702935200', 'internal_ref': u'51fb9109d3bf4370abd92983e0bbc873'}
2017-03-15 13:32:24,648 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-15 13:32:24,648 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-15 13:32:24,688 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-15 13:32:24,688 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-15 13:32:24,691 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 13:32:24,691 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-15 13:32:24,694 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-15 13:32:24,694 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-15 13:32:24,696 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-15 13:32:24,696 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-15 13:32:24,700 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-15 13:32:24,700 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-15 13:32:24,702 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-15 13:32:24,702 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-15 13:32:24,704 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-15 13:32:24,704 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 13:32:24,706 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-15 13:32:24,706 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-15 13:32:24,710 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-15 13:32:24,710 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 13:32:24,712 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-15 13:32:24,713 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f9ffb5e2cd0>
2017-03-15 13:32:24,719 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-15 13:32:24,719 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-15 13:32:24,720 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-15 13:32:24,720 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-15 13:32:24,720 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254702935200
2017-03-15 13:32:24,720 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254702935200
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254702935200
2017-03-15 13:32:24,721 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-15 13:32:24,721 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-15 13:32:24,722 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 8
2017-03-15 13:32:24,722 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 8
2017-03-15 13:32:24,722 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-15 13:32:24,722 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-15 13:32:24,723 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-15 13:32:24,723 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-15 13:32:24,723 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 50 of airtime from Saiba 
2017-03-15 13:32:24,723 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 50 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 50 of airtime from Saiba 
2017-03-15 13:32:25,936 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":166,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T13:29:46.806269Z"}
2017-03-15 13:32:25,936 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":166,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T13:29:46.806269Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":166,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T13:29:46.806269Z"}
2017-03-15 13:32:25,937 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-15 13:32:25,937 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-15 13:32:25,937 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":166,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T13:29:46.806269Z"}
2017-03-15 13:32:25,937 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":166,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T13:29:46.806269Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":166,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-15T13:29:46.806269Z"}
2017-03-15 13:32:25,938 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-15 13:32:25,938 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-15 13:32:25,938 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-15 13:32:25,938 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-15 13:32:25,938 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-15 13:32:25,938 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-15 13:32:25,939 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-15 13:32:25,939 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-15 13:32:25,939 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254702935200", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
2017-03-15 13:32:25,939 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254702935200", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": null, "destination_mobile_number": "254702935200", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
2017-03-15 13:32:25,940 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-15 13:32:25,940 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-15 13:32:25,981 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-15 13:32:25,981 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-15 13:32:25,982 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-15 13:32:25,982 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-15 13:32:25,983 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-15 13:32:25,983 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-15 13:32:25,983 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-15 13:32:25,983 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-15 13:32:25,985 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2320.05ms
2017-03-15 13:32:25,985 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2320.05ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 2320.05ms
2017-03-15 13:53:29,582 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.50ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.50ms
2017-03-15 13:53:29,582 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.50ms
2017-03-15 15:19:07,515 = tornado.access - WARNING - 404 GET / (185.153.197.210) 0.66ms
2017-03-15 15:19:07,515 = tornado.access - WARNING - 404 GET / (185.153.197.210) 0.66ms
WARNING:tornado.access:404 GET / (185.153.197.210) 0.66ms
2017-03-15 15:19:07,738 = tornado.access - WARNING - 404 GET /HNAP1/ (185.153.197.210) 0.71ms
2017-03-15 15:19:07,738 = tornado.access - WARNING - 404 GET /HNAP1/ (185.153.197.210) 0.71ms
WARNING:tornado.access:404 GET /HNAP1/ (185.153.197.210) 0.71ms
2017-03-15 16:21:59,848 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.48ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.48ms
2017-03-15 16:21:59,848 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.48ms
2017-03-15 17:43:58,764 = tornado.access - WARNING - 404 GET /struts2-showcase/ (149.202.175.8) 0.75ms
WARNING:tornado.access:404 GET /struts2-showcase/ (149.202.175.8) 0.75ms
2017-03-15 17:43:58,764 = tornado.access - WARNING - 404 GET /struts2-showcase/ (149.202.175.8) 0.75ms
2017-03-15 17:44:47,951 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/10000/-------------------
2017-03-15 17:44:47,951 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-15 17:44:47,952 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 15/03/2017 17:44:47
2017-03-15 17:44:47,952 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-15 17:44:47,952 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-15 17:44:47,953 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = eedcbeba12e844bf8d91b9173c930e47
2017-03-15 17:44:47,953 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-15 17:44:47,953 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-15 17:44:47,954 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 17:44:47</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>eedcbeba12e844bf8d91b9173c930e47</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 17:44:47,954 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-15 17:44:47,954 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-15 17:44:47,955 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 17:44:47</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>eedcbeba12e844bf8d91b9173c930e47</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 17:44:47,955 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/10000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 15/03/2017 17:44:47
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = eedcbeba12e844bf8d91b9173c930e47
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 17:44:47</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>eedcbeba12e844bf8d91b9173c930e47</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 17:44:47</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>eedcbeba12e844bf8d91b9173c930e47</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-15 17:44:47,951 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/10000/-------------------
2017-03-15 17:44:47,951 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-15 17:44:47,952 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 15/03/2017 17:44:47
2017-03-15 17:44:47,952 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-15 17:44:47,952 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-15 17:44:47,953 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = eedcbeba12e844bf8d91b9173c930e47
2017-03-15 17:44:47,953 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-15 17:44:47,953 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-15 17:44:47,954 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 17:44:47</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>eedcbeba12e844bf8d91b9173c930e47</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 17:44:47,954 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-15 17:44:47,954 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-15 17:44:47,955 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>15/03/2017 17:44:47</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>eedcbeba12e844bf8d91b9173c930e47</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-15 17:44:47,955 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-15 17:44:48,770 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-15 17:44:48,770 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-15 17:44:48,771 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>15/03/17 17:42:09</ns0:DATE><ns0:EXTREFNUM>eedcbeba12e844bf8d91b9173c930e47</ns0:EXTREFNUM><ns0:TXNID>R170315.1742.140009</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 100 to 702935200 is successful. Your new balance is KSH 2795</ns0:MESSAGE></ns0:COMMAND>

2017-03-15 17:44:48,771 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>15/03/17 17:42:09</ns0:DATE><ns0:EXTREFNUM>eedcbeba12e844bf8d91b9173c930e47</ns0:EXTREFNUM><ns0:TXNID>R170315.1742.140009</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 100 to 702935200 is successful. Your new balance is KSH 2795</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>15/03/17 17:42:09</ns0:DATE><ns0:EXTREFNUM>eedcbeba12e844bf8d91b9173c930e47</ns0:EXTREFNUM><ns0:TXNID>R170315.1742.140009</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 100 to 702935200 is successful. Your new balance is KSH 2795</ns0:MESSAGE></ns0:COMMAND>

2017-03-15 17:44:48,771 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-15 17:44:48,771 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-15 17:44:48,772 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------100-----------------------
2017-03-15 17:44:48,772 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------100-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------100-----------------------
2017-03-15 17:44:48,772 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-15 17:44:48,772 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-15 17:44:48,773 = handlers.result_handler.AirtimeHandler - DEBUG - 15/03/17 17:42:09
2017-03-15 17:44:48,773 = handlers.result_handler.AirtimeHandler - DEBUG - 15/03/17 17:42:09
DEBUG:handlers.result_handler.AirtimeHandler:15/03/17 17:42:09
2017-03-15 17:44:48,773 = handlers.result_handler.AirtimeHandler - DEBUG - eedcbeba12e844bf8d91b9173c930e47
2017-03-15 17:44:48,773 = handlers.result_handler.AirtimeHandler - DEBUG - eedcbeba12e844bf8d91b9173c930e47
DEBUG:handlers.result_handler.AirtimeHandler:eedcbeba12e844bf8d91b9173c930e47
2017-03-15 17:44:48,774 = handlers.result_handler.AirtimeHandler - DEBUG - R170315.1742.140009
2017-03-15 17:44:48,774 = handlers.result_handler.AirtimeHandler - DEBUG - R170315.1742.140009
DEBUG:handlers.result_handler.AirtimeHandler:R170315.1742.140009
2017-03-15 17:44:48,774 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'15/03/17 17:42:09', 'amount': '100', 'external_ref': u'R170315.1742.140009', 'msisdn_2': u'254702935200', 'internal_ref': u'eedcbeba12e844bf8d91b9173c930e47'}
2017-03-15 17:44:48,774 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'15/03/17 17:42:09', 'amount': '100', 'external_ref': u'R170315.1742.140009', 'msisdn_2': u'254702935200', 'internal_ref': u'eedcbeba12e844bf8d91b9173c930e47'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'15/03/17 17:42:09', 'amount': '100', 'external_ref': u'R170315.1742.140009', 'msisdn_2': u'254702935200', 'internal_ref': u'eedcbeba12e844bf8d91b9173c930e47'}
2017-03-15 17:44:48,774 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-15 17:44:48,774 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-15 17:44:48,811 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-15 17:44:48,812 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-15 17:44:48,816 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-15 17:44:48,817 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 17:44:48,821 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-15 17:44:48,821 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-15 17:44:48,823 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-15 17:44:48,824 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-15 17:44:48,828 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-15 17:44:48,828 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 17:44:48,831 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-15 17:44:48,832 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 17:44:48,834 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-15 17:44:48,834 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-15 17:44:48,837 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-15 17:44:48,838 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 17:44:48,841 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-15 17:44:48,842 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-15 17:44:48,844 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-15 17:44:48,844 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f9ffb8699d0>
2017-03-15 17:44:48,850 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-15 17:44:48,850 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-15 17:44:48,851 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-15 17:44:48,851 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-15 17:44:48,852 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 100 of airtime from Saiba  to 254702935200
2017-03-15 17:44:48,852 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 100 of airtime from Saiba  to 254702935200
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 100 of airtime from Saiba  to 254702935200
2017-03-15 17:44:48,853 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-15 17:44:48,853 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-15 17:44:48,854 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 100 of airtime from Saiba  to 8
2017-03-15 17:44:48,854 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 100 of airtime from Saiba  to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 100 of airtime from Saiba  to 8
2017-03-15 17:44:48,854 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 100 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-15 17:44:48,854 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 100 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 100 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-15 17:44:48,855 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-15 17:44:48,855 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-15 17:44:48,856 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 100 of airtime from Saiba 
2017-03-15 17:44:48,856 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 100 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 100 of airtime from Saiba 
2017-03-15 17:44:50,176 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":180,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 100 of airtime from Saiba","image_url":"","date":"2017-03-15T17:42:10.572259Z"}
2017-03-15 17:44:50,176 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":180,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 100 of airtime from Saiba","image_url":"","date":"2017-03-15T17:42:10.572259Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":180,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 100 of airtime from Saiba","image_url":"","date":"2017-03-15T17:42:10.572259Z"}
2017-03-15 17:44:50,178 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-15 17:44:50,178 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-15 17:44:50,178 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":180,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 100 of airtime from Saiba","image_url":"","date":"2017-03-15T17:42:10.572259Z"}
2017-03-15 17:44:50,178 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":180,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 100 of airtime from Saiba","image_url":"","date":"2017-03-15T17:42:10.572259Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":180,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 100 of airtime from Saiba","image_url":"","date":"2017-03-15T17:42:10.572259Z"}
2017-03-15 17:44:50,179 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-15 17:44:50,179 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-15 17:44:50,179 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-15 17:44:50,179 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-15 17:44:50,180 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-15 17:44:50,180 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-15 17:44:50,181 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-15 17:44:50,181 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-15 17:44:50,181 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "Please buy me credit", "destination_mobile_number": "254702935200", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10000", "service_provider_id": 1}
2017-03-15 17:44:50,181 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "Please buy me credit", "destination_mobile_number": "254702935200", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "Please buy me credit", "destination_mobile_number": "254702935200", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10000", "service_provider_id": 1}
2017-03-15 17:44:50,182 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-15 17:44:50,182 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-15 17:44:51,299 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-15 17:44:51,299 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-15 17:44:51,300 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-15 17:44:51,300 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-15 17:44:51,300 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-15 17:44:51,300 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-15 17:44:51,301 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-15 17:44:51,301 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-15 17:44:51,302 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3351.68ms
2017-03-15 17:44:51,302 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3351.68ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3351.68ms
2017-03-15 20:40:24,712 = tornado.access - WARNING - 404 HEAD http://180.163.113.82/check_proxy (180.97.106.161) 0.56ms
WARNING:tornado.access:404 HEAD http://180.163.113.82/check_proxy (180.97.106.161) 0.56ms
2017-03-15 20:40:24,712 = tornado.access - WARNING - 404 HEAD http://180.163.113.82/check_proxy (180.97.106.161) 0.56ms
2017-03-15 21:30:13,881 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.53ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.53ms
2017-03-15 21:30:13,881 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.53ms
2017-03-15 21:30:32,694 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.45ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.45ms
2017-03-15 21:30:32,694 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.45ms
2017-03-15 22:38:26,843 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.47ms
2017-03-15 22:38:26,843 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.47ms
WARNING:tornado.access:404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.47ms
2017-03-16 02:15:19,468 = tornado.access - WARNING - 404 GET / (186.74.221.122) 1.05ms
WARNING:tornado.access:404 GET / (186.74.221.122) 1.05ms
2017-03-16 02:15:19,468 = tornado.access - WARNING - 404 GET / (186.74.221.122) 1.05ms
2017-03-16 03:14:45,596 = tornado.access - WARNING - 404 GET / (117.21.191.103) 0.61ms
WARNING:tornado.access:404 GET / (117.21.191.103) 0.61ms
2017-03-16 03:14:45,596 = tornado.access - WARNING - 404 GET / (117.21.191.103) 0.61ms
2017-03-16 05:12:41,236 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.82.147) 0.48ms
WARNING:tornado.access:404 GET http://www.baidu.com/favicon.ico (123.59.82.147) 0.48ms
2017-03-16 05:12:41,236 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.82.147) 0.48ms
2017-03-16 05:17:23,784 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.55ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.55ms
2017-03-16 05:17:23,784 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.55ms
2017-03-16 06:43:10,359 = tornado.access - WARNING - 404 GET / (122.54.135.15) 0.49ms
WARNING:tornado.access:404 GET / (122.54.135.15) 0.49ms
2017-03-16 06:43:10,359 = tornado.access - WARNING - 404 GET / (122.54.135.15) 0.49ms
2017-03-16 08:24:07,605 = tornado.access - WARNING - 404 GET / (139.162.111.98) 0.53ms
WARNING:tornado.access:404 GET / (139.162.111.98) 0.53ms
2017-03-16 08:24:07,605 = tornado.access - WARNING - 404 GET / (139.162.111.98) 0.53ms
2017-03-16 08:43:07,468 = tornado.access - WARNING - 404 GET / (187.152.143.100) 0.53ms
WARNING:tornado.access:404 GET / (187.152.143.100) 0.53ms
2017-03-16 08:43:07,468 = tornado.access - WARNING - 404 GET / (187.152.143.100) 0.53ms
2017-03-16 09:06:09,205 = tornado.access - WARNING - 404 GET /manager/html (186.232.30.2) 0.65ms
WARNING:tornado.access:404 GET /manager/html (186.232.30.2) 0.65ms
2017-03-16 09:06:09,205 = tornado.access - WARNING - 404 GET /manager/html (186.232.30.2) 0.65ms
2017-03-16 09:10:15,158 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-16 09:10:15,158 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 09:10:15,159 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 09:10:15
2017-03-16 09:10:15,159 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 09:10:15,159 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 09:10:15,159 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 3afe8437e86f48e4bfd4c241449e3dcf
2017-03-16 09:10:15,160 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 09:10:15,160 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 09:10:15,160 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 09:10:15</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3afe8437e86f48e4bfd4c241449e3dcf</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 09:10:15,160 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 09:10:15,160 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 09:10:15,161 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 09:10:15</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3afe8437e86f48e4bfd4c241449e3dcf</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 09:10:15,161 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/5000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 16/03/2017 09:10:15
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 3afe8437e86f48e4bfd4c241449e3dcf
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 09:10:15</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3afe8437e86f48e4bfd4c241449e3dcf</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 09:10:15</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3afe8437e86f48e4bfd4c241449e3dcf</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-16 09:10:15,158 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-16 09:10:15,158 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 09:10:15,159 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 09:10:15
2017-03-16 09:10:15,159 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 09:10:15,159 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 09:10:15,159 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 3afe8437e86f48e4bfd4c241449e3dcf
2017-03-16 09:10:15,160 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 09:10:15,160 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 09:10:15,160 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 09:10:15</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3afe8437e86f48e4bfd4c241449e3dcf</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 09:10:15,160 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 09:10:15,160 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 09:10:15,161 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 09:10:15</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3afe8437e86f48e4bfd4c241449e3dcf</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 09:10:15,161 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 09:10:16,012 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 09:10:16,012 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-16 09:10:16,013 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 09:07:34</ns0:DATE><ns0:EXTREFNUM>3afe8437e86f48e4bfd4c241449e3dcf</ns0:EXTREFNUM><ns0:TXNID>R170316.0907.140036</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 721799582 is successful. Your new balance is KSH 2745</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 09:10:16,013 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 09:07:34</ns0:DATE><ns0:EXTREFNUM>3afe8437e86f48e4bfd4c241449e3dcf</ns0:EXTREFNUM><ns0:TXNID>R170316.0907.140036</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 721799582 is successful. Your new balance is KSH 2745</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 09:07:34</ns0:DATE><ns0:EXTREFNUM>3afe8437e86f48e4bfd4c241449e3dcf</ns0:EXTREFNUM><ns0:TXNID>R170316.0907.140036</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 721799582 is successful. Your new balance is KSH 2745</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 09:10:16,014 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 09:10:16,014 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-16 09:10:16,015 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
2017-03-16 09:10:16,015 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------50-----------------------
2017-03-16 09:10:16,015 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-16 09:10:16,015 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-16 09:10:16,016 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 09:07:34
2017-03-16 09:10:16,016 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 09:07:34
DEBUG:handlers.result_handler.AirtimeHandler:16/03/17 09:07:34
2017-03-16 09:10:16,016 = handlers.result_handler.AirtimeHandler - DEBUG - 3afe8437e86f48e4bfd4c241449e3dcf
2017-03-16 09:10:16,016 = handlers.result_handler.AirtimeHandler - DEBUG - 3afe8437e86f48e4bfd4c241449e3dcf
DEBUG:handlers.result_handler.AirtimeHandler:3afe8437e86f48e4bfd4c241449e3dcf
2017-03-16 09:10:16,017 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.0907.140036
2017-03-16 09:10:16,017 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.0907.140036
DEBUG:handlers.result_handler.AirtimeHandler:R170316.0907.140036
2017-03-16 09:10:16,018 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 09:07:34', 'amount': '50', 'external_ref': u'R170316.0907.140036', 'msisdn_2': u'254721799582', 'internal_ref': u'3afe8437e86f48e4bfd4c241449e3dcf'}
2017-03-16 09:10:16,018 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 09:07:34', 'amount': '50', 'external_ref': u'R170316.0907.140036', 'msisdn_2': u'254721799582', 'internal_ref': u'3afe8437e86f48e4bfd4c241449e3dcf'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'16/03/17 09:07:34', 'amount': '50', 'external_ref': u'R170316.0907.140036', 'msisdn_2': u'254721799582', 'internal_ref': u'3afe8437e86f48e4bfd4c241449e3dcf'}
2017-03-16 09:10:16,018 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-16 09:10:16,018 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-16 09:10:16,058 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-16 09:10:16,059 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-16 09:10:16,062 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-16 09:10:16,063 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 09:10:16,066 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-16 09:10:16,067 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 09:10:16,069 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-16 09:10:16,070 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 09:10:16,074 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-16 09:10:16,074 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 09:10:16,077 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-16 09:10:16,077 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 09:10:16,080 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-16 09:10:16,080 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-16 09:10:16,082 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-16 09:10:16,082 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 09:10:16,086 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-16 09:10:16,086 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 09:10:16,087 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-16 09:10:16,088 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f9ffb8002d0>
2017-03-16 09:10:16,093 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-16 09:10:16,093 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-16 09:10:16,094 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-16 09:10:16,094 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-16 09:10:16,094 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254721799582
2017-03-16 09:10:16,094 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254721799582
2017-03-16 09:10:16,095 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 09:10:16,095 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-16 09:10:16,095 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 3
2017-03-16 09:10:16,095 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 3
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 3
2017-03-16 09:10:16,096 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-16 09:10:16,096 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-16 09:10:16,096 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 09:10:16,096 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-16 09:10:16,096 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 50 of airtime from Saiba 
2017-03-16 09:10:16,096 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 50 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 50 of airtime from Saiba 
2017-03-16 09:10:17,439 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":182,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-16T09:07:36.102922Z"}
2017-03-16 09:10:17,439 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":182,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-16T09:07:36.102922Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":182,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-16T09:07:36.102922Z"}
2017-03-16 09:10:17,440 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-16 09:10:17,440 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-16 09:10:17,441 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":182,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-16T09:07:36.102922Z"}
2017-03-16 09:10:17,441 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":182,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-16T09:07:36.102922Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":182,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-16T09:07:36.102922Z"}
2017-03-16 09:10:17,441 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-16 09:10:17,441 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-16 09:10:17,442 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-16 09:10:17,442 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-16 09:10:17,442 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-16 09:10:17,442 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-16 09:10:17,443 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-16 09:10:17,443 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-16 09:10:17,443 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "TEST 1", "destination_mobile_number": "254721799582", "user": 3, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
2017-03-16 09:10:17,443 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "TEST 1", "destination_mobile_number": "254721799582", "user": 3, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "TEST 1", "destination_mobile_number": "254721799582", "user": 3, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
2017-03-16 09:10:17,443 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-16 09:10:17,443 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-16 09:10:18,573 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 09:10:18,573 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 09:10:18,574 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-16 09:10:18,574 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-16 09:10:18,575 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 09:10:18,575 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 09:10:18,575 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-16 09:10:18,575 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-16 09:10:18,576 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3418.60ms
2017-03-16 09:10:18,576 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3418.60ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3418.60ms
2017-03-16 09:47:56,885 = tornado.access - WARNING - 404 GET / (181.90.67.134) 0.71ms
WARNING:tornado.access:404 GET / (181.90.67.134) 0.71ms
2017-03-16 09:47:56,885 = tornado.access - WARNING - 404 GET / (181.90.67.134) 0.71ms
2017-03-16 10:21:28,662 = tornado.access - WARNING - 404 POST / (110.90.95.163) 0.80ms
WARNING:tornado.access:404 POST / (110.90.95.163) 0.80ms
2017-03-16 10:21:28,662 = tornado.access - WARNING - 404 POST / (110.90.95.163) 0.80ms
2017-03-16 10:54:38,920 = tornado.access - WARNING - 405 CONNECT triennials.com:443 (45.32.90.152) 0.63ms
WARNING:tornado.access:405 CONNECT triennials.com:443 (45.32.90.152) 0.63ms
2017-03-16 10:54:38,920 = tornado.access - WARNING - 405 CONNECT triennials.com:443 (45.32.90.152) 0.63ms
2017-03-16 10:54:39,246 = tornado.access - WARNING - 404 GET http://triennials.com/?q=a3c04598-7b66-470f-8ef1-071c7dcfee8c (64.145.94.203) 1.10ms
WARNING:tornado.access:404 GET http://triennials.com/?q=a3c04598-7b66-470f-8ef1-071c7dcfee8c (64.145.94.203) 1.10ms
2017-03-16 10:54:39,246 = tornado.access - WARNING - 404 GET http://triennials.com/?q=a3c04598-7b66-470f-8ef1-071c7dcfee8c (64.145.94.203) 1.10ms
2017-03-16 12:48:19,283 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-16 12:48:19,283 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 12:48:19,283 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 12:48:19
2017-03-16 12:48:19,284 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 12:48:19,284 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 12:48:19,284 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 595c41b8260a44758717cca2fcc2416b
2017-03-16 12:48:19,284 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 12:48:19,285 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 12:48:19,285 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 12:48:19</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>595c41b8260a44758717cca2fcc2416b</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 12:48:19,285 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 12:48:19,285 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 12:48:19,285 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 12:48:19</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>595c41b8260a44758717cca2fcc2416b</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 12:48:19,286 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/5000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 16/03/2017 12:48:19
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 595c41b8260a44758717cca2fcc2416b
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 12:48:19</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>595c41b8260a44758717cca2fcc2416b</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 12:48:19</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>595c41b8260a44758717cca2fcc2416b</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-16 12:48:19,283 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-16 12:48:19,283 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 12:48:19,283 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 12:48:19
2017-03-16 12:48:19,284 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 12:48:19,284 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 12:48:19,284 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 595c41b8260a44758717cca2fcc2416b
2017-03-16 12:48:19,284 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 12:48:19,285 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 12:48:19,285 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 12:48:19</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>595c41b8260a44758717cca2fcc2416b</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 12:48:19,285 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 12:48:19,285 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 12:48:19,285 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 12:48:19</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>595c41b8260a44758717cca2fcc2416b</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 12:48:19,286 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 12:48:20,116 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 12:48:20,116 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-16 12:48:20,117 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 12:45:38</ns0:DATE><ns0:EXTREFNUM>595c41b8260a44758717cca2fcc2416b</ns0:EXTREFNUM><ns0:TXNID>R170316.1245.140042</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 720384396 is successful. Your new balance is KSH 2695</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 12:48:20,117 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 12:45:38</ns0:DATE><ns0:EXTREFNUM>595c41b8260a44758717cca2fcc2416b</ns0:EXTREFNUM><ns0:TXNID>R170316.1245.140042</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 720384396 is successful. Your new balance is KSH 2695</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 12:45:38</ns0:DATE><ns0:EXTREFNUM>595c41b8260a44758717cca2fcc2416b</ns0:EXTREFNUM><ns0:TXNID>R170316.1245.140042</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 720384396 is successful. Your new balance is KSH 2695</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 12:48:20,118 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 12:48:20,118 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-16 12:48:20,118 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
2017-03-16 12:48:20,118 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------50-----------------------
2017-03-16 12:48:20,119 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-16 12:48:20,119 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-16 12:48:20,120 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 12:45:38
2017-03-16 12:48:20,120 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 12:45:38
DEBUG:handlers.result_handler.AirtimeHandler:16/03/17 12:45:38
2017-03-16 12:48:20,120 = handlers.result_handler.AirtimeHandler - DEBUG - 595c41b8260a44758717cca2fcc2416b
2017-03-16 12:48:20,120 = handlers.result_handler.AirtimeHandler - DEBUG - 595c41b8260a44758717cca2fcc2416b
DEBUG:handlers.result_handler.AirtimeHandler:595c41b8260a44758717cca2fcc2416b
2017-03-16 12:48:20,121 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1245.140042
2017-03-16 12:48:20,121 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1245.140042
DEBUG:handlers.result_handler.AirtimeHandler:R170316.1245.140042
2017-03-16 12:48:20,122 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 12:45:38', 'amount': '50', 'external_ref': u'R170316.1245.140042', 'msisdn_2': u'254720384396', 'internal_ref': u'595c41b8260a44758717cca2fcc2416b'}
2017-03-16 12:48:20,122 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 12:45:38', 'amount': '50', 'external_ref': u'R170316.1245.140042', 'msisdn_2': u'254720384396', 'internal_ref': u'595c41b8260a44758717cca2fcc2416b'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'16/03/17 12:45:38', 'amount': '50', 'external_ref': u'R170316.1245.140042', 'msisdn_2': u'254720384396', 'internal_ref': u'595c41b8260a44758717cca2fcc2416b'}
2017-03-16 12:48:20,122 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-16 12:48:20,122 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-16 12:48:20,169 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-16 12:48:20,169 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-16 12:48:20,173 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-16 12:48:20,173 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 12:48:20,177 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-16 12:48:20,178 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 12:48:20,180 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-16 12:48:20,181 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 12:48:20,185 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-16 12:48:20,185 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 12:48:20,188 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-16 12:48:20,188 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 12:48:20,191 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-16 12:48:20,191 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-16 12:48:20,194 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-16 12:48:20,194 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 12:48:20,198 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-16 12:48:20,199 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 12:48:20,201 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-16 12:48:20,201 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f9ffb834290>
2017-03-16 12:48:20,208 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-16 12:48:20,208 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-16 12:48:20,209 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-16 12:48:20,209 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-16 12:48:20,209 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254720384396
2017-03-16 12:48:20,209 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254720384396
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254720384396
2017-03-16 12:48:20,210 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 12:48:20,210 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-16 12:48:20,210 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 5
2017-03-16 12:48:20,210 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 5
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 5
2017-03-16 12:48:20,211 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "5", "title": "Safaricom  Airtime"}
2017-03-16 12:48:20,211 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "5", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "5", "title": "Safaricom  Airtime"}
2017-03-16 12:48:20,211 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 12:48:20,211 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-16 12:48:20,211 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 50 of airtime from Saiba 
2017-03-16 12:48:20,211 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 50 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 50 of airtime from Saiba 
2017-03-16 12:48:21,475 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":188,"user":5,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-16T12:45:39.728312Z"}
2017-03-16 12:48:21,475 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":188,"user":5,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-16T12:45:39.728312Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":188,"user":5,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-16T12:45:39.728312Z"}
2017-03-16 12:48:21,476 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-16 12:48:21,476 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-16 12:48:21,476 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":188,"user":5,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-16T12:45:39.728312Z"}
2017-03-16 12:48:21,476 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":188,"user":5,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-16T12:45:39.728312Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":188,"user":5,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-16T12:45:39.728312Z"}
2017-03-16 12:48:21,477 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-16 12:48:21,477 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-16 12:48:21,477 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-16 12:48:21,477 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-16 12:48:21,478 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-16 12:48:21,478 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-16 12:48:21,478 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-16 12:48:21,478 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-16 12:48:21,478 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254720384396", "user": 5, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
2017-03-16 12:48:21,478 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254720384396", "user": 5, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": null, "destination_mobile_number": "254720384396", "user": 5, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
2017-03-16 12:48:21,479 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-16 12:48:21,479 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-16 12:48:22,666 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 12:48:22,666 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 12:48:22,667 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-16 12:48:22,667 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-16 12:48:22,668 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 12:48:22,668 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 12:48:22,668 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-16 12:48:22,668 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-16 12:48:22,669 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3386.74ms
2017-03-16 12:48:22,669 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3386.74ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3386.74ms
2017-03-16 12:51:13,390 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.64ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.64ms
2017-03-16 12:51:13,390 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.64ms
2017-03-16 12:56:24,041 = tornado.access - WARNING - 404 GET / (185.40.4.18) 0.83ms
WARNING:tornado.access:404 GET / (185.40.4.18) 0.83ms
2017-03-16 12:56:24,041 = tornado.access - WARNING - 404 GET / (185.40.4.18) 0.83ms
2017-03-16 13:02:31,065 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-16 13:02:31,065 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-16 13:02:31,065 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 13:02:31,065 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-16 13:02:31,065 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 13:02:31
2017-03-16 13:02:31,065 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 13:02:31
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 16/03/2017 13:02:31
2017-03-16 13:02:31,066 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 13:02:31,066 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-16 13:02:31,066 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 13:02:31,066 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-16 13:02:31,066 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = f5735268d4c04340aa74b1278143f299
2017-03-16 13:02:31,066 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = f5735268d4c04340aa74b1278143f299
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = f5735268d4c04340aa74b1278143f299
2017-03-16 13:02:31,067 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 13:02:31,067 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-16 13:02:31,067 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 13:02:31,067 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-16 13:02:31,067 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:02:31</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f5735268d4c04340aa74b1278143f299</ns0:EXTREFNUM><ns0:MSISDN2>254707269123</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 13:02:31,067 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:02:31</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f5735268d4c04340aa74b1278143f299</ns0:EXTREFNUM><ns0:MSISDN2>254707269123</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:02:31</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f5735268d4c04340aa74b1278143f299</ns0:EXTREFNUM><ns0:MSISDN2>254707269123</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 13:02:31,068 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 13:02:31,068 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-16 13:02:31,068 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 13:02:31,068 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-16 13:02:31,068 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:02:31</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f5735268d4c04340aa74b1278143f299</ns0:EXTREFNUM><ns0:MSISDN2>254707269123</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 13:02:31,068 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:02:31</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f5735268d4c04340aa74b1278143f299</ns0:EXTREFNUM><ns0:MSISDN2>254707269123</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:02:31</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f5735268d4c04340aa74b1278143f299</ns0:EXTREFNUM><ns0:MSISDN2>254707269123</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 13:02:31,069 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 13:02:31,069 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-16 13:02:31,937 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 13:02:31,937 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-16 13:02:31,938 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 12:59:50</ns0:DATE><ns0:EXTREFNUM>f5735268d4c04340aa74b1278143f299</ns0:EXTREFNUM><ns0:TXNID>R170316.1259.140061</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 707269123 is successful. Your new balance is KSH 2685</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 13:02:31,938 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 12:59:50</ns0:DATE><ns0:EXTREFNUM>f5735268d4c04340aa74b1278143f299</ns0:EXTREFNUM><ns0:TXNID>R170316.1259.140061</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 707269123 is successful. Your new balance is KSH 2685</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 12:59:50</ns0:DATE><ns0:EXTREFNUM>f5735268d4c04340aa74b1278143f299</ns0:EXTREFNUM><ns0:TXNID>R170316.1259.140061</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 707269123 is successful. Your new balance is KSH 2685</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 13:02:31,938 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 13:02:31,938 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-16 13:02:31,938 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-16 13:02:31,938 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
2017-03-16 13:02:31,938 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-16 13:02:31,938 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-16 13:02:31,939 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 12:59:50
2017-03-16 13:02:31,939 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 12:59:50
DEBUG:handlers.result_handler.AirtimeHandler:16/03/17 12:59:50
2017-03-16 13:02:31,939 = handlers.result_handler.AirtimeHandler - DEBUG - f5735268d4c04340aa74b1278143f299
2017-03-16 13:02:31,939 = handlers.result_handler.AirtimeHandler - DEBUG - f5735268d4c04340aa74b1278143f299
DEBUG:handlers.result_handler.AirtimeHandler:f5735268d4c04340aa74b1278143f299
2017-03-16 13:02:31,939 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1259.140061
2017-03-16 13:02:31,939 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1259.140061
DEBUG:handlers.result_handler.AirtimeHandler:R170316.1259.140061
2017-03-16 13:02:31,940 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 12:59:50', 'amount': '10', 'external_ref': u'R170316.1259.140061', 'msisdn_2': u'254707269123', 'internal_ref': u'f5735268d4c04340aa74b1278143f299'}
2017-03-16 13:02:31,940 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 12:59:50', 'amount': '10', 'external_ref': u'R170316.1259.140061', 'msisdn_2': u'254707269123', 'internal_ref': u'f5735268d4c04340aa74b1278143f299'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'16/03/17 12:59:50', 'amount': '10', 'external_ref': u'R170316.1259.140061', 'msisdn_2': u'254707269123', 'internal_ref': u'f5735268d4c04340aa74b1278143f299'}
2017-03-16 13:02:31,940 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-16 13:02:31,940 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-16 13:02:31,980 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-16 13:02:31,980 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-16 13:02:31,984 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-16 13:02:31,984 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:02:31,988 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-16 13:02:31,988 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 13:02:31,990 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 13:02:31,990 INFO sqlalchemy.engine.base.Engine {}
2017-03-16 13:02:31,993 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:02:31,993 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 13:02:31,995 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:02:31,995 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 13:02:31,997 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-16 13:02:31,997 INFO sqlalchemy.engine.base.Engine {'table': 23559}
2017-03-16 13:02:31,999 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-16 13:02:31,999 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:02:32,003 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:02:32,003 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 13:02:32,005 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:02:32,005 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 13:02:32,010 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f9ffb5b6790>
2017-03-16 13:02:32,010 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-16 13:02:32,011 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-16 13:02:32,011 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-16 13:02:32,011 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254707269123
2017-03-16 13:02:32,011 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254707269123
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254707269123
2017-03-16 13:02:32,011 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 13:02:32,011 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-16 13:02:32,011 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 4
2017-03-16 13:02:32,011 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 4
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 4
2017-03-16 13:02:32,011 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "4", "title": "Safaricom  Airtime"}
2017-03-16 13:02:32,011 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "4", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "4", "title": "Safaricom  Airtime"}
2017-03-16 13:02:32,012 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 13:02:32,012 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-16 13:02:32,012 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-16 13:02:32,012 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-16 13:02:33,216 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":189,"user":4,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T12:59:51.441278Z"}
2017-03-16 13:02:33,216 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":189,"user":4,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T12:59:51.441278Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":189,"user":4,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T12:59:51.441278Z"}
2017-03-16 13:02:33,216 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-16 13:02:33,216 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-16 13:02:33,216 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":189,"user":4,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T12:59:51.441278Z"}
2017-03-16 13:02:33,216 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":189,"user":4,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T12:59:51.441278Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":189,"user":4,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T12:59:51.441278Z"}
2017-03-16 13:02:33,216 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-16 13:02:33,216 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-16 13:02:33,217 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-16 13:02:33,217 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-16 13:02:33,217 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-16 13:02:33,217 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-16 13:02:33,217 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-16 13:02:33,217 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-16 13:02:33,217 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254707269123", "user": 4, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-16 13:02:33,217 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254707269123", "user": 4, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": null, "destination_mobile_number": "254707269123", "user": 4, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-16 13:02:33,217 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-16 13:02:33,217 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-16 13:02:34,398 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
2017-03-16 13:02:34,398 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 13:02:34,399 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-16 13:02:34,399 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-16 13:02:34,399 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 13:02:34,399 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 13:02:34,399 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-16 13:02:34,399 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-16 13:02:34,400 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3336.07ms
2017-03-16 13:02:34,400 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3336.07ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3336.07ms
2017-03-16 13:21:47,313 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-16 13:21:47,314 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 13:21:47,314 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 13:21:47
2017-03-16 13:21:47,314 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 13:21:47,315 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 13:21:47,315 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 789d4ff8294647238c61835b8f7c9b13
2017-03-16 13:21:47,315 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 13:21:47,315 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 13:21:47,316 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:21:47</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>789d4ff8294647238c61835b8f7c9b13</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 13:21:47,316 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 13:21:47,316 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 13:21:47,316 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:21:47</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>789d4ff8294647238c61835b8f7c9b13</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 13:21:47,317 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/5000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 16/03/2017 13:21:47
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 789d4ff8294647238c61835b8f7c9b13
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:21:47</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>789d4ff8294647238c61835b8f7c9b13</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:21:47</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>789d4ff8294647238c61835b8f7c9b13</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-16 13:21:47,313 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-16 13:21:47,314 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 13:21:47,314 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 13:21:47
2017-03-16 13:21:47,314 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 13:21:47,315 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 13:21:47,315 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 789d4ff8294647238c61835b8f7c9b13
2017-03-16 13:21:47,315 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 13:21:47,315 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 13:21:47,316 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:21:47</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>789d4ff8294647238c61835b8f7c9b13</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 13:21:47,316 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 13:21:47,316 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 13:21:47,316 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:21:47</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>789d4ff8294647238c61835b8f7c9b13</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 13:21:47,317 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 13:21:48,154 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 13:21:48,154 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-16 13:21:48,154 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 13:19:06</ns0:DATE><ns0:EXTREFNUM>789d4ff8294647238c61835b8f7c9b13</ns0:EXTREFNUM><ns0:TXNID>R170316.1319.140013</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 720384396 is successful. Your new balance is KSH 2635</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 13:21:48,154 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 13:19:06</ns0:DATE><ns0:EXTREFNUM>789d4ff8294647238c61835b8f7c9b13</ns0:EXTREFNUM><ns0:TXNID>R170316.1319.140013</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 720384396 is successful. Your new balance is KSH 2635</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 13:19:06</ns0:DATE><ns0:EXTREFNUM>789d4ff8294647238c61835b8f7c9b13</ns0:EXTREFNUM><ns0:TXNID>R170316.1319.140013</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 720384396 is successful. Your new balance is KSH 2635</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 13:21:48,155 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 13:21:48,155 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-16 13:21:48,155 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
2017-03-16 13:21:48,155 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------50-----------------------
2017-03-16 13:21:48,156 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-16 13:21:48,156 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-16 13:21:48,156 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 13:19:06
2017-03-16 13:21:48,156 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 13:19:06
DEBUG:handlers.result_handler.AirtimeHandler:16/03/17 13:19:06
2017-03-16 13:21:48,156 = handlers.result_handler.AirtimeHandler - DEBUG - 789d4ff8294647238c61835b8f7c9b13
2017-03-16 13:21:48,156 = handlers.result_handler.AirtimeHandler - DEBUG - 789d4ff8294647238c61835b8f7c9b13
DEBUG:handlers.result_handler.AirtimeHandler:789d4ff8294647238c61835b8f7c9b13
2017-03-16 13:21:48,157 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1319.140013
2017-03-16 13:21:48,157 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1319.140013
DEBUG:handlers.result_handler.AirtimeHandler:R170316.1319.140013
2017-03-16 13:21:48,157 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 13:19:06', 'amount': '50', 'external_ref': u'R170316.1319.140013', 'msisdn_2': u'254720384396', 'internal_ref': u'789d4ff8294647238c61835b8f7c9b13'}
2017-03-16 13:21:48,157 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 13:19:06', 'amount': '50', 'external_ref': u'R170316.1319.140013', 'msisdn_2': u'254720384396', 'internal_ref': u'789d4ff8294647238c61835b8f7c9b13'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'16/03/17 13:19:06', 'amount': '50', 'external_ref': u'R170316.1319.140013', 'msisdn_2': u'254720384396', 'internal_ref': u'789d4ff8294647238c61835b8f7c9b13'}
2017-03-16 13:21:48,157 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-16 13:21:48,157 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-16 13:21:48,202 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-16 13:21:48,203 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-16 13:21:48,207 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-16 13:21:48,207 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-16 13:21:48,211 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-16 13:21:48,211 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 13:21:48,213 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 13:21:48,214 INFO sqlalchemy.engine.base.Engine {}
2017-03-16 13:21:48,217 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:21:48,217 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 13:21:48,220 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:21:48,220 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 13:21:48,222 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-16 13:21:48,222 INFO sqlalchemy.engine.base.Engine {'table': 23559}
2017-03-16 13:21:48,224 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:21:48,224 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 13:21:48,229 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:21:48,229 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 13:21:48,231 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-16 13:21:48,231 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:21:48,237 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f9ffb580f10>
2017-03-16 13:21:48,237 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-16 13:21:48,238 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-16 13:21:48,238 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-16 13:21:48,238 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254720384396
2017-03-16 13:21:48,238 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254720384396
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254720384396
2017-03-16 13:21:48,238 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 13:21:48,238 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-16 13:21:48,239 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 5
2017-03-16 13:21:48,239 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 5
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 5
2017-03-16 13:21:48,239 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "5", "title": "Safaricom  Airtime"}
2017-03-16 13:21:48,239 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "5", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "5", "title": "Safaricom  Airtime"}
2017-03-16 13:21:48,239 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 13:21:48,239 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-16 13:21:48,240 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 50 of airtime from Saiba 
2017-03-16 13:21:48,240 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 50 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 50 of airtime from Saiba 
2017-03-16 13:21:49,541 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":190,"user":5,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-16T13:19:07.728838Z"}
2017-03-16 13:21:49,541 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":190,"user":5,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-16T13:19:07.728838Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":190,"user":5,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-16T13:19:07.728838Z"}
2017-03-16 13:21:49,544 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-16 13:21:49,544 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-16 13:21:49,545 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":190,"user":5,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-16T13:19:07.728838Z"}
2017-03-16 13:21:49,545 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":190,"user":5,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-16T13:19:07.728838Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":190,"user":5,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-16T13:19:07.728838Z"}
2017-03-16 13:21:49,545 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-16 13:21:49,545 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-16 13:21:49,545 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-16 13:21:49,545 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-16 13:21:49,546 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-16 13:21:49,546 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-16 13:21:49,547 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-16 13:21:49,547 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-16 13:21:49,549 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254720384396", "user": 5, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
2017-03-16 13:21:49,549 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254720384396", "user": 5, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
2017-03-16 13:21:49,550 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:{"note": null, "destination_mobile_number": "254720384396", "user": 5, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-16 13:21:49,550 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-16 13:21:50,687 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
2017-03-16 13:21:50,687 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 13:21:50,688 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-16 13:21:50,688 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-16 13:21:50,688 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 13:21:50,688 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 13:21:50,689 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-16 13:21:50,689 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-16 13:21:50,690 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3376.97ms
2017-03-16 13:21:50,690 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3376.97ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3376.97ms
2017-03-16 13:26:37,720 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-16 13:26:37,720 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 13:26:37,721 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 13:26:37
2017-03-16 13:26:37,721 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 13:26:37,721 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 13:26:37,721 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 8e2bf85327ca44dbabb474c264e28629
2017-03-16 13:26:37,721 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 13:26:37,722 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 13:26:37,722 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:26:37</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8e2bf85327ca44dbabb474c264e28629</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 13:26:37,722 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 13:26:37,722 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 13:26:37,722 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:26:37</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8e2bf85327ca44dbabb474c264e28629</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 13:26:37,723 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/2000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 16/03/2017 13:26:37
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 8e2bf85327ca44dbabb474c264e28629
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:26:37</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8e2bf85327ca44dbabb474c264e28629</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:26:37</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8e2bf85327ca44dbabb474c264e28629</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-16 13:26:37,720 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-16 13:26:37,720 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 13:26:37,721 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 13:26:37
2017-03-16 13:26:37,721 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 13:26:37,721 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 13:26:37,721 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 8e2bf85327ca44dbabb474c264e28629
2017-03-16 13:26:37,721 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 13:26:37,722 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 13:26:37,722 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:26:37</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8e2bf85327ca44dbabb474c264e28629</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 13:26:37,722 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 13:26:37,722 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 13:26:37,722 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:26:37</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8e2bf85327ca44dbabb474c264e28629</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 13:26:37,723 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 13:26:40,029 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 13:26:40,030 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 13:23:58</ns0:DATE><ns0:EXTREFNUM>8e2bf85327ca44dbabb474c264e28629</ns0:EXTREFNUM><ns0:TXNID>R170316.1323.140095</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 721799582 is successful. Your new balance is KSH 2615</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 13:26:40,030 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 13:26:40,030 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------20-----------------------
2017-03-16 13:26:40,031 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-16 13:26:40,031 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 13:23:58
2017-03-16 13:26:40,031 = handlers.result_handler.AirtimeHandler - DEBUG - 8e2bf85327ca44dbabb474c264e28629
2017-03-16 13:26:40,031 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1323.140095
2017-03-16 13:26:40,032 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 13:23:58', 'amount': '20', 'external_ref': u'R170316.1323.140095', 'msisdn_2': u'254721799582', 'internal_ref': u'8e2bf85327ca44dbabb474c264e28629'}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 13:23:58</ns0:DATE><ns0:EXTREFNUM>8e2bf85327ca44dbabb474c264e28629</ns0:EXTREFNUM><ns0:TXNID>R170316.1323.140095</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 721799582 is successful. Your new balance is KSH 2615</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------20-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:16/03/17 13:23:58
DEBUG:handlers.result_handler.AirtimeHandler:8e2bf85327ca44dbabb474c264e28629
DEBUG:handlers.result_handler.AirtimeHandler:R170316.1323.140095
2017-03-16 13:26:40,029 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 13:26:40,030 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 13:23:58</ns0:DATE><ns0:EXTREFNUM>8e2bf85327ca44dbabb474c264e28629</ns0:EXTREFNUM><ns0:TXNID>R170316.1323.140095</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 721799582 is successful. Your new balance is KSH 2615</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 13:26:40,030 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 13:26:40,030 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------20-----------------------
2017-03-16 13:26:40,031 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-16 13:26:40,031 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 13:23:58
2017-03-16 13:26:40,031 = handlers.result_handler.AirtimeHandler - DEBUG - 8e2bf85327ca44dbabb474c264e28629
2017-03-16 13:26:40,031 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1323.140095
2017-03-16 13:26:40,032 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 13:23:58', 'amount': '20', 'external_ref': u'R170316.1323.140095', 'msisdn_2': u'254721799582', 'internal_ref': u'8e2bf85327ca44dbabb474c264e28629'}
2017-03-16 13:26:40,032 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'16/03/17 13:23:58', 'amount': '20', 'external_ref': u'R170316.1323.140095', 'msisdn_2': u'254721799582', 'internal_ref': u'8e2bf85327ca44dbabb474c264e28629'}
2017-03-16 13:26:40,032 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-16 13:26:40,072 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-16 13:26:40,072 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:26:40,076 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-16 13:26:40,076 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 13:26:40,080 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-16 13:26:40,081 INFO sqlalchemy.engine.base.Engine {}
2017-03-16 13:26:40,083 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-16 13:26:40,084 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 13:26:40,089 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-16 13:26:40,090 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:26:40,094 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-16 13:26:40,095 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:26:40,098 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-16 13:26:40,099 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-16 13:26:40,102 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-16 13:26:40,103 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:26:40,108 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-16 13:26:40,109 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:26:40,112 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-16 13:26:40,113 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f9ffb580c50>
2017-03-16 13:26:40,120 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-16 13:26:40,120 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-16 13:26:40,121 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-16 13:26:40,121 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-16 13:26:40,122 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 20 of airtime from Saiba  to 254721799582
2017-03-16 13:26:40,122 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 20 of airtime from Saiba  to 254721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 20 of airtime from Saiba  to 254721799582
2017-03-16 13:26:40,123 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 13:26:40,123 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-16 13:26:40,124 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 20 of airtime from Saiba  to 3
2017-03-16 13:26:40,124 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 20 of airtime from Saiba  to 3
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 20 of airtime from Saiba  to 3
2017-03-16 13:26:40,124 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 20 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-16 13:26:40,124 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 20 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 20 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-16 13:26:40,125 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 13:26:40,125 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-16 13:26:40,125 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 20 of airtime from Saiba 
2017-03-16 13:26:40,125 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 20 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 20 of airtime from Saiba 
2017-03-16 13:26:40,306 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":191,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-16T13:23:58.488762Z"}
2017-03-16 13:26:40,306 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":191,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-16T13:23:58.488762Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":191,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-16T13:23:58.488762Z"}
2017-03-16 13:26:40,307 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-16 13:26:40,307 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-16 13:26:40,308 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":191,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-16T13:23:58.488762Z"}
2017-03-16 13:26:40,308 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":191,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-16T13:23:58.488762Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":191,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-16T13:23:58.488762Z"}
2017-03-16 13:26:40,308 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-16 13:26:40,308 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-16 13:26:40,309 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-16 13:26:40,309 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-16 13:26:40,309 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-16 13:26:40,309 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-16 13:26:40,310 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-16 13:26:40,310 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-16 13:26:40,310 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "40", "destination_mobile_number": "254721799582", "user": 3, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "2000", "service_provider_id": 1}
2017-03-16 13:26:40,310 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "40", "destination_mobile_number": "254721799582", "user": 3, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "2000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "40", "destination_mobile_number": "254721799582", "user": 3, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "2000", "service_provider_id": 1}
2017-03-16 13:26:40,311 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-16 13:26:40,311 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-16 13:26:40,359 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 13:26:40,359 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 13:26:40,361 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-16 13:26:40,361 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-16 13:26:40,361 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 13:26:40,361 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 13:26:40,362 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-16 13:26:40,362 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-16 13:26:40,363 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2643.83ms
2017-03-16 13:26:40,363 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2643.83ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 2643.83ms
2017-03-16 13:31:37,787 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-16 13:31:37,787 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 13:31:37,787 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-16 13:31:37,787 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-16 13:31:37,788 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 13:31:37
2017-03-16 13:31:37,788 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 13:31:37
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 16/03/2017 13:31:37
2017-03-16 13:31:37,788 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 13:31:37,788 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-16 13:31:37,789 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 13:31:37,789 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-16 13:31:37,789 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 89f05285cb0446ef957d44c8909c2ba6
2017-03-16 13:31:37,789 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 89f05285cb0446ef957d44c8909c2ba6
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 89f05285cb0446ef957d44c8909c2ba6
2017-03-16 13:31:37,789 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 13:31:37,789 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-16 13:31:37,789 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 13:31:37,789 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-16 13:31:37,790 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:31:37</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>89f05285cb0446ef957d44c8909c2ba6</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 13:31:37,790 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:31:37</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>89f05285cb0446ef957d44c8909c2ba6</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:31:37</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>89f05285cb0446ef957d44c8909c2ba6</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 13:31:37,790 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 13:31:37,790 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-16 13:31:37,790 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 13:31:37,790 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-16 13:31:37,790 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:31:37</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>89f05285cb0446ef957d44c8909c2ba6</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 13:31:37,790 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:31:37</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>89f05285cb0446ef957d44c8909c2ba6</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:31:37</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>89f05285cb0446ef957d44c8909c2ba6</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 13:31:37,790 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 13:31:37,790 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-16 13:31:38,411 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 13:31:38,411 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-16 13:31:38,412 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>16/03/17 13:28:56</ns0:DATE><ns0:EXTREFNUM>89f05285cb0446ef957d44c8909c2ba6</ns0:EXTREFNUM><ns0:TXNID>R170316.1328.140080</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 13:31:38,412 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>16/03/17 13:28:56</ns0:DATE><ns0:EXTREFNUM>89f05285cb0446ef957d44c8909c2ba6</ns0:EXTREFNUM><ns0:TXNID>R170316.1328.140080</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>16/03/17 13:28:56</ns0:DATE><ns0:EXTREFNUM>89f05285cb0446ef957d44c8909c2ba6</ns0:EXTREFNUM><ns0:TXNID>R170316.1328.140080</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 13:31:38,412 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 13:31:38,412 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-16 13:31:38,412 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-16 13:31:38,412 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-16 13:31:38,413 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 13:31:38,413 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-16 13:31:38,413 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 4
2017-03-16 13:31:38,413 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 4
DEBUG:handlers.result_handler.AirtimeHandler:sending message could not complete your request at this time please try again later to 4
2017-03-16 13:31:38,413 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "4", "title": "Safaricom  Airtime"}
2017-03-16 13:31:38,413 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "4", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "could not complete your request at this time please try again later", "user": "4", "title": "Safaricom  Airtime"}
2017-03-16 13:31:38,413 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 13:31:38,413 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 13:31:38,413 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-16 13:31:38,413 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
DEBUG:handlers.result_handler.AirtimeHandler:could not complete your request at this time please try again later
2017-03-16 13:31:39,615 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":192,"user":4,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-16T13:28:57.784475Z"}
2017-03-16 13:31:39,615 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":192,"user":4,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-16T13:28:57.784475Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":192,"user":4,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-16T13:28:57.784475Z"}
2017-03-16 13:31:39,617 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-16 13:31:39,617 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-16 13:31:39,617 = handlers.result_handler.AirtimeHandler - DEBUG - https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-16 13:31:39,617 = handlers.result_handler.AirtimeHandler - DEBUG - https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-16 13:31:39,618 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token b9d30f778501df2e3af8797fb931cee7820671e3'}
2017-03-16 13:31:39,618 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token b9d30f778501df2e3af8797fb931cee7820671e3'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token b9d30f778501df2e3af8797fb931cee7820671e3'}
2017-03-16 13:31:39,618 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "1000", "user": 4, "user_credit_type": 1, "debit": "0"}
2017-03-16 13:31:39,618 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "1000", "user": 4, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "1000", "user": 4, "user_credit_type": 1, "debit": "0"}
2017-03-16 13:31:39,664 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-16 13:31:39,664 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-16 13:31:39,665 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":4,"user_credit_type":1,"debit":0.0,"credit":1000.0,"balance":1478.0}
2017-03-16 13:31:39,665 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":4,"user_credit_type":1,"debit":0.0,"credit":1000.0,"balance":1478.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":4,"user_credit_type":1,"debit":0.0,"credit":1000.0,"balance":1478.0}
2017-03-16 13:31:39,665 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
{"user":4,"user_credit_type":1,"debit":0.0,"credit":1000.0,"balance":1478.0}
2017-03-16 13:31:39,665 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-16 13:31:39,665 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-16 13:31:39,665 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-16 13:31:39,666 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 1879.44ms
2017-03-16 13:31:39,666 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 1879.44ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 1879.44ms
2017-03-16 13:31:59,754 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-16 13:31:59,754 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-16 13:31:59,754 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 13:31:59,754 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-16 13:31:59,755 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 13:31:59
2017-03-16 13:31:59,755 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 13:31:59
2017-03-16 13:31:59,755 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 13:31:59,755 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 13:31:59,755 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = ebba4af536484d93b64f8408c5c6ba71
2017-03-16 13:31:59,756 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 13:31:59,756 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 13:31:59,756 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:31:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ebba4af536484d93b64f8408c5c6ba71</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 13:31:59,756 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 13:31:59,756 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 13:31:59,756 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:31:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ebba4af536484d93b64f8408c5c6ba71</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 16/03/2017 13:31:59
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = ebba4af536484d93b64f8408c5c6ba71
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:31:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ebba4af536484d93b64f8408c5c6ba71</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-16 13:31:59,755 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 13:31:59,755 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 13:31:59,755 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = ebba4af536484d93b64f8408c5c6ba71
2017-03-16 13:31:59,756 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 13:31:59,756 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 13:31:59,756 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:31:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ebba4af536484d93b64f8408c5c6ba71</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 13:31:59,756 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 13:31:59,756 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 13:31:59,756 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:31:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ebba4af536484d93b64f8408c5c6ba71</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:31:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ebba4af536484d93b64f8408c5c6ba71</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 13:31:59,757 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 13:31:59,757 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-16 13:32:00,716 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 13:32:00,716 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-16 13:32:00,716 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 13:29:18</ns0:DATE><ns0:EXTREFNUM>ebba4af536484d93b64f8408c5c6ba71</ns0:EXTREFNUM><ns0:TXNID>R170316.1329.140041</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 702935200 is successful. Your new balance is KSH 2605</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 13:32:00,716 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 13:29:18</ns0:DATE><ns0:EXTREFNUM>ebba4af536484d93b64f8408c5c6ba71</ns0:EXTREFNUM><ns0:TXNID>R170316.1329.140041</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 702935200 is successful. Your new balance is KSH 2605</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 13:29:18</ns0:DATE><ns0:EXTREFNUM>ebba4af536484d93b64f8408c5c6ba71</ns0:EXTREFNUM><ns0:TXNID>R170316.1329.140041</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 702935200 is successful. Your new balance is KSH 2605</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 13:32:00,717 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 13:32:00,717 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-16 13:32:00,717 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-16 13:32:00,717 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
2017-03-16 13:32:00,717 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-16 13:32:00,717 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-16 13:32:00,718 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 13:29:18
2017-03-16 13:32:00,718 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 13:29:18
DEBUG:handlers.result_handler.AirtimeHandler:16/03/17 13:29:18
2017-03-16 13:32:00,718 = handlers.result_handler.AirtimeHandler - DEBUG - ebba4af536484d93b64f8408c5c6ba71
2017-03-16 13:32:00,718 = handlers.result_handler.AirtimeHandler - DEBUG - ebba4af536484d93b64f8408c5c6ba71
DEBUG:handlers.result_handler.AirtimeHandler:ebba4af536484d93b64f8408c5c6ba71
2017-03-16 13:32:00,718 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1329.140041
2017-03-16 13:32:00,718 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1329.140041
DEBUG:handlers.result_handler.AirtimeHandler:R170316.1329.140041
2017-03-16 13:32:00,719 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 13:29:18', 'amount': '10', 'external_ref': u'R170316.1329.140041', 'msisdn_2': u'254702935200', 'internal_ref': u'ebba4af536484d93b64f8408c5c6ba71'}
2017-03-16 13:32:00,719 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 13:29:18', 'amount': '10', 'external_ref': u'R170316.1329.140041', 'msisdn_2': u'254702935200', 'internal_ref': u'ebba4af536484d93b64f8408c5c6ba71'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'16/03/17 13:29:18', 'amount': '10', 'external_ref': u'R170316.1329.140041', 'msisdn_2': u'254702935200', 'internal_ref': u'ebba4af536484d93b64f8408c5c6ba71'}
2017-03-16 13:32:00,719 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-16 13:32:00,719 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-16 13:32:00,754 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-16 13:32:00,754 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-16 13:32:00,757 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:32:00,757 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 13:32:00,760 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 13:32:00,760 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-16 13:32:00,761 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-16 13:32:00,761 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-16 13:32:00,764 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-16 13:32:00,764 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:32:00,766 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-16 13:32:00,766 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:32:00,769 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-16 13:32:00,769 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-16 13:32:00,771 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-16 13:32:00,771 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:32:00,774 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-16 13:32:00,774 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:32:00,776 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:32:00,776 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 13:32:00,781 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f9ffb580990>
2017-03-16 13:32:00,781 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-16 13:32:00,782 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-16 13:32:00,782 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-16 13:32:00,782 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254702935200
2017-03-16 13:32:00,782 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254702935200
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254702935200
2017-03-16 13:32:00,782 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 13:32:00,782 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-16 13:32:00,783 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 3
2017-03-16 13:32:00,783 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 3
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 3
2017-03-16 13:32:00,783 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-16 13:32:00,783 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-16 13:32:00,783 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 13:32:00,783 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-16 13:32:00,783 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-16 13:32:00,783 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-16 13:32:01,843 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":193,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T13:29:20.015657Z"}
2017-03-16 13:32:01,843 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":193,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T13:29:20.015657Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":193,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T13:29:20.015657Z"}
2017-03-16 13:32:01,843 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-16 13:32:01,843 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-16 13:32:01,844 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":193,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T13:29:20.015657Z"}
2017-03-16 13:32:01,844 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":193,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T13:29:20.015657Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":193,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T13:29:20.015657Z"}
2017-03-16 13:32:01,844 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-16 13:32:01,844 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-16 13:32:01,844 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-16 13:32:01,844 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-16 13:32:01,844 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-16 13:32:01,844 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-16 13:32:01,844 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-16 13:32:01,844 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-16 13:32:01,844 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "hi", "destination_mobile_number": "254702935200", "user": 3, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-16 13:32:01,844 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "hi", "destination_mobile_number": "254702935200", "user": 3, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "hi", "destination_mobile_number": "254702935200", "user": 3, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-16 13:32:01,845 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-16 13:32:01,845 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-16 13:32:01,886 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
2017-03-16 13:32:01,886 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 13:32:01,887 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-16 13:32:01,887 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-16 13:32:01,887 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 13:32:01,887 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 13:32:01,887 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-16 13:32:01,887 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-16 13:32:01,888 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2134.96ms
2017-03-16 13:32:01,888 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2134.96ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 2134.96ms
2017-03-16 13:50:33,575 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-16 13:50:33,575 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/2000/-------------------
2017-03-16 13:50:33,576 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 13:50:33,576 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-16 13:50:33,576 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 13:50:33
2017-03-16 13:50:33,576 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 13:50:33
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 16/03/2017 13:50:33
2017-03-16 13:50:33,577 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 13:50:33,577 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-16 13:50:33,577 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 13:50:33,577 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-16 13:50:33,578 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 2c2df98bc7f04a59b3f7f4902bb66338
2017-03-16 13:50:33,578 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 2c2df98bc7f04a59b3f7f4902bb66338
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 2c2df98bc7f04a59b3f7f4902bb66338
2017-03-16 13:50:33,578 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 13:50:33,578 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-16 13:50:33,578 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 13:50:33,578 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-16 13:50:33,579 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:50:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2c2df98bc7f04a59b3f7f4902bb66338</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 13:50:33,579 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:50:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2c2df98bc7f04a59b3f7f4902bb66338</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:50:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2c2df98bc7f04a59b3f7f4902bb66338</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 13:50:33,579 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 13:50:33,579 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-16 13:50:33,579 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 13:50:33,579 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-16 13:50:33,580 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:50:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2c2df98bc7f04a59b3f7f4902bb66338</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 13:50:33,580 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:50:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2c2df98bc7f04a59b3f7f4902bb66338</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 13:50:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2c2df98bc7f04a59b3f7f4902bb66338</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 13:50:33,580 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 13:50:33,580 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-16 13:50:34,426 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 13:50:34,426 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-16 13:50:34,427 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 13:47:52</ns0:DATE><ns0:EXTREFNUM>2c2df98bc7f04a59b3f7f4902bb66338</ns0:EXTREFNUM><ns0:TXNID>R170316.1347.140059</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 720384396 is successful. Your new balance is KSH 2585</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 13:50:34,427 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 13:47:52</ns0:DATE><ns0:EXTREFNUM>2c2df98bc7f04a59b3f7f4902bb66338</ns0:EXTREFNUM><ns0:TXNID>R170316.1347.140059</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 720384396 is successful. Your new balance is KSH 2585</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 13:47:52</ns0:DATE><ns0:EXTREFNUM>2c2df98bc7f04a59b3f7f4902bb66338</ns0:EXTREFNUM><ns0:TXNID>R170316.1347.140059</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 720384396 is successful. Your new balance is KSH 2585</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 13:50:34,427 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 13:50:34,427 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-16 13:50:34,427 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------20-----------------------
2017-03-16 13:50:34,427 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------20-----------------------
2017-03-16 13:50:34,428 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------20-----------------------
2017-03-16 13:50:34,428 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-16 13:50:34,428 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 13:47:52
2017-03-16 13:50:34,428 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 13:47:52
DEBUG:handlers.result_handler.AirtimeHandler:16/03/17 13:47:52
2017-03-16 13:50:34,428 = handlers.result_handler.AirtimeHandler - DEBUG - 2c2df98bc7f04a59b3f7f4902bb66338
2017-03-16 13:50:34,428 = handlers.result_handler.AirtimeHandler - DEBUG - 2c2df98bc7f04a59b3f7f4902bb66338
DEBUG:handlers.result_handler.AirtimeHandler:2c2df98bc7f04a59b3f7f4902bb66338
2017-03-16 13:50:34,428 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1347.140059
2017-03-16 13:50:34,428 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1347.140059
DEBUG:handlers.result_handler.AirtimeHandler:R170316.1347.140059
2017-03-16 13:50:34,428 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 13:47:52', 'amount': '20', 'external_ref': u'R170316.1347.140059', 'msisdn_2': u'254720384396', 'internal_ref': u'2c2df98bc7f04a59b3f7f4902bb66338'}
2017-03-16 13:50:34,428 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 13:47:52', 'amount': '20', 'external_ref': u'R170316.1347.140059', 'msisdn_2': u'254720384396', 'internal_ref': u'2c2df98bc7f04a59b3f7f4902bb66338'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'16/03/17 13:47:52', 'amount': '20', 'external_ref': u'R170316.1347.140059', 'msisdn_2': u'254720384396', 'internal_ref': u'2c2df98bc7f04a59b3f7f4902bb66338'}
2017-03-16 13:50:34,428 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-16 13:50:34,428 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-16 13:50:34,464 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-16 13:50:34,465 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-16 13:50:34,468 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:50:34,468 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 13:50:34,470 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-16 13:50:34,471 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 13:50:34,472 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-16 13:50:34,473 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 13:50:34,476 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:50:34,476 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-16 13:50:34,484 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:50:34,484 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 13:50:34,488 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-16 13:50:34,488 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-16 13:50:34,493 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:50:34,493 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-16 13:50:34,498 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-16 13:50:34,498 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:50:34,500 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 13:50:34,500 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 13:50:34,505 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f9ffb589e90>
2017-03-16 13:50:34,505 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-16 13:50:34,505 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-16 13:50:34,505 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-16 13:50:34,505 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 20 of airtime from Saiba  to 254720384396
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-16 13:50:34,505 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 20 of airtime from Saiba  to 254720384396
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 20 of airtime from Saiba  to 254720384396
2017-03-16 13:50:34,505 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 13:50:34,505 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-16 13:50:34,506 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 20 of airtime from Saiba  to 7
2017-03-16 13:50:34,506 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 20 of airtime from Saiba  to 7
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 20 of airtime from Saiba  to 7
2017-03-16 13:50:34,506 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 20 of airtime from Saiba ", "user": "7", "title": "Safaricom  Airtime"}
2017-03-16 13:50:34,506 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 20 of airtime from Saiba ", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 20 of airtime from Saiba ", "user": "7", "title": "Safaricom  Airtime"}
2017-03-16 13:50:34,506 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 13:50:34,506 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-16 13:50:34,506 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 20 of airtime from Saiba 
2017-03-16 13:50:34,506 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 20 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 20 of airtime from Saiba 
2017-03-16 13:50:35,745 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":194,"user":7,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-16T13:47:53.880274Z"}
2017-03-16 13:50:35,745 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":194,"user":7,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-16T13:47:53.880274Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":194,"user":7,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-16T13:47:53.880274Z"}
2017-03-16 13:50:35,745 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-16 13:50:35,745 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-16 13:50:35,746 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":194,"user":7,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-16T13:47:53.880274Z"}
2017-03-16 13:50:35,746 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":194,"user":7,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-16T13:47:53.880274Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":194,"user":7,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-16T13:47:53.880274Z"}
2017-03-16 13:50:35,746 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-16 13:50:35,746 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-16 13:50:35,746 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-16 13:50:35,746 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-16 13:50:35,747 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-16 13:50:35,747 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-16 13:50:35,747 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-16 13:50:35,747 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-16 13:50:35,747 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254720384396", "user": 7, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "2000", "service_provider_id": 1}
2017-03-16 13:50:35,747 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254720384396", "user": 7, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "2000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": null, "destination_mobile_number": "254720384396", "user": 7, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "2000", "service_provider_id": 1}
2017-03-16 13:50:35,748 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-16 13:50:35,748 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-16 13:50:36,998 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 13:50:36,998 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 13:50:36,999 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-16 13:50:36,999 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-16 13:50:36,999 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 13:50:36,999 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 13:50:37,000 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 13:50:37,000 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-16 13:50:37,000 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3425.79ms
2017-03-16 13:50:37,000 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3425.79ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3425.79ms
2017-03-16 14:17:40,715 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-16 14:17:40,715 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-16 14:17:40,715 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 14:17:40,715 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-16 14:17:40,715 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 14:17:40
2017-03-16 14:17:40,715 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 14:17:40
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 16/03/2017 14:17:40
2017-03-16 14:17:40,716 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 14:17:40,716 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-16 14:17:40,716 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 14:17:40,716 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-16 14:17:40,717 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 073d05b2188d49209ea095d08ab7bc41
2017-03-16 14:17:40,717 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 073d05b2188d49209ea095d08ab7bc41
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 073d05b2188d49209ea095d08ab7bc41
2017-03-16 14:17:40,717 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 14:17:40,717 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-16 14:17:40,717 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-16 14:17:40,717 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 14:17:40,717 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:17:40</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>073d05b2188d49209ea095d08ab7bc41</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:17:40,717 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:17:40</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>073d05b2188d49209ea095d08ab7bc41</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:17:40</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>073d05b2188d49209ea095d08ab7bc41</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:17:40,717 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 14:17:40,717 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-16 14:17:40,718 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 14:17:40,718 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-16 14:17:40,718 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:17:40</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>073d05b2188d49209ea095d08ab7bc41</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:17:40,718 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:17:40</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>073d05b2188d49209ea095d08ab7bc41</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:17:40</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>073d05b2188d49209ea095d08ab7bc41</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:17:40,718 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 14:17:40,718 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-16 14:17:41,575 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 14:17:41,575 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-16 14:17:41,575 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:14:59</ns0:DATE><ns0:EXTREFNUM>073d05b2188d49209ea095d08ab7bc41</ns0:EXTREFNUM><ns0:TXNID>R170316.1414.140040</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 2575</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 14:17:41,575 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:14:59</ns0:DATE><ns0:EXTREFNUM>073d05b2188d49209ea095d08ab7bc41</ns0:EXTREFNUM><ns0:TXNID>R170316.1414.140040</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 2575</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:14:59</ns0:DATE><ns0:EXTREFNUM>073d05b2188d49209ea095d08ab7bc41</ns0:EXTREFNUM><ns0:TXNID>R170316.1414.140040</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 2575</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 14:17:41,576 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 14:17:41,576 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-16 14:17:41,576 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-16 14:17:41,576 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
2017-03-16 14:17:41,576 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-16 14:17:41,576 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-16 14:17:41,576 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 14:14:59
2017-03-16 14:17:41,576 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 14:14:59
DEBUG:handlers.result_handler.AirtimeHandler:16/03/17 14:14:59
2017-03-16 14:17:41,576 = handlers.result_handler.AirtimeHandler - DEBUG - 073d05b2188d49209ea095d08ab7bc41
2017-03-16 14:17:41,576 = handlers.result_handler.AirtimeHandler - DEBUG - 073d05b2188d49209ea095d08ab7bc41
DEBUG:handlers.result_handler.AirtimeHandler:073d05b2188d49209ea095d08ab7bc41
2017-03-16 14:17:41,577 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1414.140040
2017-03-16 14:17:41,577 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1414.140040
DEBUG:handlers.result_handler.AirtimeHandler:R170316.1414.140040
2017-03-16 14:17:41,577 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 14:14:59', 'amount': '10', 'external_ref': u'R170316.1414.140040', 'msisdn_2': u'254721799582', 'internal_ref': u'073d05b2188d49209ea095d08ab7bc41'}
2017-03-16 14:17:41,577 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 14:14:59', 'amount': '10', 'external_ref': u'R170316.1414.140040', 'msisdn_2': u'254721799582', 'internal_ref': u'073d05b2188d49209ea095d08ab7bc41'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'16/03/17 14:14:59', 'amount': '10', 'external_ref': u'R170316.1414.140040', 'msisdn_2': u'254721799582', 'internal_ref': u'073d05b2188d49209ea095d08ab7bc41'}
2017-03-16 14:17:41,578 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-16 14:17:41,578 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-16 14:17:41,619 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-16 14:17:41,620 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-16 14:17:41,623 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 14:17:41,624 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 14:17:41,627 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 14:17:41,627 INFO sqlalchemy.engine.base.Engine {}
2017-03-16 14:17:41,630 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-16 14:17:41,631 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 14:17:41,636 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 14:17:41,637 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 14:17:41,639 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-16 14:17:41,640 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 14:17:41,642 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-16 14:17:41,642 INFO sqlalchemy.engine.base.Engine {'table': 23559}
2017-03-16 14:17:41,644 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 14:17:41,645 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 14:17:41,651 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-16 14:17:41,653 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 14:17:41,656 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 14:17:41,656 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 14:17:41,661 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f9ffb580a50>
2017-03-16 14:17:41,661 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-16 14:17:41,662 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-16 14:17:41,662 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-16 14:17:41,662 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254721799582
2017-03-16 14:17:41,662 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254721799582
2017-03-16 14:17:41,663 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 14:17:41,663 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-16 14:17:41,663 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
2017-03-16 14:17:41,663 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
2017-03-16 14:17:41,663 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-16 14:17:41,663 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-16 14:17:41,663 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 14:17:41,663 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-16 14:17:41,664 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-16 14:17:41,664 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-16 14:17:43,344 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":195,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T14:15:01.429467Z"}
2017-03-16 14:17:43,344 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":195,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T14:15:01.429467Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":195,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T14:15:01.429467Z"}
2017-03-16 14:17:43,344 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-16 14:17:43,344 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-16 14:17:43,345 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":195,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T14:15:01.429467Z"}
2017-03-16 14:17:43,345 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":195,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T14:15:01.429467Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":195,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T14:15:01.429467Z"}
2017-03-16 14:17:43,345 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-16 14:17:43,345 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-16 14:17:43,345 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-16 14:17:43,345 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-16 14:17:43,345 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-16 14:17:43,345 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-16 14:17:43,345 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-16 14:17:43,345 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-16 14:17:43,346 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "Rt", "destination_mobile_number": "254721799582", "user": 8, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-16 14:17:43,346 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "Rt", "destination_mobile_number": "254721799582", "user": 8, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "Rt", "destination_mobile_number": "254721799582", "user": 8, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-16 14:17:43,346 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-16 14:17:43,346 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-16 14:17:44,572 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 14:17:44,572 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 14:17:44,575 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-16 14:17:44,575 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-16 14:17:44,576 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 14:17:44,576 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 14:17:44,577 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-16 14:17:44,577 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-16 14:17:44,578 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3864.56ms
2017-03-16 14:17:44,578 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3864.56ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3864.56ms
2017-03-16 14:33:34,766 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-16 14:33:34,766 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-16 14:33:34,766 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/2000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-16 14:33:34,766 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 14:33:34,767 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 14:33:34
2017-03-16 14:33:34,767 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 14:33:34
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 16/03/2017 14:33:34
2017-03-16 14:33:34,767 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 14:33:34,767 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-16 14:33:34,767 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 14:33:34,767 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-16 14:33:34,767 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = c6091a6e2111481f988080674129216b
2017-03-16 14:33:34,767 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = c6091a6e2111481f988080674129216b
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = c6091a6e2111481f988080674129216b
2017-03-16 14:33:34,767 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 14:33:34,767 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-16 14:33:34,768 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 14:33:34,768 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-16 14:33:34,768 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:33:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c6091a6e2111481f988080674129216b</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:33:34,768 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:33:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c6091a6e2111481f988080674129216b</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:33:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c6091a6e2111481f988080674129216b</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:33:34,768 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 14:33:34,768 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-16 14:33:34,768 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 14:33:34,768 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-16 14:33:34,768 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:33:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c6091a6e2111481f988080674129216b</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:33:34,768 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:33:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c6091a6e2111481f988080674129216b</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:33:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c6091a6e2111481f988080674129216b</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:33:34,769 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 14:33:34,769 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-16 14:33:35,660 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 14:33:35,660 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-16 14:33:35,661 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:30:53</ns0:DATE><ns0:EXTREFNUM>c6091a6e2111481f988080674129216b</ns0:EXTREFNUM><ns0:TXNID>R170316.1430.140033</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 721799582 is successful. Your new balance is KSH 2555</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 14:33:35,661 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:30:53</ns0:DATE><ns0:EXTREFNUM>c6091a6e2111481f988080674129216b</ns0:EXTREFNUM><ns0:TXNID>R170316.1430.140033</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 721799582 is successful. Your new balance is KSH 2555</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:30:53</ns0:DATE><ns0:EXTREFNUM>c6091a6e2111481f988080674129216b</ns0:EXTREFNUM><ns0:TXNID>R170316.1430.140033</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 721799582 is successful. Your new balance is KSH 2555</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 14:33:35,661 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 14:33:35,661 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-16 14:33:35,662 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------20-----------------------
2017-03-16 14:33:35,662 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------20-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------20-----------------------
2017-03-16 14:33:35,662 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-16 14:33:35,662 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-16 14:33:35,662 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 14:30:53
2017-03-16 14:33:35,662 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 14:30:53
DEBUG:handlers.result_handler.AirtimeHandler:16/03/17 14:30:53
2017-03-16 14:33:35,663 = handlers.result_handler.AirtimeHandler - DEBUG - c6091a6e2111481f988080674129216b
2017-03-16 14:33:35,663 = handlers.result_handler.AirtimeHandler - DEBUG - c6091a6e2111481f988080674129216b
DEBUG:handlers.result_handler.AirtimeHandler:c6091a6e2111481f988080674129216b
2017-03-16 14:33:35,663 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1430.140033
2017-03-16 14:33:35,663 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1430.140033
DEBUG:handlers.result_handler.AirtimeHandler:R170316.1430.140033
2017-03-16 14:33:35,663 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 14:30:53', 'amount': '20', 'external_ref': u'R170316.1430.140033', 'msisdn_2': u'254721799582', 'internal_ref': u'c6091a6e2111481f988080674129216b'}
2017-03-16 14:33:35,663 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 14:30:53', 'amount': '20', 'external_ref': u'R170316.1430.140033', 'msisdn_2': u'254721799582', 'internal_ref': u'c6091a6e2111481f988080674129216b'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'16/03/17 14:30:53', 'amount': '20', 'external_ref': u'R170316.1430.140033', 'msisdn_2': u'254721799582', 'internal_ref': u'c6091a6e2111481f988080674129216b'}
2017-03-16 14:33:35,664 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-16 14:33:35,664 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-16 14:33:35,698 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-16 14:33:35,698 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-16 14:33:35,700 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-16 14:33:35,700 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-16 14:33:35,703 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-16 14:33:35,703 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 14:33:35,704 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 14:33:35,704 INFO sqlalchemy.engine.base.Engine {}
2017-03-16 14:33:35,707 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-16 14:33:35,707 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 14:33:35,709 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 14:33:35,709 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 14:33:35,710 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-16 14:33:35,710 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-16 14:33:35,712 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-16 14:33:35,712 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 14:33:35,714 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 14:33:35,714 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 14:33:35,716 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 14:33:35,716 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 14:33:35,721 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f9ffb589110>
2017-03-16 14:33:35,721 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-16 14:33:35,722 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-16 14:33:35,722 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-16 14:33:35,722 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 20 of airtime from Saiba  to 254721799582
2017-03-16 14:33:35,722 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 20 of airtime from Saiba  to 254721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 20 of airtime from Saiba  to 254721799582
2017-03-16 14:33:35,722 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 14:33:35,722 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-16 14:33:35,722 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 20 of airtime from Saiba  to 7
2017-03-16 14:33:35,722 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 20 of airtime from Saiba  to 7
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 20 of airtime from Saiba  to 7
2017-03-16 14:33:35,722 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 20 of airtime from Saiba ", "user": "7", "title": "Safaricom  Airtime"}
2017-03-16 14:33:35,722 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 20 of airtime from Saiba ", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 20 of airtime from Saiba ", "user": "7", "title": "Safaricom  Airtime"}
2017-03-16 14:33:35,723 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 14:33:35,723 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-16 14:33:35,723 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 20 of airtime from Saiba 
2017-03-16 14:33:35,723 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 20 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 20 of airtime from Saiba 
2017-03-16 14:33:37,421 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":196,"user":7,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-16T14:30:55.478229Z"}
2017-03-16 14:33:37,421 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":196,"user":7,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-16T14:30:55.478229Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":196,"user":7,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-16T14:30:55.478229Z"}
2017-03-16 14:33:37,422 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-16 14:33:37,422 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-16 14:33:37,422 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":196,"user":7,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-16T14:30:55.478229Z"}
2017-03-16 14:33:37,422 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":196,"user":7,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-16T14:30:55.478229Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":196,"user":7,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-16T14:30:55.478229Z"}
2017-03-16 14:33:37,423 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-16 14:33:37,423 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-16 14:33:37,423 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-16 14:33:37,423 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-16 14:33:37,423 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-16 14:33:37,423 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-16 14:33:37,423 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-16 14:33:37,423 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-16 14:33:37,424 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254721799582", "user": 7, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "2000", "service_provider_id": 1}
2017-03-16 14:33:37,424 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254721799582", "user": 7, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "2000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": null, "destination_mobile_number": "254721799582", "user": 7, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "2000", "service_provider_id": 1}
2017-03-16 14:33:37,424 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-16 14:33:37,424 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-16 14:33:38,606 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 14:33:38,606 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 14:33:38,607 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 14:33:38,607 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-16 14:33:38,607 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 14:33:38,607 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 14:33:38,607 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 14:33:38,607 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-16 14:33:38,608 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3842.32ms
2017-03-16 14:33:38,608 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3842.32ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3842.32ms
2017-03-16 14:45:34,540 = __main__ - INFO - Creating server
2017-03-16 14:45:34,540 = __main__ - INFO - Creating server
2017-03-16 14:45:34,540 = __main__ - INFO - Created server
2017-03-16 14:45:34,540 = __main__ - INFO - Created server
2017-03-16 14:45:34,541 = __main__ - INFO - Listening on port 8080
2017-03-16 14:45:34,541 = __main__ - INFO - Listening on port 8080
2017-03-16 14:45:34,542 = __main__ - INFO - Starting event loop
2017-03-16 14:45:34,542 = __main__ - INFO - Starting event loop
2017-03-16 14:46:04,062 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-16 14:46:04,062 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
2017-03-16 14:46:04,065 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 14:46:04,065 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-16 14:46:04,066 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 14:46:04
2017-03-16 14:46:04,066 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 14:46:04
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 16/03/2017 14:46:04
2017-03-16 14:46:04,066 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 14:46:04,066 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-16 14:46:04,066 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 14:46:04,066 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-16 14:46:04,067 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 662d2ce3f57a45da860d34630dafc412
2017-03-16 14:46:04,067 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 662d2ce3f57a45da860d34630dafc412
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 662d2ce3f57a45da860d34630dafc412
2017-03-16 14:46:04,067 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 14:46:04,067 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-16 14:46:04,068 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 14:46:04,068 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-16 14:46:04,068 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:46:04</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>662d2ce3f57a45da860d34630dafc412</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:46:04,068 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:46:04</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>662d2ce3f57a45da860d34630dafc412</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:46:04</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>662d2ce3f57a45da860d34630dafc412</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:46:04,068 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 14:46:04,068 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-16 14:46:04,069 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 14:46:04,069 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 14:46:04,069 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:46:04</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>662d2ce3f57a45da860d34630dafc412</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:46:04,069 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:46:04</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>662d2ce3f57a45da860d34630dafc412</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-16 14:46:04,069 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:46:04</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>662d2ce3f57a45da860d34630dafc412</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:46:04,069 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 14:46:04,872 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 14:46:04,872 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-16 14:46:04,873 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:43:22</ns0:DATE><ns0:EXTREFNUM>662d2ce3f57a45da860d34630dafc412</ns0:EXTREFNUM><ns0:TXNID>R170316.1443.140004</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 721799582 is successful. Your new balance is KSH 2550</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 14:46:04,873 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:43:22</ns0:DATE><ns0:EXTREFNUM>662d2ce3f57a45da860d34630dafc412</ns0:EXTREFNUM><ns0:TXNID>R170316.1443.140004</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 721799582 is successful. Your new balance is KSH 2550</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:43:22</ns0:DATE><ns0:EXTREFNUM>662d2ce3f57a45da860d34630dafc412</ns0:EXTREFNUM><ns0:TXNID>R170316.1443.140004</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 721799582 is successful. Your new balance is KSH 2550</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 14:46:04,873 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 14:46:04,873 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-16 14:46:04,874 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
2017-03-16 14:46:04,874 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------5-----------------------
2017-03-16 14:46:04,874 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-16 14:46:04,874 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-16 14:46:04,874 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 14:43:22
2017-03-16 14:46:04,874 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 14:43:22
DEBUG:handlers.result_handler.AirtimeHandler:16/03/17 14:43:22
2017-03-16 14:46:04,875 = handlers.result_handler.AirtimeHandler - DEBUG - 662d2ce3f57a45da860d34630dafc412
2017-03-16 14:46:04,875 = handlers.result_handler.AirtimeHandler - DEBUG - 662d2ce3f57a45da860d34630dafc412
DEBUG:handlers.result_handler.AirtimeHandler:662d2ce3f57a45da860d34630dafc412
2017-03-16 14:46:04,876 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1443.140004
2017-03-16 14:46:04,876 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1443.140004
DEBUG:handlers.result_handler.AirtimeHandler:R170316.1443.140004
2017-03-16 14:46:04,876 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 14:43:22', 'amount': '5', 'external_ref': u'R170316.1443.140004', 'msisdn_2': u'0721799582', 'internal_ref': u'662d2ce3f57a45da860d34630dafc412'}
2017-03-16 14:46:04,876 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 14:43:22', 'amount': '5', 'external_ref': u'R170316.1443.140004', 'msisdn_2': u'0721799582', 'internal_ref': u'662d2ce3f57a45da860d34630dafc412'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'16/03/17 14:43:22', 'amount': '5', 'external_ref': u'R170316.1443.140004', 'msisdn_2': u'0721799582', 'internal_ref': u'662d2ce3f57a45da860d34630dafc412'}
2017-03-16 14:46:04,876 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-16 14:46:04,876 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-16 14:46:04,990 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-16 14:46:04,990 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-16 14:46:04,993 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-16 14:46:04,994 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-16 14:46:04,996 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-16 14:46:04,996 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-16 14:46:04,998 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-16 14:46:04,998 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-16 14:46:05,003 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-16 14:46:05,003 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 14:46:05,005 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 14:46:05,005 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-16 14:46:05,009 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-16 14:46:05,009 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-16 14:46:05,011 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 14:46:05,011 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 14:46:05,014 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 14:46:05,015 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 14:46:05,016 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 14:46:05,016 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 14:46:05,021 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f2a73c6edd0>
2017-03-16 14:46:05,021 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-16 14:46:05,021 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-16 14:46:05,022 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 5 of airtime from Saiba  to 0721799582
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-16 14:46:05,021 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-16 14:46:05,022 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 5 of airtime from Saiba  to 0721799582
2017-03-16 14:46:05,022 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 5 of airtime from Saiba  to 0721799582
2017-03-16 14:46:05,022 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 14:46:05,022 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 5 of airtime from Saiba  to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-16 14:46:05,022 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 5 of airtime from Saiba  to 8
2017-03-16 14:46:05,022 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 5 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 5 of airtime from Saiba  to 8
2017-03-16 14:46:05,022 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 5 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-16 14:46:05,022 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 14:46:05,022 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 5 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-16 14:46:05,022 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 5 of airtime from Saiba 
2017-03-16 14:46:05,022 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 5 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 5 of airtime from Saiba 
2017-03-16 14:46:06,682 = handlers.result_handler.AirtimeHandler - WARNING - HTTP 401: Unauthorized
2017-03-16 14:46:06,682 = handlers.result_handler.AirtimeHandler - WARNING - HTTP 401: Unauthorized
WARNING:handlers.result_handler.AirtimeHandler:HTTP 401: Unauthorized
2017-03-16 14:46:06,683 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 401: Unauthorized
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 250, in send_notification
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 401: Unauthorized
2017-03-16 14:46:06,683 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 401: Unauthorized
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 250, in send_notification
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 401: Unauthorized
ERROR:handlers.result_handler.AirtimeHandler:HTTP 401: Unauthorized
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 250, in send_notification
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 401: Unauthorized
2017-03-16 14:46:06,685 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-16 14:46:06,685 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-16 14:46:06,685 = handlers.result_handler.AirtimeHandler - DEBUG - HTTP 401: Unauthorized
2017-03-16 14:46:06,685 = handlers.result_handler.AirtimeHandler - DEBUG - HTTP 401: Unauthorized
DEBUG:handlers.result_handler.AirtimeHandler:HTTP 401: Unauthorized
2017-03-16 14:46:06,685 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-16 14:46:06,685 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-16 14:46:06,685 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-16 14:46:06,685 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-16 14:46:06,686 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-16 14:46:06,686 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-16 14:46:06,686 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-16 14:46:06,686 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-16 14:46:06,686 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "", "destination_mobile_number": "0721799582", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "500", "service_provider_id": 1}
2017-03-16 14:46:06,686 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "", "destination_mobile_number": "0721799582", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "500", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "", "destination_mobile_number": "0721799582", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "500", "service_provider_id": 1}
2017-03-16 14:46:06,687 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-16 14:46:06,687 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-16 14:46:08,263 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 401: Unauthorized
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 401: Unauthorized
2017-03-16 14:46:08,264 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
2017-03-16 14:46:08,263 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 401: Unauthorized
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 401: Unauthorized
2017-03-16 14:46:08,264 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
ERROR:handlers.result_handler.AirtimeHandler:HTTP 401: Unauthorized
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 401: Unauthorized
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": "LC323322"}
2017-03-16 14:46:09,562 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-16 14:46:09,562 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-16 14:46:09,562 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
2017-03-16 14:46:09,562 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
DEBUG:handlers.result_handler.AirtimeHandler:{"status": 1, "message": "Transaction not found"}
{"status": 1, "message": "Transaction not found"}
2017-03-16 14:46:09,562 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-16 14:46:09,562 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-16 14:46:09,563 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-16 14:46:09,563 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-16 14:46:09,565 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 5503.53ms
2017-03-16 14:46:09,565 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 5503.53ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 5503.53ms
2017-03-16 14:48:39,017 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-16 14:48:39,017 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-16 14:48:39,018 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/2000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-16 14:48:39,018 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 14:48:39
2017-03-16 14:48:39,018 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 14:48:39,018 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 14:48:39
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 16/03/2017 14:48:39
2017-03-16 14:48:39,019 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 14:48:39,019 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-16 14:48:39,019 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 14:48:39,019 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-16 14:48:39,020 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = ac1ee3bc5faf4902bff58b360732ee2f
2017-03-16 14:48:39,020 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 14:48:39,020 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 14:48:39,021 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:48:39</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ac1ee3bc5faf4902bff58b360732ee2f</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:48:39,021 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 14:48:39,021 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 14:48:39,022 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:48:39</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ac1ee3bc5faf4902bff58b360732ee2f</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:48:39,022 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = ac1ee3bc5faf4902bff58b360732ee2f
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:48:39</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ac1ee3bc5faf4902bff58b360732ee2f</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:48:39</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ac1ee3bc5faf4902bff58b360732ee2f</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-16 14:48:39,020 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = ac1ee3bc5faf4902bff58b360732ee2f
2017-03-16 14:48:39,020 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 14:48:39,020 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 14:48:39,021 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:48:39</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ac1ee3bc5faf4902bff58b360732ee2f</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:48:39,021 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 14:48:39,021 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 14:48:39,022 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:48:39</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ac1ee3bc5faf4902bff58b360732ee2f</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:48:39,022 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 14:48:42,778 = __main__ - INFO - Creating server
2017-03-16 14:48:42,779 = __main__ - INFO - Created server
2017-03-16 14:48:42,779 = __main__ - INFO - Listening on port 8080
2017-03-16 14:48:42,780 = __main__ - INFO - Starting event loop
2017-03-16 14:48:47,970 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-16 14:48:47,971 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 14:48:47,971 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 14:48:47
2017-03-16 14:48:47,971 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 14:48:47,972 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 14:48:47,972 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 87f08b9f8c1140c381cebdf622d7b176
2017-03-16 14:48:47,972 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 14:48:47,973 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 14:48:47,973 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:48:47</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>87f08b9f8c1140c381cebdf622d7b176</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:48:47,973 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 14:48:47,974 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 14:48:47,974 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:48:47</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>87f08b9f8c1140c381cebdf622d7b176</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:48:47,974 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 14:48:48,575 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 14:48:48,576 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:46:06</ns0:DATE><ns0:EXTREFNUM>87f08b9f8c1140c381cebdf622d7b176</ns0:EXTREFNUM><ns0:TXNID>R170316.1446.140005</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 14:48:48,576 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 14:48:48,577 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-16 14:48:48,577 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 14:48:48,577 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 8
2017-03-16 14:48:48,578 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "8", "title": "Safaricom  Airtime"}
2017-03-16 14:48:48,578 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 14:48:48,578 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
2017-03-16 14:48:48,625 = handlers.result_handler.AirtimeHandler - WARNING - HTTP 401: Unauthorized
2017-03-16 14:48:48,627 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 401: Unauthorized
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 250, in send_notification
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 401: Unauthorized
2017-03-16 14:48:48,629 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-16 14:48:48,629 = handlers.result_handler.AirtimeHandler - DEBUG - https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-16 14:48:48,630 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-16 14:48:48,630 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "500", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-16 14:48:48,672 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 401: Unauthorized
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 320, in add_credits
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 401: Unauthorized
2017-03-16 14:48:48,673 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-16 14:48:48,674 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 704.22ms
2017-03-16 14:49:27,507 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-16 14:49:27,507 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 14:49:27,508 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 14:49:27
2017-03-16 14:49:27,508 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 14:49:27,508 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 14:49:27,509 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 3a4e5fee3f8646848c60ce4c91d3729a
2017-03-16 14:49:27,509 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 14:49:27,509 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 14:49:27,510 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:49:27</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3a4e5fee3f8646848c60ce4c91d3729a</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:49:27,510 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 14:49:27,510 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 14:49:27,511 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:49:27</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3a4e5fee3f8646848c60ce4c91d3729a</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:49:27,511 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 14:49:28,109 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 14:49:28,110 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:46:46</ns0:DATE><ns0:EXTREFNUM>3a4e5fee3f8646848c60ce4c91d3729a</ns0:EXTREFNUM><ns0:TXNID>R170316.1446.140022</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 14:49:28,111 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 14:49:28,111 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-16 14:49:28,111 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 14:49:28,111 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 8
2017-03-16 14:49:28,112 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "8", "title": "Safaricom  Airtime"}
2017-03-16 14:49:28,112 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 14:49:28,112 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
2017-03-16 14:49:28,244 = handlers.result_handler.AirtimeHandler - WARNING - HTTP 401: Unauthorized
2017-03-16 14:49:28,245 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 401: Unauthorized
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 250, in send_notification
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 401: Unauthorized
2017-03-16 14:49:28,245 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-16 14:49:28,246 = handlers.result_handler.AirtimeHandler - DEBUG - https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-16 14:49:28,246 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-16 14:49:28,246 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "500", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-16 14:49:28,285 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 401: Unauthorized
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 320, in add_credits
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 401: Unauthorized
2017-03-16 14:49:28,286 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-16 14:49:28,287 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 781.40ms
2017-03-16 14:50:18,519 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-16 14:50:18,520 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 14:50:18,520 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 14:50:18
2017-03-16 14:50:18,520 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 14:50:18,520 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 14:50:18,520 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 9e94850de9df4c35a564395326ea3440
2017-03-16 14:50:18,521 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 14:50:18,521 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 14:50:18,521 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:50:18</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9e94850de9df4c35a564395326ea3440</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:50:18,521 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 14:50:18,521 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 14:50:18,522 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:50:18</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9e94850de9df4c35a564395326ea3440</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:50:18,522 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 14:50:19,095 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 14:50:19,096 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:47:37</ns0:DATE><ns0:EXTREFNUM>9e94850de9df4c35a564395326ea3440</ns0:EXTREFNUM><ns0:TXNID>R170316.1447.140026</ns0:TXNID><ns0:MESSAGE>The mobile number 702935200 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 14:50:19,096 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 14:50:19,097 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-16 14:50:19,097 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 14:50:19,098 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 8
2017-03-16 14:50:19,098 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "8", "title": "Safaricom  Airtime"}
2017-03-16 14:50:19,099 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 14:50:19,099 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
2017-03-16 14:50:19,134 = handlers.result_handler.AirtimeHandler - WARNING - HTTP 401: Unauthorized
2017-03-16 14:50:19,135 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 401: Unauthorized
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 250, in send_notification
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 401: Unauthorized
2017-03-16 14:50:19,136 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-16 14:50:19,136 = handlers.result_handler.AirtimeHandler - DEBUG - https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-16 14:50:19,137 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-16 14:50:19,137 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "2000", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-16 14:50:19,177 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 401: Unauthorized
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 320, in add_credits
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 401: Unauthorized
2017-03-16 14:50:19,177 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-16 14:50:19,178 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 659.50ms
2017-03-16 14:51:28,401 = __main__ - INFO - Creating server
2017-03-16 14:51:28,401 = __main__ - INFO - Created server
2017-03-16 14:51:28,402 = __main__ - INFO - Listening on port 8080
2017-03-16 14:51:28,403 = __main__ - INFO - Starting event loop
2017-03-16 14:51:36,400 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-16 14:51:36,400 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 14:51:36,400 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 14:51:36
2017-03-16 14:51:36,401 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 14:51:36,401 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 14:51:36,401 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = b0b6eb936e554750bf442196b1a27fd9
2017-03-16 14:51:36,401 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 14:51:36,402 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 14:51:36,402 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:51:36</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>b0b6eb936e554750bf442196b1a27fd9</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:51:36,402 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 14:51:36,402 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 14:51:36,402 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:51:36</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>b0b6eb936e554750bf442196b1a27fd9</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:51:36,403 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 14:51:37,249 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 14:51:37,249 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:48:55</ns0:DATE><ns0:EXTREFNUM>b0b6eb936e554750bf442196b1a27fd9</ns0:EXTREFNUM><ns0:TXNID>R170316.1448.140029</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 721799582 is successful. Your new balance is KSH 2525</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 14:51:37,249 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 14:51:37,250 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
2017-03-16 14:51:37,250 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-16 14:51:37,251 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 14:48:55
2017-03-16 14:51:37,251 = handlers.result_handler.AirtimeHandler - DEBUG - b0b6eb936e554750bf442196b1a27fd9
2017-03-16 14:51:37,251 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1448.140029
2017-03-16 14:51:37,252 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 14:48:55', 'amount': '5', 'external_ref': u'R170316.1448.140029', 'msisdn_2': u'0721799582', 'internal_ref': u'b0b6eb936e554750bf442196b1a27fd9'}
2017-03-16 14:51:37,252 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-16 14:51:37,410 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-16 14:51:37,411 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-16 14:51:37,411 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 5 of airtime from Saiba  to 0721799582
2017-03-16 14:51:37,411 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 14:51:37,411 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 5 of airtime from Saiba  to 8
2017-03-16 14:51:37,411 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 5 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-16 14:51:37,412 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 14:51:37,412 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 5 of airtime from Saiba 
2017-03-16 14:51:38,726 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":3,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-16T14:48:56.749666Z"}
2017-03-16 14:51:38,727 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-16 14:51:38,727 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":3,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-16T14:48:56.749666Z"}
2017-03-16 14:51:38,727 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-16 14:51:38,728 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-16 14:51:38,728 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-16 14:51:38,728 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-16 14:51:38,728 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "", "destination_mobile_number": "0721799582", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "500", "service_provider_id": 1}
2017-03-16 14:51:38,728 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-16 14:51:40,092 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-16 14:51:40,092 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":1,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"0721799582","request":null,"amount":500.0,"payment_method":1,"note":"","bundle":null,"account_number":null}
2017-03-16 14:51:40,093 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-16 14:51:40,093 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
2017-03-16 14:51:41,379 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-16 14:51:41,379 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
2017-03-16 14:51:41,379 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-16 14:51:41,380 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-16 14:51:41,381 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4981.51ms
2017-03-16 14:53:25,387 = __main__ - INFO - Creating server
2017-03-16 14:53:25,387 = __main__ - INFO - Creating server
2017-03-16 14:53:25,388 = __main__ - INFO - Created server
2017-03-16 14:53:25,388 = __main__ - INFO - Created server
2017-03-16 14:53:25,388 = __main__ - INFO - Listening on port 8080
2017-03-16 14:53:25,388 = __main__ - INFO - Listening on port 8080
2017-03-16 14:53:25,389 = __main__ - INFO - Starting event loop
2017-03-16 14:53:25,389 = __main__ - INFO - Starting event loop
2017-03-16 14:53:27,959 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-16 14:53:27,959 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-16 14:53:27,960 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
2017-03-16 14:53:27,960 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 14:53:27,960 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 14:53:27
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-16 14:53:27,960 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 14:53:27
2017-03-16 14:53:27,960 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 16/03/2017 14:53:27
2017-03-16 14:53:27,960 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-16 14:53:27,960 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 14:53:27,960 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-16 14:53:27,961 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 027183f599ee48e38ffbdf081e090372
2017-03-16 14:53:27,961 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 027183f599ee48e38ffbdf081e090372
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 027183f599ee48e38ffbdf081e090372
2017-03-16 14:53:27,961 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 14:53:27,961 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-16 14:53:27,961 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 14:53:27,961 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-16 14:53:27,961 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:53:27</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>027183f599ee48e38ffbdf081e090372</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:53:27,961 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:53:27</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>027183f599ee48e38ffbdf081e090372</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:53:27</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>027183f599ee48e38ffbdf081e090372</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:53:27,961 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 14:53:27,961 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-16 14:53:27,962 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 14:53:27,962 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-16 14:53:27,962 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:53:27</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>027183f599ee48e38ffbdf081e090372</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:53:27,962 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:53:27</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>027183f599ee48e38ffbdf081e090372</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:53:27</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>027183f599ee48e38ffbdf081e090372</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:53:27,962 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 14:53:27,962 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-16 14:53:28,566 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 14:53:28,566 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-16 14:53:28,567 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:50:46</ns0:DATE><ns0:EXTREFNUM>027183f599ee48e38ffbdf081e090372</ns0:EXTREFNUM><ns0:TXNID>R170316.1450.140027</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 14:53:28,567 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:50:46</ns0:DATE><ns0:EXTREFNUM>027183f599ee48e38ffbdf081e090372</ns0:EXTREFNUM><ns0:TXNID>R170316.1450.140027</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:50:46</ns0:DATE><ns0:EXTREFNUM>027183f599ee48e38ffbdf081e090372</ns0:EXTREFNUM><ns0:TXNID>R170316.1450.140027</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 14:53:28,567 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 14:53:28,567 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-16 14:53:28,568 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-16 14:53:28,568 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-16 14:53:28,568 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 14:53:28,568 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-16 14:53:28,568 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 8
2017-03-16 14:53:28,568 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message could not complete your request at this time please try again later to 8
2017-03-16 14:53:28,569 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "8", "title": "Safaricom  Airtime"}
2017-03-16 14:53:28,569 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "could not complete your request at this time please try again later", "user": "8", "title": "Safaricom  Airtime"}
2017-03-16 14:53:28,569 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 14:53:28,569 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-16 14:53:28,569 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
2017-03-16 14:53:28,569 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
DEBUG:handlers.result_handler.AirtimeHandler:could not complete your request at this time please try again later
2017-03-16 14:53:28,647 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":4,"user":8,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-16T14:50:46.665260Z"}
2017-03-16 14:53:28,647 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":4,"user":8,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-16T14:50:46.665260Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":4,"user":8,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-16T14:50:46.665260Z"}
2017-03-16 14:53:28,648 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-16 14:53:28,648 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-16 14:53:28,648 = handlers.result_handler.AirtimeHandler - DEBUG - https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-16 14:53:28,648 = handlers.result_handler.AirtimeHandler - DEBUG - https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-16 14:53:28,649 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-16 14:53:28,649 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-16 14:53:28,649 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "500", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-16 14:53:28,649 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "500", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "500", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-16 14:53:28,813 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 401: Unauthorized
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 320, in add_credits
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
2017-03-16 14:53:28,813 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 401: Unauthorized
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 320, in add_credits
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 401: Unauthorized
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 401: Unauthorized
ERROR:handlers.result_handler.AirtimeHandler:HTTP 401: Unauthorized
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 320, in add_credits
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 401: Unauthorized
2017-03-16 14:53:28,814 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-16 14:53:28,814 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-16 14:53:28,816 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 856.99ms
2017-03-16 14:53:28,816 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 856.99ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 856.99ms
2017-03-16 14:53:49,675 = __main__ - INFO - Creating server
2017-03-16 14:53:49,676 = __main__ - INFO - Created server
2017-03-16 14:53:49,676 = __main__ - INFO - Listening on port 8080
2017-03-16 14:54:10,247 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-16 14:54:10,247 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-16 14:54:10,247 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
2017-03-16 14:54:10,247 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 14:54:10,248 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 14:54:10
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 16/03/2017 14:54:10
2017-03-16 14:54:10,248 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 14:54:10,248 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 14:54:10
2017-03-16 14:54:10,248 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 14:54:10,248 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-16 14:54:10,248 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-16 14:54:10,248 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 7fda931828094f19bd13bfb25798256a
2017-03-16 14:54:10,248 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 7fda931828094f19bd13bfb25798256a
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 7fda931828094f19bd13bfb25798256a
2017-03-16 14:54:10,248 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 14:54:10,248 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-16 14:54:10,249 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-16 14:54:10,249 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 14:54:10,249 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:54:10</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>7fda931828094f19bd13bfb25798256a</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:54:10,249 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:54:10</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>7fda931828094f19bd13bfb25798256a</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:54:10,249 = handlers.result_handler.AirtimeHandler - INFO - Built XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:54:10</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>7fda931828094f19bd13bfb25798256a</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:54:10,249 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 14:54:10,249 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-16 14:54:10,249 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 14:54:10,249 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:54:10</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>7fda931828094f19bd13bfb25798256a</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-16 14:54:10,249 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:54:10</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>7fda931828094f19bd13bfb25798256a</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:54:10,250 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:54:10</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>7fda931828094f19bd13bfb25798256a</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-16 14:54:10,250 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 14:54:10,819 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 14:54:10,819 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-16 14:54:10,820 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:51:28</ns0:DATE><ns0:EXTREFNUM>7fda931828094f19bd13bfb25798256a</ns0:EXTREFNUM><ns0:TXNID>R170316.1451.140015</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 14:54:10,820 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:51:28</ns0:DATE><ns0:EXTREFNUM>7fda931828094f19bd13bfb25798256a</ns0:EXTREFNUM><ns0:TXNID>R170316.1451.140015</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:51:28</ns0:DATE><ns0:EXTREFNUM>7fda931828094f19bd13bfb25798256a</ns0:EXTREFNUM><ns0:TXNID>R170316.1451.140015</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 14:54:10,821 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 14:54:10,821 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-16 14:54:10,821 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-16 14:54:10,821 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-16 14:54:10,822 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 14:54:10,822 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-16 14:54:10,822 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 8
2017-03-16 14:54:10,822 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message could not complete your request at this time please try again later to 8
2017-03-16 14:54:10,823 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "8", "title": "Safaricom  Airtime"}
2017-03-16 14:54:10,823 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "could not complete your request at this time please try again later", "user": "8", "title": "Safaricom  Airtime"}
2017-03-16 14:54:10,823 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 14:54:10,823 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-16 14:54:10,824 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
2017-03-16 14:54:10,824 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
DEBUG:handlers.result_handler.AirtimeHandler:could not complete your request at this time please try again later
2017-03-16 14:54:10,980 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":5,"user":8,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-16T14:51:28.997381Z"}
2017-03-16 14:54:10,980 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":5,"user":8,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-16T14:51:28.997381Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":5,"user":8,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-16T14:51:28.997381Z"}
2017-03-16 14:54:10,980 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-16 14:54:10,980 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-16 14:54:10,981 = handlers.result_handler.AirtimeHandler - DEBUG - https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-16 14:54:10,981 = handlers.result_handler.AirtimeHandler - DEBUG - https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://staging.wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-16 14:54:10,981 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-16 14:54:10,981 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-16 14:54:10,982 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "500", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-16 14:54:10,982 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "500", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "500", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-16 14:54:11,107 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 401: Unauthorized
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 320, in add_credits
    res = client.fetch(req)
2017-03-16 14:54:11,107 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 401: Unauthorized
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 320, in add_credits
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 401: Unauthorized
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 401: Unauthorized
ERROR:handlers.result_handler.AirtimeHandler:HTTP 401: Unauthorized
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 320, in add_credits
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 401: Unauthorized
2017-03-16 14:54:11,108 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-16 14:54:11,108 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-16 14:54:11,110 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 863.59ms
2017-03-16 14:54:11,110 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 863.59ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 863.59ms
2017-03-16 14:56:15,311 = __main__ - INFO - Creating server
2017-03-16 14:56:15,311 = __main__ - INFO - Creating server
2017-03-16 14:56:15,312 = __main__ - INFO - Created server
2017-03-16 14:56:15,312 = __main__ - INFO - Created server
2017-03-16 14:56:15,312 = __main__ - INFO - Listening on port 8080
2017-03-16 14:56:15,312 = __main__ - INFO - Listening on port 8080
2017-03-16 14:56:15,313 = __main__ - INFO - Starting event loop
2017-03-16 14:56:15,313 = __main__ - INFO - Starting event loop
2017-03-16 14:56:28,502 = __main__ - INFO - Creating server
2017-03-16 14:56:28,502 = __main__ - INFO - Created server
2017-03-16 14:56:28,502 = __main__ - INFO - Listening on port 8080
2017-03-16 14:56:48,054 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-16 14:56:48,054 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
2017-03-16 14:56:48,054 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 14:56:48,054 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-16 14:56:48,055 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 14:56:48
2017-03-16 14:56:48,055 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 14:56:48
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 16/03/2017 14:56:48
2017-03-16 14:56:48,055 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 14:56:48,055 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-16 14:56:48,055 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 14:56:48,055 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-16 14:56:48,056 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = a150ef790cfc4b69a568c588ed067a83
2017-03-16 14:56:48,057 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 14:56:48,058 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 14:56:48,058 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:56:48</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a150ef790cfc4b69a568c588ed067a83</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:56:48,058 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 14:56:48,056 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = a150ef790cfc4b69a568c588ed067a83
2017-03-16 14:56:48,057 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 14:56:48,058 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 14:56:48,058 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:56:48</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a150ef790cfc4b69a568c588ed067a83</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:56:48,058 = handlers.result_handler.AirtimeHandler - INFO - Built XML
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = a150ef790cfc4b69a568c588ed067a83
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:56:48</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a150ef790cfc4b69a568c588ed067a83</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-16 14:56:48,059 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 14:56:48,059 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-16 14:56:48,060 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:56:48</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a150ef790cfc4b69a568c588ed067a83</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:56:48,060 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:56:48</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a150ef790cfc4b69a568c588ed067a83</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:56:48</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a150ef790cfc4b69a568c588ed067a83</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:56:48,062 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 14:56:48,062 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-16 14:56:48,851 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 14:56:48,851 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 14:56:48,851 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:54:06</ns0:DATE><ns0:EXTREFNUM>a150ef790cfc4b69a568c588ed067a83</ns0:EXTREFNUM><ns0:TXNID>R170316.1454.140004</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 721799582 is successful. Your new balance is KSH 2520</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-16 14:56:48,851 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:54:06</ns0:DATE><ns0:EXTREFNUM>a150ef790cfc4b69a568c588ed067a83</ns0:EXTREFNUM><ns0:TXNID>R170316.1454.140004</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 721799582 is successful. Your new balance is KSH 2520</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 14:56:48,852 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:54:06</ns0:DATE><ns0:EXTREFNUM>a150ef790cfc4b69a568c588ed067a83</ns0:EXTREFNUM><ns0:TXNID>R170316.1454.140004</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 721799582 is successful. Your new balance is KSH 2520</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-16 14:56:48,852 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 14:56:48,852 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
2017-03-16 14:56:48,852 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------5-----------------------
2017-03-16 14:56:48,852 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-16 14:56:48,852 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-16 14:56:48,853 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 14:54:06
2017-03-16 14:56:48,853 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 14:54:06
DEBUG:handlers.result_handler.AirtimeHandler:16/03/17 14:54:06
2017-03-16 14:56:48,853 = handlers.result_handler.AirtimeHandler - DEBUG - a150ef790cfc4b69a568c588ed067a83
2017-03-16 14:56:48,853 = handlers.result_handler.AirtimeHandler - DEBUG - a150ef790cfc4b69a568c588ed067a83
DEBUG:handlers.result_handler.AirtimeHandler:a150ef790cfc4b69a568c588ed067a83
2017-03-16 14:56:48,854 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1454.140004
2017-03-16 14:56:48,854 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1454.140004
DEBUG:handlers.result_handler.AirtimeHandler:R170316.1454.140004
2017-03-16 14:56:48,854 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 14:54:06', 'amount': '5', 'external_ref': u'R170316.1454.140004', 'msisdn_2': u'0721799582', 'internal_ref': u'a150ef790cfc4b69a568c588ed067a83'}
2017-03-16 14:56:48,854 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 14:54:06', 'amount': '5', 'external_ref': u'R170316.1454.140004', 'msisdn_2': u'0721799582', 'internal_ref': u'a150ef790cfc4b69a568c588ed067a83'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'16/03/17 14:54:06', 'amount': '5', 'external_ref': u'R170316.1454.140004', 'msisdn_2': u'0721799582', 'internal_ref': u'a150ef790cfc4b69a568c588ed067a83'}
2017-03-16 14:56:48,854 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-16 14:56:48,854 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-16 14:56:48,965 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-16 14:56:48,965 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-16 14:56:48,968 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-16 14:56:48,968 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 14:56:48,972 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 14:56:48,972 INFO sqlalchemy.engine.base.Engine {}
2017-03-16 14:56:48,974 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 14:56:48,974 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 14:56:48,982 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-16 14:56:48,982 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 14:56:48,986 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 14:56:48,986 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 14:56:48,993 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-16 14:56:48,994 INFO sqlalchemy.engine.base.Engine {'table': 23559}
2017-03-16 14:56:48,997 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 14:56:48,997 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 14:56:49,002 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 14:56:49,002 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-16 14:56:49,004 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-16 14:56:49,004 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7fec71cf5dd0>
2017-03-16 14:56:49,012 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-16 14:56:49,012 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-16 14:56:49,013 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-16 14:56:49,013 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-16 14:56:49,013 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 5 of airtime from Saiba  to 0721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-16 14:56:49,013 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 5 of airtime from Saiba  to 0721799582
2017-03-16 14:56:49,013 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 5 of airtime from Saiba  to 0721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-16 14:56:49,014 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 5 of airtime from Saiba  to 8
2017-03-16 14:56:49,013 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 14:56:49,014 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 5 of airtime from Saiba  to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 5 of airtime from Saiba  to 8
2017-03-16 14:56:49,014 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 5 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 5 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-16 14:56:49,014 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 14:56:49,014 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 5 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-16 14:56:49,014 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 14:56:49,015 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 5 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-16 14:56:49,015 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 5 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 5 of airtime from Saiba 
2017-03-16 14:56:50,245 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":6,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-16T14:54:08.257766Z"}
2017-03-16 14:56:50,245 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":6,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-16T14:54:08.257766Z"}
2017-03-16 14:56:50,246 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:{"id":6,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-16T14:54:08.257766Z"}
2017-03-16 14:56:50,246 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-16 14:56:50,246 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":6,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-16T14:54:08.257766Z"}
2017-03-16 14:56:50,246 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":6,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-16T14:54:08.257766Z"}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:{"id":6,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-16T14:54:08.257766Z"}
2017-03-16 14:56:50,246 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-16 14:56:50,246 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-16 14:56:50,247 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-16 14:56:50,247 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-16 14:56:50,247 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-16 14:56:50,247 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-16 14:56:50,247 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-16 14:56:50,247 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:null
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-16 14:56:50,248 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "", "destination_mobile_number": "0721799582", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "500", "service_provider_id": 1}
2017-03-16 14:56:50,248 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "", "destination_mobile_number": "0721799582", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "500", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "", "destination_mobile_number": "0721799582", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "500", "service_provider_id": 1}
2017-03-16 14:56:50,248 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-16 14:56:50,248 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-16 14:56:51,502 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-16 14:56:51,502 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-16 14:56:51,502 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":2,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"0721799582","request":null,"amount":500.0,"payment_method":1,"note":"","bundle":null,"account_number":null}
2017-03-16 14:56:51,502 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"id":2,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"0721799582","request":null,"amount":500.0,"payment_method":1,"note":"","bundle":null,"account_number":null}
2017-03-16 14:56:51,503 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
2017-03-16 14:56:51,502 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":2,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"0721799582","request":null,"amount":500.0,"payment_method":1,"note":"","bundle":null,"account_number":null}
2017-03-16 14:56:51,502 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-16 14:56:51,503 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": "LC323322"}
2017-03-16 14:56:52,557 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-16 14:56:52,557 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-16 14:56:52,557 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-16 14:56:52,557 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
{"status": 1, "message": "Transaction not found"}
2017-03-16 14:56:52,558 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-16 14:56:52,558 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:{"status": 1, "message": "Transaction not found"}
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-16 14:56:52,558 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-16 14:56:52,558 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-16 14:56:52,559 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4506.33ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 4506.33ms
2017-03-16 14:56:52,559 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4506.33ms
2017-03-16 14:56:55,274 = tornado.access - WARNING - 404 GET / (190.25.55.19) 0.89ms
WARNING:tornado.access:404 GET / (190.25.55.19) 0.89ms
2017-03-16 14:56:55,274 = tornado.access - WARNING - 404 GET / (190.25.55.19) 0.89ms
2017-03-16 14:58:01,108 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-16 14:58:01,109 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 14:58:01,109 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 14:58:01
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-16 14:58:01,109 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 14:58:01,108 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-16 14:58:01,109 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 14:58:01,109 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 14:58:01
2017-03-16 14:58:01,109 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 14:58:01,109 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 16/03/2017 14:58:01
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-16 14:58:01,110 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 4b5563b6263f479ea5b40da21c00d0fa
2017-03-16 14:58:01,109 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 14:58:01,110 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 4b5563b6263f479ea5b40da21c00d0fa
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 4b5563b6263f479ea5b40da21c00d0fa
2017-03-16 14:58:01,110 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 14:58:01,110 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 14:58:01,110 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-16 14:58:01,110 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 14:58:01,110 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:58:01</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>4b5563b6263f479ea5b40da21c00d0fa</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:58:01,110 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:58:01</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>4b5563b6263f479ea5b40da21c00d0fa</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:58:01</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>4b5563b6263f479ea5b40da21c00d0fa</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:58:01,110 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-16 14:58:01,111 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 14:58:01,110 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 14:58:01,111 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 14:58:01,111 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:58:01</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>4b5563b6263f479ea5b40da21c00d0fa</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-16 14:58:01,111 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:58:01</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>4b5563b6263f479ea5b40da21c00d0fa</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 14:58:01,111 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 14:58:01,111 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 14:58:01</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>4b5563b6263f479ea5b40da21c00d0fa</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-16 14:58:01,687 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-16 14:58:01,687 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 14:58:01,688 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:55:19</ns0:DATE><ns0:EXTREFNUM>4b5563b6263f479ea5b40da21c00d0fa</ns0:EXTREFNUM><ns0:TXNID>R170316.1455.140018</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 14:58:01,688 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:55:19</ns0:DATE><ns0:EXTREFNUM>4b5563b6263f479ea5b40da21c00d0fa</ns0:EXTREFNUM><ns0:TXNID>R170316.1455.140018</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>16/03/17 14:55:19</ns0:DATE><ns0:EXTREFNUM>4b5563b6263f479ea5b40da21c00d0fa</ns0:EXTREFNUM><ns0:TXNID>R170316.1455.140018</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 14:58:01,688 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 14:58:01,688 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-16 14:58:01,688 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-16 14:58:01,688 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-16 14:58:01,689 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 14:58:01,689 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-16 14:58:01,689 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 7
2017-03-16 14:58:01,689 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 7
DEBUG:handlers.result_handler.AirtimeHandler:sending message could not complete your request at this time please try again later to 7
2017-03-16 14:58:01,689 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "7", "title": "Safaricom  Airtime"}
2017-03-16 14:58:01,689 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "could not complete your request at this time please try again later", "user": "7", "title": "Safaricom  Airtime"}
2017-03-16 14:58:01,690 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 14:58:01,690 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-16 14:58:01,690 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
2017-03-16 14:58:01,690 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
DEBUG:handlers.result_handler.AirtimeHandler:could not complete your request at this time please try again later
2017-03-16 14:58:01,730 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":7,"user":7,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-16T14:55:19.742971Z"}
2017-03-16 14:58:01,730 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":7,"user":7,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-16T14:55:19.742971Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":7,"user":7,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-16T14:55:19.742971Z"}
2017-03-16 14:58:01,731 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-16 14:58:01,731 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-16 14:58:01,731 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-16 14:58:01,731 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-16 14:58:01,732 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-16 14:58:01,732 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-16 14:58:01,732 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "1000", "user": 7, "user_credit_type": 1, "debit": "0"}
2017-03-16 14:58:01,732 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "1000", "user": 7, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "1000", "user": 7, "user_credit_type": 1, "debit": "0"}
2017-03-16 14:58:01,784 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-16 14:58:01,784 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-16 14:58:01,785 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":7,"user_credit_type":1,"debit":0.0,"credit":1000.0,"balance":1000.0}
2017-03-16 14:58:01,785 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":7,"user_credit_type":1,"debit":0.0,"credit":1000.0,"balance":1000.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":7,"user_credit_type":1,"debit":0.0,"credit":1000.0,"balance":1000.0}
{"user":7,"user_credit_type":1,"debit":0.0,"credit":1000.0,"balance":1000.0}
2017-03-16 14:58:01,785 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-16 14:58:01,785 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-16 14:58:01,786 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-16 14:58:01,786 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-16 14:58:01,787 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 678.80ms
2017-03-16 14:58:01,787 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 678.80ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 678.80ms
2017-03-16 15:16:57,084 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-16 15:16:57,085 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-16 15:16:57,085 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 15:16:57
2017-03-16 15:16:57,084 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-16 15:16:57,085 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 15:16:57,085 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 15:16:57
2017-03-16 15:16:57,086 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 15:16:57,086 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 16/03/2017 15:16:57
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-16 15:16:57,086 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 15:16:57,086 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 15:16:57,086 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 9f6a5cc0bda94629927a281b92249d0d
2017-03-16 15:16:57,086 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 9f6a5cc0bda94629927a281b92249d0d
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 9f6a5cc0bda94629927a281b92249d0d
2017-03-16 15:16:57,086 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-16 15:16:57,087 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 15:16:57,086 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 15:16:57,087 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 15:16:57,087 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 15:16:57</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9f6a5cc0bda94629927a281b92249d0d</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-16 15:16:57,087 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 15:16:57</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9f6a5cc0bda94629927a281b92249d0d</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 15:16:57,087 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 15:16:57,087 = handlers.result_handler.AirtimeHandler - INFO - Built XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 15:16:57</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9f6a5cc0bda94629927a281b92249d0d</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-16 15:16:57,088 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-16 15:16:57,088 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 15:16:57</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9f6a5cc0bda94629927a281b92249d0d</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 15:16:57,088 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 15:16:57,088 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 15:16:57</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9f6a5cc0bda94629927a281b92249d0d</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 15:16:57,088 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 15:16:57</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9f6a5cc0bda94629927a281b92249d0d</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-16 15:16:57,088 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 15:16:57,948 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 15:16:57,949 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 15:14:15</ns0:DATE><ns0:EXTREFNUM>9f6a5cc0bda94629927a281b92249d0d</ns0:EXTREFNUM><ns0:TXNID>R170316.1514.140006</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 702935200 is successful. Your new balance is KSH 2510</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 15:16:57,949 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 15:16:57,950 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-16 15:16:57,950 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-16 15:16:57,950 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 15:14:15
2017-03-16 15:16:57,951 = handlers.result_handler.AirtimeHandler - DEBUG - 9f6a5cc0bda94629927a281b92249d0d
2017-03-16 15:16:57,951 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1514.140006
2017-03-16 15:16:57,951 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 15:14:15', 'amount': '10', 'external_ref': u'R170316.1514.140006', 'msisdn_2': u'254702935200', 'internal_ref': u'9f6a5cc0bda94629927a281b92249d0d'}
2017-03-16 15:16:57,951 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 15:14:15</ns0:DATE><ns0:EXTREFNUM>9f6a5cc0bda94629927a281b92249d0d</ns0:EXTREFNUM><ns0:TXNID>R170316.1514.140006</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 702935200 is successful. Your new balance is KSH 2510</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:16/03/17 15:14:15
DEBUG:handlers.result_handler.AirtimeHandler:9f6a5cc0bda94629927a281b92249d0d
DEBUG:handlers.result_handler.AirtimeHandler:R170316.1514.140006
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'16/03/17 15:14:15', 'amount': '10', 'external_ref': u'R170316.1514.140006', 'msisdn_2': u'254702935200', 'internal_ref': u'9f6a5cc0bda94629927a281b92249d0d'}
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-16 15:16:57,948 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 15:16:57,949 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 15:14:15</ns0:DATE><ns0:EXTREFNUM>9f6a5cc0bda94629927a281b92249d0d</ns0:EXTREFNUM><ns0:TXNID>R170316.1514.140006</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 702935200 is successful. Your new balance is KSH 2510</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 15:16:57,949 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 15:16:57,950 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-16 15:16:57,950 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-16 15:16:57,950 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 15:14:15
2017-03-16 15:16:57,951 = handlers.result_handler.AirtimeHandler - DEBUG - 9f6a5cc0bda94629927a281b92249d0d
2017-03-16 15:16:57,951 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1514.140006
2017-03-16 15:16:57,951 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 15:14:15', 'amount': '10', 'external_ref': u'R170316.1514.140006', 'msisdn_2': u'254702935200', 'internal_ref': u'9f6a5cc0bda94629927a281b92249d0d'}
2017-03-16 15:16:57,951 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-16 15:16:57,993 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-16 15:16:57,994 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-16 15:16:57,997 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 15:16:57,997 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 15:16:58,000 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 15:16:58,000 INFO sqlalchemy.engine.base.Engine {}
2017-03-16 15:16:58,003 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 15:16:58,003 INFO sqlalchemy.engine.base.Engine {}
2017-03-16 15:16:58,006 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 15:16:58,007 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 15:16:58,009 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-16 15:16:58,009 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 15:16:58,011 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-16 15:16:58,011 INFO sqlalchemy.engine.base.Engine {'table': 23559}
2017-03-16 15:16:58,013 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 15:16:58,013 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-16 15:16:58,018 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-16 15:16:58,018 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-16 15:16:58,020 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-16 15:16:58,020 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 15:16:58,027 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7fec719ff850>
2017-03-16 15:16:58,027 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-16 15:16:58,028 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-16 15:16:58,028 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-16 15:16:58,028 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254702935200
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254702935200
2017-03-16 15:16:58,028 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254702935200
2017-03-16 15:16:58,028 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-16 15:16:58,028 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 15:16:58,029 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
2017-03-16 15:16:58,029 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
2017-03-16 15:16:58,029 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-16 15:16:58,029 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-16 15:16:58,029 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 15:16:58,029 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-16 15:16:58,030 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-16 15:16:58,030 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-16 15:16:58,076 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":12,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T15:14:16.053135Z"}
2017-03-16 15:16:58,076 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":12,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T15:14:16.053135Z"}
2017-03-16 15:16:58,077 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:{"id":12,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T15:14:16.053135Z"}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-16 15:16:58,077 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":12,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T15:14:16.053135Z"}
2017-03-16 15:16:58,077 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-16 15:16:58,077 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":12,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T15:14:16.053135Z"}
2017-03-16 15:16:58,077 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:{"id":12,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T15:14:16.053135Z"}
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-16 15:16:58,077 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-16 15:16:58,077 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-16 15:16:58,077 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-16 15:16:58,078 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-16 15:16:58,078 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-16 15:16:58,078 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-16 15:16:58,078 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-16 15:16:58,078 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254702935200", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-16 15:16:58,078 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254702935200", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-16 15:16:58,078 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-16 15:16:58,078 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:{"note": null, "destination_mobile_number": "254702935200", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-16 15:16:59,125 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 15:16:59,125 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 15:16:59,127 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-16 15:16:59,127 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 15:16:59,127 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-16 15:16:59,127 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 15:16:59,128 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-16 15:16:59,128 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-16 15:16:59,129 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2044.71ms
2017-03-16 15:16:59,129 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2044.71ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 2044.71ms
2017-03-16 15:19:46,724 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-16 15:19:46,724 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-16 15:19:46,724 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 15:19:46,724 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 15:19:46,725 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 15:19:46
2017-03-16 15:19:46,725 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 16/03/2017 15:19:46
2017-03-16 15:19:46,725 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 15:19:46
2017-03-16 15:19:46,725 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 15:19:46,725 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 15:19:46,725 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-16 15:19:46,725 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 9704e0b9726345c281fa6f7b6d29a151
2017-03-16 15:19:46,725 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 9704e0b9726345c281fa6f7b6d29a151
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 9704e0b9726345c281fa6f7b6d29a151
2017-03-16 15:19:46,726 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-16 15:19:46,726 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 15:19:46,726 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 15:19:46,726 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 15:19:46,726 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 15:19:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9704e0b9726345c281fa6f7b6d29a151</ns0:EXTREFNUM><ns0:MSISDN2>254725437441</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-16 15:19:46,726 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 15:19:46,726 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 15:19:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9704e0b9726345c281fa6f7b6d29a151</ns0:EXTREFNUM><ns0:MSISDN2>254725437441</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 15:19:46,726 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 15:19:46,726 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 15:19:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9704e0b9726345c281fa6f7b6d29a151</ns0:EXTREFNUM><ns0:MSISDN2>254725437441</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-16 15:19:46,727 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 15:19:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9704e0b9726345c281fa6f7b6d29a151</ns0:EXTREFNUM><ns0:MSISDN2>254725437441</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 15:19:46,726 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 15:19:46,727 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 15:19:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9704e0b9726345c281fa6f7b6d29a151</ns0:EXTREFNUM><ns0:MSISDN2>254725437441</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 15:19:46,727 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 15:19:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9704e0b9726345c281fa6f7b6d29a151</ns0:EXTREFNUM><ns0:MSISDN2>254725437441</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-16 15:19:46,727 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 15:19:47,561 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 15:19:47,561 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-16 15:19:47,561 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 15:17:05</ns0:DATE><ns0:EXTREFNUM>9704e0b9726345c281fa6f7b6d29a151</ns0:EXTREFNUM><ns0:TXNID>R170316.1517.140003</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 725437441 is successful. Your new balance is KSH 2500</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 15:19:47,561 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 15:17:05</ns0:DATE><ns0:EXTREFNUM>9704e0b9726345c281fa6f7b6d29a151</ns0:EXTREFNUM><ns0:TXNID>R170316.1517.140003</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 725437441 is successful. Your new balance is KSH 2500</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 15:17:05</ns0:DATE><ns0:EXTREFNUM>9704e0b9726345c281fa6f7b6d29a151</ns0:EXTREFNUM><ns0:TXNID>R170316.1517.140003</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 725437441 is successful. Your new balance is KSH 2500</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 15:19:47,562 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 15:19:47,562 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-16 15:19:47,562 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-16 15:19:47,562 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
2017-03-16 15:19:47,563 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-16 15:19:47,563 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-16 15:19:47,563 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 15:17:05
2017-03-16 15:19:47,563 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 15:17:05
DEBUG:handlers.result_handler.AirtimeHandler:16/03/17 15:17:05
2017-03-16 15:19:47,563 = handlers.result_handler.AirtimeHandler - DEBUG - 9704e0b9726345c281fa6f7b6d29a151
2017-03-16 15:19:47,563 = handlers.result_handler.AirtimeHandler - DEBUG - 9704e0b9726345c281fa6f7b6d29a151
DEBUG:handlers.result_handler.AirtimeHandler:9704e0b9726345c281fa6f7b6d29a151
2017-03-16 15:19:47,564 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1517.140003
2017-03-16 15:19:47,564 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1517.140003
DEBUG:handlers.result_handler.AirtimeHandler:R170316.1517.140003
2017-03-16 15:19:47,564 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 15:17:05', 'amount': '10', 'external_ref': u'R170316.1517.140003', 'msisdn_2': u'254725437441', 'internal_ref': u'9704e0b9726345c281fa6f7b6d29a151'}
2017-03-16 15:19:47,564 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 15:17:05', 'amount': '10', 'external_ref': u'R170316.1517.140003', 'msisdn_2': u'254725437441', 'internal_ref': u'9704e0b9726345c281fa6f7b6d29a151'}
2017-03-16 15:19:47,564 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'16/03/17 15:17:05', 'amount': '10', 'external_ref': u'R170316.1517.140003', 'msisdn_2': u'254725437441', 'internal_ref': u'9704e0b9726345c281fa6f7b6d29a151'}
2017-03-16 15:19:47,564 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-16 15:19:47,614 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-16 15:19:47,614 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-16 15:19:47,619 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 15:19:47,619 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 15:19:47,627 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 15:19:47,627 INFO sqlalchemy.engine.base.Engine {}
2017-03-16 15:19:47,630 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 15:19:47,631 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 15:19:47,637 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-16 15:19:47,637 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 15:19:47,642 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-16 15:19:47,643 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 15:19:47,647 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-16 15:19:47,649 INFO sqlalchemy.engine.base.Engine {'table': 23559}
2017-03-16 15:19:47,654 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 15:19:47,655 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 15:19:47,660 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 15:19:47,660 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 15:19:47,662 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 15:19:47,662 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 15:19:47,670 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7fec71a64e50>
2017-03-16 15:19:47,670 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-16 15:19:47,670 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-16 15:19:47,671 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254725437441
2017-03-16 15:19:47,670 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-16 15:19:47,671 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254725437441
2017-03-16 15:19:47,671 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254725437441
2017-03-16 15:19:47,671 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 15:19:47,671 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
2017-03-16 15:19:47,671 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
2017-03-16 15:19:47,671 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 15:19:47,671 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
2017-03-16 15:19:47,671 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-16 15:19:47,671 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 15:19:47,672 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-16 15:19:47,672 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-16 15:19:48,897 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":13,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T15:17:06.867578Z"}
2017-03-16 15:19:48,897 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":13,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T15:17:06.867578Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":13,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T15:17:06.867578Z"}
2017-03-16 15:19:48,900 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-16 15:19:48,900 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-16 15:19:48,902 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":13,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T15:17:06.867578Z"}
2017-03-16 15:19:48,902 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":13,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T15:17:06.867578Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":13,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T15:17:06.867578Z"}
2017-03-16 15:19:48,903 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-16 15:19:48,903 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-16 15:19:48,903 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-16 15:19:48,903 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-16 15:19:48,903 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-16 15:19:48,903 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-16 15:19:48,904 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-16 15:19:48,904 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-16 15:19:48,904 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254725437441", "user": 8, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-16 15:19:48,904 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254725437441", "user": 8, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": null, "destination_mobile_number": "254725437441", "user": 8, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-16 15:19:48,904 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-16 15:19:48,904 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-16 15:19:50,109 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
2017-03-16 15:19:50,109 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 15:19:50,110 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-16 15:19:50,110 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-16 15:19:50,110 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 15:19:50,110 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 15:19:50,111 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-16 15:19:50,111 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-16 15:19:50,112 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3388.58ms
2017-03-16 15:19:50,112 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3388.58ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3388.58ms
2017-03-16 15:29:13,134 = tornado.access - WARNING - 404 GET /script (221.194.44.252) 0.72ms
2017-03-16 15:29:13,134 = tornado.access - WARNING - 404 GET /script (221.194.44.252) 0.72ms
WARNING:tornado.access:404 GET /script (221.194.44.252) 0.72ms
2017-03-16 15:35:38,897 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-16 15:35:38,898 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-16 15:35:38,898 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 15:35:38
2017-03-16 15:35:38,897 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-16 15:35:38,898 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 15:35:38,898 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 15:35:38
2017-03-16 15:35:38,898 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 16/03/2017 15:35:38
2017-03-16 15:35:38,898 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 15:35:38,899 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 15:35:38,899 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-16 15:35:38,899 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = b51081fc2c0b4640b50cb0b6d9afd66b
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = b51081fc2c0b4640b50cb0b6d9afd66b
2017-03-16 15:35:38,899 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 15:35:38,899 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = b51081fc2c0b4640b50cb0b6d9afd66b
2017-03-16 15:35:38,899 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-16 15:35:38,900 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 15:35:38,900 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-16 15:35:38,900 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 15:35:38</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>b51081fc2c0b4640b50cb0b6d9afd66b</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 15:35:38,900 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 15:35:38</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>b51081fc2c0b4640b50cb0b6d9afd66b</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 15:35:38</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>b51081fc2c0b4640b50cb0b6d9afd66b</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 15:35:38,900 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 15:35:38,900 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 15:35:38,901 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-16 15:35:38,901 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 15:35:38,901 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 15:35:38</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>b51081fc2c0b4640b50cb0b6d9afd66b</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 15:35:38</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>b51081fc2c0b4640b50cb0b6d9afd66b</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 15:35:38,901 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 15:35:38,901 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 15:35:38</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>b51081fc2c0b4640b50cb0b6d9afd66b</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 15:35:38,901 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-16 15:35:39,716 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 15:35:39,717 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 15:32:57</ns0:DATE><ns0:EXTREFNUM>b51081fc2c0b4640b50cb0b6d9afd66b</ns0:EXTREFNUM><ns0:TXNID>R170316.1532.140022</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 702935200 is successful. Your new balance is KSH 2490</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-16 15:35:39,717 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 15:35:39,716 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 15:35:39,717 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 15:32:57</ns0:DATE><ns0:EXTREFNUM>b51081fc2c0b4640b50cb0b6d9afd66b</ns0:EXTREFNUM><ns0:TXNID>R170316.1532.140022</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 702935200 is successful. Your new balance is KSH 2490</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 15:35:39,717 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 15:35:39,717 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 15:32:57</ns0:DATE><ns0:EXTREFNUM>b51081fc2c0b4640b50cb0b6d9afd66b</ns0:EXTREFNUM><ns0:TXNID>R170316.1532.140022</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 702935200 is successful. Your new balance is KSH 2490</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-16 15:35:39,717 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-16 15:35:39,718 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-16 15:35:39,718 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 15:32:57
2017-03-16 15:35:39,718 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-16 15:35:39,718 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 15:32:57
2017-03-16 15:35:39,718 = handlers.result_handler.AirtimeHandler - DEBUG - b51081fc2c0b4640b50cb0b6d9afd66b
DEBUG:handlers.result_handler.AirtimeHandler:16/03/17 15:32:57
DEBUG:handlers.result_handler.AirtimeHandler:b51081fc2c0b4640b50cb0b6d9afd66b
2017-03-16 15:35:39,718 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1532.140022
2017-03-16 15:35:39,718 = handlers.result_handler.AirtimeHandler - DEBUG - b51081fc2c0b4640b50cb0b6d9afd66b
2017-03-16 15:35:39,718 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1532.140022
2017-03-16 15:35:39,719 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 15:32:57', 'amount': '10', 'external_ref': u'R170316.1532.140022', 'msisdn_2': u'254702935200', 'internal_ref': u'b51081fc2c0b4640b50cb0b6d9afd66b'}
DEBUG:handlers.result_handler.AirtimeHandler:R170316.1532.140022
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'16/03/17 15:32:57', 'amount': '10', 'external_ref': u'R170316.1532.140022', 'msisdn_2': u'254702935200', 'internal_ref': u'b51081fc2c0b4640b50cb0b6d9afd66b'}
2017-03-16 15:35:39,719 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-16 15:35:39,719 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 15:32:57', 'amount': '10', 'external_ref': u'R170316.1532.140022', 'msisdn_2': u'254702935200', 'internal_ref': u'b51081fc2c0b4640b50cb0b6d9afd66b'}
2017-03-16 15:35:39,719 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-16 15:35:39,764 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-16 15:35:39,764 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 15:35:39,768 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-16 15:35:39,768 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 15:35:39,772 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-16 15:35:39,772 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 15:35:39,775 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-16 15:35:39,776 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 15:35:39,780 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-16 15:35:39,780 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 15:35:39,784 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-16 15:35:39,785 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 15:35:39,788 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-16 15:35:39,788 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-16 15:35:39,791 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-16 15:35:39,792 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 15:35:39,796 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-16 15:35:39,797 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 15:35:39,800 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-16 15:35:39,800 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7fec719c3c10>
2017-03-16 15:35:39,808 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-16 15:35:39,808 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-16 15:35:39,809 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-16 15:35:39,809 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-16 15:35:39,809 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254702935200
2017-03-16 15:35:39,809 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254702935200
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254702935200
2017-03-16 15:35:39,810 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 15:35:39,810 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-16 15:35:39,811 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 3
2017-03-16 15:35:39,811 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 3
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 3
2017-03-16 15:35:39,812 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-16 15:35:39,812 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-16 15:35:39,812 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 15:35:39,812 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-16 15:35:39,813 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-16 15:35:39,813 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-16 15:35:41,144 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":14,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T15:32:59.083516Z"}
2017-03-16 15:35:41,144 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":14,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T15:32:59.083516Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":14,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T15:32:59.083516Z"}
2017-03-16 15:35:41,145 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-16 15:35:41,145 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-16 15:35:41,146 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":14,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T15:32:59.083516Z"}
2017-03-16 15:35:41,146 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":14,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T15:32:59.083516Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":14,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T15:32:59.083516Z"}
2017-03-16 15:35:41,146 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-16 15:35:41,146 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-16 15:35:41,147 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-16 15:35:41,147 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-16 15:35:41,148 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-16 15:35:41,148 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-16 15:35:41,148 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-16 15:35:41,148 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-16 15:35:41,149 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254702935200", "user": 3, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-16 15:35:41,149 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254702935200", "user": 3, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": null, "destination_mobile_number": "254702935200", "user": 3, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-16 15:35:41,150 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-16 15:35:41,150 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-16 15:35:42,680 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 15:35:42,680 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 15:35:42,682 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-16 15:35:42,682 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-16 15:35:42,682 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 15:35:42,682 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 15:35:42,683 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-16 15:35:42,683 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-16 15:35:42,685 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3787.83ms
2017-03-16 15:35:42,685 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3787.83ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3787.83ms
2017-03-16 15:38:29,503 = tornado.access - WARNING - 404 GET / (60.191.38.77) 0.73ms
WARNING:tornado.access:404 GET / (60.191.38.77) 0.73ms
2017-03-16 15:38:29,503 = tornado.access - WARNING - 404 GET / (60.191.38.77) 0.73ms
2017-03-16 16:27:35,804 = tornado.access - WARNING - 404 GET / (112.135.58.155) 0.58ms
WARNING:tornado.access:404 GET / (112.135.58.155) 0.58ms
2017-03-16 16:27:35,804 = tornado.access - WARNING - 404 GET / (112.135.58.155) 0.58ms
2017-03-16 16:49:54,868 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-16 16:49:54,868 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-16 16:49:54,869 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-16 16:49:54,869 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 16:49:54
2017-03-16 16:49:54,869 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 16:49:54,869 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 16:49:54
2017-03-16 16:49:54,869 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 16/03/2017 16:49:54
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-16 16:49:54,870 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 16:49:54,869 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 16:49:54,870 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-16 16:49:54,870 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 604dd1d187584cd8bc40328c08093468
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 604dd1d187584cd8bc40328c08093468
2017-03-16 16:49:54,870 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 16:49:54,870 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 604dd1d187584cd8bc40328c08093468
2017-03-16 16:49:54,870 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-16 16:49:54,871 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 16:49:54,871 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 16:49:54,871 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 16:49:54</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>604dd1d187584cd8bc40328c08093468</ns0:EXTREFNUM><ns0:MSISDN2>254725437441</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 16:49:54</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>604dd1d187584cd8bc40328c08093468</ns0:EXTREFNUM><ns0:MSISDN2>254725437441</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 16:49:54,871 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 16:49:54,871 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 16:49:54</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>604dd1d187584cd8bc40328c08093468</ns0:EXTREFNUM><ns0:MSISDN2>254725437441</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 16:49:54,871 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 16:49:54,872 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 16:49:54,872 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 16:49:54</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>604dd1d187584cd8bc40328c08093468</ns0:EXTREFNUM><ns0:MSISDN2>254725437441</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-16 16:49:54,872 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 16:49:54,872 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 16:49:54,872 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 16:49:54</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>604dd1d187584cd8bc40328c08093468</ns0:EXTREFNUM><ns0:MSISDN2>254725437441</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 16:49:54,872 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 16:49:54</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>604dd1d187584cd8bc40328c08093468</ns0:EXTREFNUM><ns0:MSISDN2>254725437441</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-16 16:49:55,698 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 16:49:55,698 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 16:47:13</ns0:DATE><ns0:EXTREFNUM>604dd1d187584cd8bc40328c08093468</ns0:EXTREFNUM><ns0:TXNID>R170316.1647.140013</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 725437441 is successful. Your new balance is KSH 2480</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 16:49:55,699 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 16:49:55,699 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-16 16:49:55,699 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-16 16:49:55,700 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 16:47:13
2017-03-16 16:49:55,700 = handlers.result_handler.AirtimeHandler - DEBUG - 604dd1d187584cd8bc40328c08093468
2017-03-16 16:49:55,700 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1647.140013
2017-03-16 16:49:55,700 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 16:47:13', 'amount': '10', 'external_ref': u'R170316.1647.140013', 'msisdn_2': u'254725437441', 'internal_ref': u'604dd1d187584cd8bc40328c08093468'}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 16:47:13</ns0:DATE><ns0:EXTREFNUM>604dd1d187584cd8bc40328c08093468</ns0:EXTREFNUM><ns0:TXNID>R170316.1647.140013</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 725437441 is successful. Your new balance is KSH 2480</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:16/03/17 16:47:13
DEBUG:handlers.result_handler.AirtimeHandler:604dd1d187584cd8bc40328c08093468
DEBUG:handlers.result_handler.AirtimeHandler:R170316.1647.140013
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'16/03/17 16:47:13', 'amount': '10', 'external_ref': u'R170316.1647.140013', 'msisdn_2': u'254725437441', 'internal_ref': u'604dd1d187584cd8bc40328c08093468'}
2017-03-16 16:49:55,698 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 16:49:55,698 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 16:47:13</ns0:DATE><ns0:EXTREFNUM>604dd1d187584cd8bc40328c08093468</ns0:EXTREFNUM><ns0:TXNID>R170316.1647.140013</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 725437441 is successful. Your new balance is KSH 2480</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 16:49:55,699 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 16:49:55,699 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-16 16:49:55,699 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-16 16:49:55,700 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 16:47:13
2017-03-16 16:49:55,700 = handlers.result_handler.AirtimeHandler - DEBUG - 604dd1d187584cd8bc40328c08093468
2017-03-16 16:49:55,700 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1647.140013
2017-03-16 16:49:55,700 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 16:47:13', 'amount': '10', 'external_ref': u'R170316.1647.140013', 'msisdn_2': u'254725437441', 'internal_ref': u'604dd1d187584cd8bc40328c08093468'}
2017-03-16 16:49:55,702 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-16 16:49:55,702 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-16 16:49:55,754 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-16 16:49:55,755 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-16 16:49:55,759 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-16 16:49:55,760 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 16:49:55,766 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-16 16:49:55,769 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 16:49:55,773 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-16 16:49:55,775 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 16:49:55,781 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-16 16:49:55,782 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 16:49:55,785 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-16 16:49:55,786 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 16:49:55,790 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-16 16:49:55,791 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-16 16:49:55,794 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-16 16:49:55,794 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 16:49:55,800 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-16 16:49:55,801 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 16:49:55,803 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-16 16:49:55,804 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7fec71cf5290>
2017-03-16 16:49:55,812 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-16 16:49:55,812 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-16 16:49:55,813 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-16 16:49:55,813 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-16 16:49:55,813 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254725437441
2017-03-16 16:49:55,813 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254725437441
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254725437441
2017-03-16 16:49:55,814 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 16:49:55,814 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-16 16:49:55,815 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
2017-03-16 16:49:55,815 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
2017-03-16 16:49:55,815 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-16 16:49:55,815 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-16 16:49:55,816 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 16:49:55,816 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-16 16:49:55,816 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-16 16:49:55,816 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-16 16:49:57,135 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":16,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T16:47:14.935928Z"}
2017-03-16 16:49:57,135 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":16,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T16:47:14.935928Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":16,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T16:47:14.935928Z"}
2017-03-16 16:49:57,137 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-16 16:49:57,137 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-16 16:49:57,138 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":16,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T16:47:14.935928Z"}
2017-03-16 16:49:57,138 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":16,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T16:47:14.935928Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":16,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T16:47:14.935928Z"}
2017-03-16 16:49:57,138 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-16 16:49:57,138 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-16 16:49:57,139 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-16 16:49:57,139 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-16 16:49:57,139 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-16 16:49:57,139 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-16 16:49:57,140 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-16 16:49:57,140 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-16 16:49:57,141 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "@", "destination_mobile_number": "254725437441", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-16 16:49:57,141 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "@", "destination_mobile_number": "254725437441", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "@", "destination_mobile_number": "254725437441", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-16 16:49:57,141 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-16 16:49:57,141 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-16 16:49:58,750 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 16:49:58,750 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 16:49:58,752 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-16 16:49:58,752 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-16 16:49:58,752 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 16:49:58,752 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 16:49:58,753 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-16 16:49:58,753 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-16 16:49:58,754 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3886.44ms
2017-03-16 16:49:58,754 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3886.44ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3886.44ms
2017-03-16 16:58:05,662 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.49ms
WARNING:tornado.access:404 GET http://www.google.com/ (91.236.75.4) 0.49ms
2017-03-16 16:58:05,662 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.49ms
2017-03-16 17:46:46,572 = tornado.access - WARNING - 404 GET / (219.151.7.149) 0.97ms
2017-03-16 17:46:46,572 = tornado.access - WARNING - 404 GET / (219.151.7.149) 0.97ms
WARNING:tornado.access:404 GET / (219.151.7.149) 0.97ms
2017-03-16 17:57:49,216 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.83ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.83ms
2017-03-16 17:57:49,216 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.83ms
2017-03-16 18:06:41,322 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2500/-------------------
2017-03-16 18:06:41,322 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 18:06:41,322 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 18:06:41
2017-03-16 18:06:41,323 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 18:06:41,323 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 18:06:41,323 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = e9b41e53cace4693b0363db5d094015a
2017-03-16 18:06:41,323 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 18:06:41,323 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 18:06:41,324 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 18:06:41</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e9b41e53cace4693b0363db5d094015a</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 18:06:41,324 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 18:06:41,324 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 18:06:41,324 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 18:06:41</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e9b41e53cace4693b0363db5d094015a</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 18:06:41,324 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/2500/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 16/03/2017 18:06:41
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = e9b41e53cace4693b0363db5d094015a
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 18:06:41</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e9b41e53cace4693b0363db5d094015a</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 18:06:41</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e9b41e53cace4693b0363db5d094015a</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-16 18:06:41,322 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2500/-------------------
2017-03-16 18:06:41,322 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 18:06:41,322 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 18:06:41
2017-03-16 18:06:41,323 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 18:06:41,323 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 18:06:41,323 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = e9b41e53cace4693b0363db5d094015a
2017-03-16 18:06:41,323 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 18:06:41,323 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 18:06:41,324 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 18:06:41</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e9b41e53cace4693b0363db5d094015a</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 18:06:41,324 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 18:06:41,324 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 18:06:41,324 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 18:06:41</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e9b41e53cace4693b0363db5d094015a</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 18:06:41,324 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 18:06:42,129 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 18:06:42,129 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 18:03:59</ns0:DATE><ns0:EXTREFNUM>e9b41e53cace4693b0363db5d094015a</ns0:EXTREFNUM><ns0:TXNID>R170316.1803.140062</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 25 to 721799582 is successful. Your new balance is KSH 2455</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 18:06:42,130 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 18:06:42,130 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------25-----------------------
2017-03-16 18:06:42,130 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-16 18:06:42,130 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 18:03:59
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 18:03:59</ns0:DATE><ns0:EXTREFNUM>e9b41e53cace4693b0363db5d094015a</ns0:EXTREFNUM><ns0:TXNID>R170316.1803.140062</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 25 to 721799582 is successful. Your new balance is KSH 2455</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------25-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-16 18:06:42,129 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 18:06:42,129 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 18:03:59</ns0:DATE><ns0:EXTREFNUM>e9b41e53cace4693b0363db5d094015a</ns0:EXTREFNUM><ns0:TXNID>R170316.1803.140062</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 25 to 721799582 is successful. Your new balance is KSH 2455</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 18:06:42,130 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 18:06:42,130 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------25-----------------------
2017-03-16 18:06:42,130 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-16 18:06:42,130 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 18:03:59
2017-03-16 18:06:42,130 = handlers.result_handler.AirtimeHandler - DEBUG - e9b41e53cace4693b0363db5d094015a
DEBUG:handlers.result_handler.AirtimeHandler:16/03/17 18:03:59
DEBUG:handlers.result_handler.AirtimeHandler:e9b41e53cace4693b0363db5d094015a
2017-03-16 18:06:42,130 = handlers.result_handler.AirtimeHandler - DEBUG - e9b41e53cace4693b0363db5d094015a
2017-03-16 18:06:42,131 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1803.140062
2017-03-16 18:06:42,131 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.1803.140062
DEBUG:handlers.result_handler.AirtimeHandler:R170316.1803.140062
2017-03-16 18:06:42,131 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 18:03:59', 'amount': '25', 'external_ref': u'R170316.1803.140062', 'msisdn_2': u'254721799582', 'internal_ref': u'e9b41e53cace4693b0363db5d094015a'}
2017-03-16 18:06:42,131 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 18:03:59', 'amount': '25', 'external_ref': u'R170316.1803.140062', 'msisdn_2': u'254721799582', 'internal_ref': u'e9b41e53cace4693b0363db5d094015a'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'16/03/17 18:03:59', 'amount': '25', 'external_ref': u'R170316.1803.140062', 'msisdn_2': u'254721799582', 'internal_ref': u'e9b41e53cace4693b0363db5d094015a'}
2017-03-16 18:06:42,131 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-16 18:06:42,131 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-16 18:06:42,175 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-16 18:06:42,175 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-16 18:06:42,178 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 18:06:42,178 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-16 18:06:42,182 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-16 18:06:42,182 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 18:06:42,184 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 18:06:42,184 INFO sqlalchemy.engine.base.Engine {}
2017-03-16 18:06:42,187 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 18:06:42,187 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-16 18:06:42,189 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-16 18:06:42,189 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-16 18:06:42,190 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-16 18:06:42,191 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-16 18:06:42,192 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 18:06:42,193 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-16 18:06:42,196 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-16 18:06:42,196 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-16 18:06:42,198 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-16 18:06:42,198 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 18:06:42,203 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7fec719ec250>
2017-03-16 18:06:42,203 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-16 18:06:42,203 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-16 18:06:42,203 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-16 18:06:42,203 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 25 of airtime from Saiba  to 254721799582
2017-03-16 18:06:42,203 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 25 of airtime from Saiba  to 254721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 25 of airtime from Saiba  to 254721799582
2017-03-16 18:06:42,204 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 18:06:42,204 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-16 18:06:42,204 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 25 of airtime from Saiba  to 3
2017-03-16 18:06:42,204 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 25 of airtime from Saiba  to 3
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 25 of airtime from Saiba  to 3
2017-03-16 18:06:42,204 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 25 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-16 18:06:42,204 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 25 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 25 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-16 18:06:42,204 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 18:06:42,204 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-16 18:06:42,204 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 25 of airtime from Saiba 
2017-03-16 18:06:42,204 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 25 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 25 of airtime from Saiba 
2017-03-16 18:06:43,449 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":17,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 25 of airtime from Saiba","image_url":"","date":"2017-03-16T18:04:01.107551Z"}
2017-03-16 18:06:43,449 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":17,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 25 of airtime from Saiba","image_url":"","date":"2017-03-16T18:04:01.107551Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":17,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 25 of airtime from Saiba","image_url":"","date":"2017-03-16T18:04:01.107551Z"}
2017-03-16 18:06:43,451 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-16 18:06:43,451 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-16 18:06:43,451 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":17,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 25 of airtime from Saiba","image_url":"","date":"2017-03-16T18:04:01.107551Z"}
2017-03-16 18:06:43,451 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":17,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 25 of airtime from Saiba","image_url":"","date":"2017-03-16T18:04:01.107551Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":17,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 25 of airtime from Saiba","image_url":"","date":"2017-03-16T18:04:01.107551Z"}
2017-03-16 18:06:43,451 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-16 18:06:43,451 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-16 18:06:43,452 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-16 18:06:43,452 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-16 18:06:43,452 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-16 18:06:43,452 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-16 18:06:43,452 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-16 18:06:43,452 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-16 18:06:43,452 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254721799582", "user": 3, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "2500", "service_provider_id": 1}
2017-03-16 18:06:43,452 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254721799582", "user": 3, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "2500", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": null, "destination_mobile_number": "254721799582", "user": 3, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "2500", "service_provider_id": 1}
2017-03-16 18:06:43,452 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-16 18:06:43,452 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-16 18:06:44,654 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 18:06:44,654 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 18:06:44,655 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-16 18:06:44,655 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-16 18:06:44,655 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 18:06:44,655 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 18:06:44,656 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-16 18:06:44,656 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-16 18:06:44,657 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3335.45ms
2017-03-16 18:06:44,657 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3335.45ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3335.45ms
2017-03-16 20:01:11,540 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.60ms
2017-03-16 20:01:11,540 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.60ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.60ms
2017-03-16 20:47:32,683 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-16 20:47:32,683 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-16 20:47:32,684 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-16 20:47:32,684 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-16 20:47:32,684 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 20:47:32
2017-03-16 20:47:32,684 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 16/03/2017 20:47:32
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 16/03/2017 20:47:32
2017-03-16 20:47:32,684 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-16 20:47:32,684 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-16 20:47:32,684 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-16 20:47:32,684 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-16 20:47:32,685 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 80fdef887d0847f5b60fda2c0cf1f445
2017-03-16 20:47:32,685 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 80fdef887d0847f5b60fda2c0cf1f445
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 80fdef887d0847f5b60fda2c0cf1f445
2017-03-16 20:47:32,685 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-16 20:47:32,685 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-16 20:47:32,685 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-16 20:47:32,685 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-16 20:47:32,685 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 20:47:32</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>80fdef887d0847f5b60fda2c0cf1f445</ns0:EXTREFNUM><ns0:MSISDN2>254712661665</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 20:47:32,685 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 20:47:32</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>80fdef887d0847f5b60fda2c0cf1f445</ns0:EXTREFNUM><ns0:MSISDN2>254712661665</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 20:47:32</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>80fdef887d0847f5b60fda2c0cf1f445</ns0:EXTREFNUM><ns0:MSISDN2>254712661665</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 20:47:32,686 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-16 20:47:32,686 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-16 20:47:32,686 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-16 20:47:32,686 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-16 20:47:32,686 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 20:47:32</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>80fdef887d0847f5b60fda2c0cf1f445</ns0:EXTREFNUM><ns0:MSISDN2>254712661665</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 20:47:32,686 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 20:47:32</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>80fdef887d0847f5b60fda2c0cf1f445</ns0:EXTREFNUM><ns0:MSISDN2>254712661665</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>16/03/2017 20:47:32</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>80fdef887d0847f5b60fda2c0cf1f445</ns0:EXTREFNUM><ns0:MSISDN2>254712661665</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-16 20:47:32,686 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-16 20:47:32,686 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-16 20:47:33,479 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-16 20:47:33,479 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-16 20:47:33,480 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 20:44:50</ns0:DATE><ns0:EXTREFNUM>80fdef887d0847f5b60fda2c0cf1f445</ns0:EXTREFNUM><ns0:TXNID>R170316.2044.140054</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 712661665 is successful. Your new balance is KSH 2445</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 20:47:33,480 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 20:44:50</ns0:DATE><ns0:EXTREFNUM>80fdef887d0847f5b60fda2c0cf1f445</ns0:EXTREFNUM><ns0:TXNID>R170316.2044.140054</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 712661665 is successful. Your new balance is KSH 2445</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>16/03/17 20:44:50</ns0:DATE><ns0:EXTREFNUM>80fdef887d0847f5b60fda2c0cf1f445</ns0:EXTREFNUM><ns0:TXNID>R170316.2044.140054</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 712661665 is successful. Your new balance is KSH 2445</ns0:MESSAGE></ns0:COMMAND>

2017-03-16 20:47:33,480 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-16 20:47:33,480 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-16 20:47:33,480 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-16 20:47:33,480 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
2017-03-16 20:47:33,480 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-16 20:47:33,480 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-16 20:47:33,480 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 20:44:50
2017-03-16 20:47:33,480 = handlers.result_handler.AirtimeHandler - DEBUG - 16/03/17 20:44:50
DEBUG:handlers.result_handler.AirtimeHandler:16/03/17 20:44:50
2017-03-16 20:47:33,481 = handlers.result_handler.AirtimeHandler - DEBUG - 80fdef887d0847f5b60fda2c0cf1f445
2017-03-16 20:47:33,481 = handlers.result_handler.AirtimeHandler - DEBUG - 80fdef887d0847f5b60fda2c0cf1f445
DEBUG:handlers.result_handler.AirtimeHandler:80fdef887d0847f5b60fda2c0cf1f445
2017-03-16 20:47:33,481 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.2044.140054
2017-03-16 20:47:33,481 = handlers.result_handler.AirtimeHandler - DEBUG - R170316.2044.140054
DEBUG:handlers.result_handler.AirtimeHandler:R170316.2044.140054
2017-03-16 20:47:33,481 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 20:44:50', 'amount': '10', 'external_ref': u'R170316.2044.140054', 'msisdn_2': u'254712661665', 'internal_ref': u'80fdef887d0847f5b60fda2c0cf1f445'}
2017-03-16 20:47:33,481 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'16/03/17 20:44:50', 'amount': '10', 'external_ref': u'R170316.2044.140054', 'msisdn_2': u'254712661665', 'internal_ref': u'80fdef887d0847f5b60fda2c0cf1f445'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'16/03/17 20:44:50', 'amount': '10', 'external_ref': u'R170316.2044.140054', 'msisdn_2': u'254712661665', 'internal_ref': u'80fdef887d0847f5b60fda2c0cf1f445'}
2017-03-16 20:47:33,481 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-16 20:47:33,481 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-16 20:47:33,520 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-16 20:47:33,520 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-16 20:47:33,523 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-16 20:47:33,523 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-16 20:47:33,526 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-16 20:47:33,526 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-16 20:47:33,528 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-16 20:47:33,528 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-16 20:47:33,531 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-16 20:47:33,531 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-16 20:47:33,533 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-16 20:47:33,533 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 20:47:33,535 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-16 20:47:33,535 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-16 20:47:33,537 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 20:47:33,537 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-16 20:47:33,541 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-16 20:47:33,541 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-16 20:47:33,543 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-16 20:47:33,543 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-16 20:47:33,548 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7fec719771d0>
2017-03-16 20:47:33,548 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-16 20:47:33,549 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-16 20:47:33,549 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-16 20:47:33,549 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254712661665
2017-03-16 20:47:33,549 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254712661665
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254712661665
2017-03-16 20:47:33,549 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-16 20:47:33,549 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-16 20:47:33,549 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 9
2017-03-16 20:47:33,549 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 9
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 9
2017-03-16 20:47:33,549 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "9", "title": "Safaricom  Airtime"}
2017-03-16 20:47:33,549 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "9", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "9", "title": "Safaricom  Airtime"}
2017-03-16 20:47:33,550 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-16 20:47:33,550 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-16 20:47:33,550 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-16 20:47:33,550 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-16 20:47:34,843 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":18,"user":9,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T20:44:52.199916Z"}
2017-03-16 20:47:34,843 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":18,"user":9,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T20:44:52.199916Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":18,"user":9,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T20:44:52.199916Z"}
2017-03-16 20:47:34,843 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-16 20:47:34,843 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-16 20:47:34,843 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":18,"user":9,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T20:44:52.199916Z"}
2017-03-16 20:47:34,843 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":18,"user":9,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T20:44:52.199916Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":18,"user":9,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-16T20:44:52.199916Z"}
2017-03-16 20:47:34,844 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-16 20:47:34,844 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-16 20:47:34,844 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-16 20:47:34,844 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-16 20:47:34,844 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-16 20:47:34,844 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-16 20:47:34,844 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-16 20:47:34,844 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-16 20:47:34,844 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "buy airtime", "destination_mobile_number": "254712661665", "user": 9, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-16 20:47:34,844 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "buy airtime", "destination_mobile_number": "254712661665", "user": 9, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "buy airtime", "destination_mobile_number": "254712661665", "user": 9, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-16 20:47:34,844 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-16 20:47:34,844 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-16 20:47:35,985 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
2017-03-16 20:47:35,985 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 277, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-16 20:47:35,986 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-16 20:47:35,986 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-16 20:47:35,987 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 20:47:35,987 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 295, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-16 20:47:35,987 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-16 20:47:35,987 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-16 20:47:35,988 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3305.32ms
2017-03-16 20:47:35,988 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3305.32ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3305.32ms
2017-03-16 22:54:26,341 = tornado.access - WARNING - 404 GET / (93.142.10.237) 0.59ms
WARNING:tornado.access:404 GET / (93.142.10.237) 0.59ms
2017-03-16 22:54:26,341 = tornado.access - WARNING - 404 GET / (93.142.10.237) 0.59ms
2017-03-16 22:58:37,223 = tornado.access - WARNING - 404 GET / (69.164.211.196) 0.73ms
2017-03-16 22:58:37,223 = tornado.access - WARNING - 404 GET / (69.164.211.196) 0.73ms
WARNING:tornado.access:404 GET / (69.164.211.196) 0.73ms
2017-03-16 23:20:14,848 = tornado.access - WARNING - 404 GET /script (222.186.34.119) 0.47ms
WARNING:tornado.access:404 GET /script (222.186.34.119) 0.47ms
2017-03-16 23:20:14,848 = tornado.access - WARNING - 404 GET /script (222.186.34.119) 0.47ms
2017-03-16 23:26:19,497 = tornado.access - WARNING - 404 GET / (60.191.38.77) 0.79ms
WARNING:tornado.access:404 GET / (60.191.38.77) 0.79ms
2017-03-16 23:26:19,497 = tornado.access - WARNING - 404 GET / (60.191.38.77) 0.79ms
2017-03-17 02:59:33,288 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.45ms
WARNING:tornado.access:404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.45ms
2017-03-17 02:59:33,288 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.45ms
2017-03-17 07:27:16,257 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.44ms
WARNING:tornado.access:404 GET http://www.google.com/ (91.236.75.4) 0.44ms
2017-03-17 07:27:16,257 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.44ms
2017-03-17 07:45:02,715 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.43ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.43ms
2017-03-17 07:45:02,715 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.43ms
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 12, in <module>
    from common import Application
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/__init__.py", line 2, in <module>
    from application import Application
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/application.py", line 37
    "notification_url":"https://wallet.api.saiba.co.ke/v1/service/notification/",
                      ^
SyntaxError: invalid syntax
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 12, in <module>
    from common import Application
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/__init__.py", line 2, in <module>
    from application import Application
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/application.py", line 37
    "notification_url":"https://wallet.api.saiba.co.ke/v1/service/notification/",
                      ^
SyntaxError: invalid syntax
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 12, in <module>
    from common import Application
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/__init__.py", line 2, in <module>
    from application import Application
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/application.py", line 37
    "notification_url":"https://wallet.api.saiba.co.ke/v1/service/notification/",
                      ^
SyntaxError: invalid syntax
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 12, in <module>
    from common import Application
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/__init__.py", line 2, in <module>
    from application import Application
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/application.py", line 37
    "notification_url":"https://wallet.api.saiba.co.ke/v1/service/notification/",
                      ^
SyntaxError: invalid syntax
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 12, in <module>
    from common import Application
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/__init__.py", line 2, in <module>
    from application import Application
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/application.py", line 5, in <module>
    from handlers import AirtimeHandler
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/__init__.py", line 1, in <module>
    from airtime_handler import AirtimeHandler
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 16, in <module>
    class AirtimeHandler(BaseHandler,SentryMixin):
NameError: name 'SentryMixin' is not defined
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 12, in <module>
    from common import Application
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/__init__.py", line 2, in <module>
    from application import Application
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/application.py", line 5, in <module>
    from handlers import AirtimeHandler
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/__init__.py", line 1, in <module>
    from airtime_handler import AirtimeHandler
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 16, in <module>
    class AirtimeHandler(BaseHandler,SentryMixin):
NameError: name 'SentryMixin' is not defined
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 12, in <module>
    from common import Application
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/__init__.py", line 2, in <module>
    from application import Application
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/application.py", line 5, in <module>
    from handlers import AirtimeHandler
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/__init__.py", line 1, in <module>
    from airtime_handler import AirtimeHandler
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 16, in <module>
    class AirtimeHandler(BaseHandler,SentryMixin):
NameError: name 'SentryMixin' is not defined
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 12, in <module>
    from common import Application
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/__init__.py", line 2, in <module>
    from application import Application
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/application.py", line 5, in <module>
    from handlers import AirtimeHandler
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/__init__.py", line 1, in <module>
    from airtime_handler import AirtimeHandler
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 16, in <module>
    class AirtimeHandler(BaseHandler,SentryMixin):
NameError: name 'SentryMixin' is not defined
2017-03-17 10:28:07,753 = __main__ - INFO - Creating server
2017-03-17 10:28:07,753 = __main__ - INFO - Creating server
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 49, in <module>
    main()
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 35, in main
    http_server = HTTPServer(Application())
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/application.py", line 44, in __init__
    'https://6fbec91e99c24fe291d972b81acecd84:43722299fd2b490b808f3e8b1ca3ac95@sentry.io/146906'
AttributeError: 'Application' object has no attribute 'application'
2017-03-17 10:28:09,049 = __main__ - INFO - Creating server
2017-03-17 10:28:09,049 = __main__ - INFO - Creating server
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 49, in <module>
    main()
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 35, in main
    http_server = HTTPServer(Application())
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/application.py", line 44, in __init__
    'https://6fbec91e99c24fe291d972b81acecd84:43722299fd2b490b808f3e8b1ca3ac95@sentry.io/146906'
AttributeError: 'Application' object has no attribute 'application'
2017-03-17 10:28:11,348 = __main__ - INFO - Creating server
2017-03-17 10:28:11,348 = __main__ - INFO - Creating server
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 49, in <module>
    main()
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 35, in main
    http_server = HTTPServer(Application())
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/application.py", line 44, in __init__
    'https://6fbec91e99c24fe291d972b81acecd84:43722299fd2b490b808f3e8b1ca3ac95@sentry.io/146906'
AttributeError: 'Application' object has no attribute 'application'
2017-03-17 10:28:14,647 = __main__ - INFO - Creating server
2017-03-17 10:28:14,647 = __main__ - INFO - Creating server
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 49, in <module>
    main()
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 35, in main
    http_server = HTTPServer(Application())
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/application.py", line 44, in __init__
    'https://6fbec91e99c24fe291d972b81acecd84:43722299fd2b490b808f3e8b1ca3ac95@sentry.io/146906'
AttributeError: 'Application' object has no attribute 'application'
2017-03-17 10:29:13,308 = __main__ - INFO - Creating server
2017-03-17 10:29:13,308 = __main__ - INFO - Creating server
2017-03-17 10:29:13,312 = __main__ - INFO - Created server
2017-03-17 10:29:13,312 = __main__ - INFO - Created server
2017-03-17 10:29:13,313 = __main__ - INFO - Listening on port 8080
2017-03-17 10:29:13,313 = __main__ - INFO - Listening on port 8080
2017-03-17 10:29:13,314 = __main__ - INFO - Starting event loop
2017-03-17 10:29:13,314 = __main__ - INFO - Starting event loop
2017-03-17 10:29:46,755 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-17 10:29:46,755 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-17 10:29:46,756 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-17 10:29:46,756 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-17 10:29:46,756 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 10:29:46
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 17/03/2017 10:29:46
2017-03-17 10:29:46,756 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 10:29:46
2017-03-17 10:29:46,756 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-17 10:29:46,756 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-17 10:29:46,757 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-17 10:29:46,757 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-17 10:29:46,757 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 24bc9a5ce8074bbb8ec7b181a2ad242f
2017-03-17 10:29:46,757 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 24bc9a5ce8074bbb8ec7b181a2ad242f
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 24bc9a5ce8074bbb8ec7b181a2ad242f
2017-03-17 10:29:46,758 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-17 10:29:46,758 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-17 10:29:46,758 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-17 10:29:46,758 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-17 10:29:46,758 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:29:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>24bc9a5ce8074bbb8ec7b181a2ad242f</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:29:46,758 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:29:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>24bc9a5ce8074bbb8ec7b181a2ad242f</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:29:46,758 = handlers.result_handler.AirtimeHandler - INFO - Built XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:29:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>24bc9a5ce8074bbb8ec7b181a2ad242f</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:29:46,758 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-17 10:29:46,759 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-17 10:29:46,759 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-17 10:29:46,759 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:29:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>24bc9a5ce8074bbb8ec7b181a2ad242f</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:29:46,759 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:29:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>24bc9a5ce8074bbb8ec7b181a2ad242f</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:29:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>24bc9a5ce8074bbb8ec7b181a2ad242f</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:29:46,759 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-17 10:29:46,759 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-17 10:29:47,623 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-17 10:29:47,623 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-17 10:29:47,623 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 10:27:03</ns0:DATE><ns0:EXTREFNUM>24bc9a5ce8074bbb8ec7b181a2ad242f</ns0:EXTREFNUM><ns0:TXNID>R170317.1027.140003</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 2435</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 10:29:47,623 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 10:27:03</ns0:DATE><ns0:EXTREFNUM>24bc9a5ce8074bbb8ec7b181a2ad242f</ns0:EXTREFNUM><ns0:TXNID>R170317.1027.140003</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 2435</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 10:29:47,624 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 10:27:03</ns0:DATE><ns0:EXTREFNUM>24bc9a5ce8074bbb8ec7b181a2ad242f</ns0:EXTREFNUM><ns0:TXNID>R170317.1027.140003</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 2435</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-17 10:29:47,624 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-17 10:29:47,624 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-17 10:29:47,624 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
2017-03-17 10:29:47,625 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-17 10:29:47,625 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-17 10:29:47,625 = handlers.result_handler.AirtimeHandler - DEBUG - 17/03/17 10:27:03
2017-03-17 10:29:47,625 = handlers.result_handler.AirtimeHandler - DEBUG - 17/03/17 10:27:03
DEBUG:handlers.result_handler.AirtimeHandler:17/03/17 10:27:03
2017-03-17 10:29:47,626 = handlers.result_handler.AirtimeHandler - DEBUG - 24bc9a5ce8074bbb8ec7b181a2ad242f
2017-03-17 10:29:47,626 = handlers.result_handler.AirtimeHandler - DEBUG - 24bc9a5ce8074bbb8ec7b181a2ad242f
DEBUG:handlers.result_handler.AirtimeHandler:24bc9a5ce8074bbb8ec7b181a2ad242f
2017-03-17 10:29:47,626 = handlers.result_handler.AirtimeHandler - DEBUG - R170317.1027.140003
2017-03-17 10:29:47,626 = handlers.result_handler.AirtimeHandler - DEBUG - R170317.1027.140003
DEBUG:handlers.result_handler.AirtimeHandler:R170317.1027.140003
2017-03-17 10:29:47,627 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'17/03/17 10:27:03', 'amount': '10', 'external_ref': u'R170317.1027.140003', 'msisdn_2': u'0721799582', 'internal_ref': u'24bc9a5ce8074bbb8ec7b181a2ad242f'}
2017-03-17 10:29:47,627 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'17/03/17 10:27:03', 'amount': '10', 'external_ref': u'R170317.1027.140003', 'msisdn_2': u'0721799582', 'internal_ref': u'24bc9a5ce8074bbb8ec7b181a2ad242f'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'17/03/17 10:27:03', 'amount': '10', 'external_ref': u'R170317.1027.140003', 'msisdn_2': u'0721799582', 'internal_ref': u'24bc9a5ce8074bbb8ec7b181a2ad242f'}
2017-03-17 10:29:47,627 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-17 10:29:47,627 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-17 10:29:47,747 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-17 10:29:47,747 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-17 10:29:47,751 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 10:29:47,751 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-17 10:29:47,757 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-17 10:29:47,757 INFO sqlalchemy.engine.base.Engine {}
2017-03-17 10:29:47,760 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-17 10:29:47,760 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-17 10:29:47,765 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-17 10:29:47,766 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-17 10:29:47,769 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-17 10:29:47,769 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-17 10:29:47,773 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-17 10:29:47,773 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-17 10:29:47,777 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-17 10:29:47,778 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 10:29:47,783 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 10:29:47,783 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-17 10:29:47,785 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-17 10:29:47,786 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 10:29:47,792 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7fd52e6edcd0>
2017-03-17 10:29:47,792 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-17 10:29:47,793 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-17 10:29:47,793 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-17 10:29:47,794 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 0721799582
2017-03-17 10:29:47,794 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 0721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 0721799582
2017-03-17 10:29:47,794 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-17 10:29:47,794 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-17 10:29:47,794 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
2017-03-17 10:29:47,794 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
2017-03-17 10:29:47,795 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 10:29:47,795 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 10:29:47,795 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-17 10:29:47,795 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-17 10:29:47,795 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-17 10:29:47,795 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-17 10:29:49,164 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":19,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T10:27:04.970253Z"}
2017-03-17 10:29:49,164 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":19,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T10:27:04.970253Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":19,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T10:27:04.970253Z"}
2017-03-17 10:29:49,164 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-17 10:29:49,164 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-17 10:29:49,165 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":19,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T10:27:04.970253Z"}
2017-03-17 10:29:49,165 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":19,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T10:27:04.970253Z"}
2017-03-17 10:29:49,165 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-17 10:29:49,165 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:{"id":19,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T10:27:04.970253Z"}
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-17 10:29:49,165 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-17 10:29:49,165 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-17 10:29:49,165 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-17 10:29:49,165 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-17 10:29:49,165 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-17 10:29:49,165 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-17 10:29:49,166 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "", "destination_mobile_number": "0721799582", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-17 10:29:49,166 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "", "destination_mobile_number": "0721799582", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-17 10:29:49,166 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-17 10:29:49,166 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "", "destination_mobile_number": "0721799582", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-17 10:29:50,227 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-17 10:29:50,228 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":7,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"0721799582","request":null,"amount":1000.0,"payment_method":1,"note":"","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-17 10:29:50,228 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-17 10:29:50,227 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-17 10:29:50,228 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":7,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"0721799582","request":null,"amount":1000.0,"payment_method":1,"note":"","bundle":null,"account_number":null}
2017-03-17 10:29:50,228 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:{"id":7,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"0721799582","request":null,"amount":1000.0,"payment_method":1,"note":"","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-17 10:29:50,228 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
2017-03-17 10:29:50,228 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": "LC323322"}
2017-03-17 10:29:51,340 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-17 10:29:51,340 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-17 10:29:51,340 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-17 10:29:51,340 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
{"status": 1, "message": "Transaction not found"}
2017-03-17 10:29:51,341 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-17 10:29:51,341 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:{"status": 1, "message": "Transaction not found"}
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-17 10:29:51,341 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-17 10:29:51,341 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-17 10:29:51,342 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4587.78ms
2017-03-17 10:29:51,342 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4587.78ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 4587.78ms
2017-03-17 10:32:31,802 = __main__ - INFO - Creating server
2017-03-17 10:32:31,802 = __main__ - INFO - Creating server
2017-03-17 10:32:31,806 = __main__ - INFO - Created server
2017-03-17 10:32:31,806 = __main__ - INFO - Created server
2017-03-17 10:32:31,806 = __main__ - INFO - Listening on port 8080
2017-03-17 10:32:31,806 = __main__ - INFO - Listening on port 8080
2017-03-17 10:32:31,807 = __main__ - INFO - Starting event loop
2017-03-17 10:32:31,807 = __main__ - INFO - Starting event loop
2017-03-17 10:32:41,938 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-17 10:32:41,938 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-17 10:32:41,938 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-17 10:32:41,938 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-17 10:32:41,939 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 10:32:41
2017-03-17 10:32:41,939 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 10:32:41
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 17/03/2017 10:32:41
2017-03-17 10:32:41,939 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-17 10:32:41,939 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-17 10:32:41,939 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-17 10:32:41,939 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-17 10:32:41,939 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 4b8543a17c2844febc58e6461a1f1c3d
2017-03-17 10:32:41,939 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 4b8543a17c2844febc58e6461a1f1c3d
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 4b8543a17c2844febc58e6461a1f1c3d
2017-03-17 10:32:41,939 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-17 10:32:41,939 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-17 10:32:41,940 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-17 10:32:41,940 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-17 10:32:41,940 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:32:41</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>4b8543a17c2844febc58e6461a1f1c3d</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:32:41,940 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:32:41</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>4b8543a17c2844febc58e6461a1f1c3d</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:32:41</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>4b8543a17c2844febc58e6461a1f1c3d</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:32:41,940 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-17 10:32:41,940 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-17 10:32:41,940 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-17 10:32:41,940 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-17 10:32:41,940 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:32:41</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>4b8543a17c2844febc58e6461a1f1c3d</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:32:41,940 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:32:41</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>4b8543a17c2844febc58e6461a1f1c3d</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:32:41</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>4b8543a17c2844febc58e6461a1f1c3d</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:32:41,941 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-17 10:32:41,941 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-17 10:32:42,569 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-17 10:32:42,569 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-17 10:32:42,570 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>17/03/17 10:29:58</ns0:DATE><ns0:EXTREFNUM>4b8543a17c2844febc58e6461a1f1c3d</ns0:EXTREFNUM><ns0:TXNID>R170317.1029.140075</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-17 10:32:42,570 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>17/03/17 10:29:58</ns0:DATE><ns0:EXTREFNUM>4b8543a17c2844febc58e6461a1f1c3d</ns0:EXTREFNUM><ns0:TXNID>R170317.1029.140075</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>17/03/17 10:29:58</ns0:DATE><ns0:EXTREFNUM>4b8543a17c2844febc58e6461a1f1c3d</ns0:EXTREFNUM><ns0:TXNID>R170317.1029.140075</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 10:32:42,570 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-17 10:32:42,570 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-17 10:32:42,570 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-17 10:32:42,571 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-17 10:32:42,570 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-17 10:32:42,571 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-17 10:32:42,571 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending message could not complete your request at this time please try again later to 8
2017-03-17 10:32:42,571 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 8
2017-03-17 10:32:42,571 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 10:32:42,571 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 10:32:42,571 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "could not complete your request at this time please try again later", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 10:32:42,571 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-17 10:32:42,572 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
2017-03-17 10:32:42,572 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
DEBUG:handlers.result_handler.AirtimeHandler:could not complete your request at this time please try again later
2017-03-17 10:32:42,633 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":20,"user":8,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-17T10:29:58.434082Z"}
2017-03-17 10:32:42,633 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":20,"user":8,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-17T10:29:58.434082Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":20,"user":8,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-17T10:29:58.434082Z"}
2017-03-17 10:32:42,633 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-17 10:32:42,633 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-17 10:32:42,633 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-17 10:32:42,633 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-17 10:32:42,634 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-17 10:32:42,634 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-17 10:32:42,634 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "1000", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-17 10:32:42,634 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "1000", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "1000", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-17 10:32:42,697 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-17 10:32:42,697 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-17 10:32:42,698 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":1000.0,"balance":1000.0}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-17 10:32:42,698 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":1000.0,"balance":1000.0}
2017-03-17 10:32:42,698 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:{"user":8,"user_credit_type":1,"debit":0.0,"credit":1000.0,"balance":1000.0}
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
{"user":8,"user_credit_type":1,"debit":0.0,"credit":1000.0,"balance":1000.0}
2017-03-17 10:32:42,698 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-17 10:32:42,699 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-17 10:32:42,699 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-17 10:32:42,700 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 763.14ms
2017-03-17 10:32:42,700 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 763.14ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 763.14ms
2017-03-17 10:36:32,295 = __main__ - INFO - Creating server
2017-03-17 10:36:32,295 = __main__ - INFO - Creating server
2017-03-17 10:36:32,300 = __main__ - INFO - Created server
2017-03-17 10:36:32,300 = __main__ - INFO - Created server
2017-03-17 10:36:32,301 = __main__ - INFO - Listening on port 8080
2017-03-17 10:36:32,301 = __main__ - INFO - Listening on port 8080
2017-03-17 10:36:32,302 = __main__ - INFO - Starting event loop
2017-03-17 10:36:32,302 = __main__ - INFO - Starting event loop
2017-03-17 10:37:03,546 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-17 10:37:03,546 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-17 10:37:03,547 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/2000/-------------------
2017-03-17 10:37:03,547 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-17 10:37:03,547 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 10:37:03
2017-03-17 10:37:03,547 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 10:37:03
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 17/03/2017 10:37:03
2017-03-17 10:37:03,547 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-17 10:37:03,547 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-17 10:37:03,547 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-17 10:37:03,547 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-17 10:37:03,548 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 8aad977e567f4f46b300164022082aef
2017-03-17 10:37:03,548 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 8aad977e567f4f46b300164022082aef
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 8aad977e567f4f46b300164022082aef
2017-03-17 10:37:03,548 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-17 10:37:03,548 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-17 10:37:03,548 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-17 10:37:03,548 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-17 10:37:03,548 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:37:03</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8aad977e567f4f46b300164022082aef</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:37:03,548 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:37:03</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8aad977e567f4f46b300164022082aef</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:37:03</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8aad977e567f4f46b300164022082aef</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:37:03,549 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-17 10:37:03,549 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-17 10:37:03,549 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-17 10:37:03,549 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-17 10:37:03,549 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:37:03</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8aad977e567f4f46b300164022082aef</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:37:03,549 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:37:03</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8aad977e567f4f46b300164022082aef</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:37:03</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8aad977e567f4f46b300164022082aef</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:37:03,549 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-17 10:37:03,549 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-17 10:37:04,387 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-17 10:37:04,387 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-17 10:37:04,388 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 10:34:20</ns0:DATE><ns0:EXTREFNUM>8aad977e567f4f46b300164022082aef</ns0:EXTREFNUM><ns0:TXNID>R170317.1034.140030</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 721799582 is successful. Your new balance is KSH 2415</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 10:37:04,388 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 10:34:20</ns0:DATE><ns0:EXTREFNUM>8aad977e567f4f46b300164022082aef</ns0:EXTREFNUM><ns0:TXNID>R170317.1034.140030</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 721799582 is successful. Your new balance is KSH 2415</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 10:34:20</ns0:DATE><ns0:EXTREFNUM>8aad977e567f4f46b300164022082aef</ns0:EXTREFNUM><ns0:TXNID>R170317.1034.140030</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 721799582 is successful. Your new balance is KSH 2415</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 10:37:04,388 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-17 10:37:04,388 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-17 10:37:04,389 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------20-----------------------
2017-03-17 10:37:04,389 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------20-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------20-----------------------
2017-03-17 10:37:04,389 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-17 10:37:04,389 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-17 10:37:04,390 = handlers.result_handler.AirtimeHandler - DEBUG - 17/03/17 10:34:20
2017-03-17 10:37:04,390 = handlers.result_handler.AirtimeHandler - DEBUG - 17/03/17 10:34:20
DEBUG:handlers.result_handler.AirtimeHandler:17/03/17 10:34:20
2017-03-17 10:37:04,391 = handlers.result_handler.AirtimeHandler - DEBUG - 8aad977e567f4f46b300164022082aef
2017-03-17 10:37:04,391 = handlers.result_handler.AirtimeHandler - DEBUG - 8aad977e567f4f46b300164022082aef
DEBUG:handlers.result_handler.AirtimeHandler:8aad977e567f4f46b300164022082aef
2017-03-17 10:37:04,391 = handlers.result_handler.AirtimeHandler - DEBUG - R170317.1034.140030
2017-03-17 10:37:04,391 = handlers.result_handler.AirtimeHandler - DEBUG - R170317.1034.140030
DEBUG:handlers.result_handler.AirtimeHandler:R170317.1034.140030
2017-03-17 10:37:04,392 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'17/03/17 10:34:20', 'amount': '20', 'external_ref': u'R170317.1034.140030', 'msisdn_2': u'254721799582', 'internal_ref': u'8aad977e567f4f46b300164022082aef'}
2017-03-17 10:37:04,392 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'17/03/17 10:34:20', 'amount': '20', 'external_ref': u'R170317.1034.140030', 'msisdn_2': u'254721799582', 'internal_ref': u'8aad977e567f4f46b300164022082aef'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'17/03/17 10:34:20', 'amount': '20', 'external_ref': u'R170317.1034.140030', 'msisdn_2': u'254721799582', 'internal_ref': u'8aad977e567f4f46b300164022082aef'}
2017-03-17 10:37:04,392 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-17 10:37:04,392 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-17 10:37:04,504 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-17 10:37:04,505 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-17 10:37:04,508 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-17 10:37:04,508 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 10:37:04,512 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-17 10:37:04,513 INFO sqlalchemy.engine.base.Engine {}
2017-03-17 10:37:04,515 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-17 10:37:04,515 INFO sqlalchemy.engine.base.Engine {}
2017-03-17 10:37:04,520 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 10:37:04,520 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-17 10:37:04,522 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 10:37:04,522 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-17 10:37:04,525 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-17 10:37:04,526 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-17 10:37:04,528 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 10:37:04,528 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-17 10:37:04,533 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-17 10:37:04,533 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 10:37:04,535 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-17 10:37:04,535 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 10:37:04,540 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f15aa0b1fd0>
2017-03-17 10:37:04,540 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-17 10:37:04,540 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-17 10:37:04,540 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-17 10:37:04,541 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 20 of airtime from Saiba  to 254721799582
2017-03-17 10:37:04,541 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 20 of airtime from Saiba  to 254721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 20 of airtime from Saiba  to 254721799582
2017-03-17 10:37:04,541 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-17 10:37:04,541 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-17 10:37:04,541 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 20 of airtime from Saiba  to 8
2017-03-17 10:37:04,541 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 20 of airtime from Saiba  to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 20 of airtime from Saiba  to 8
2017-03-17 10:37:04,541 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 20 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 10:37:04,541 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 20 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 20 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 10:37:04,542 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-17 10:37:04,542 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-17 10:37:04,542 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 20 of airtime from Saiba 
2017-03-17 10:37:04,542 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 20 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 20 of airtime from Saiba 
2017-03-17 10:37:05,817 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":21,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-17T10:34:21.610645Z"}
2017-03-17 10:37:05,817 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":21,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-17T10:34:21.610645Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":21,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-17T10:34:21.610645Z"}
2017-03-17 10:37:05,817 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-17 10:37:05,817 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-17 10:37:05,818 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":21,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-17T10:34:21.610645Z"}
2017-03-17 10:37:05,818 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":21,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-17T10:34:21.610645Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":21,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 20 of airtime from Saiba","image_url":"","date":"2017-03-17T10:34:21.610645Z"}
2017-03-17 10:37:05,818 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-17 10:37:05,818 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-17 10:37:05,818 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-17 10:37:05,818 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-17 10:37:05,818 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-17 10:37:05,818 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-17 10:37:05,818 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-17 10:37:05,818 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-17 10:37:05,819 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "2", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "2", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-17 10:37:05,819 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "2", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-17 10:37:06,846 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-17 10:37:06,846 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-17 10:37:06,846 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":2.0,"balance":982.0}
2017-03-17 10:37:06,846 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":2.0,"balance":982.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":8,"user_credit_type":1,"debit":0.0,"credit":2.0,"balance":982.0}
{"user":8,"user_credit_type":1,"debit":0.0,"credit":2.0,"balance":982.0}
2017-03-17 10:37:06,847 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-17 10:37:06,847 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-17 10:37:06,847 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-17 10:37:06,847 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-17 10:37:06,848 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-17 10:37:06,848 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-17 10:37:06,848 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-17 10:37:06,848 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-17 10:37:06,849 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "Am", "destination_mobile_number": "254721799582", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "2000", "service_provider_id": 1}
2017-03-17 10:37:06,849 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "Am", "destination_mobile_number": "254721799582", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "2000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "Am", "destination_mobile_number": "254721799582", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "2000", "service_provider_id": 1}
2017-03-17 10:37:06,849 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-17 10:37:06,849 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-17 10:37:08,003 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 285, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-17 10:37:08,003 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 285, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 285, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-17 10:37:08,007 = handlers.result_handler.AirtimeHandler - ERROR - _get_value() takes exactly 4 arguments (22 given)
2017-03-17 10:37:08,007 = handlers.result_handler.AirtimeHandler - ERROR - _get_value() takes exactly 4 arguments (22 given)
ERROR:handlers.result_handler.AirtimeHandler:_get_value() takes exactly 4 arguments (22 given)
2017-03-17 10:37:08,008 = handlers.result_handler.AirtimeHandler - ERROR - _get_value() takes exactly 4 arguments (50 given)
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 80, in post
    r=self.purchase_airtime(xml,url,msisdn_2,amount,user_id,receipt_number)
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 197, in purchase_airtime
    self.captureException(str(e))
  File "/usr/local/lib/python2.7/dist-packages/raven/contrib/tornado/__init__.py", line 221, in captureException
    return self._capture('captureException', exc_info=exc_info, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/contrib/tornado/__init__.py", line 218, in _capture
    return getattr(client, call_name)(data=data, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/base.py", line 799, in captureException
    'raven.events.Exception', exc_info=exc_info, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/contrib/tornado/__init__.py", line 39, in capture
    data = self.build_msg(*args, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/base.py", line 379, in build_msg
    result = handler.capture(**kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/events.py", line 117, in capture
    value = self._get_value(*exc_info)
TypeError: _get_value() takes exactly 4 arguments (50 given)
2017-03-17 10:37:08,008 = handlers.result_handler.AirtimeHandler - ERROR - _get_value() takes exactly 4 arguments (50 given)
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 80, in post
    r=self.purchase_airtime(xml,url,msisdn_2,amount,user_id,receipt_number)
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 197, in purchase_airtime
    self.captureException(str(e))
  File "/usr/local/lib/python2.7/dist-packages/raven/contrib/tornado/__init__.py", line 221, in captureException
    return self._capture('captureException', exc_info=exc_info, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/contrib/tornado/__init__.py", line 218, in _capture
    return getattr(client, call_name)(data=data, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/base.py", line 799, in captureException
    'raven.events.Exception', exc_info=exc_info, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/contrib/tornado/__init__.py", line 39, in capture
    data = self.build_msg(*args, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/base.py", line 379, in build_msg
    result = handler.capture(**kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/events.py", line 117, in capture
    value = self._get_value(*exc_info)
TypeError: _get_value() takes exactly 4 arguments (50 given)
ERROR:handlers.result_handler.AirtimeHandler:_get_value() takes exactly 4 arguments (50 given)
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 80, in post
    r=self.purchase_airtime(xml,url,msisdn_2,amount,user_id,receipt_number)
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 197, in purchase_airtime
    self.captureException(str(e))
  File "/usr/local/lib/python2.7/dist-packages/raven/contrib/tornado/__init__.py", line 221, in captureException
    return self._capture('captureException', exc_info=exc_info, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/contrib/tornado/__init__.py", line 218, in _capture
    return getattr(client, call_name)(data=data, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/base.py", line 799, in captureException
    'raven.events.Exception', exc_info=exc_info, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/contrib/tornado/__init__.py", line 39, in capture
    data = self.build_msg(*args, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/base.py", line 379, in build_msg
    result = handler.capture(**kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/events.py", line 117, in capture
    value = self._get_value(*exc_info)
TypeError: _get_value() takes exactly 4 arguments (50 given)
2017-03-17 10:37:08,010 = tornado.application - ERROR - Uncaught exception POST /v1/airtime/buy (127.0.0.1)
HTTPServerRequest(protocol='http', host='airtime-backend', method='POST', uri='/v1/airtime/buy', version='HTTP/1.0', remote_ip='127.0.0.1', headers={'Content-Length': '230', 'Accept-Encoding': 'gzip, deflate', 'Connection': 'close', 'Accept': '*/*', 'User-Agent': 'python-requests/2.12.5', 'Host': 'airtime-backend', 'Content-Type': 'application/json'})
Traceback (most recent call last):
  File "/usr/local/lib/python2.7/dist-packages/tornado/web.py", line 1469, in _execute
    result = yield result
  File "/usr/local/lib/python2.7/dist-packages/tornado/gen.py", line 1015, in run
    value = future.result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "/usr/local/lib/python2.7/dist-packages/tornado/gen.py", line 270, in wrapper
    result = func(*args, **kwargs)
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 88, in post
    self.captureException(str(te))
  File "/usr/local/lib/python2.7/dist-packages/raven/contrib/tornado/__init__.py", line 221, in captureException
    return self._capture('captureException', exc_info=exc_info, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/contrib/tornado/__init__.py", line 218, in _capture
    return getattr(client, call_name)(data=data, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/base.py", line 799, in captureException
    'raven.events.Exception', exc_info=exc_info, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/contrib/tornado/__init__.py", line 39, in capture
    data = self.build_msg(*args, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/base.py", line 379, in build_msg
    result = handler.capture(**kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/events.py", line 117, in capture
    value = self._get_value(*exc_info)
TypeError: _get_value() takes exactly 4 arguments (50 given)
2017-03-17 10:37:08,010 = tornado.application - ERROR - Uncaught exception POST /v1/airtime/buy (127.0.0.1)
HTTPServerRequest(protocol='http', host='airtime-backend', method='POST', uri='/v1/airtime/buy', version='HTTP/1.0', remote_ip='127.0.0.1', headers={'Content-Length': '230', 'Accept-Encoding': 'gzip, deflate', 'Connection': 'close', 'Accept': '*/*', 'User-Agent': 'python-requests/2.12.5', 'Host': 'airtime-backend', 'Content-Type': 'application/json'})
Traceback (most recent call last):
  File "/usr/local/lib/python2.7/dist-packages/tornado/web.py", line 1469, in _execute
    result = yield result
  File "/usr/local/lib/python2.7/dist-packages/tornado/gen.py", line 1015, in run
    value = future.result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "/usr/local/lib/python2.7/dist-packages/tornado/gen.py", line 270, in wrapper
    result = func(*args, **kwargs)
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 88, in post
    self.captureException(str(te))
  File "/usr/local/lib/python2.7/dist-packages/raven/contrib/tornado/__init__.py", line 221, in captureException
    return self._capture('captureException', exc_info=exc_info, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/contrib/tornado/__init__.py", line 218, in _capture
    return getattr(client, call_name)(data=data, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/base.py", line 799, in captureException
    'raven.events.Exception', exc_info=exc_info, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/contrib/tornado/__init__.py", line 39, in capture
    data = self.build_msg(*args, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/base.py", line 379, in build_msg
    result = handler.capture(**kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/events.py", line 117, in capture
    value = self._get_value(*exc_info)
TypeError: _get_value() takes exactly 4 arguments (50 given)
ERROR:tornado.application:Uncaught exception POST /v1/airtime/buy (127.0.0.1)
HTTPServerRequest(protocol='http', host='airtime-backend', method='POST', uri='/v1/airtime/buy', version='HTTP/1.0', remote_ip='127.0.0.1', headers={'Content-Length': '230', 'Accept-Encoding': 'gzip, deflate', 'Connection': 'close', 'Accept': '*/*', 'User-Agent': 'python-requests/2.12.5', 'Host': 'airtime-backend', 'Content-Type': 'application/json'})
Traceback (most recent call last):
  File "/usr/local/lib/python2.7/dist-packages/tornado/web.py", line 1469, in _execute
    result = yield result
  File "/usr/local/lib/python2.7/dist-packages/tornado/gen.py", line 1015, in run
    value = future.result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "/usr/local/lib/python2.7/dist-packages/tornado/gen.py", line 270, in wrapper
    result = func(*args, **kwargs)
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 88, in post
    self.captureException(str(te))
  File "/usr/local/lib/python2.7/dist-packages/raven/contrib/tornado/__init__.py", line 221, in captureException
    return self._capture('captureException', exc_info=exc_info, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/contrib/tornado/__init__.py", line 218, in _capture
    return getattr(client, call_name)(data=data, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/base.py", line 799, in captureException
    'raven.events.Exception', exc_info=exc_info, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/contrib/tornado/__init__.py", line 39, in capture
    data = self.build_msg(*args, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/base.py", line 379, in build_msg
    result = handler.capture(**kwargs)
  File "/usr/local/lib/python2.7/dist-packages/raven/events.py", line 117, in capture
    value = self._get_value(*exc_info)
TypeError: _get_value() takes exactly 4 arguments (50 given)
2017-03-17 10:37:08,013 = tornado.access - ERROR - 500 POST /v1/airtime/buy (127.0.0.1) 4467.38ms
2017-03-17 10:37:08,013 = tornado.access - ERROR - 500 POST /v1/airtime/buy (127.0.0.1) 4467.38ms
ERROR:tornado.access:500 POST /v1/airtime/buy (127.0.0.1) 4467.38ms
2017-03-17 10:41:53,742 = __main__ - INFO - Creating server
2017-03-17 10:41:53,742 = __main__ - INFO - Creating server
2017-03-17 10:41:53,746 = __main__ - INFO - Created server
2017-03-17 10:41:53,746 = __main__ - INFO - Created server
2017-03-17 10:41:53,746 = __main__ - INFO - Listening on port 8080
2017-03-17 10:41:53,746 = __main__ - INFO - Listening on port 8080
2017-03-17 10:41:53,747 = __main__ - INFO - Starting event loop
2017-03-17 10:41:53,747 = __main__ - INFO - Starting event loop
2017-03-17 10:42:20,843 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/3000/-------------------
2017-03-17 10:42:20,843 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/3000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/3000/-------------------
2017-03-17 10:42:20,844 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-17 10:42:20,844 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-17 10:42:20,844 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 10:42:20
2017-03-17 10:42:20,844 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 10:42:20
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 17/03/2017 10:42:20
2017-03-17 10:42:20,845 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-17 10:42:20,845 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-17 10:42:20,845 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-17 10:42:20,845 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-17 10:42:20,846 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 6abbb34bef884e58aa253fed83c60246
2017-03-17 10:42:20,846 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 6abbb34bef884e58aa253fed83c60246
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 6abbb34bef884e58aa253fed83c60246
2017-03-17 10:42:20,846 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-17 10:42:20,846 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-17 10:42:20,846 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-17 10:42:20,846 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-17 10:42:20,847 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:42:20</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>6abbb34bef884e58aa253fed83c60246</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>3000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:42:20,847 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:42:20</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>6abbb34bef884e58aa253fed83c60246</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>3000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:42:20,847 = handlers.result_handler.AirtimeHandler - INFO - Built XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:42:20</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>6abbb34bef884e58aa253fed83c60246</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>3000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:42:20,847 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-17 10:42:20,847 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-17 10:42:20,847 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-17 10:42:20,848 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:42:20</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>6abbb34bef884e58aa253fed83c60246</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>3000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-17 10:42:20,848 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:42:20</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>6abbb34bef884e58aa253fed83c60246</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>3000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:42:20,848 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:42:20</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>6abbb34bef884e58aa253fed83c60246</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>3000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:42:20,848 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-17 10:42:21,630 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-17 10:42:21,630 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-17 10:42:21,631 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 10:39:37</ns0:DATE><ns0:EXTREFNUM>6abbb34bef884e58aa253fed83c60246</ns0:EXTREFNUM><ns0:TXNID>R170317.1039.140059</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 30 to 721799582 is successful. Your new balance is KSH 2385</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 10:42:21,631 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 10:39:37</ns0:DATE><ns0:EXTREFNUM>6abbb34bef884e58aa253fed83c60246</ns0:EXTREFNUM><ns0:TXNID>R170317.1039.140059</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 30 to 721799582 is successful. Your new balance is KSH 2385</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 10:39:37</ns0:DATE><ns0:EXTREFNUM>6abbb34bef884e58aa253fed83c60246</ns0:EXTREFNUM><ns0:TXNID>R170317.1039.140059</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 30 to 721799582 is successful. Your new balance is KSH 2385</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 10:42:21,632 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-17 10:42:21,632 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-17 10:42:21,633 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------30-----------------------
2017-03-17 10:42:21,633 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------30-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------30-----------------------
2017-03-17 10:42:21,633 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-17 10:42:21,633 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-17 10:42:21,634 = handlers.result_handler.AirtimeHandler - DEBUG - 17/03/17 10:39:37
2017-03-17 10:42:21,634 = handlers.result_handler.AirtimeHandler - DEBUG - 17/03/17 10:39:37
DEBUG:handlers.result_handler.AirtimeHandler:17/03/17 10:39:37
2017-03-17 10:42:21,635 = handlers.result_handler.AirtimeHandler - DEBUG - 6abbb34bef884e58aa253fed83c60246
2017-03-17 10:42:21,635 = handlers.result_handler.AirtimeHandler - DEBUG - 6abbb34bef884e58aa253fed83c60246
DEBUG:handlers.result_handler.AirtimeHandler:6abbb34bef884e58aa253fed83c60246
2017-03-17 10:42:21,636 = handlers.result_handler.AirtimeHandler - DEBUG - R170317.1039.140059
2017-03-17 10:42:21,636 = handlers.result_handler.AirtimeHandler - DEBUG - R170317.1039.140059
DEBUG:handlers.result_handler.AirtimeHandler:R170317.1039.140059
2017-03-17 10:42:21,636 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'17/03/17 10:39:37', 'amount': '30', 'external_ref': u'R170317.1039.140059', 'msisdn_2': u'254721799582', 'internal_ref': u'6abbb34bef884e58aa253fed83c60246'}
2017-03-17 10:42:21,636 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'17/03/17 10:39:37', 'amount': '30', 'external_ref': u'R170317.1039.140059', 'msisdn_2': u'254721799582', 'internal_ref': u'6abbb34bef884e58aa253fed83c60246'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'17/03/17 10:39:37', 'amount': '30', 'external_ref': u'R170317.1039.140059', 'msisdn_2': u'254721799582', 'internal_ref': u'6abbb34bef884e58aa253fed83c60246'}
2017-03-17 10:42:21,637 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-17 10:42:21,637 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-17 10:42:21,768 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-17 10:42:21,769 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-17 10:42:21,772 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 10:42:21,772 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-17 10:42:21,775 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-17 10:42:21,775 INFO sqlalchemy.engine.base.Engine {}
2017-03-17 10:42:21,777 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-17 10:42:21,778 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-17 10:42:21,781 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 10:42:21,782 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-17 10:42:21,784 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 10:42:21,784 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-17 10:42:21,787 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-17 10:42:21,787 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-17 10:42:21,789 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-17 10:42:21,789 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 10:42:21,793 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-17 10:42:21,793 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 10:42:21,794 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-17 10:42:21,794 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 10:42:21,800 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7fdab9565fd0>
2017-03-17 10:42:21,800 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-17 10:42:21,800 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-17 10:42:21,800 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-17 10:42:21,800 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 30 of airtime from Saiba  to 254721799582
2017-03-17 10:42:21,800 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 30 of airtime from Saiba  to 254721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 30 of airtime from Saiba  to 254721799582
2017-03-17 10:42:21,801 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-17 10:42:21,801 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-17 10:42:21,801 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 30 of airtime from Saiba  to 8
2017-03-17 10:42:21,801 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 30 of airtime from Saiba  to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 30 of airtime from Saiba  to 8
2017-03-17 10:42:21,802 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 30 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 10:42:21,802 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 30 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 30 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 10:42:21,802 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-17 10:42:21,802 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-17 10:42:21,802 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 30 of airtime from Saiba 
2017-03-17 10:42:21,802 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 30 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 30 of airtime from Saiba 
2017-03-17 10:42:22,879 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":23,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 30 of airtime from Saiba","image_url":"","date":"2017-03-17T10:39:38.661080Z"}
2017-03-17 10:42:22,879 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":23,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 30 of airtime from Saiba","image_url":"","date":"2017-03-17T10:39:38.661080Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":23,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 30 of airtime from Saiba","image_url":"","date":"2017-03-17T10:39:38.661080Z"}
2017-03-17 10:42:22,880 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-17 10:42:22,880 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-17 10:42:22,880 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":23,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 30 of airtime from Saiba","image_url":"","date":"2017-03-17T10:39:38.661080Z"}
2017-03-17 10:42:22,880 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":23,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 30 of airtime from Saiba","image_url":"","date":"2017-03-17T10:39:38.661080Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":23,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 30 of airtime from Saiba","image_url":"","date":"2017-03-17T10:39:38.661080Z"}
2017-03-17 10:42:22,880 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-17 10:42:22,880 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-17 10:42:22,881 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-17 10:42:22,881 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-17 10:42:22,881 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-17 10:42:22,881 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-17 10:42:22,882 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-17 10:42:22,882 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-17 10:42:22,882 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "3", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-17 10:42:22,882 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "3", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "3", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-17 10:42:24,133 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-17 10:42:24,133 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":3.0,"balance":975.0}
2017-03-17 10:42:24,133 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-17 10:42:24,134 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"user":8,"user_credit_type":1,"debit":0.0,"credit":3.0,"balance":975.0}
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-17 10:42:24,134 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-17 10:42:24,133 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":3.0,"balance":975.0}
{"user":8,"user_credit_type":1,"debit":0.0,"credit":3.0,"balance":975.0}
2017-03-17 10:42:24,134 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-17 10:42:24,134 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-17 10:42:24,134 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-17 10:42:24,134 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-17 10:42:24,134 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-17 10:42:24,134 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-17 10:42:24,135 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "56", "destination_mobile_number": "254721799582", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "3000", "service_provider_id": 1}
2017-03-17 10:42:24,135 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "56", "destination_mobile_number": "254721799582", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "3000", "service_provider_id": 1}
2017-03-17 10:42:24,135 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "56", "destination_mobile_number": "254721799582", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "3000", "service_provider_id": 1}
2017-03-17 10:42:24,135 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-17 10:42:25,331 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 285, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 285, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-17 10:42:25,331 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 285, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-17 10:42:25,336 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-17 10:42:25,337 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
2017-03-17 10:42:25,336 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-17 10:42:25,337 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 304, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 304, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 304, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-17 10:42:25,340 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-17 10:42:25,340 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-17 10:42:25,341 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4498.75ms
2017-03-17 10:42:25,341 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4498.75ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 4498.75ms
ERROR:sentry.errors.uncaught:[u'HTTP 400: Bad Request']
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-17 10:45:28,192 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.58ms
2017-03-17 10:45:28,192 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.58ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.58ms
2017-03-17 10:46:49,199 = __main__ - INFO - Creating server
2017-03-17 10:46:49,199 = __main__ - INFO - Creating server
2017-03-17 10:46:49,205 = __main__ - INFO - Created server
2017-03-17 10:46:49,205 = __main__ - INFO - Created server
2017-03-17 10:46:49,205 = __main__ - INFO - Listening on port 8080
2017-03-17 10:46:49,205 = __main__ - INFO - Listening on port 8080
2017-03-17 10:46:49,206 = __main__ - INFO - Starting event loop
2017-03-17 10:46:49,206 = __main__ - INFO - Starting event loop
2017-03-17 10:47:02,002 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-17 10:47:02,002 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-17 10:47:02,002 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-17 10:47:02,002 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-17 10:47:02,002 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 10:47:02
2017-03-17 10:47:02,002 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 10:47:02
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 17/03/2017 10:47:02
2017-03-17 10:47:02,003 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-17 10:47:02,003 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-17 10:47:02,003 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-17 10:47:02,003 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-17 10:47:02,003 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 36dc431ac4784514a2fbdbada6e7f310
2017-03-17 10:47:02,003 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 36dc431ac4784514a2fbdbada6e7f310
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 36dc431ac4784514a2fbdbada6e7f310
2017-03-17 10:47:02,003 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-17 10:47:02,003 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-17 10:47:02,004 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-17 10:47:02,004 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-17 10:47:02,004 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:47:02</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>36dc431ac4784514a2fbdbada6e7f310</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:47:02,004 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:47:02</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>36dc431ac4784514a2fbdbada6e7f310</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:47:02</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>36dc431ac4784514a2fbdbada6e7f310</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:47:02,004 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-17 10:47:02,004 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-17 10:47:02,004 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-17 10:47:02,004 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-17 10:47:02,005 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:47:02</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>36dc431ac4784514a2fbdbada6e7f310</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:47:02,005 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:47:02</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>36dc431ac4784514a2fbdbada6e7f310</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:47:02</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>36dc431ac4784514a2fbdbada6e7f310</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:47:02,005 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-17 10:47:02,005 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-17 10:47:02,593 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-17 10:47:02,593 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-17 10:47:02,593 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>17/03/17 10:44:18</ns0:DATE><ns0:EXTREFNUM>36dc431ac4784514a2fbdbada6e7f310</ns0:EXTREFNUM><ns0:TXNID>R170317.1044.140031</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 10:47:02,593 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>17/03/17 10:44:18</ns0:DATE><ns0:EXTREFNUM>36dc431ac4784514a2fbdbada6e7f310</ns0:EXTREFNUM><ns0:TXNID>R170317.1044.140031</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>17/03/17 10:44:18</ns0:DATE><ns0:EXTREFNUM>36dc431ac4784514a2fbdbada6e7f310</ns0:EXTREFNUM><ns0:TXNID>R170317.1044.140031</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 10:47:02,594 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-17 10:47:02,594 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-17 10:47:02,594 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-17 10:47:02,594 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-17 10:47:02,594 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-17 10:47:02,594 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-17 10:47:02,595 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 8
2017-03-17 10:47:02,595 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message could not complete your request at this time please try again later to 8
2017-03-17 10:47:02,595 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 10:47:02,595 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "could not complete your request at this time please try again later", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 10:47:02,595 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-17 10:47:02,595 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-17 10:47:02,595 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
2017-03-17 10:47:02,595 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
DEBUG:handlers.result_handler.AirtimeHandler:could not complete your request at this time please try again later
2017-03-17 10:47:02,635 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":24,"user":8,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-17T10:44:18.411077Z"}
2017-03-17 10:47:02,635 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":24,"user":8,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-17T10:44:18.411077Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":24,"user":8,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-17T10:44:18.411077Z"}
2017-03-17 10:47:02,636 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-17 10:47:02,636 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-17 10:47:02,636 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-17 10:47:02,636 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-17 10:47:02,636 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-17 10:47:02,636 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-17 10:47:02,637 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "100", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-17 10:47:02,637 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "100", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "100", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-17 10:47:02,678 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-17 10:47:02,678 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-17 10:47:02,678 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":100.0,"balance":1065.0}
2017-03-17 10:47:02,678 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":100.0,"balance":1065.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":8,"user_credit_type":1,"debit":0.0,"credit":100.0,"balance":1065.0}
{"user":8,"user_credit_type":1,"debit":0.0,"credit":100.0,"balance":1065.0}
2017-03-17 10:47:02,678 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-17 10:47:02,678 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-17 10:47:02,679 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-17 10:47:02,679 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-17 10:47:02,679 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 678.32ms
2017-03-17 10:47:02,679 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 678.32ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 678.32ms
2017-03-17 10:51:34,912 = __main__ - INFO - Creating server
2017-03-17 10:51:34,912 = __main__ - INFO - Creating server
2017-03-17 10:51:34,916 = __main__ - INFO - Created server
2017-03-17 10:51:34,916 = __main__ - INFO - Created server
2017-03-17 10:51:34,916 = __main__ - INFO - Listening on port 8080
2017-03-17 10:51:34,916 = __main__ - INFO - Listening on port 8080
2017-03-17 10:51:34,917 = __main__ - INFO - Starting event loop
2017-03-17 10:51:34,917 = __main__ - INFO - Starting event loop
2017-03-17 10:55:04,769 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-17 10:55:04,769 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-17 10:55:04,770 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-17 10:55:04,770 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-17 10:55:04,770 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 10:55:04
2017-03-17 10:55:04,770 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 10:55:04
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 17/03/2017 10:55:04
2017-03-17 10:55:04,771 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-17 10:55:04,771 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-17 10:55:04,771 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-17 10:55:04,771 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-17 10:55:04,772 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = e65449e2eef84fa9a057c7d0284ef560
2017-03-17 10:55:04,772 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = e65449e2eef84fa9a057c7d0284ef560
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = e65449e2eef84fa9a057c7d0284ef560
2017-03-17 10:55:04,772 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-17 10:55:04,772 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-17 10:55:04,772 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-17 10:55:04,772 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-17 10:55:04,773 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:55:04</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e65449e2eef84fa9a057c7d0284ef560</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:55:04,773 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:55:04</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e65449e2eef84fa9a057c7d0284ef560</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:55:04</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e65449e2eef84fa9a057c7d0284ef560</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:55:04,773 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-17 10:55:04,773 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-17 10:55:04,773 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-17 10:55:04,773 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-17 10:55:04,773 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:55:04</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e65449e2eef84fa9a057c7d0284ef560</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:55:04,773 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:55:04</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e65449e2eef84fa9a057c7d0284ef560</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 10:55:04</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e65449e2eef84fa9a057c7d0284ef560</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 10:55:04,774 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-17 10:55:04,774 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-17 10:55:05,544 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-17 10:55:05,544 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-17 10:55:05,544 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 10:52:21</ns0:DATE><ns0:EXTREFNUM>e65449e2eef84fa9a057c7d0284ef560</ns0:EXTREFNUM><ns0:TXNID>R170317.1052.140028</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 2375</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 10:52:21</ns0:DATE><ns0:EXTREFNUM>e65449e2eef84fa9a057c7d0284ef560</ns0:EXTREFNUM><ns0:TXNID>R170317.1052.140028</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 2375</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 10:55:05,544 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-17 10:55:05,544 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 10:52:21</ns0:DATE><ns0:EXTREFNUM>e65449e2eef84fa9a057c7d0284ef560</ns0:EXTREFNUM><ns0:TXNID>R170317.1052.140028</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 2375</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 10:55:05,544 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-17 10:55:05,545 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-17 10:55:05,545 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-17 10:55:05,545 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-17 10:55:05,545 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-17 10:55:05,545 = handlers.result_handler.AirtimeHandler - DEBUG - 17/03/17 10:52:21
2017-03-17 10:55:05,545 = handlers.result_handler.AirtimeHandler - DEBUG - 17/03/17 10:52:21
DEBUG:handlers.result_handler.AirtimeHandler:17/03/17 10:52:21
2017-03-17 10:55:05,546 = handlers.result_handler.AirtimeHandler - DEBUG - e65449e2eef84fa9a057c7d0284ef560
2017-03-17 10:55:05,546 = handlers.result_handler.AirtimeHandler - DEBUG - e65449e2eef84fa9a057c7d0284ef560
DEBUG:handlers.result_handler.AirtimeHandler:e65449e2eef84fa9a057c7d0284ef560
2017-03-17 10:55:05,546 = handlers.result_handler.AirtimeHandler - DEBUG - R170317.1052.140028
2017-03-17 10:55:05,546 = handlers.result_handler.AirtimeHandler - DEBUG - R170317.1052.140028
DEBUG:handlers.result_handler.AirtimeHandler:R170317.1052.140028
2017-03-17 10:55:05,546 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'17/03/17 10:52:21', 'amount': '10', 'external_ref': u'R170317.1052.140028', 'msisdn_2': u'254721799582', 'internal_ref': u'e65449e2eef84fa9a057c7d0284ef560'}
2017-03-17 10:55:05,546 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'17/03/17 10:52:21', 'amount': '10', 'external_ref': u'R170317.1052.140028', 'msisdn_2': u'254721799582', 'internal_ref': u'e65449e2eef84fa9a057c7d0284ef560'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'17/03/17 10:52:21', 'amount': '10', 'external_ref': u'R170317.1052.140028', 'msisdn_2': u'254721799582', 'internal_ref': u'e65449e2eef84fa9a057c7d0284ef560'}
2017-03-17 10:55:05,547 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-17 10:55:05,547 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-17 10:55:05,662 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-17 10:55:05,662 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-17 10:55:05,666 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 10:55:05,666 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-17 10:55:05,669 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-17 10:55:05,669 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-17 10:55:05,671 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-17 10:55:05,671 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-17 10:55:05,675 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 10:55:05,675 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-17 10:55:05,678 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-17 10:55:05,678 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-17 10:55:05,681 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-17 10:55:05,681 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-17 10:55:05,683 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 10:55:05,683 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-17 10:55:05,687 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-17 10:55:05,687 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 10:55:05,689 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 10:55:05,689 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-17 10:55:05,695 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f3ef312cfd0>
2017-03-17 10:55:05,695 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-17 10:55:05,696 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-17 10:55:05,696 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254721799582
2017-03-17 10:55:05,696 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-17 10:55:05,696 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254721799582
2017-03-17 10:55:05,696 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-17 10:55:05,697 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
2017-03-17 10:55:05,696 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-17 10:55:05,697 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
2017-03-17 10:55:05,697 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
2017-03-17 10:55:05,697 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-17 10:55:05,697 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 10:55:05,697 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-17 10:55:05,697 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-17 10:55:05,697 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-17 10:55:06,898 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":25,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T10:52:22.659367Z"}
2017-03-17 10:55:06,898 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":25,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T10:52:22.659367Z"}
2017-03-17 10:55:06,899 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:{"id":25,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T10:52:22.659367Z"}
2017-03-17 10:55:06,899 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-17 10:55:06,899 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":25,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T10:52:22.659367Z"}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:{"id":25,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T10:52:22.659367Z"}
2017-03-17 10:55:06,900 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-17 10:55:06,899 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":25,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T10:52:22.659367Z"}
2017-03-17 10:55:06,900 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-17 10:55:06,900 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-17 10:55:06,900 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-17 10:55:06,900 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-17 10:55:06,900 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-17 10:55:06,900 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:null
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-17 10:55:06,900 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254721799582", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-17 10:55:06,900 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-17 10:55:06,900 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": null, "destination_mobile_number": "254721799582", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": null, "destination_mobile_number": "254721799582", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-17 10:55:06,901 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-17 10:55:06,901 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-17 10:55:08,110 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
2017-03-17 10:55:08,110 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 287, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 287, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 287, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-17 10:55:08,115 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-17 10:55:08,115 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-17 10:55:08,117 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3348.27ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3348.27ms
2017-03-17 10:55:08,117 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3348.27ms
2017-03-17 11:00:32,974 = tornado.access - WARNING - 404 GET / (193.150.38.14) 0.59ms
WARNING:tornado.access:404 GET / (193.150.38.14) 0.59ms
2017-03-17 11:00:32,974 = tornado.access - WARNING - 404 GET / (193.150.38.14) 0.59ms
2017-03-17 11:01:46,278 = __main__ - INFO - Creating server
2017-03-17 11:01:46,278 = __main__ - INFO - Creating server
2017-03-17 11:01:46,282 = __main__ - INFO - Created server
2017-03-17 11:01:46,282 = __main__ - INFO - Created server
2017-03-17 11:01:46,282 = __main__ - INFO - Listening on port 8080
2017-03-17 11:01:46,282 = __main__ - INFO - Listening on port 8080
2017-03-17 11:01:46,283 = __main__ - INFO - Starting event loop
2017-03-17 11:01:46,283 = __main__ - INFO - Starting event loop
2017-03-17 11:02:35,657 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-17 11:02:35,657 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-17 11:02:35,657 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-17 11:02:35,657 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-17 11:02:35,657 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 11:02:35
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 17/03/2017 11:02:35
2017-03-17 11:02:35,657 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 11:02:35
2017-03-17 11:02:35,657 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-17 11:02:35,657 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-17 11:02:35,658 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-17 11:02:35,658 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-17 11:02:35,658 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 16b5e53dbe97441fab456d123ae2570e
2017-03-17 11:02:35,658 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 16b5e53dbe97441fab456d123ae2570e
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 16b5e53dbe97441fab456d123ae2570e
2017-03-17 11:02:35,658 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-17 11:02:35,658 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-17 11:02:35,659 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-17 11:02:35,659 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-17 11:02:35,659 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:02:35</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>16b5e53dbe97441fab456d123ae2570e</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:02:35,659 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:02:35</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>16b5e53dbe97441fab456d123ae2570e</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:02:35</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>16b5e53dbe97441fab456d123ae2570e</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:02:35,659 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-17 11:02:35,659 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-17 11:02:35,659 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-17 11:02:35,659 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-17 11:02:35,659 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:02:35</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>16b5e53dbe97441fab456d123ae2570e</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:02:35,659 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:02:35</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>16b5e53dbe97441fab456d123ae2570e</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:02:35</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>16b5e53dbe97441fab456d123ae2570e</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:02:35,660 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-17 11:02:35,660 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-17 11:02:36,524 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-17 11:02:36,524 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-17 11:02:36,525 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 10:59:52</ns0:DATE><ns0:EXTREFNUM>16b5e53dbe97441fab456d123ae2570e</ns0:EXTREFNUM><ns0:TXNID>R170317.1059.140063</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 2365</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 11:02:36,525 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 10:59:52</ns0:DATE><ns0:EXTREFNUM>16b5e53dbe97441fab456d123ae2570e</ns0:EXTREFNUM><ns0:TXNID>R170317.1059.140063</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 2365</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 11:02:36,525 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 10:59:52</ns0:DATE><ns0:EXTREFNUM>16b5e53dbe97441fab456d123ae2570e</ns0:EXTREFNUM><ns0:TXNID>R170317.1059.140063</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 2365</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-17 11:02:36,525 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-17 11:02:36,525 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-17 11:02:36,525 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
2017-03-17 11:02:36,526 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-17 11:02:36,526 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-17 11:02:36,526 = handlers.result_handler.AirtimeHandler - DEBUG - 17/03/17 10:59:52
2017-03-17 11:02:36,526 = handlers.result_handler.AirtimeHandler - DEBUG - 17/03/17 10:59:52
DEBUG:handlers.result_handler.AirtimeHandler:17/03/17 10:59:52
2017-03-17 11:02:36,526 = handlers.result_handler.AirtimeHandler - DEBUG - 16b5e53dbe97441fab456d123ae2570e
2017-03-17 11:02:36,526 = handlers.result_handler.AirtimeHandler - DEBUG - 16b5e53dbe97441fab456d123ae2570e
DEBUG:handlers.result_handler.AirtimeHandler:16b5e53dbe97441fab456d123ae2570e
2017-03-17 11:02:36,527 = handlers.result_handler.AirtimeHandler - DEBUG - R170317.1059.140063
2017-03-17 11:02:36,527 = handlers.result_handler.AirtimeHandler - DEBUG - R170317.1059.140063
DEBUG:handlers.result_handler.AirtimeHandler:R170317.1059.140063
2017-03-17 11:02:36,527 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'17/03/17 10:59:52', 'amount': '10', 'external_ref': u'R170317.1059.140063', 'msisdn_2': u'254721799582', 'internal_ref': u'16b5e53dbe97441fab456d123ae2570e'}
2017-03-17 11:02:36,527 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'17/03/17 10:59:52', 'amount': '10', 'external_ref': u'R170317.1059.140063', 'msisdn_2': u'254721799582', 'internal_ref': u'16b5e53dbe97441fab456d123ae2570e'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'17/03/17 10:59:52', 'amount': '10', 'external_ref': u'R170317.1059.140063', 'msisdn_2': u'254721799582', 'internal_ref': u'16b5e53dbe97441fab456d123ae2570e'}
2017-03-17 11:02:36,527 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-17 11:02:36,527 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-17 11:02:36,644 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-17 11:02:36,644 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-17 11:02:36,647 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:02:36,647 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-17 11:02:36,650 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-17 11:02:36,650 INFO sqlalchemy.engine.base.Engine {}
2017-03-17 11:02:36,652 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-17 11:02:36,652 INFO sqlalchemy.engine.base.Engine {}
2017-03-17 11:02:36,656 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:02:36,656 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-17 11:02:36,658 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:02:36,658 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-17 11:02:36,661 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-17 11:02:36,661 INFO sqlalchemy.engine.base.Engine {'table': 23559}
2017-03-17 11:02:36,663 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:02:36,663 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-17 11:02:36,667 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:02:36,667 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-17 11:02:36,669 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:02:36,669 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-17 11:02:36,673 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f2367ed3fd0>
2017-03-17 11:02:36,673 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-17 11:02:36,674 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-17 11:02:36,674 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-17 11:02:36,674 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-17 11:02:36,674 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254721799582
2017-03-17 11:02:36,674 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254721799582
2017-03-17 11:02:36,674 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-17 11:02:36,674 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
2017-03-17 11:02:36,674 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
2017-03-17 11:02:36,675 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 11:02:36,675 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 11:02:36,675 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-17 11:02:36,675 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-17 11:02:36,675 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-17 11:02:36,675 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-17 11:02:37,880 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":26,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T10:59:53.625948Z"}
2017-03-17 11:02:37,880 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":26,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T10:59:53.625948Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":26,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T10:59:53.625948Z"}
2017-03-17 11:02:37,881 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-17 11:02:37,881 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":26,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T10:59:53.625948Z"}
2017-03-17 11:02:37,881 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-17 11:02:37,881 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":26,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T10:59:53.625948Z"}
2017-03-17 11:02:37,881 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:{"id":26,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T10:59:53.625948Z"}
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-17 11:02:37,881 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-17 11:02:37,882 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-17 11:02:37,882 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-17 11:02:37,882 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'note' referenced before assignment
2017-03-17 11:02:37,882 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'note' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'note' referenced before assignment
2017-03-17 11:02:37,888 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2232.67ms
2017-03-17 11:02:37,888 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2232.67ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 2232.67ms
2017-03-17 11:06:12,443 = __main__ - INFO - Creating server
2017-03-17 11:06:12,443 = __main__ - INFO - Creating server
2017-03-17 11:06:12,448 = __main__ - INFO - Created server
2017-03-17 11:06:12,448 = __main__ - INFO - Created server
2017-03-17 11:06:12,448 = __main__ - INFO - Listening on port 8080
2017-03-17 11:06:12,448 = __main__ - INFO - Listening on port 8080
2017-03-17 11:06:12,449 = __main__ - INFO - Starting event loop
2017-03-17 11:06:12,449 = __main__ - INFO - Starting event loop
2017-03-17 11:14:46,892 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-17 11:14:46,892 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
2017-03-17 11:14:46,893 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-17 11:14:46,893 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-17 11:14:46,893 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 11:14:46
2017-03-17 11:14:46,893 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 11:14:46
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 17/03/2017 11:14:46
2017-03-17 11:14:46,893 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-17 11:14:46,893 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-17 11:14:46,894 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-17 11:14:46,894 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-17 11:14:46,894 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 0d36468b90074762ac4144f6eb1f2487
2017-03-17 11:14:46,894 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 0d36468b90074762ac4144f6eb1f2487
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 0d36468b90074762ac4144f6eb1f2487
2017-03-17 11:14:46,895 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-17 11:14:46,895 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-17 11:14:46,895 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-17 11:14:46,895 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-17 11:14:46,896 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:14:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0d36468b90074762ac4144f6eb1f2487</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:14:46,896 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:14:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0d36468b90074762ac4144f6eb1f2487</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:14:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0d36468b90074762ac4144f6eb1f2487</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:14:46,896 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-17 11:14:46,896 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-17 11:14:46,896 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-17 11:14:46,896 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-17 11:14:46,897 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:14:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0d36468b90074762ac4144f6eb1f2487</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:14:46,897 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:14:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0d36468b90074762ac4144f6eb1f2487</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:14:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0d36468b90074762ac4144f6eb1f2487</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:14:46,897 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-17 11:14:46,897 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-17 11:14:47,711 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-17 11:14:47,711 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-17 11:14:47,712 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 11:12:03</ns0:DATE><ns0:EXTREFNUM>0d36468b90074762ac4144f6eb1f2487</ns0:EXTREFNUM><ns0:TXNID>R170317.1112.140005</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 721799582 is successful. Your new balance is KSH 2360</ns0:MESSAGE></ns0:COMMAND>
2017-03-17 11:14:47,712 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 11:12:03</ns0:DATE><ns0:EXTREFNUM>0d36468b90074762ac4144f6eb1f2487</ns0:EXTREFNUM><ns0:TXNID>R170317.1112.140005</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 721799582 is successful. Your new balance is KSH 2360</ns0:MESSAGE></ns0:COMMAND>


DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 11:12:03</ns0:DATE><ns0:EXTREFNUM>0d36468b90074762ac4144f6eb1f2487</ns0:EXTREFNUM><ns0:TXNID>R170317.1112.140005</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 721799582 is successful. Your new balance is KSH 2360</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 11:14:47,712 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-17 11:14:47,712 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-17 11:14:47,713 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
2017-03-17 11:14:47,713 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------5-----------------------
2017-03-17 11:14:47,714 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-17 11:14:47,714 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-17 11:14:47,714 = handlers.result_handler.AirtimeHandler - DEBUG - 17/03/17 11:12:03
2017-03-17 11:14:47,714 = handlers.result_handler.AirtimeHandler - DEBUG - 17/03/17 11:12:03
DEBUG:handlers.result_handler.AirtimeHandler:17/03/17 11:12:03
2017-03-17 11:14:47,715 = handlers.result_handler.AirtimeHandler - DEBUG - 0d36468b90074762ac4144f6eb1f2487
2017-03-17 11:14:47,716 = handlers.result_handler.AirtimeHandler - DEBUG - R170317.1112.140005
DEBUG:handlers.result_handler.AirtimeHandler:0d36468b90074762ac4144f6eb1f2487
DEBUG:handlers.result_handler.AirtimeHandler:R170317.1112.140005
2017-03-17 11:14:47,716 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'17/03/17 11:12:03', 'amount': '5', 'external_ref': u'R170317.1112.140005', 'msisdn_2': u'0721799582', 'internal_ref': u'0d36468b90074762ac4144f6eb1f2487'}
2017-03-17 11:14:47,715 = handlers.result_handler.AirtimeHandler - DEBUG - 0d36468b90074762ac4144f6eb1f2487
2017-03-17 11:14:47,716 = handlers.result_handler.AirtimeHandler - DEBUG - R170317.1112.140005
2017-03-17 11:14:47,716 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'17/03/17 11:12:03', 'amount': '5', 'external_ref': u'R170317.1112.140005', 'msisdn_2': u'0721799582', 'internal_ref': u'0d36468b90074762ac4144f6eb1f2487'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'17/03/17 11:12:03', 'amount': '5', 'external_ref': u'R170317.1112.140005', 'msisdn_2': u'0721799582', 'internal_ref': u'0d36468b90074762ac4144f6eb1f2487'}
2017-03-17 11:14:47,717 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-17 11:14:47,717 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-17 11:14:47,863 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-17 11:14:47,863 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-17 11:14:47,867 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:14:47,867 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-17 11:14:47,871 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-17 11:14:47,871 INFO sqlalchemy.engine.base.Engine {}
2017-03-17 11:14:47,874 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-17 11:14:47,874 INFO sqlalchemy.engine.base.Engine {}
2017-03-17 11:14:47,879 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:14:47,880 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-17 11:14:47,883 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:14:47,883 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-17 11:14:47,888 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-17 11:14:47,888 INFO sqlalchemy.engine.base.Engine {'table': 23559}
2017-03-17 11:14:47,890 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:14:47,891 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-17 11:14:47,894 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:14:47,894 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-17 11:14:47,896 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:14:47,896 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-17 11:14:47,902 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7fdcc2eedfd0>
2017-03-17 11:14:47,902 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-17 11:14:47,903 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-17 11:14:47,903 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-17 11:14:47,903 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 5 of airtime from Saiba  to 0721799582
2017-03-17 11:14:47,903 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 5 of airtime from Saiba  to 0721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 5 of airtime from Saiba  to 0721799582
2017-03-17 11:14:47,903 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-17 11:14:47,903 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-17 11:14:47,903 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 5 of airtime from Saiba  to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-17 11:14:47,903 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 5 of airtime from Saiba  to 8
2017-03-17 11:14:47,904 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 5 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 5 of airtime from Saiba  to 8
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 5 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 11:14:47,904 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-17 11:14:47,904 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 5 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 11:14:47,904 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-17 11:14:47,904 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 5 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 5 of airtime from Saiba 
2017-03-17 11:14:47,904 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 5 of airtime from Saiba 
2017-03-17 11:14:49,233 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":27,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-17T11:12:04.954156Z"}
2017-03-17 11:14:49,233 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":27,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-17T11:12:04.954156Z"}
2017-03-17 11:14:49,234 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:{"id":27,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-17T11:12:04.954156Z"}
2017-03-17 11:14:49,234 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-17 11:14:49,234 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":27,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-17T11:12:04.954156Z"}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-17 11:14:49,234 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":27,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-17T11:12:04.954156Z"}
2017-03-17 11:14:49,234 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-17 11:14:49,234 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:{"id":27,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-17T11:12:04.954156Z"}
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-17 11:14:49,235 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-17 11:14:49,235 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-17 11:14:49,235 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-17 11:14:49,235 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-17 11:14:49,235 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-17 11:14:49,235 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-17 11:14:49,235 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'amount' referenced before assignment
2017-03-17 11:14:49,235 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'amount' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'amount' referenced before assignment
2017-03-17 11:14:49,241 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2350.57ms
2017-03-17 11:14:49,241 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2350.57ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 2350.57ms
2017-03-17 11:15:12,188 = __main__ - INFO - Creating server
2017-03-17 11:15:12,188 = __main__ - INFO - Creating server
2017-03-17 11:15:12,193 = __main__ - INFO - Created server
2017-03-17 11:15:12,193 = __main__ - INFO - Created server
2017-03-17 11:15:12,193 = __main__ - INFO - Listening on port 8080
2017-03-17 11:15:12,193 = __main__ - INFO - Listening on port 8080
2017-03-17 11:15:12,195 = __main__ - INFO - Starting event loop
2017-03-17 11:15:12,195 = __main__ - INFO - Starting event loop
2017-03-17 11:16:20,346 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-17 11:16:20,346 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-17 11:16:20,347 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
2017-03-17 11:16:20,347 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-17 11:16:20,348 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 11:16:20
2017-03-17 11:16:20,348 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 11:16:20
2017-03-17 11:16:20,348 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 17/03/2017 11:16:20
2017-03-17 11:16:20,348 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-17 11:16:20,348 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-17 11:16:20,348 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-17 11:16:20,349 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 891e23599d65495ab40eca5e55a540d4
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-17 11:16:20,349 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 891e23599d65495ab40eca5e55a540d4
2017-03-17 11:16:20,350 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 891e23599d65495ab40eca5e55a540d4
2017-03-17 11:16:20,350 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-17 11:16:20,350 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-17 11:16:20,350 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-17 11:16:20,351 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:16:20</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>891e23599d65495ab40eca5e55a540d4</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-17 11:16:20,351 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:16:20</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>891e23599d65495ab40eca5e55a540d4</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:16:20</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>891e23599d65495ab40eca5e55a540d4</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:16:20,352 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-17 11:16:20,352 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-17 11:16:20,352 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-17 11:16:20,352 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-17 11:16:20,353 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:16:20</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>891e23599d65495ab40eca5e55a540d4</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:16:20,353 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:16:20</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>891e23599d65495ab40eca5e55a540d4</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:16:20</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>891e23599d65495ab40eca5e55a540d4</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:16:20,353 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-17 11:16:20,353 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-17 11:16:20,945 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-17 11:16:20,945 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-17 11:16:20,946 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>17/03/17 11:13:36</ns0:DATE><ns0:EXTREFNUM>891e23599d65495ab40eca5e55a540d4</ns0:EXTREFNUM><ns0:TXNID>R170317.1113.140048</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 11:16:20,946 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>17/03/17 11:13:36</ns0:DATE><ns0:EXTREFNUM>891e23599d65495ab40eca5e55a540d4</ns0:EXTREFNUM><ns0:TXNID>R170317.1113.140048</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>17/03/17 11:13:36</ns0:DATE><ns0:EXTREFNUM>891e23599d65495ab40eca5e55a540d4</ns0:EXTREFNUM><ns0:TXNID>R170317.1113.140048</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 11:16:20,946 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-17 11:16:20,946 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-17 11:16:20,947 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-17 11:16:20,947 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-17 11:16:20,948 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-17 11:16:20,948 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-17 11:16:20,948 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 8
2017-03-17 11:16:20,948 = handlers.result_handler.AirtimeHandler - DEBUG - sending message could not complete your request at this time please try again later to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message could not complete your request at this time please try again later to 8
2017-03-17 11:16:20,949 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 11:16:20,949 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "could not complete your request at this time please try again later", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "could not complete your request at this time please try again later", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 11:16:20,950 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-17 11:16:20,950 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-17 11:16:20,950 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
2017-03-17 11:16:20,950 = handlers.result_handler.AirtimeHandler - DEBUG - could not complete your request at this time please try again later
DEBUG:handlers.result_handler.AirtimeHandler:could not complete your request at this time please try again later
2017-03-17 11:16:20,992 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":28,"user":8,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-17T11:13:36.711802Z"}
2017-03-17 11:16:20,992 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":28,"user":8,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-17T11:13:36.711802Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":28,"user":8,"title":"Safaricom  Airtime","text":"could not complete your request at this time please try again later","image_url":"","date":"2017-03-17T11:13:36.711802Z"}
2017-03-17 11:16:20,993 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-17 11:16:20,993 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-17 11:16:20,994 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-17 11:16:20,994 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-17 11:16:20,994 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-17 11:16:20,994 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-17 11:16:20,995 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "50", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-17 11:16:20,995 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "50", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "50", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-17 11:16:22,255 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-17 11:16:22,255 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-17 11:16:22,256 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":50.0,"balance":1090.0}
2017-03-17 11:16:22,256 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":50.0,"balance":1090.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":8,"user_credit_type":1,"debit":0.0,"credit":50.0,"balance":1090.0}
{"user":8,"user_credit_type":1,"debit":0.0,"credit":50.0,"balance":1090.0}
2017-03-17 11:16:22,256 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-17 11:16:22,256 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-17 11:16:22,257 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-17 11:16:22,257 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-17 11:16:22,258 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 1913.30ms
2017-03-17 11:16:22,258 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 1913.30ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 1913.30ms
2017-03-17 11:17:30,922 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-17 11:17:30,922 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-17 11:17:30,922 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 11:17:30
2017-03-17 11:17:30,923 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-17 11:17:30,923 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-17 11:17:30,923 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 0387ca0d861d475faf031c2b46b31392
2017-03-17 11:17:30,923 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-17 11:17:30,923 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-17 11:17:30,924 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:17:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0387ca0d861d475faf031c2b46b31392</ns0:EXTREFNUM><ns0:MSISDN2>254726280377</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:17:30,924 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-17 11:17:30,924 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-17 11:17:30,924 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:17:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0387ca0d861d475faf031c2b46b31392</ns0:EXTREFNUM><ns0:MSISDN2>254726280377</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:17:30,924 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 17/03/2017 11:17:30
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 0387ca0d861d475faf031c2b46b31392
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:17:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0387ca0d861d475faf031c2b46b31392</ns0:EXTREFNUM><ns0:MSISDN2>254726280377</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:17:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0387ca0d861d475faf031c2b46b31392</ns0:EXTREFNUM><ns0:MSISDN2>254726280377</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-17 11:17:30,922 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-17 11:17:30,922 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-17 11:17:30,922 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 11:17:30
2017-03-17 11:17:30,923 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-17 11:17:30,923 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-17 11:17:30,923 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 0387ca0d861d475faf031c2b46b31392
2017-03-17 11:17:30,923 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-17 11:17:30,923 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-17 11:17:30,924 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:17:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0387ca0d861d475faf031c2b46b31392</ns0:EXTREFNUM><ns0:MSISDN2>254726280377</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:17:30,924 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-17 11:17:30,924 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-17 11:17:30,924 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:17:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0387ca0d861d475faf031c2b46b31392</ns0:EXTREFNUM><ns0:MSISDN2>254726280377</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:17:30,924 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-17 11:17:31,715 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-17 11:17:31,715 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-17 11:17:31,717 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 11:14:47</ns0:DATE><ns0:EXTREFNUM>0387ca0d861d475faf031c2b46b31392</ns0:EXTREFNUM><ns0:TXNID>R170317.1114.140064</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 726280377 is successful. Your new balance is KSH 2355</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 11:17:31,717 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 11:14:47</ns0:DATE><ns0:EXTREFNUM>0387ca0d861d475faf031c2b46b31392</ns0:EXTREFNUM><ns0:TXNID>R170317.1114.140064</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 726280377 is successful. Your new balance is KSH 2355</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 11:14:47</ns0:DATE><ns0:EXTREFNUM>0387ca0d861d475faf031c2b46b31392</ns0:EXTREFNUM><ns0:TXNID>R170317.1114.140064</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 726280377 is successful. Your new balance is KSH 2355</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 11:17:31,717 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-17 11:17:31,717 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-17 11:17:31,718 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
2017-03-17 11:17:31,718 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------5-----------------------
2017-03-17 11:17:31,719 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-17 11:17:31,719 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-17 11:17:31,719 = handlers.result_handler.AirtimeHandler - DEBUG - 17/03/17 11:14:47
2017-03-17 11:17:31,719 = handlers.result_handler.AirtimeHandler - DEBUG - 17/03/17 11:14:47
DEBUG:handlers.result_handler.AirtimeHandler:17/03/17 11:14:47
2017-03-17 11:17:31,720 = handlers.result_handler.AirtimeHandler - DEBUG - 0387ca0d861d475faf031c2b46b31392
2017-03-17 11:17:31,720 = handlers.result_handler.AirtimeHandler - DEBUG - 0387ca0d861d475faf031c2b46b31392
DEBUG:handlers.result_handler.AirtimeHandler:0387ca0d861d475faf031c2b46b31392
2017-03-17 11:17:31,721 = handlers.result_handler.AirtimeHandler - DEBUG - R170317.1114.140064
2017-03-17 11:17:31,721 = handlers.result_handler.AirtimeHandler - DEBUG - R170317.1114.140064
DEBUG:handlers.result_handler.AirtimeHandler:R170317.1114.140064
2017-03-17 11:17:31,722 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'17/03/17 11:14:47', 'amount': '5', 'external_ref': u'R170317.1114.140064', 'msisdn_2': u'254726280377', 'internal_ref': u'0387ca0d861d475faf031c2b46b31392'}
2017-03-17 11:17:31,722 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'17/03/17 11:14:47', 'amount': '5', 'external_ref': u'R170317.1114.140064', 'msisdn_2': u'254726280377', 'internal_ref': u'0387ca0d861d475faf031c2b46b31392'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'17/03/17 11:14:47', 'amount': '5', 'external_ref': u'R170317.1114.140064', 'msisdn_2': u'254726280377', 'internal_ref': u'0387ca0d861d475faf031c2b46b31392'}
2017-03-17 11:17:31,722 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-17 11:17:31,722 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-17 11:17:31,820 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-17 11:17:31,821 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-17 11:17:31,826 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-17 11:17:31,827 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:17:31,832 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-17 11:17:31,833 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-17 11:17:31,836 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-17 11:17:31,836 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-17 11:17:31,841 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-17 11:17:31,842 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:17:31,845 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-17 11:17:31,846 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:17:31,850 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-17 11:17:31,850 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-17 11:17:31,852 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-17 11:17:31,853 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:17:31,856 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-17 11:17:31,857 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:17:31,858 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-17 11:17:31,859 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7efee0ed50d0>
2017-03-17 11:17:31,865 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-17 11:17:31,865 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-17 11:17:31,865 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-17 11:17:31,865 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-17 11:17:31,866 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 5 of airtime from Saiba  to 254726280377
2017-03-17 11:17:31,866 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 5 of airtime from Saiba  to 254726280377
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 5 of airtime from Saiba  to 254726280377
2017-03-17 11:17:31,866 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-17 11:17:31,866 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-17 11:17:31,867 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 5 of airtime from Saiba  to 8
2017-03-17 11:17:31,867 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 5 of airtime from Saiba  to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 5 of airtime from Saiba  to 8
2017-03-17 11:17:31,868 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 5 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 11:17:31,868 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 5 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 5 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 11:17:31,868 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-17 11:17:31,868 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-17 11:17:31,869 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 5 of airtime from Saiba 
2017-03-17 11:17:31,869 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 5 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 5 of airtime from Saiba 
2017-03-17 11:17:33,514 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":29,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-17T11:14:49.232923Z"}
2017-03-17 11:17:33,514 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":29,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-17T11:14:49.232923Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":29,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-17T11:14:49.232923Z"}
2017-03-17 11:17:33,515 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-17 11:17:33,515 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-17 11:17:33,516 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":29,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-17T11:14:49.232923Z"}
2017-03-17 11:17:33,516 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":29,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-17T11:14:49.232923Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":29,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-17T11:14:49.232923Z"}
2017-03-17 11:17:33,516 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-17 11:17:33,516 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-17 11:17:33,517 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-17 11:17:33,517 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-17 11:17:33,517 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-17 11:17:33,517 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-17 11:17:33,518 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-17 11:17:33,518 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-17 11:17:33,518 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'amount' referenced before assignment
2017-03-17 11:17:33,518 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'amount' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'amount' referenced before assignment
2017-03-17 11:17:33,523 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2601.99ms
2017-03-17 11:17:33,523 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2601.99ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 2601.99ms
2017-03-17 11:20:38,747 = __main__ - INFO - Creating server
2017-03-17 11:20:38,747 = __main__ - INFO - Creating server
2017-03-17 11:20:38,751 = __main__ - INFO - Created server
2017-03-17 11:20:38,751 = __main__ - INFO - Created server
2017-03-17 11:20:38,751 = __main__ - INFO - Listening on port 8080
2017-03-17 11:20:38,751 = __main__ - INFO - Listening on port 8080
2017-03-17 11:20:38,752 = __main__ - INFO - Starting event loop
2017-03-17 11:20:38,752 = __main__ - INFO - Starting event loop
2017-03-17 11:31:50,195 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-17 11:31:50,195 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-17 11:31:50,196 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-17 11:31:50,196 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-17 11:31:50,196 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 11:31:50
2017-03-17 11:31:50,196 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 11:31:50
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 17/03/2017 11:31:50
2017-03-17 11:31:50,196 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-17 11:31:50,196 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-17 11:31:50,196 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-17 11:31:50,196 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-17 11:31:50,197 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 1867de16db1c4681957c73135901a9cb
2017-03-17 11:31:50,197 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 1867de16db1c4681957c73135901a9cb
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 1867de16db1c4681957c73135901a9cb
2017-03-17 11:31:50,197 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-17 11:31:50,197 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-17 11:31:50,197 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-17 11:31:50,197 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-17 11:31:50,198 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:31:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1867de16db1c4681957c73135901a9cb</ns0:EXTREFNUM><ns0:MSISDN2>254726280377</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:31:50,198 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:31:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1867de16db1c4681957c73135901a9cb</ns0:EXTREFNUM><ns0:MSISDN2>254726280377</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:31:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1867de16db1c4681957c73135901a9cb</ns0:EXTREFNUM><ns0:MSISDN2>254726280377</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:31:50,198 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-17 11:31:50,198 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-17 11:31:50,198 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-17 11:31:50,198 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-17 11:31:50,198 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:31:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1867de16db1c4681957c73135901a9cb</ns0:EXTREFNUM><ns0:MSISDN2>254726280377</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:31:50,198 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:31:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1867de16db1c4681957c73135901a9cb</ns0:EXTREFNUM><ns0:MSISDN2>254726280377</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:31:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1867de16db1c4681957c73135901a9cb</ns0:EXTREFNUM><ns0:MSISDN2>254726280377</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:31:50,199 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-17 11:31:50,199 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-17 11:31:51,004 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-17 11:31:51,004 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-17 11:31:51,004 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 11:29:06</ns0:DATE><ns0:EXTREFNUM>1867de16db1c4681957c73135901a9cb</ns0:EXTREFNUM><ns0:TXNID>R170317.1129.140011</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 726280377 is successful. Your new balance is KSH 2350</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 11:29:06</ns0:DATE><ns0:EXTREFNUM>1867de16db1c4681957c73135901a9cb</ns0:EXTREFNUM><ns0:TXNID>R170317.1129.140011</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 726280377 is successful. Your new balance is KSH 2350</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 11:31:51,005 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-17 11:31:51,004 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 11:29:06</ns0:DATE><ns0:EXTREFNUM>1867de16db1c4681957c73135901a9cb</ns0:EXTREFNUM><ns0:TXNID>R170317.1129.140011</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 726280377 is successful. Your new balance is KSH 2350</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 11:31:51,005 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-17 11:31:51,005 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
2017-03-17 11:31:51,005 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------5-----------------------
2017-03-17 11:31:51,005 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-17 11:31:51,005 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-17 11:31:51,006 = handlers.result_handler.AirtimeHandler - DEBUG - 17/03/17 11:29:06
2017-03-17 11:31:51,006 = handlers.result_handler.AirtimeHandler - DEBUG - 17/03/17 11:29:06
DEBUG:handlers.result_handler.AirtimeHandler:17/03/17 11:29:06
2017-03-17 11:31:51,006 = handlers.result_handler.AirtimeHandler - DEBUG - 1867de16db1c4681957c73135901a9cb
2017-03-17 11:31:51,006 = handlers.result_handler.AirtimeHandler - DEBUG - 1867de16db1c4681957c73135901a9cb
DEBUG:handlers.result_handler.AirtimeHandler:1867de16db1c4681957c73135901a9cb
2017-03-17 11:31:51,007 = handlers.result_handler.AirtimeHandler - DEBUG - R170317.1129.140011
2017-03-17 11:31:51,007 = handlers.result_handler.AirtimeHandler - DEBUG - R170317.1129.140011
DEBUG:handlers.result_handler.AirtimeHandler:R170317.1129.140011
2017-03-17 11:31:51,007 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'17/03/17 11:29:06', 'amount': '5', 'external_ref': u'R170317.1129.140011', 'msisdn_2': u'254726280377', 'internal_ref': u'1867de16db1c4681957c73135901a9cb'}
2017-03-17 11:31:51,007 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'17/03/17 11:29:06', 'amount': '5', 'external_ref': u'R170317.1129.140011', 'msisdn_2': u'254726280377', 'internal_ref': u'1867de16db1c4681957c73135901a9cb'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'17/03/17 11:29:06', 'amount': '5', 'external_ref': u'R170317.1129.140011', 'msisdn_2': u'254726280377', 'internal_ref': u'1867de16db1c4681957c73135901a9cb'}
2017-03-17 11:31:51,008 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-17 11:31:51,008 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-17 11:31:51,126 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-17 11:31:51,126 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-17 11:31:51,129 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-17 11:31:51,129 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:31:51,132 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-17 11:31:51,132 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-17 11:31:51,134 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-17 11:31:51,134 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-17 11:31:51,138 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:31:51,138 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-17 11:31:51,139 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-17 11:31:51,139 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-17 11:31:51,143 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-17 11:31:51,144 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-17 11:31:51,145 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-17 11:31:51,146 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-17 11:31:51,148 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-17 11:31:51,149 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:31:51,150 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:31:51,150 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-17 11:31:51,155 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f365ca18fd0>
2017-03-17 11:31:51,155 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-17 11:31:51,155 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-17 11:31:51,155 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-17 11:31:51,155 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 5 of airtime from Saiba  to 254726280377
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-17 11:31:51,155 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 5 of airtime from Saiba  to 254726280377
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 5 of airtime from Saiba  to 254726280377
2017-03-17 11:31:51,156 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-17 11:31:51,156 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-17 11:31:51,156 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 5 of airtime from Saiba  to 8
2017-03-17 11:31:51,156 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 5 of airtime from Saiba  to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 5 of airtime from Saiba  to 8
2017-03-17 11:31:51,157 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 5 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 11:31:51,157 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 5 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 5 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 11:31:51,157 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-17 11:31:51,157 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-17 11:31:51,157 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 5 of airtime from Saiba 
2017-03-17 11:31:51,157 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 5 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 5 of airtime from Saiba 
2017-03-17 11:31:52,459 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":30,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-17T11:29:08.151641Z"}
2017-03-17 11:31:52,459 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":30,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-17T11:29:08.151641Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":30,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-17T11:29:08.151641Z"}
2017-03-17 11:31:52,460 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-17 11:31:52,460 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-17 11:31:52,460 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":30,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-17T11:29:08.151641Z"}
2017-03-17 11:31:52,460 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":30,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-17T11:29:08.151641Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":30,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 5 of airtime from Saiba","image_url":"","date":"2017-03-17T11:29:08.151641Z"}
2017-03-17 11:31:52,461 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-17 11:31:52,461 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-17 11:31:52,461 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-17 11:31:52,461 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-17 11:31:52,461 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-17 11:31:52,461 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-17 11:31:52,461 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-17 11:31:52,461 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-17 11:31:52,462 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "254726280377", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "254726280377", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-17 11:31:52,462 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "254726280377", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-17 11:31:52,462 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-17 11:31:52,462 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-17 11:31:53,513 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 288, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-17 11:31:53,513 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 288, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 288, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-17 11:31:53,523 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-17 11:31:53,523 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-17 11:31:53,524 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3329.52ms
2017-03-17 11:31:53,524 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3329.52ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3329.52ms
2017-03-17 11:46:27,376 = __main__ - INFO - Creating server
2017-03-17 11:46:27,376 = __main__ - INFO - Creating server
2017-03-17 11:46:27,380 = __main__ - INFO - Created server
2017-03-17 11:46:27,380 = __main__ - INFO - Created server
2017-03-17 11:46:27,380 = __main__ - INFO - Listening on port 8080
2017-03-17 11:46:27,380 = __main__ - INFO - Listening on port 8080
2017-03-17 11:46:27,381 = __main__ - INFO - Starting event loop
2017-03-17 11:46:27,381 = __main__ - INFO - Starting event loop
2017-03-17 11:47:18,558 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-17 11:47:18,558 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-17 11:47:18,558 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-17 11:47:18,558 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-17 11:47:18,559 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 11:47:18
2017-03-17 11:47:18,559 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 11:47:18
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 17/03/2017 11:47:18
2017-03-17 11:47:18,559 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-17 11:47:18,559 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-17 11:47:18,560 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-17 11:47:18,560 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-17 11:47:18,561 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 4004e230cb364e97bd6a93304076d526
2017-03-17 11:47:18,561 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 4004e230cb364e97bd6a93304076d526
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 4004e230cb364e97bd6a93304076d526
2017-03-17 11:47:18,561 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-17 11:47:18,561 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-17 11:47:18,562 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-17 11:47:18,562 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-17 11:47:18,562 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:47:18</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>4004e230cb364e97bd6a93304076d526</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-17 11:47:18,562 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:47:18</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>4004e230cb364e97bd6a93304076d526</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:47:18</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>4004e230cb364e97bd6a93304076d526</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:47:18,563 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-17 11:47:18,563 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-17 11:47:18,564 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-17 11:47:18,564 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-17 11:47:18,564 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:47:18</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>4004e230cb364e97bd6a93304076d526</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:47:18,564 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:47:18</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>4004e230cb364e97bd6a93304076d526</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:47:18</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>4004e230cb364e97bd6a93304076d526</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:47:18,565 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-17 11:47:18,565 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-17 11:47:19,430 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-17 11:47:19,430 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-17 11:47:19,431 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 11:44:35</ns0:DATE><ns0:EXTREFNUM>4004e230cb364e97bd6a93304076d526</ns0:EXTREFNUM><ns0:TXNID>R170317.1144.140036</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 2340</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 11:47:19,431 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 11:44:35</ns0:DATE><ns0:EXTREFNUM>4004e230cb364e97bd6a93304076d526</ns0:EXTREFNUM><ns0:TXNID>R170317.1144.140036</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 2340</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 11:44:35</ns0:DATE><ns0:EXTREFNUM>4004e230cb364e97bd6a93304076d526</ns0:EXTREFNUM><ns0:TXNID>R170317.1144.140036</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 2340</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 11:47:19,431 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-17 11:47:19,431 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-17 11:47:19,432 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-17 11:47:19,432 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
2017-03-17 11:47:19,432 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-17 11:47:19,432 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-17 11:47:19,433 = handlers.result_handler.AirtimeHandler - DEBUG - 17/03/17 11:44:35
2017-03-17 11:47:19,433 = handlers.result_handler.AirtimeHandler - DEBUG - 17/03/17 11:44:35
DEBUG:handlers.result_handler.AirtimeHandler:17/03/17 11:44:35
2017-03-17 11:47:19,433 = handlers.result_handler.AirtimeHandler - DEBUG - 4004e230cb364e97bd6a93304076d526
2017-03-17 11:47:19,433 = handlers.result_handler.AirtimeHandler - DEBUG - 4004e230cb364e97bd6a93304076d526
DEBUG:handlers.result_handler.AirtimeHandler:4004e230cb364e97bd6a93304076d526
2017-03-17 11:47:19,434 = handlers.result_handler.AirtimeHandler - DEBUG - R170317.1144.140036
2017-03-17 11:47:19,434 = handlers.result_handler.AirtimeHandler - DEBUG - R170317.1144.140036
DEBUG:handlers.result_handler.AirtimeHandler:R170317.1144.140036
2017-03-17 11:47:19,434 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'17/03/17 11:44:35', 'amount': '10', 'external_ref': u'R170317.1144.140036', 'msisdn_2': u'254721799582', 'internal_ref': u'4004e230cb364e97bd6a93304076d526'}
2017-03-17 11:47:19,434 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'17/03/17 11:44:35', 'amount': '10', 'external_ref': u'R170317.1144.140036', 'msisdn_2': u'254721799582', 'internal_ref': u'4004e230cb364e97bd6a93304076d526'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'17/03/17 11:44:35', 'amount': '10', 'external_ref': u'R170317.1144.140036', 'msisdn_2': u'254721799582', 'internal_ref': u'4004e230cb364e97bd6a93304076d526'}
2017-03-17 11:47:19,434 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-17 11:47:19,434 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-17 11:47:19,537 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-17 11:47:19,537 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-17 11:47:19,540 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:47:19,540 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-17 11:47:19,544 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-17 11:47:19,544 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-17 11:47:19,547 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-17 11:47:19,547 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-17 11:47:19,551 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-17 11:47:19,551 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:47:19,554 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-17 11:47:19,554 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:47:19,558 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-17 11:47:19,559 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-17 11:47:19,562 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-17 11:47:19,562 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:47:19,566 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-17 11:47:19,566 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-17 11:47:19,568 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-17 11:47:19,568 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:47:19,575 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7fb66cf3bfd0>
2017-03-17 11:47:19,575 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-17 11:47:19,576 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-17 11:47:19,576 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-17 11:47:19,576 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254721799582
2017-03-17 11:47:19,576 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254721799582
2017-03-17 11:47:19,577 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-17 11:47:19,577 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-17 11:47:19,578 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
2017-03-17 11:47:19,578 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
2017-03-17 11:47:19,578 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 11:47:19,578 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 11:47:19,579 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-17 11:47:19,579 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-17 11:47:19,579 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-17 11:47:19,579 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-17 11:47:20,859 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":31,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T11:44:36.519278Z"}
2017-03-17 11:47:20,859 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":31,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T11:44:36.519278Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":31,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T11:44:36.519278Z"}
2017-03-17 11:47:20,860 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-17 11:47:20,860 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-17 11:47:20,860 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":31,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T11:44:36.519278Z"}
2017-03-17 11:47:20,860 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":31,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T11:44:36.519278Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":31,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T11:44:36.519278Z"}
2017-03-17 11:47:20,860 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-17 11:47:20,860 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-17 11:47:20,861 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-17 11:47:20,861 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-17 11:47:20,861 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-17 11:47:20,861 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-17 11:47:20,861 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-17 11:47:20,861 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-17 11:47:20,862 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "254721799582", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "", "service_provider_id": 1}
2017-03-17 11:47:20,862 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "254721799582", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "254721799582", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "", "service_provider_id": 1}
2017-03-17 11:47:20,862 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-17 11:47:20,862 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-17 11:47:21,993 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
2017-03-17 11:47:21,993 = handlers.result_handler.AirtimeHandler - ERROR - HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 289, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 289, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
ERROR:handlers.result_handler.AirtimeHandler:HTTP 400: Bad Request
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 289, in create_transaction
    res = client.fetch(req)
  File "/usr/local/lib/python2.7/dist-packages/tornado/httpclient.py", line 102, in fetch
    self._async_client.fetch, request, **kwargs))
  File "/usr/local/lib/python2.7/dist-packages/tornado/ioloop.py", line 457, in run_sync
    return future_cell[0].result()
  File "/usr/local/lib/python2.7/dist-packages/tornado/concurrent.py", line 237, in result
    raise_exc_info(self._exc_info)
  File "<string>", line 3, in raise_exc_info
HTTPError: HTTP 400: Bad Request
2017-03-17 11:47:21,999 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-17 11:47:21,999 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-17 11:47:21,999 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3442.74ms
2017-03-17 11:47:21,999 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3442.74ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3442.74ms
2017-03-17 11:56:10,009 = __main__ - INFO - Creating server
2017-03-17 11:56:10,009 = __main__ - INFO - Creating server
2017-03-17 11:56:10,013 = __main__ - INFO - Created server
2017-03-17 11:56:10,013 = __main__ - INFO - Created server
2017-03-17 11:56:10,013 = __main__ - INFO - Listening on port 8080
2017-03-17 11:56:10,013 = __main__ - INFO - Listening on port 8080
2017-03-17 11:56:10,014 = __main__ - INFO - Starting event loop
2017-03-17 11:56:10,014 = __main__ - INFO - Starting event loop
2017-03-17 11:57:06,620 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-17 11:57:06,620 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-17 11:57:06,620 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-17 11:57:06,620 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-17 11:57:06,621 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 11:57:06
2017-03-17 11:57:06,621 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 17/03/2017 11:57:06
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 17/03/2017 11:57:06
2017-03-17 11:57:06,621 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-17 11:57:06,621 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-17 11:57:06,621 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-17 11:57:06,621 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-17 11:57:06,622 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = a9384aa4e1cf4ae68dc03cd05ece712d
2017-03-17 11:57:06,622 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = a9384aa4e1cf4ae68dc03cd05ece712d
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = a9384aa4e1cf4ae68dc03cd05ece712d
2017-03-17 11:57:06,622 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-17 11:57:06,622 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-17 11:57:06,623 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-17 11:57:06,623 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-17 11:57:06,623 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:57:06</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a9384aa4e1cf4ae68dc03cd05ece712d</ns0:EXTREFNUM><ns0:MSISDN2>254725437441</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:57:06,623 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:57:06</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a9384aa4e1cf4ae68dc03cd05ece712d</ns0:EXTREFNUM><ns0:MSISDN2>254725437441</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:57:06</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a9384aa4e1cf4ae68dc03cd05ece712d</ns0:EXTREFNUM><ns0:MSISDN2>254725437441</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:57:06,623 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-17 11:57:06,623 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-17 11:57:06,624 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-17 11:57:06,624 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-17 11:57:06,624 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:57:06</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a9384aa4e1cf4ae68dc03cd05ece712d</ns0:EXTREFNUM><ns0:MSISDN2>254725437441</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:57:06,624 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:57:06</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a9384aa4e1cf4ae68dc03cd05ece712d</ns0:EXTREFNUM><ns0:MSISDN2>254725437441</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>17/03/2017 11:57:06</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a9384aa4e1cf4ae68dc03cd05ece712d</ns0:EXTREFNUM><ns0:MSISDN2>254725437441</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-17 11:57:06,625 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-17 11:57:06,625 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-17 11:57:07,423 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-17 11:57:07,423 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-17 11:57:07,423 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 11:54:22</ns0:DATE><ns0:EXTREFNUM>a9384aa4e1cf4ae68dc03cd05ece712d</ns0:EXTREFNUM><ns0:TXNID>R170317.1154.140030</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 725437441 is successful. Your new balance is KSH 2330</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 11:57:07,423 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 11:54:22</ns0:DATE><ns0:EXTREFNUM>a9384aa4e1cf4ae68dc03cd05ece712d</ns0:EXTREFNUM><ns0:TXNID>R170317.1154.140030</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 725437441 is successful. Your new balance is KSH 2330</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>17/03/17 11:54:22</ns0:DATE><ns0:EXTREFNUM>a9384aa4e1cf4ae68dc03cd05ece712d</ns0:EXTREFNUM><ns0:TXNID>R170317.1154.140030</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 725437441 is successful. Your new balance is KSH 2330</ns0:MESSAGE></ns0:COMMAND>

2017-03-17 11:57:07,424 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-17 11:57:07,424 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-17 11:57:07,424 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-17 11:57:07,424 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
2017-03-17 11:57:07,425 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-17 11:57:07,425 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-17 11:57:07,425 = handlers.result_handler.AirtimeHandler - DEBUG - 17/03/17 11:54:22
2017-03-17 11:57:07,425 = handlers.result_handler.AirtimeHandler - DEBUG - 17/03/17 11:54:22
DEBUG:handlers.result_handler.AirtimeHandler:17/03/17 11:54:22
2017-03-17 11:57:07,426 = handlers.result_handler.AirtimeHandler - DEBUG - a9384aa4e1cf4ae68dc03cd05ece712d
2017-03-17 11:57:07,426 = handlers.result_handler.AirtimeHandler - DEBUG - a9384aa4e1cf4ae68dc03cd05ece712d
DEBUG:handlers.result_handler.AirtimeHandler:a9384aa4e1cf4ae68dc03cd05ece712d
2017-03-17 11:57:07,426 = handlers.result_handler.AirtimeHandler - DEBUG - R170317.1154.140030
2017-03-17 11:57:07,426 = handlers.result_handler.AirtimeHandler - DEBUG - R170317.1154.140030
2017-03-17 11:57:07,426 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'17/03/17 11:54:22', 'amount': '10', 'external_ref': u'R170317.1154.140030', 'msisdn_2': u'254725437441', 'internal_ref': u'a9384aa4e1cf4ae68dc03cd05ece712d'}
DEBUG:handlers.result_handler.AirtimeHandler:R170317.1154.140030
2017-03-17 11:57:07,426 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'17/03/17 11:54:22', 'amount': '10', 'external_ref': u'R170317.1154.140030', 'msisdn_2': u'254725437441', 'internal_ref': u'a9384aa4e1cf4ae68dc03cd05ece712d'}
2017-03-17 11:57:07,426 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-17 11:57:07,426 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'17/03/17 11:54:22', 'amount': '10', 'external_ref': u'R170317.1154.140030', 'msisdn_2': u'254725437441', 'internal_ref': u'a9384aa4e1cf4ae68dc03cd05ece712d'}
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-17 11:57:07,535 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-17 11:57:07,536 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-17 11:57:07,538 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:57:07,538 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-17 11:57:07,541 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-17 11:57:07,541 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-17 11:57:07,543 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-17 11:57:07,543 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-17 11:57:07,548 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-17 11:57:07,548 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-17 11:57:07,550 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-17 11:57:07,550 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:57:07,553 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-17 11:57:07,553 INFO sqlalchemy.engine.base.Engine {'table': 23559}
2017-03-17 11:57:07,555 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-17 11:57:07,555 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:57:07,559 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:57:07,559 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-17 11:57:07,561 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-17 11:57:07,561 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-17 11:57:07,566 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7fa4d20c8fd0>
2017-03-17 11:57:07,566 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-17 11:57:07,567 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-17 11:57:07,567 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-17 11:57:07,567 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254725437441
2017-03-17 11:57:07,567 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254725437441
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254725437441
2017-03-17 11:57:07,567 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-17 11:57:07,567 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-17 11:57:07,567 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-17 11:57:07,567 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
2017-03-17 11:57:07,568 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 8
2017-03-17 11:57:07,568 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-17 11:57:07,568 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-17 11:57:07,568 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-17 11:57:07,568 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-17 11:57:07,568 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-17 11:57:08,851 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":32,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T11:54:24.493549Z"}
2017-03-17 11:57:08,851 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":32,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T11:54:24.493549Z"}
2017-03-17 11:57:08,852 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:{"id":32,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T11:54:24.493549Z"}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-17 11:57:08,852 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":32,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T11:54:24.493549Z"}
2017-03-17 11:57:08,852 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-17 11:57:08,852 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":32,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T11:54:24.493549Z"}
2017-03-17 11:57:08,852 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:{"id":32,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-17T11:54:24.493549Z"}
2017-03-17 11:57:08,852 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-17 11:57:08,852 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-17 11:57:08,852 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-17 11:57:08,852 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-17 11:57:08,852 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-17 11:57:08,853 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-17 11:57:08,853 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-17 11:57:08,853 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "725437441", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "725437441", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-17 11:57:08,853 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-17 11:57:08,853 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "725437441", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-17 11:57:08,853 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-17 11:57:09,925 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-17 11:57:09,925 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-17 11:57:09,926 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":8,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"725437441","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-17 11:57:09,926 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":8,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"725437441","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-17 11:57:09,926 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:{"id":8,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"725437441","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-17 11:57:09,926 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-17 11:57:09,927 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-17 11:57:09,927 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-17 11:57:09,928 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3309.00ms
2017-03-17 11:57:09,928 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3309.00ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3309.00ms
2017-03-17 11:59:37,995 = __main__ - INFO - Creating server
2017-03-17 11:59:37,995 = __main__ - INFO - Creating server
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 49, in <module>
    main()
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 35, in main
    http_server = HTTPServer(Application())
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/application.py", line 44, in __init__
    'https://6fbec91e99c24fe291d972b81acecd84:43722299fd2b490b808f3e8b1ca3ac95@sentry.io/146906'
AttributeError: 'Application' object has no attribute 'application'
2017-03-17 11:59:39,302 = __main__ - INFO - Creating server
2017-03-17 11:59:39,302 = __main__ - INFO - Creating server
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 49, in <module>
    main()
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 35, in main
    http_server = HTTPServer(Application())
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/application.py", line 44, in __init__
    'https://6fbec91e99c24fe291d972b81acecd84:43722299fd2b490b808f3e8b1ca3ac95@sentry.io/146906'
AttributeError: 'Application' object has no attribute 'application'
2017-03-17 11:59:41,597 = __main__ - INFO - Creating server
2017-03-17 11:59:41,597 = __main__ - INFO - Creating server
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 49, in <module>
    main()
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 35, in main
    http_server = HTTPServer(Application())
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/application.py", line 44, in __init__
    'https://6fbec91e99c24fe291d972b81acecd84:43722299fd2b490b808f3e8b1ca3ac95@sentry.io/146906'
AttributeError: 'Application' object has no attribute 'application'
2017-03-17 11:59:44,911 = __main__ - INFO - Creating server
2017-03-17 11:59:44,911 = __main__ - INFO - Creating server
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 49, in <module>
    main()
  File "/opt/saiba/ke-safaricom-airtime-integration/app/main.py", line 35, in main
    http_server = HTTPServer(Application())
  File "/opt/saiba/ke-safaricom-airtime-integration/app/common/application.py", line 44, in __init__
    'https://6fbec91e99c24fe291d972b81acecd84:43722299fd2b490b808f3e8b1ca3ac95@sentry.io/146906'
AttributeError: 'Application' object has no attribute 'application'
2017-03-18 10:56:37,296 = __main__ - INFO - Creating server
2017-03-18 10:57:28,823 = __main__ - INFO - Creating server
2017-03-18 10:57:28,823 = __main__ - INFO - Creating server
2017-03-18 10:57:28,827 = __main__ - INFO - Created server
2017-03-18 10:57:28,827 = __main__ - INFO - Created server
2017-03-18 10:57:28,827 = __main__ - INFO - Listening on port 8080
2017-03-18 10:57:28,827 = __main__ - INFO - Listening on port 8080
2017-03-18 10:57:28,828 = __main__ - INFO - Starting event loop
2017-03-18 10:57:28,828 = __main__ - INFO - Starting event loop
2017-03-18 10:57:34,736 = __main__ - INFO - Creating server
2017-03-18 10:57:34,741 = __main__ - INFO - Created server
2017-03-18 10:57:34,741 = __main__ - INFO - Listening on port 8080
2017-03-18 10:57:43,873 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-18 10:57:43,873 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-18 10:57:43,873 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-18 10:57:43,873 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-18 10:57:43,874 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 10:57:43
2017-03-18 10:57:43,874 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 10:57:43
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 18/03/2017 10:57:43
2017-03-18 10:57:43,874 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-18 10:57:43,874 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-18 10:57:43,874 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-18 10:57:43,874 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-18 10:57:43,874 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 74e254fbc79840bb99c05358a70ba23d
2017-03-18 10:57:43,874 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 74e254fbc79840bb99c05358a70ba23d
2017-03-18 10:57:43,875 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 74e254fbc79840bb99c05358a70ba23d
2017-03-18 10:57:43,875 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-18 10:57:43,875 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-18 10:57:43,875 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-18 10:57:43,875 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 10:57:43</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>74e254fbc79840bb99c05358a70ba23d</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 10:57:43</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>74e254fbc79840bb99c05358a70ba23d</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 10:57:43,875 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-18 10:57:43,875 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 10:57:43</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>74e254fbc79840bb99c05358a70ba23d</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 10:57:43,875 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-18 10:57:43,875 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-18 10:57:43,875 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-18 10:57:43,875 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 10:57:43</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>74e254fbc79840bb99c05358a70ba23d</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 10:57:43,875 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 10:57:43</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>74e254fbc79840bb99c05358a70ba23d</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 10:57:43</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>74e254fbc79840bb99c05358a70ba23d</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 10:57:43,876 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-18 10:57:43,876 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-18 10:57:44,758 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-18 10:57:44,758 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-18 10:57:44,758 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 10:54:57</ns0:DATE><ns0:EXTREFNUM>74e254fbc79840bb99c05358a70ba23d</ns0:EXTREFNUM><ns0:TXNID>R170318.1054.140068</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 720384396 is successful. Your new balance is KSH 2320</ns0:MESSAGE></ns0:COMMAND>
2017-03-18 10:57:44,758 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 10:54:57</ns0:DATE><ns0:EXTREFNUM>74e254fbc79840bb99c05358a70ba23d</ns0:EXTREFNUM><ns0:TXNID>R170318.1054.140068</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 720384396 is successful. Your new balance is KSH 2320</ns0:MESSAGE></ns0:COMMAND>


DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 10:54:57</ns0:DATE><ns0:EXTREFNUM>74e254fbc79840bb99c05358a70ba23d</ns0:EXTREFNUM><ns0:TXNID>R170318.1054.140068</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 720384396 is successful. Your new balance is KSH 2320</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 10:57:44,759 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-18 10:57:44,759 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-18 10:57:44,759 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-18 10:57:44,759 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
2017-03-18 10:57:44,760 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-18 10:57:44,760 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-18 10:57:44,760 = handlers.result_handler.AirtimeHandler - DEBUG - 18/03/17 10:54:57
2017-03-18 10:57:44,760 = handlers.result_handler.AirtimeHandler - DEBUG - 18/03/17 10:54:57
DEBUG:handlers.result_handler.AirtimeHandler:18/03/17 10:54:57
2017-03-18 10:57:44,761 = handlers.result_handler.AirtimeHandler - DEBUG - 74e254fbc79840bb99c05358a70ba23d
2017-03-18 10:57:44,761 = handlers.result_handler.AirtimeHandler - DEBUG - 74e254fbc79840bb99c05358a70ba23d
DEBUG:handlers.result_handler.AirtimeHandler:74e254fbc79840bb99c05358a70ba23d
2017-03-18 10:57:44,761 = handlers.result_handler.AirtimeHandler - DEBUG - R170318.1054.140068
2017-03-18 10:57:44,761 = handlers.result_handler.AirtimeHandler - DEBUG - R170318.1054.140068
DEBUG:handlers.result_handler.AirtimeHandler:R170318.1054.140068
2017-03-18 10:57:44,762 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'18/03/17 10:54:57', 'amount': '10', 'external_ref': u'R170318.1054.140068', 'msisdn_2': u'254720384396', 'internal_ref': u'74e254fbc79840bb99c05358a70ba23d'}
2017-03-18 10:57:44,762 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'18/03/17 10:54:57', 'amount': '10', 'external_ref': u'R170318.1054.140068', 'msisdn_2': u'254720384396', 'internal_ref': u'74e254fbc79840bb99c05358a70ba23d'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'18/03/17 10:54:57', 'amount': '10', 'external_ref': u'R170318.1054.140068', 'msisdn_2': u'254720384396', 'internal_ref': u'74e254fbc79840bb99c05358a70ba23d'}
2017-03-18 10:57:44,762 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-18 10:57:44,762 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-18 10:57:44,860 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-18 10:57:44,860 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-18 10:57:44,863 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-18 10:57:44,863 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-18 10:57:44,866 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-18 10:57:44,866 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-18 10:57:44,868 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-18 10:57:44,868 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-18 10:57:44,871 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 10:57:44,871 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-18 10:57:44,873 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 10:57:44,873 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-18 10:57:44,876 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-18 10:57:44,876 INFO sqlalchemy.engine.base.Engine {'table': 23559}
2017-03-18 10:57:44,878 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 10:57:44,878 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-18 10:57:44,880 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-18 10:57:44,881 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-18 10:57:44,882 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-18 10:57:44,882 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f93171bccd0>
2017-03-18 10:57:44,887 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-18 10:57:44,887 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-18 10:57:44,887 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-18 10:57:44,887 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-18 10:57:44,888 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254720384396
2017-03-18 10:57:44,888 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254720384396
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254720384396
2017-03-18 10:57:44,888 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-18 10:57:44,888 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-18 10:57:44,888 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 3
2017-03-18 10:57:44,888 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 3
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 3
2017-03-18 10:57:44,888 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-18 10:57:44,888 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-18 10:57:44,888 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-18 10:57:44,888 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-18 10:57:44,889 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-18 10:57:44,889 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-18 10:57:46,285 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":41,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-18T10:54:59.337059Z"}
2017-03-18 10:57:46,285 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":41,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-18T10:54:59.337059Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":41,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-18T10:54:59.337059Z"}
2017-03-18 10:57:46,286 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-18 10:57:46,286 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-18 10:57:46,286 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":41,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-18T10:54:59.337059Z"}
2017-03-18 10:57:46,286 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":41,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-18T10:54:59.337059Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":41,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-18T10:54:59.337059Z"}
2017-03-18 10:57:46,286 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-18 10:57:46,286 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-18 10:57:46,286 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-18 10:57:46,286 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-18 10:57:46,286 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-18 10:57:46,286 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-18 10:57:46,286 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-18 10:57:46,286 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-18 10:57:46,287 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "720384396", "user": 3, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-18 10:57:46,287 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "720384396", "user": 3, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "720384396", "user": 3, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-18 10:57:46,287 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-18 10:57:46,287 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-18 10:57:47,440 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 10:57:47,440 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 10:57:47,440 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":16,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"720384396","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-18 10:57:47,440 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":16,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"720384396","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":16,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"720384396","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-18 10:57:47,441 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 10:57:47,441 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 10:57:47,441 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-18 10:57:47,441 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-18 10:57:47,442 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3569.64ms
2017-03-18 10:57:47,442 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3569.64ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3569.64ms
2017-03-18 10:57:52,704 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/100000/-------------------
2017-03-18 10:57:52,704 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/100000/-------------------
2017-03-18 10:57:52,704 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/100000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-18 10:57:52,704 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-18 10:57:52,705 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 10:57:52
2017-03-18 10:57:52,705 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 10:57:52
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 18/03/2017 10:57:52
2017-03-18 10:57:52,705 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-18 10:57:52,705 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-18 10:57:52,705 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-18 10:57:52,705 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-18 10:57:52,705 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 5ab1e3d9f5e244ceb4a33a75f4853a1a
2017-03-18 10:57:52,705 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 5ab1e3d9f5e244ceb4a33a75f4853a1a
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 5ab1e3d9f5e244ceb4a33a75f4853a1a
2017-03-18 10:57:52,706 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-18 10:57:52,706 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-18 10:57:52,706 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-18 10:57:52,706 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-18 10:57:52,706 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 10:57:52</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5ab1e3d9f5e244ceb4a33a75f4853a1a</ns0:EXTREFNUM><ns0:MSISDN2>254705091831</ns0:MSISDN2><ns0:AMOUNT>100000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 10:57:52,706 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 10:57:52</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5ab1e3d9f5e244ceb4a33a75f4853a1a</ns0:EXTREFNUM><ns0:MSISDN2>254705091831</ns0:MSISDN2><ns0:AMOUNT>100000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 10:57:52</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5ab1e3d9f5e244ceb4a33a75f4853a1a</ns0:EXTREFNUM><ns0:MSISDN2>254705091831</ns0:MSISDN2><ns0:AMOUNT>100000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 10:57:52,706 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-18 10:57:52,706 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-18 10:57:52,707 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-18 10:57:52,707 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-18 10:57:52,707 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 10:57:52</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5ab1e3d9f5e244ceb4a33a75f4853a1a</ns0:EXTREFNUM><ns0:MSISDN2>254705091831</ns0:MSISDN2><ns0:AMOUNT>100000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 10:57:52,707 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 10:57:52</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5ab1e3d9f5e244ceb4a33a75f4853a1a</ns0:EXTREFNUM><ns0:MSISDN2>254705091831</ns0:MSISDN2><ns0:AMOUNT>100000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 10:57:52</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5ab1e3d9f5e244ceb4a33a75f4853a1a</ns0:EXTREFNUM><ns0:MSISDN2>254705091831</ns0:MSISDN2><ns0:AMOUNT>100000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 10:57:52,707 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-18 10:57:52,707 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-18 10:57:53,510 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-18 10:57:53,510 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 10:55:06</ns0:DATE><ns0:EXTREFNUM>5ab1e3d9f5e244ceb4a33a75f4853a1a</ns0:EXTREFNUM><ns0:TXNID>R170318.1055.140008</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 1000 to 705091831 is successful. Your new balance is KSH 1320</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 10:57:53,511 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 10:55:06</ns0:DATE><ns0:EXTREFNUM>5ab1e3d9f5e244ceb4a33a75f4853a1a</ns0:EXTREFNUM><ns0:TXNID>R170318.1055.140008</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 1000 to 705091831 is successful. Your new balance is KSH 1320</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 10:57:53,510 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-18 10:57:53,510 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 10:55:06</ns0:DATE><ns0:EXTREFNUM>5ab1e3d9f5e244ceb4a33a75f4853a1a</ns0:EXTREFNUM><ns0:TXNID>R170318.1055.140008</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 1000 to 705091831 is successful. Your new balance is KSH 1320</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 10:57:53,511 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-18 10:57:53,511 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------1000-----------------------
2017-03-18 10:57:53,511 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------1000-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------1000-----------------------
2017-03-18 10:57:53,511 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-18 10:57:53,511 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-18 10:57:53,512 = handlers.result_handler.AirtimeHandler - DEBUG - 18/03/17 10:55:06
2017-03-18 10:57:53,512 = handlers.result_handler.AirtimeHandler - DEBUG - 18/03/17 10:55:06
DEBUG:handlers.result_handler.AirtimeHandler:18/03/17 10:55:06
2017-03-18 10:57:53,512 = handlers.result_handler.AirtimeHandler - DEBUG - 5ab1e3d9f5e244ceb4a33a75f4853a1a
2017-03-18 10:57:53,512 = handlers.result_handler.AirtimeHandler - DEBUG - 5ab1e3d9f5e244ceb4a33a75f4853a1a
DEBUG:handlers.result_handler.AirtimeHandler:5ab1e3d9f5e244ceb4a33a75f4853a1a
2017-03-18 10:57:53,512 = handlers.result_handler.AirtimeHandler - DEBUG - R170318.1055.140008
2017-03-18 10:57:53,512 = handlers.result_handler.AirtimeHandler - DEBUG - R170318.1055.140008
DEBUG:handlers.result_handler.AirtimeHandler:R170318.1055.140008
2017-03-18 10:57:53,513 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'18/03/17 10:55:06', 'amount': '1000', 'external_ref': u'R170318.1055.140008', 'msisdn_2': u'254705091831', 'internal_ref': u'5ab1e3d9f5e244ceb4a33a75f4853a1a'}
2017-03-18 10:57:53,513 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'18/03/17 10:55:06', 'amount': '1000', 'external_ref': u'R170318.1055.140008', 'msisdn_2': u'254705091831', 'internal_ref': u'5ab1e3d9f5e244ceb4a33a75f4853a1a'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'18/03/17 10:55:06', 'amount': '1000', 'external_ref': u'R170318.1055.140008', 'msisdn_2': u'254705091831', 'internal_ref': u'5ab1e3d9f5e244ceb4a33a75f4853a1a'}
2017-03-18 10:57:53,513 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-18 10:57:53,513 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-18 10:57:53,547 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-18 10:57:53,547 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-18 10:57:53,550 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 10:57:53,551 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-18 10:57:53,553 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-18 10:57:53,554 INFO sqlalchemy.engine.base.Engine {}
2017-03-18 10:57:53,555 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-18 10:57:53,556 INFO sqlalchemy.engine.base.Engine {}
2017-03-18 10:57:53,560 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 10:57:53,560 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-18 10:57:53,562 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-18 10:57:53,563 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 10:57:53,564 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-18 10:57:53,565 INFO sqlalchemy.engine.base.Engine {'table': 23559}
2017-03-18 10:57:53,567 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 10:57:53,567 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-18 10:57:53,570 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-18 10:57:53,570 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 10:57:53,572 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 10:57:53,572 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f9316f4ec50>
2017-03-18 10:57:53,577 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-18 10:57:53,577 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-18 10:57:53,577 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-18 10:57:53,577 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-18 10:57:53,578 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 1000 of airtime from Saiba  to 254705091831
2017-03-18 10:57:53,578 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 1000 of airtime from Saiba  to 254705091831
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 1000 of airtime from Saiba  to 254705091831
2017-03-18 10:57:53,578 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-18 10:57:53,578 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-18 10:57:53,578 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 1000 of airtime from Saiba  to 8
2017-03-18 10:57:53,578 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 1000 of airtime from Saiba  to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 1000 of airtime from Saiba  to 8
2017-03-18 10:57:53,578 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 1000 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-18 10:57:53,578 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 1000 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 1000 of airtime from Saiba ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-18 10:57:53,579 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-18 10:57:53,579 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-18 10:57:53,579 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 1000 of airtime from Saiba 
2017-03-18 10:57:53,579 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 1000 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 1000 of airtime from Saiba 
2017-03-18 10:57:54,731 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":42,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 1000 of airtime from Saiba","image_url":"","date":"2017-03-18T10:55:07.784965Z"}
2017-03-18 10:57:54,731 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":42,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 1000 of airtime from Saiba","image_url":"","date":"2017-03-18T10:55:07.784965Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":42,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 1000 of airtime from Saiba","image_url":"","date":"2017-03-18T10:55:07.784965Z"}
2017-03-18 10:57:54,731 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-18 10:57:54,731 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-18 10:57:54,732 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":42,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 1000 of airtime from Saiba","image_url":"","date":"2017-03-18T10:55:07.784965Z"}
2017-03-18 10:57:54,732 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":42,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 1000 of airtime from Saiba","image_url":"","date":"2017-03-18T10:55:07.784965Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":42,"user":8,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 1000 of airtime from Saiba","image_url":"","date":"2017-03-18T10:55:07.784965Z"}
2017-03-18 10:57:54,732 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-18 10:57:54,732 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-18 10:57:54,732 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-18 10:57:54,732 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-18 10:57:54,732 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-18 10:57:54,732 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-18 10:57:54,733 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-18 10:57:54,733 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-18 10:57:54,733 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "705091831", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-18 10:57:54,733 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "705091831", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "705091831", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-18 10:57:54,733 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-18 10:57:54,733 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-18 10:57:54,784 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 10:57:54,784 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 10:57:54,785 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":17,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"705091831","request":null,"amount":1000.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-18 10:57:54,785 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":17,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"705091831","request":null,"amount":1000.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":17,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"705091831","request":null,"amount":1000.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-18 10:57:54,785 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 10:57:54,785 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 10:57:54,785 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-18 10:57:54,785 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-18 10:57:54,786 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2082.64ms
2017-03-18 10:57:54,786 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2082.64ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 2082.64ms
2017-03-18 11:18:13,096 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-18 11:18:13,096 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/5000/-------------------
2017-03-18 11:18:13,097 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-18 11:18:13,097 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-18 11:18:13,097 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 11:18:13
2017-03-18 11:18:13,097 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 11:18:13
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 18/03/2017 11:18:13
2017-03-18 11:18:13,097 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-18 11:18:13,097 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-18 11:18:13,097 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-18 11:18:13,097 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-18 11:18:13,098 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 02f68bfe881a4ae6bd49f9e0443f5cb4
2017-03-18 11:18:13,098 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 02f68bfe881a4ae6bd49f9e0443f5cb4
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 02f68bfe881a4ae6bd49f9e0443f5cb4
2017-03-18 11:18:13,098 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-18 11:18:13,098 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-18 11:18:13,098 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-18 11:18:13,098 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-18 11:18:13,098 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 11:18:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>02f68bfe881a4ae6bd49f9e0443f5cb4</ns0:EXTREFNUM><ns0:MSISDN2>254722340898</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 11:18:13,098 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 11:18:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>02f68bfe881a4ae6bd49f9e0443f5cb4</ns0:EXTREFNUM><ns0:MSISDN2>254722340898</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 11:18:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>02f68bfe881a4ae6bd49f9e0443f5cb4</ns0:EXTREFNUM><ns0:MSISDN2>254722340898</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 11:18:13,099 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-18 11:18:13,099 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-18 11:18:13,099 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-18 11:18:13,099 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-18 11:18:13,099 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 11:18:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>02f68bfe881a4ae6bd49f9e0443f5cb4</ns0:EXTREFNUM><ns0:MSISDN2>254722340898</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 11:18:13,099 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 11:18:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>02f68bfe881a4ae6bd49f9e0443f5cb4</ns0:EXTREFNUM><ns0:MSISDN2>254722340898</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 11:18:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>02f68bfe881a4ae6bd49f9e0443f5cb4</ns0:EXTREFNUM><ns0:MSISDN2>254722340898</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 11:18:13,099 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-18 11:18:13,099 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-18 11:18:13,895 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-18 11:18:13,895 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-18 11:18:13,896 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 11:15:26</ns0:DATE><ns0:EXTREFNUM>02f68bfe881a4ae6bd49f9e0443f5cb4</ns0:EXTREFNUM><ns0:TXNID>R170318.1115.140043</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 722340898 is successful. Your new balance is KSH 1270</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 11:18:13,896 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 11:15:26</ns0:DATE><ns0:EXTREFNUM>02f68bfe881a4ae6bd49f9e0443f5cb4</ns0:EXTREFNUM><ns0:TXNID>R170318.1115.140043</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 722340898 is successful. Your new balance is KSH 1270</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 11:15:26</ns0:DATE><ns0:EXTREFNUM>02f68bfe881a4ae6bd49f9e0443f5cb4</ns0:EXTREFNUM><ns0:TXNID>R170318.1115.140043</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 722340898 is successful. Your new balance is KSH 1270</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 11:18:13,896 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-18 11:18:13,896 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-18 11:18:13,896 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
2017-03-18 11:18:13,896 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------50-----------------------
2017-03-18 11:18:13,896 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-18 11:18:13,896 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-18 11:18:13,897 = handlers.result_handler.AirtimeHandler - DEBUG - 18/03/17 11:15:26
2017-03-18 11:18:13,897 = handlers.result_handler.AirtimeHandler - DEBUG - 18/03/17 11:15:26
DEBUG:handlers.result_handler.AirtimeHandler:18/03/17 11:15:26
2017-03-18 11:18:13,897 = handlers.result_handler.AirtimeHandler - DEBUG - 02f68bfe881a4ae6bd49f9e0443f5cb4
2017-03-18 11:18:13,897 = handlers.result_handler.AirtimeHandler - DEBUG - 02f68bfe881a4ae6bd49f9e0443f5cb4
DEBUG:handlers.result_handler.AirtimeHandler:02f68bfe881a4ae6bd49f9e0443f5cb4
2017-03-18 11:18:13,897 = handlers.result_handler.AirtimeHandler - DEBUG - R170318.1115.140043
2017-03-18 11:18:13,897 = handlers.result_handler.AirtimeHandler - DEBUG - R170318.1115.140043
DEBUG:handlers.result_handler.AirtimeHandler:R170318.1115.140043
2017-03-18 11:18:13,897 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'18/03/17 11:15:26', 'amount': '50', 'external_ref': u'R170318.1115.140043', 'msisdn_2': u'254722340898', 'internal_ref': u'02f68bfe881a4ae6bd49f9e0443f5cb4'}
2017-03-18 11:18:13,897 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'18/03/17 11:15:26', 'amount': '50', 'external_ref': u'R170318.1115.140043', 'msisdn_2': u'254722340898', 'internal_ref': u'02f68bfe881a4ae6bd49f9e0443f5cb4'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'18/03/17 11:15:26', 'amount': '50', 'external_ref': u'R170318.1115.140043', 'msisdn_2': u'254722340898', 'internal_ref': u'02f68bfe881a4ae6bd49f9e0443f5cb4'}
2017-03-18 11:18:13,898 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-18 11:18:13,898 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-18 11:18:13,935 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-18 11:18:13,935 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-18 11:18:13,938 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-18 11:18:13,938 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 11:18:13,941 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-18 11:18:13,941 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-18 11:18:13,943 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-18 11:18:13,943 INFO sqlalchemy.engine.base.Engine {}
2017-03-18 11:18:13,947 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 11:18:13,947 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-18 11:18:13,949 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 11:18:13,950 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-18 11:18:13,952 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-18 11:18:13,952 INFO sqlalchemy.engine.base.Engine {'table': 23559}
2017-03-18 11:18:13,954 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 11:18:13,954 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-18 11:18:13,957 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 11:18:13,957 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-18 11:18:13,958 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 11:18:13,958 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f9316f64550>
2017-03-18 11:18:13,963 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-18 11:18:13,963 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-18 11:18:13,963 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-18 11:18:13,963 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-18 11:18:13,964 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254722340898
2017-03-18 11:18:13,964 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254722340898
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254722340898
2017-03-18 11:18:13,964 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-18 11:18:13,964 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-18 11:18:13,964 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 4
2017-03-18 11:18:13,964 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 4
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 4
2017-03-18 11:18:13,964 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "4", "title": "Safaricom  Airtime"}
2017-03-18 11:18:13,964 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "4", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "4", "title": "Safaricom  Airtime"}
2017-03-18 11:18:13,965 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-18 11:18:13,965 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-18 11:18:13,965 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 50 of airtime from Saiba 
2017-03-18 11:18:13,965 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 50 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 50 of airtime from Saiba 
2017-03-18 11:18:15,326 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":44,"user":4,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-18T11:15:28.340532Z"}
2017-03-18 11:18:15,326 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":44,"user":4,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-18T11:15:28.340532Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":44,"user":4,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-18T11:15:28.340532Z"}
2017-03-18 11:18:15,327 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-18 11:18:15,327 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-18 11:18:15,327 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":44,"user":4,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-18T11:15:28.340532Z"}
2017-03-18 11:18:15,327 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":44,"user":4,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-18T11:15:28.340532Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":44,"user":4,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-18T11:15:28.340532Z"}
2017-03-18 11:18:15,327 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-18 11:18:15,327 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-18 11:18:15,327 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-18 11:18:15,327 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-18 11:18:15,327 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-18 11:18:15,327 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-18 11:18:15,328 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-18 11:18:15,328 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-18 11:18:15,328 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "722340898", "user": 4, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "50", "service_provider_id": 1}
2017-03-18 11:18:15,328 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "722340898", "user": 4, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "50", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "722340898", "user": 4, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "50", "service_provider_id": 1}
2017-03-18 11:18:15,328 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-18 11:18:15,328 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-18 11:18:16,642 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 11:18:16,642 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-18 11:18:16,642 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":19,"user":4,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"722340898","request":null,"amount":50.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-18 11:18:16,642 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":19,"user":4,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"722340898","request":null,"amount":50.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":19,"user":4,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"722340898","request":null,"amount":50.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-18 11:18:16,642 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 11:18:16,642 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 11:18:16,643 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-18 11:18:16,643 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-18 11:18:16,644 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3548.15ms
2017-03-18 11:18:16,644 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3548.15ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3548.15ms
2017-03-18 11:23:53,396 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-18 11:23:53,396 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-18 11:23:53,397 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-18 11:23:53,397 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-18 11:23:53,397 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 11:23:53
2017-03-18 11:23:53,397 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 11:23:53
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 18/03/2017 11:23:53
2017-03-18 11:23:53,397 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-18 11:23:53,397 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-18 11:23:53,397 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-18 11:23:53,397 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-18 11:23:53,398 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = f0c0b3b4439d4e11b163a1488ec9d506
2017-03-18 11:23:53,398 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = f0c0b3b4439d4e11b163a1488ec9d506
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = f0c0b3b4439d4e11b163a1488ec9d506
2017-03-18 11:23:53,398 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-18 11:23:53,398 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-18 11:23:53,398 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-18 11:23:53,398 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-18 11:23:53,398 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 11:23:53</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f0c0b3b4439d4e11b163a1488ec9d506</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 11:23:53,398 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 11:23:53</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f0c0b3b4439d4e11b163a1488ec9d506</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 11:23:53</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f0c0b3b4439d4e11b163a1488ec9d506</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 11:23:53,399 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-18 11:23:53,399 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-18 11:23:53,399 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-18 11:23:53,399 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-18 11:23:53,399 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 11:23:53</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f0c0b3b4439d4e11b163a1488ec9d506</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 11:23:53,399 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 11:23:53</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f0c0b3b4439d4e11b163a1488ec9d506</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 11:23:53</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f0c0b3b4439d4e11b163a1488ec9d506</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 11:23:53,399 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-18 11:23:53,399 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-18 11:23:54,360 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-18 11:23:54,360 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-18 11:23:54,361 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 11:21:07</ns0:DATE><ns0:EXTREFNUM>f0c0b3b4439d4e11b163a1488ec9d506</ns0:EXTREFNUM><ns0:TXNID>R170318.1121.140008</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 702935200 is successful. Your new balance is KSH 1260</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-18 11:23:54,361 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 11:21:07</ns0:DATE><ns0:EXTREFNUM>f0c0b3b4439d4e11b163a1488ec9d506</ns0:EXTREFNUM><ns0:TXNID>R170318.1121.140008</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 702935200 is successful. Your new balance is KSH 1260</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 11:23:54,361 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 11:21:07</ns0:DATE><ns0:EXTREFNUM>f0c0b3b4439d4e11b163a1488ec9d506</ns0:EXTREFNUM><ns0:TXNID>R170318.1121.140008</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 702935200 is successful. Your new balance is KSH 1260</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 11:23:54,361 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-18 11:23:54,361 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-18 11:23:54,361 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
2017-03-18 11:23:54,361 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-18 11:23:54,361 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-18 11:23:54,361 = handlers.result_handler.AirtimeHandler - DEBUG - 18/03/17 11:21:07
2017-03-18 11:23:54,361 = handlers.result_handler.AirtimeHandler - DEBUG - 18/03/17 11:21:07
DEBUG:handlers.result_handler.AirtimeHandler:18/03/17 11:21:07
2017-03-18 11:23:54,362 = handlers.result_handler.AirtimeHandler - DEBUG - f0c0b3b4439d4e11b163a1488ec9d506
2017-03-18 11:23:54,362 = handlers.result_handler.AirtimeHandler - DEBUG - f0c0b3b4439d4e11b163a1488ec9d506
DEBUG:handlers.result_handler.AirtimeHandler:f0c0b3b4439d4e11b163a1488ec9d506
2017-03-18 11:23:54,362 = handlers.result_handler.AirtimeHandler - DEBUG - R170318.1121.140008
2017-03-18 11:23:54,362 = handlers.result_handler.AirtimeHandler - DEBUG - R170318.1121.140008
DEBUG:handlers.result_handler.AirtimeHandler:R170318.1121.140008
2017-03-18 11:23:54,362 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'18/03/17 11:21:07', 'amount': '10', 'external_ref': u'R170318.1121.140008', 'msisdn_2': u'254702935200', 'internal_ref': u'f0c0b3b4439d4e11b163a1488ec9d506'}
2017-03-18 11:23:54,362 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'18/03/17 11:21:07', 'amount': '10', 'external_ref': u'R170318.1121.140008', 'msisdn_2': u'254702935200', 'internal_ref': u'f0c0b3b4439d4e11b163a1488ec9d506'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'18/03/17 11:21:07', 'amount': '10', 'external_ref': u'R170318.1121.140008', 'msisdn_2': u'254702935200', 'internal_ref': u'f0c0b3b4439d4e11b163a1488ec9d506'}
2017-03-18 11:23:54,362 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-18 11:23:54,362 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-18 11:23:54,397 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-18 11:23:54,397 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-18 11:23:54,400 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 11:23:54,400 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-18 11:23:54,403 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-18 11:23:54,403 INFO sqlalchemy.engine.base.Engine {}
2017-03-18 11:23:54,406 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-18 11:23:54,406 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-18 11:23:54,409 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 11:23:54,409 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-18 11:23:54,411 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 11:23:54,411 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-18 11:23:54,413 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-18 11:23:54,413 INFO sqlalchemy.engine.base.Engine {'table': 23559}
2017-03-18 11:23:54,415 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-18 11:23:54,415 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 11:23:54,418 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 11:23:54,418 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-18 11:23:54,419 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 11:23:54,419 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-18 11:23:54,425 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f9316f6f690>
2017-03-18 11:23:54,425 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-18 11:23:54,425 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-18 11:23:54,425 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-18 11:23:54,425 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254702935200
2017-03-18 11:23:54,425 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254702935200
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 10 of airtime from Saiba  to 254702935200
2017-03-18 11:23:54,426 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-18 11:23:54,426 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-18 11:23:54,426 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 4
2017-03-18 11:23:54,426 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 4
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 10 of airtime from Saiba  to 4
2017-03-18 11:23:54,426 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "4", "title": "Safaricom  Airtime"}
2017-03-18 11:23:54,426 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "4", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 10 of airtime from Saiba ", "user": "4", "title": "Safaricom  Airtime"}
2017-03-18 11:23:54,426 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-18 11:23:54,426 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-18 11:23:54,427 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-18 11:23:54,427 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 10 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 10 of airtime from Saiba 
2017-03-18 11:23:55,786 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":45,"user":4,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-18T11:21:08.789642Z"}
2017-03-18 11:23:55,786 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":45,"user":4,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-18T11:21:08.789642Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":45,"user":4,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-18T11:21:08.789642Z"}
2017-03-18 11:23:55,787 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-18 11:23:55,787 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-18 11:23:55,787 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":45,"user":4,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-18T11:21:08.789642Z"}
2017-03-18 11:23:55,787 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":45,"user":4,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-18T11:21:08.789642Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":45,"user":4,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 10 of airtime from Saiba","image_url":"","date":"2017-03-18T11:21:08.789642Z"}
2017-03-18 11:23:55,787 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-18 11:23:55,787 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-18 11:23:55,787 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-18 11:23:55,787 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-18 11:23:55,788 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-18 11:23:55,788 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-18 11:23:55,788 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-18 11:23:55,788 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-18 11:23:55,788 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 4, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-18 11:23:55,788 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 4, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 4, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-18 11:23:55,788 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-18 11:23:55,788 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-18 11:23:57,384 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 11:23:57,384 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-18 11:23:57,384 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":20,"user":4,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-18 11:23:57,384 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":20,"user":4,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":20,"user":4,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-18 11:23:57,384 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 11:23:57,384 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 11:23:57,385 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-18 11:23:57,385 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-18 11:23:57,385 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3989.50ms
2017-03-18 11:23:57,385 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3989.50ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3989.50ms
2017-03-18 11:25:05,855 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-18 11:25:05,855 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/5000/-------------------
2017-03-18 11:25:05,856 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-18 11:25:05,856 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-18 11:25:05,856 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 11:25:05
2017-03-18 11:25:05,856 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 11:25:05
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 18/03/2017 11:25:05
2017-03-18 11:25:05,857 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-18 11:25:05,857 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-18 11:25:05,857 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-18 11:25:05,857 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-18 11:25:05,858 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 6f7678dcd9274a0f8dda656d7c0b48dd
2017-03-18 11:25:05,858 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 6f7678dcd9274a0f8dda656d7c0b48dd
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 6f7678dcd9274a0f8dda656d7c0b48dd
2017-03-18 11:25:05,858 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-18 11:25:05,858 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-18 11:25:05,858 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-18 11:25:05,858 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-18 11:25:05,859 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 11:25:05</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>6f7678dcd9274a0f8dda656d7c0b48dd</ns0:EXTREFNUM><ns0:MSISDN2>254795362310</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 11:25:05,859 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 11:25:05</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>6f7678dcd9274a0f8dda656d7c0b48dd</ns0:EXTREFNUM><ns0:MSISDN2>254795362310</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 11:25:05</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>6f7678dcd9274a0f8dda656d7c0b48dd</ns0:EXTREFNUM><ns0:MSISDN2>254795362310</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 11:25:05,859 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-18 11:25:05,859 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-18 11:25:05,859 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-18 11:25:05,859 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-18 11:25:05,860 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 11:25:05</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>6f7678dcd9274a0f8dda656d7c0b48dd</ns0:EXTREFNUM><ns0:MSISDN2>254795362310</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 11:25:05,860 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 11:25:05</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>6f7678dcd9274a0f8dda656d7c0b48dd</ns0:EXTREFNUM><ns0:MSISDN2>254795362310</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 11:25:05</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>6f7678dcd9274a0f8dda656d7c0b48dd</ns0:EXTREFNUM><ns0:MSISDN2>254795362310</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 11:25:05,860 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-18 11:25:05,860 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-18 11:25:06,656 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-18 11:25:06,656 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-18 11:25:06,656 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 11:22:19</ns0:DATE><ns0:EXTREFNUM>6f7678dcd9274a0f8dda656d7c0b48dd</ns0:EXTREFNUM><ns0:TXNID>R170318.1122.140032</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 795362310 is successful. Your new balance is KSH 1210</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 11:25:06,656 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 11:22:19</ns0:DATE><ns0:EXTREFNUM>6f7678dcd9274a0f8dda656d7c0b48dd</ns0:EXTREFNUM><ns0:TXNID>R170318.1122.140032</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 795362310 is successful. Your new balance is KSH 1210</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 11:22:19</ns0:DATE><ns0:EXTREFNUM>6f7678dcd9274a0f8dda656d7c0b48dd</ns0:EXTREFNUM><ns0:TXNID>R170318.1122.140032</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 795362310 is successful. Your new balance is KSH 1210</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 11:25:06,656 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-18 11:25:06,656 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-18 11:25:06,657 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
2017-03-18 11:25:06,657 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------50-----------------------
2017-03-18 11:25:06,657 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-18 11:25:06,657 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-18 11:25:06,657 = handlers.result_handler.AirtimeHandler - DEBUG - 18/03/17 11:22:19
2017-03-18 11:25:06,657 = handlers.result_handler.AirtimeHandler - DEBUG - 18/03/17 11:22:19
DEBUG:handlers.result_handler.AirtimeHandler:18/03/17 11:22:19
2017-03-18 11:25:06,657 = handlers.result_handler.AirtimeHandler - DEBUG - 6f7678dcd9274a0f8dda656d7c0b48dd
2017-03-18 11:25:06,657 = handlers.result_handler.AirtimeHandler - DEBUG - 6f7678dcd9274a0f8dda656d7c0b48dd
DEBUG:handlers.result_handler.AirtimeHandler:6f7678dcd9274a0f8dda656d7c0b48dd
2017-03-18 11:25:06,658 = handlers.result_handler.AirtimeHandler - DEBUG - R170318.1122.140032
2017-03-18 11:25:06,658 = handlers.result_handler.AirtimeHandler - DEBUG - R170318.1122.140032
DEBUG:handlers.result_handler.AirtimeHandler:R170318.1122.140032
2017-03-18 11:25:06,658 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'18/03/17 11:22:19', 'amount': '50', 'external_ref': u'R170318.1122.140032', 'msisdn_2': u'254795362310', 'internal_ref': u'6f7678dcd9274a0f8dda656d7c0b48dd'}
2017-03-18 11:25:06,658 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'18/03/17 11:22:19', 'amount': '50', 'external_ref': u'R170318.1122.140032', 'msisdn_2': u'254795362310', 'internal_ref': u'6f7678dcd9274a0f8dda656d7c0b48dd'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'18/03/17 11:22:19', 'amount': '50', 'external_ref': u'R170318.1122.140032', 'msisdn_2': u'254795362310', 'internal_ref': u'6f7678dcd9274a0f8dda656d7c0b48dd'}
2017-03-18 11:25:06,658 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-18 11:25:06,658 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-18 11:25:06,692 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-18 11:25:06,693 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-18 11:25:06,696 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-18 11:25:06,696 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 11:25:06,698 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-18 11:25:06,698 INFO sqlalchemy.engine.base.Engine {}
2017-03-18 11:25:06,700 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-18 11:25:06,701 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-18 11:25:06,704 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-18 11:25:06,704 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 11:25:06,706 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-18 11:25:06,706 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-18 11:25:06,708 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-18 11:25:06,708 INFO sqlalchemy.engine.base.Engine {'table': 23559}
2017-03-18 11:25:06,710 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 11:25:06,711 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-18 11:25:06,714 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 11:25:06,714 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-18 11:25:06,715 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-18 11:25:06,716 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 11:25:06,721 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f9316f64a10>
2017-03-18 11:25:06,721 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-18 11:25:06,722 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-18 11:25:06,722 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-18 11:25:06,722 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254795362310
2017-03-18 11:25:06,722 = handlers.result_handler.AirtimeHandler - DEBUG - sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254795362310
DEBUG:handlers.result_handler.AirtimeHandler:sending Your Have succesfully purchased ksh 50 of airtime from Saiba  to 254795362310
2017-03-18 11:25:06,722 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-18 11:25:06,722 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-18 11:25:06,723 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 3
2017-03-18 11:25:06,723 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 3
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your Have succesfully purchased ksh 50 of airtime from Saiba  to 3
2017-03-18 11:25:06,723 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-18 11:25:06,723 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your Have succesfully purchased ksh 50 of airtime from Saiba ", "user": "3", "title": "Safaricom  Airtime"}
2017-03-18 11:25:06,724 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-18 11:25:06,724 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-18 11:25:06,724 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 50 of airtime from Saiba 
2017-03-18 11:25:06,724 = handlers.result_handler.AirtimeHandler - DEBUG - Your Have succesfully purchased ksh 50 of airtime from Saiba 
DEBUG:handlers.result_handler.AirtimeHandler:Your Have succesfully purchased ksh 50 of airtime from Saiba 
2017-03-18 11:25:08,176 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":46,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-18T11:22:21.174969Z"}
2017-03-18 11:25:08,176 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":46,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-18T11:22:21.174969Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":46,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-18T11:22:21.174969Z"}
2017-03-18 11:25:08,177 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-18 11:25:08,177 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-18 11:25:08,177 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":46,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-18T11:22:21.174969Z"}
2017-03-18 11:25:08,177 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":46,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-18T11:22:21.174969Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":46,"user":3,"title":"Safaricom  Airtime","text":"Your Have succesfully purchased ksh 50 of airtime from Saiba","image_url":"","date":"2017-03-18T11:22:21.174969Z"}
2017-03-18 11:25:08,177 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-18 11:25:08,177 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-18 11:25:08,178 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-18 11:25:08,178 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-18 11:25:08,178 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-18 11:25:08,178 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-18 11:25:08,178 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-18 11:25:08,178 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-18 11:25:08,178 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "795362310", "user": 3, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "50", "service_provider_id": 1}
2017-03-18 11:25:08,178 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "795362310", "user": 3, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "50", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "795362310", "user": 3, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "50", "service_provider_id": 1}
2017-03-18 11:25:08,179 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-18 11:25:08,179 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-18 11:25:08,241 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 11:25:08,241 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-18 11:25:08,242 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":21,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"795362310","request":null,"amount":50.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":21,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"795362310","request":null,"amount":50.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-18 11:25:08,242 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":21,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"795362310","request":null,"amount":50.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-18 11:25:08,242 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 11:25:08,242 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 11:25:08,242 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-18 11:25:08,242 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-18 11:25:08,243 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2388.35ms
2017-03-18 11:25:08,243 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2388.35ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 2388.35ms
2017-03-18 13:13:31,471 = __main__ - INFO - Creating server
2017-03-18 13:13:31,471 = __main__ - INFO - Creating server
2017-03-18 13:13:31,475 = __main__ - INFO - Created server
2017-03-18 13:13:31,475 = __main__ - INFO - Created server
2017-03-18 13:13:31,476 = __main__ - INFO - Listening on port 8080
2017-03-18 13:13:31,476 = __main__ - INFO - Listening on port 8080
2017-03-18 13:13:31,477 = __main__ - INFO - Starting event loop
2017-03-18 13:13:31,477 = __main__ - INFO - Starting event loop
2017-03-18 13:19:12,681 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-18 13:19:12,681 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
2017-03-18 13:19:12,681 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-18 13:19:12,681 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-18 13:19:12,682 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 13:19:12
2017-03-18 13:19:12,682 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 13:19:12
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 18/03/2017 13:19:12
2017-03-18 13:19:12,682 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-18 13:19:12,682 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-18 13:19:12,683 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-18 13:19:12,683 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-18 13:19:12,683 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 1bcc8ca6538147c9a67240308b62b7aa
2017-03-18 13:19:12,683 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 1bcc8ca6538147c9a67240308b62b7aa
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 1bcc8ca6538147c9a67240308b62b7aa
2017-03-18 13:19:12,684 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-18 13:19:12,684 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-18 13:19:12,684 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-18 13:19:12,684 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-18 13:19:12,684 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:19:12</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1bcc8ca6538147c9a67240308b62b7aa</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 13:19:12,684 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:19:12</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1bcc8ca6538147c9a67240308b62b7aa</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:19:12</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1bcc8ca6538147c9a67240308b62b7aa</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 13:19:12,685 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-18 13:19:12,685 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-18 13:19:12,685 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-18 13:19:12,685 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-18 13:19:12,686 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:19:12</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1bcc8ca6538147c9a67240308b62b7aa</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 13:19:12,686 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:19:12</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1bcc8ca6538147c9a67240308b62b7aa</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:19:12</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1bcc8ca6538147c9a67240308b62b7aa</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 13:19:12,686 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-18 13:19:12,686 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-18 13:19:13,538 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-18 13:19:13,538 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-18 13:19:13,539 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:16:26</ns0:DATE><ns0:EXTREFNUM>1bcc8ca6538147c9a67240308b62b7aa</ns0:EXTREFNUM><ns0:TXNID>R170318.1316.140027</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 1205</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 13:19:13,539 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:16:26</ns0:DATE><ns0:EXTREFNUM>1bcc8ca6538147c9a67240308b62b7aa</ns0:EXTREFNUM><ns0:TXNID>R170318.1316.140027</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 1205</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:16:26</ns0:DATE><ns0:EXTREFNUM>1bcc8ca6538147c9a67240308b62b7aa</ns0:EXTREFNUM><ns0:TXNID>R170318.1316.140027</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 1205</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 13:19:13,539 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-18 13:19:13,539 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-18 13:19:13,540 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
2017-03-18 13:19:13,540 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------5-----------------------
2017-03-18 13:19:13,541 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-18 13:19:13,541 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-18 13:19:13,541 = handlers.result_handler.AirtimeHandler - DEBUG - 18/03/17 13:16:26
2017-03-18 13:19:13,541 = handlers.result_handler.AirtimeHandler - DEBUG - 18/03/17 13:16:26
DEBUG:handlers.result_handler.AirtimeHandler:18/03/17 13:16:26
2017-03-18 13:19:13,542 = handlers.result_handler.AirtimeHandler - DEBUG - 1bcc8ca6538147c9a67240308b62b7aa
2017-03-18 13:19:13,542 = handlers.result_handler.AirtimeHandler - DEBUG - 1bcc8ca6538147c9a67240308b62b7aa
DEBUG:handlers.result_handler.AirtimeHandler:1bcc8ca6538147c9a67240308b62b7aa
2017-03-18 13:19:13,542 = handlers.result_handler.AirtimeHandler - DEBUG - R170318.1316.140027
2017-03-18 13:19:13,542 = handlers.result_handler.AirtimeHandler - DEBUG - R170318.1316.140027
DEBUG:handlers.result_handler.AirtimeHandler:R170318.1316.140027
2017-03-18 13:19:13,543 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'18/03/17 13:16:26', 'amount': '5', 'external_ref': u'R170318.1316.140027', 'msisdn_2': u'254702935200', 'internal_ref': '2KPL5VD8VE'}
2017-03-18 13:19:13,543 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'18/03/17 13:16:26', 'amount': '5', 'external_ref': u'R170318.1316.140027', 'msisdn_2': u'254702935200', 'internal_ref': '2KPL5VD8VE'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'18/03/17 13:16:26', 'amount': '5', 'external_ref': u'R170318.1316.140027', 'msisdn_2': u'254702935200', 'internal_ref': '2KPL5VD8VE'}
2017-03-18 13:19:13,543 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-18 13:19:13,543 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-18 13:19:13,644 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-18 13:19:13,645 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-18 13:19:13,648 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 13:19:13,648 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-18 13:19:13,652 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-18 13:19:13,653 INFO sqlalchemy.engine.base.Engine {}
2017-03-18 13:19:13,655 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-18 13:19:13,656 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-18 13:19:13,661 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-18 13:19:13,662 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 13:19:13,664 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-18 13:19:13,664 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 13:19:13,668 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-18 13:19:13,668 INFO sqlalchemy.engine.base.Engine {'table': 23559}
2017-03-18 13:19:13,670 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-18 13:19:13,670 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 13:19:13,673 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-18 13:19:13,673 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-18 13:19:13,674 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-18 13:19:13,674 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 13:19:13,680 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7ff88d626e90>
2017-03-18 13:19:13,680 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-18 13:19:13,680 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-18 13:19:13,680 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-18 13:19:13,680 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2KPL5VD8VE
2017-03-18 13:19:13,680 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2KPL5VD8VE
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2KPL5VD8VE
2017-03-18 13:19:13,681 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2KPL5VD8VE to 254702935200
2017-03-18 13:19:13,681 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2KPL5VD8VE to 254702935200
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2KPL5VD8VE to 254702935200
2017-03-18 13:19:13,681 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-18 13:19:13,681 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-18 13:19:13,681 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2KPL5VD8VE to 7
2017-03-18 13:19:13,681 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2KPL5VD8VE to 7
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2KPL5VD8VE to 7
2017-03-18 13:19:13,682 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2KPL5VD8VE", "user": "7", "title": "Safaricom  Airtime"}
2017-03-18 13:19:13,682 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2KPL5VD8VE", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2KPL5VD8VE", "user": "7", "title": "Safaricom  Airtime"}
2017-03-18 13:19:13,682 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-18 13:19:13,682 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-18 13:19:13,682 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2KPL5VD8VE
2017-03-18 13:19:13,682 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2KPL5VD8VE
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2KPL5VD8VE
2017-03-18 13:19:15,040 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":47,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2KPL5VD8VE","image_url":"","date":"2017-03-18T13:16:27.827502Z"}
2017-03-18 13:19:15,040 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":47,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2KPL5VD8VE","image_url":"","date":"2017-03-18T13:16:27.827502Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":47,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2KPL5VD8VE","image_url":"","date":"2017-03-18T13:16:27.827502Z"}
2017-03-18 13:19:15,040 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-18 13:19:15,040 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-18 13:19:15,041 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":47,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2KPL5VD8VE","image_url":"","date":"2017-03-18T13:16:27.827502Z"}
2017-03-18 13:19:15,041 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":47,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2KPL5VD8VE","image_url":"","date":"2017-03-18T13:16:27.827502Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":47,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2KPL5VD8VE","image_url":"","date":"2017-03-18T13:16:27.827502Z"}
2017-03-18 13:19:15,041 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-18 13:19:15,041 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-18 13:19:15,041 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-18 13:19:15,041 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-18 13:19:15,042 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-18 13:19:15,042 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-18 13:19:15,042 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-18 13:19:15,042 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-18 13:19:15,042 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-18 13:19:15,042 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-18 13:19:15,043 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-18 13:19:15,043 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-18 13:19:16,319 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 13:19:16,319 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 13:19:16,320 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":22,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-18 13:19:16,320 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":22,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":22,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-18 13:19:16,321 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 13:19:16,321 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 13:19:16,321 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-18 13:19:16,321 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-18 13:19:16,322 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3642.39ms
2017-03-18 13:19:16,322 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3642.39ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3642.39ms
2017-03-18 13:36:29,881 = __main__ - INFO - Creating server
2017-03-18 13:36:29,881 = __main__ - INFO - Creating server
2017-03-18 13:36:29,886 = __main__ - INFO - Created server
2017-03-18 13:36:29,886 = __main__ - INFO - Created server
2017-03-18 13:36:29,886 = __main__ - INFO - Listening on port 8080
2017-03-18 13:36:29,886 = __main__ - INFO - Listening on port 8080
2017-03-18 13:36:29,887 = __main__ - INFO - Starting event loop
2017-03-18 13:36:29,887 = __main__ - INFO - Starting event loop
2017-03-18 13:38:35,808 = tornado.access - WARNING - 404 GET /manager/html (119.1.109.17) 0.87ms
2017-03-18 13:38:35,808 = tornado.access - WARNING - 404 GET /manager/html (119.1.109.17) 0.87ms
2017-03-18 13:41:24,056 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-18 13:41:24,056 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-18 13:41:24,056 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
2017-03-18 13:41:24,056 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-18 13:41:24,056 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 13:41:24
2017-03-18 13:41:24,056 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 13:41:24
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 18/03/2017 13:41:24
2017-03-18 13:41:24,057 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-18 13:41:24,057 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-18 13:41:24,057 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-18 13:41:24,057 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-18 13:41:24,057 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = c455ef701bae439790fab3e909b2e583
2017-03-18 13:41:24,057 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = c455ef701bae439790fab3e909b2e583
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = c455ef701bae439790fab3e909b2e583
2017-03-18 13:41:24,058 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-18 13:41:24,058 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-18 13:41:24,058 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-18 13:41:24,058 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-18 13:41:24,058 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:41:24</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c455ef701bae439790fab3e909b2e583</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-18 13:41:24,058 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-18 13:41:24,058 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:41:24</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c455ef701bae439790fab3e909b2e583</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 13:41:24,058 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-18 13:41:24,059 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:41:24</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c455ef701bae439790fab3e909b2e583</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-18 13:41:24,059 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-18 13:41:24,059 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:41:24</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c455ef701bae439790fab3e909b2e583</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 13:41:24,059 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:41:24</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c455ef701bae439790fab3e909b2e583</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:41:24</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c455ef701bae439790fab3e909b2e583</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 13:41:24,059 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-18 13:41:24,059 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-18 13:41:24,522 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-18 13:41:24,522 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-18 13:41:24,522 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>7048</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:38:37</ns0:DATE><ns0:EXTREFNUM>c455ef701bae439790fab3e909b2e583</ns0:EXTREFNUM><ns0:TXNID></ns0:TXNID><ns0:MESSAGE>Receiver mobile number is from un-supported network.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>7048</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:38:37</ns0:DATE><ns0:EXTREFNUM>c455ef701bae439790fab3e909b2e583</ns0:EXTREFNUM><ns0:TXNID></ns0:TXNID><ns0:MESSAGE>Receiver mobile number is from un-supported network.</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 13:41:24,522 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-18 13:41:24,522 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>7048</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:38:37</ns0:DATE><ns0:EXTREFNUM>c455ef701bae439790fab3e909b2e583</ns0:EXTREFNUM><ns0:TXNID></ns0:TXNID><ns0:MESSAGE>Receiver mobile number is from un-supported network.</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 13:41:24,522 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-18 13:41:24,523 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-18 13:41:24,523 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-18 13:41:24,523 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 500. Your account has been refunded with KES 500 Saiba Credits which can be used to transact on Saiba
2017-03-18 13:41:24,523 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 500. Your account has been refunded with KES 500 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 500. Your account has been refunded with KES 500 Saiba Credits which can be used to transact on Saiba
2017-03-18 13:41:24,523 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-18 13:41:24,523 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-18 13:41:24,524 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 500. Your account has been refunded with KES 500 Saiba Credits which can be used to transact on Saiba to 8
2017-03-18 13:41:24,524 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 500. Your account has been refunded with KES 500 Saiba Credits which can be used to transact on Saiba to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 500. Your account has been refunded with KES 500 Saiba Credits which can be used to transact on Saiba to 8
2017-03-18 13:41:24,524 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 500. Your account has been refunded with KES 500 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-18 13:41:24,524 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 500. Your account has been refunded with KES 500 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 500. Your account has been refunded with KES 500 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-18 13:41:24,524 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-18 13:41:24,524 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-18 13:41:24,525 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 500. Your account has been refunded with KES 500 Saiba Credits which can be used to transact on Saiba
2017-03-18 13:41:24,525 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 500. Your account has been refunded with KES 500 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 500. Your account has been refunded with KES 500 Saiba Credits which can be used to transact on Saiba
2017-03-18 13:41:25,898 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":48,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 500. Your account has been refunded with KES 500 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-18T13:38:38.643023Z"}
2017-03-18 13:41:25,898 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":48,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 500. Your account has been refunded with KES 500 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-18T13:38:38.643023Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":48,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 500. Your account has been refunded with KES 500 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-18T13:38:38.643023Z"}
2017-03-18 13:41:25,898 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-18 13:41:25,898 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-18 13:41:25,899 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-18 13:41:25,899 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-18 13:41:25,899 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-18 13:41:25,899 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-18 13:41:25,899 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "50", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-18 13:41:25,899 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "50", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "50", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-18 13:41:27,027 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 13:41:27,028 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":50.0,"balance":1110.0}
2017-03-18 13:41:27,027 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 13:41:27,028 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"user":8,"user_credit_type":1,"debit":0.0,"credit":50.0,"balance":1110.0}
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 13:41:27,028 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-18 13:41:27,028 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":50.0,"balance":1110.0}
{"user":8,"user_credit_type":1,"debit":0.0,"credit":50.0,"balance":1110.0}
2017-03-18 13:41:27,028 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 13:41:27,028 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-18 13:41:27,029 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-18 13:41:27,029 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-18 13:41:27,029 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-18 13:41:27,029 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-18 13:41:27,029 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "329378", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "500", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "329378", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "500", "service_provider_id": 1}
2017-03-18 13:41:27,030 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-18 13:41:27,029 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "329378", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "500", "service_provider_id": 1}
2017-03-18 13:41:27,030 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-18 13:41:28,175 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 13:41:28,175 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 13:41:28,175 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":23,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"329378","request":null,"amount":500.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-18 13:41:28,176 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"id":23,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"329378","request":null,"amount":500.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-18 13:41:28,175 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":23,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"329378","request":null,"amount":500.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-18 13:41:28,176 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 13:41:28,176 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-18 13:41:28,176 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4121.18ms
2017-03-18 13:41:28,176 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-18 13:41:28,176 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4121.18ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 4121.18ms
2017-03-18 13:45:25,205 = __main__ - INFO - Creating server
2017-03-18 13:45:25,205 = __main__ - INFO - Creating server
2017-03-18 13:45:25,210 = __main__ - INFO - Created server
2017-03-18 13:45:25,210 = __main__ - INFO - Created server
2017-03-18 13:45:25,211 = __main__ - INFO - Listening on port 8080
2017-03-18 13:45:25,211 = __main__ - INFO - Listening on port 8080
2017-03-18 13:45:25,212 = __main__ - INFO - Starting event loop
2017-03-18 13:45:25,212 = __main__ - INFO - Starting event loop
2017-03-18 13:45:35,579 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-18 13:45:35,579 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
2017-03-18 13:45:35,580 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-18 13:45:35,580 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-18 13:45:35,581 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 13:45:35
2017-03-18 13:45:35,581 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 13:45:35
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 18/03/2017 13:45:35
2017-03-18 13:45:35,581 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-18 13:45:35,581 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-18 13:45:35,582 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-18 13:45:35,582 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-18 13:45:35,583 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 262219bfe8e44adea132f09784227920
2017-03-18 13:45:35,583 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 262219bfe8e44adea132f09784227920
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 262219bfe8e44adea132f09784227920
2017-03-18 13:45:35,584 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-18 13:45:35,584 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-18 13:45:35,585 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-18 13:45:35,585 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-18 13:45:35,586 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:45:35</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>262219bfe8e44adea132f09784227920</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 13:45:35,586 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:45:35</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>262219bfe8e44adea132f09784227920</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:45:35</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>262219bfe8e44adea132f09784227920</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 13:45:35,587 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-18 13:45:35,587 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-18 13:45:35,588 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-18 13:45:35,588 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-18 13:45:35,589 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:45:35</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>262219bfe8e44adea132f09784227920</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 13:45:35,589 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:45:35</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>262219bfe8e44adea132f09784227920</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:45:35</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>262219bfe8e44adea132f09784227920</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 13:45:35,590 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-18 13:45:35,590 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-18 13:45:36,063 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-18 13:45:36,063 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-18 13:45:36,064 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>7048</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:42:48</ns0:DATE><ns0:EXTREFNUM>262219bfe8e44adea132f09784227920</ns0:EXTREFNUM><ns0:TXNID></ns0:TXNID><ns0:MESSAGE>Receiver mobile number is from un-supported network.</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 13:45:36,064 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>7048</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:42:48</ns0:DATE><ns0:EXTREFNUM>262219bfe8e44adea132f09784227920</ns0:EXTREFNUM><ns0:TXNID></ns0:TXNID><ns0:MESSAGE>Receiver mobile number is from un-supported network.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>7048</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:42:48</ns0:DATE><ns0:EXTREFNUM>262219bfe8e44adea132f09784227920</ns0:EXTREFNUM><ns0:TXNID></ns0:TXNID><ns0:MESSAGE>Receiver mobile number is from un-supported network.</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 13:45:36,065 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-18 13:45:36,065 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-18 13:45:36,066 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-18 13:45:36,066 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-18 13:45:36,066 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-18 13:45:36,066 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-18 13:45:36,067 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-18 13:45:36,067 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-18 13:45:36,068 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-18 13:45:36,068 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-18 13:45:36,068 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 8
2017-03-18 13:45:36,068 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 8
2017-03-18 13:45:36,069 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-18 13:45:36,069 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-18 13:45:36,069 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-18 13:45:36,069 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-18 13:45:36,070 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-18 13:45:36,070 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-18 13:45:36,116 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":49,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-18T13:42:48.855157Z"}
2017-03-18 13:45:36,116 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":49,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-18T13:42:48.855157Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":49,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-18T13:42:48.855157Z"}
2017-03-18 13:45:36,118 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-18 13:45:36,118 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-18 13:45:36,118 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-18 13:45:36,118 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-18 13:45:36,119 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-18 13:45:36,119 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-18 13:45:36,119 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "0", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-18 13:45:36,119 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "0", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "0", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-18 13:45:36,174 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 13:45:36,174 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-18 13:45:36,175 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":0.0,"balance":1110.0}
2017-03-18 13:45:36,175 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":0.0,"balance":1110.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":8,"user_credit_type":1,"debit":0.0,"credit":0.0,"balance":1110.0}
{"user":8,"user_credit_type":1,"debit":0.0,"credit":0.0,"balance":1110.0}
2017-03-18 13:45:36,176 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 13:45:36,176 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 13:45:36,176 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-18 13:45:36,176 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-18 13:45:36,177 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-18 13:45:36,177 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-18 13:45:36,177 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-18 13:45:36,177 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-18 13:45:36,178 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "329378", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-18 13:45:36,178 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "329378", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "329378", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-18 13:45:36,178 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-18 13:45:36,178 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-18 13:45:36,221 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 13:45:36,221 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-18 13:45:36,222 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":24,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"329378","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-18 13:45:36,222 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":24,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"329378","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":24,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"329378","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-18 13:45:36,222 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 13:45:36,222 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 13:45:36,223 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-18 13:45:36,223 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-18 13:45:36,224 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 646.21ms
2017-03-18 13:45:36,224 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 646.21ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 646.21ms
2017-03-18 13:55:25,741 = __main__ - INFO - Creating server
2017-03-18 13:55:25,741 = __main__ - INFO - Creating server
2017-03-18 13:55:25,745 = __main__ - INFO - Created server
2017-03-18 13:55:25,745 = __main__ - INFO - Created server
2017-03-18 13:55:25,745 = __main__ - INFO - Listening on port 8080
2017-03-18 13:55:25,745 = __main__ - INFO - Listening on port 8080
2017-03-18 13:55:25,746 = __main__ - INFO - Starting event loop
2017-03-18 13:55:25,746 = __main__ - INFO - Starting event loop
2017-03-18 13:55:30,990 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-18 13:55:30,990 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
2017-03-18 13:55:30,991 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-18 13:55:30,991 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-18 13:55:30,992 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 13:55:30
2017-03-18 13:55:30,992 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 13:55:30
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 18/03/2017 13:55:30
2017-03-18 13:55:30,992 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-18 13:55:30,992 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-18 13:55:30,993 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-18 13:55:30,993 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-18 13:55:30,993 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 73bd1ea7af0841af8a4b09dfba8387f7
2017-03-18 13:55:30,993 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 73bd1ea7af0841af8a4b09dfba8387f7
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 73bd1ea7af0841af8a4b09dfba8387f7
2017-03-18 13:55:30,994 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-18 13:55:30,994 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-18 13:55:30,994 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-18 13:55:30,994 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-18 13:55:30,995 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:55:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>73bd1ea7af0841af8a4b09dfba8387f7</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 13:55:30,995 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:55:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>73bd1ea7af0841af8a4b09dfba8387f7</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:55:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>73bd1ea7af0841af8a4b09dfba8387f7</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 13:55:30,995 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-18 13:55:30,995 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-18 13:55:30,996 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-18 13:55:30,996 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-18 13:55:30,996 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:55:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>73bd1ea7af0841af8a4b09dfba8387f7</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 13:55:30,996 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:55:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>73bd1ea7af0841af8a4b09dfba8387f7</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:55:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>73bd1ea7af0841af8a4b09dfba8387f7</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 13:55:30,997 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-18 13:55:30,997 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-18 13:55:31,509 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-18 13:55:31,509 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-18 13:55:31,510 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>7048</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:52:44</ns0:DATE><ns0:EXTREFNUM>73bd1ea7af0841af8a4b09dfba8387f7</ns0:EXTREFNUM><ns0:TXNID></ns0:TXNID><ns0:MESSAGE>Receiver mobile number is from un-supported network.</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 13:55:31,510 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>7048</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:52:44</ns0:DATE><ns0:EXTREFNUM>73bd1ea7af0841af8a4b09dfba8387f7</ns0:EXTREFNUM><ns0:TXNID></ns0:TXNID><ns0:MESSAGE>Receiver mobile number is from un-supported network.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>7048</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:52:44</ns0:DATE><ns0:EXTREFNUM>73bd1ea7af0841af8a4b09dfba8387f7</ns0:EXTREFNUM><ns0:TXNID></ns0:TXNID><ns0:MESSAGE>Receiver mobile number is from un-supported network.</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 13:55:31,511 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-18 13:55:31,511 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-18 13:55:31,512 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-18 13:55:31,512 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-18 13:55:31,513 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-18 13:55:31,513 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-18 13:55:31,513 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-18 13:55:31,513 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-18 13:55:31,514 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-18 13:55:31,514 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-18 13:55:31,515 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 8
2017-03-18 13:55:31,515 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 8
2017-03-18 13:55:31,516 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-18 13:55:31,516 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-18 13:55:31,517 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-18 13:55:31,517 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-18 13:55:31,517 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-18 13:55:31,517 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-18 13:55:32,724 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":50,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-18T13:52:45.443325Z"}
2017-03-18 13:55:32,724 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":50,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-18T13:52:45.443325Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":50,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-18T13:52:45.443325Z"}
2017-03-18 13:55:32,727 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-18 13:55:32,727 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-18 13:55:32,728 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-18 13:55:32,728 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-18 13:55:32,729 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-18 13:55:32,729 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-18 13:55:32,729 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-18 13:55:32,729 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "5", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-18 13:55:34,028 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 13:55:34,028 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-18 13:55:34,029 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":1115.0}
2017-03-18 13:55:34,029 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":1115.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":1115.0}
{"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":1115.0}
2017-03-18 13:55:34,030 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 13:55:34,030 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 13:55:34,030 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-18 13:55:34,030 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-18 13:55:34,031 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-18 13:55:34,031 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-18 13:55:34,031 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-18 13:55:34,031 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-18 13:55:34,032 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "329378", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-18 13:55:34,032 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "329378", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "329378", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-18 13:55:34,032 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-18 13:55:34,032 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-18 13:55:35,064 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 13:55:35,064 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-18 13:55:35,065 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":25,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"329378","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-18 13:55:35,065 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":25,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"329378","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":25,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"329378","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-18 13:55:35,066 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 13:55:35,066 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 13:55:35,066 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-18 13:55:35,066 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-18 13:55:35,067 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4077.56ms
2017-03-18 13:55:35,067 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4077.56ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 4077.56ms
2017-03-18 13:57:17,723 = __main__ - INFO - Creating server
2017-03-18 13:57:17,723 = __main__ - INFO - Creating server
2017-03-18 13:57:17,729 = __main__ - INFO - Created server
2017-03-18 13:57:17,729 = __main__ - INFO - Created server
2017-03-18 13:57:17,730 = __main__ - INFO - Listening on port 8080
2017-03-18 13:57:17,730 = __main__ - INFO - Listening on port 8080
2017-03-18 13:57:17,731 = __main__ - INFO - Starting event loop
2017-03-18 13:57:17,731 = __main__ - INFO - Starting event loop
2017-03-18 13:57:30,046 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-18 13:57:30,046 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
2017-03-18 13:57:30,047 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-18 13:57:30,047 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-18 13:57:30,047 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 13:57:30
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 18/03/2017 13:57:30
2017-03-18 13:57:30,047 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 13:57:30
2017-03-18 13:57:30,047 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-18 13:57:30,047 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-18 13:57:30,048 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-18 13:57:30,048 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-18 13:57:30,048 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = fd9e6185d8b2447382ddd2efd5d66ae4
2017-03-18 13:57:30,048 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = fd9e6185d8b2447382ddd2efd5d66ae4
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = fd9e6185d8b2447382ddd2efd5d66ae4
2017-03-18 13:57:30,049 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-18 13:57:30,049 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-18 13:57:30,049 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-18 13:57:30,049 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-18 13:57:30,049 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:57:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>fd9e6185d8b2447382ddd2efd5d66ae4</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 13:57:30,049 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:57:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>fd9e6185d8b2447382ddd2efd5d66ae4</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:57:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>fd9e6185d8b2447382ddd2efd5d66ae4</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 13:57:30,050 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-18 13:57:30,050 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-18 13:57:30,050 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-18 13:57:30,050 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-18 13:57:30,050 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:57:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>fd9e6185d8b2447382ddd2efd5d66ae4</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 13:57:30,050 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:57:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>fd9e6185d8b2447382ddd2efd5d66ae4</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:57:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>fd9e6185d8b2447382ddd2efd5d66ae4</ns0:EXTREFNUM><ns0:MSISDN2>786329378</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 13:57:30,050 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-18 13:57:30,050 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-18 13:57:30,522 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-18 13:57:30,522 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-18 13:57:30,522 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>7048</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:54:43</ns0:DATE><ns0:EXTREFNUM>fd9e6185d8b2447382ddd2efd5d66ae4</ns0:EXTREFNUM><ns0:TXNID></ns0:TXNID><ns0:MESSAGE>Receiver mobile number is from un-supported network.</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 13:57:30,522 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>7048</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:54:43</ns0:DATE><ns0:EXTREFNUM>fd9e6185d8b2447382ddd2efd5d66ae4</ns0:EXTREFNUM><ns0:TXNID></ns0:TXNID><ns0:MESSAGE>Receiver mobile number is from un-supported network.</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 13:57:30,523 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>7048</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:54:43</ns0:DATE><ns0:EXTREFNUM>fd9e6185d8b2447382ddd2efd5d66ae4</ns0:EXTREFNUM><ns0:TXNID></ns0:TXNID><ns0:MESSAGE>Receiver mobile number is from un-supported network.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-18 13:57:30,523 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-18 13:57:30,523 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-18 13:57:30,524 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-18 13:57:30,523 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-18 13:57:30,524 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-18 13:57:30,524 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-18 13:57:30,524 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-18 13:57:30,525 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-18 13:57:30,525 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-18 13:57:30,525 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 8
2017-03-18 13:57:30,525 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 8
2017-03-18 13:57:30,525 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-18 13:57:30,525 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-18 13:57:30,526 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-18 13:57:30,526 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-18 13:57:30,526 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-18 13:57:30,526 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-18 13:57:30,592 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":51,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-18T13:54:43.300703Z"}
2017-03-18 13:57:30,592 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":51,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-18T13:54:43.300703Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":51,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-18T13:54:43.300703Z"}
2017-03-18 13:57:30,599 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-18 13:57:30,599 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-18 13:57:30,600 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-18 13:57:30,600 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-18 13:57:30,600 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-18 13:57:30,600 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-18 13:57:30,600 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "5", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-18 13:57:30,600 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-18 13:57:30,654 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 13:57:30,654 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 13:57:30,655 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":1120.0}
2017-03-18 13:57:30,655 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":1120.0}
2017-03-18 13:57:30,655 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":1120.0}
{"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":1120.0}
2017-03-18 13:57:30,655 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 13:57:30,655 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-18 13:57:30,656 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-18 13:57:30,655 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-18 13:57:30,656 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-18 13:57:30,656 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-18 13:57:30,656 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "329378", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-18 13:57:30,656 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-18 13:57:30,656 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "329378", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "329378", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-18 13:57:30,657 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-18 13:57:30,657 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-18 13:57:30,724 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 13:57:30,724 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 13:57:30,725 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":26,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"329378","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"id":26,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"329378","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-18 13:57:30,725 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 13:57:30,725 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":26,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"329378","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-18 13:57:30,725 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 13:57:30,725 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-18 13:57:30,725 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-18 13:57:30,726 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 681.12ms
2017-03-18 13:57:30,726 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 681.12ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 681.12ms
2017-03-18 13:58:33,256 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-18 13:58:33,256 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-18 13:58:33,257 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 13:58:33
2017-03-18 13:58:33,257 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-18 13:58:33,257 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-18 13:58:33,257 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = a9ae6f3326f245e69ae121652043f17f
2017-03-18 13:58:33,257 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-18 13:58:33,258 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-18 13:58:33,258 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:58:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a9ae6f3326f245e69ae121652043f17f</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 13:58:33,258 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-18 13:58:33,258 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-18 13:58:33,259 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:58:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a9ae6f3326f245e69ae121652043f17f</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 13:58:33,259 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 18/03/2017 13:58:33
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = a9ae6f3326f245e69ae121652043f17f
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:58:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a9ae6f3326f245e69ae121652043f17f</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:58:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a9ae6f3326f245e69ae121652043f17f</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-18 13:58:33,256 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-18 13:58:33,256 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-18 13:58:33,257 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 13:58:33
2017-03-18 13:58:33,257 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-18 13:58:33,257 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-18 13:58:33,257 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = a9ae6f3326f245e69ae121652043f17f
2017-03-18 13:58:33,257 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-18 13:58:33,258 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-18 13:58:33,258 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:58:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a9ae6f3326f245e69ae121652043f17f</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 13:58:33,258 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-18 13:58:33,258 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-18 13:58:33,259 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 13:58:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a9ae6f3326f245e69ae121652043f17f</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 13:58:33,259 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-18 13:58:34,223 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-18 13:58:34,223 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-18 13:58:34,224 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:55:46</ns0:DATE><ns0:EXTREFNUM>a9ae6f3326f245e69ae121652043f17f</ns0:EXTREFNUM><ns0:TXNID>R170318.1355.140037</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 721799582 is successful. Your new balance is KSH 1200</ns0:MESSAGE></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-18 13:58:34,224 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:55:46</ns0:DATE><ns0:EXTREFNUM>a9ae6f3326f245e69ae121652043f17f</ns0:EXTREFNUM><ns0:TXNID>R170318.1355.140037</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 721799582 is successful. Your new balance is KSH 1200</ns0:MESSAGE></ns0:COMMAND>


2017-03-18 13:58:34,225 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:55:46</ns0:DATE><ns0:EXTREFNUM>a9ae6f3326f245e69ae121652043f17f</ns0:EXTREFNUM><ns0:TXNID>R170318.1355.140037</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 721799582 is successful. Your new balance is KSH 1200</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 13:58:34,225 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-18 13:58:34,225 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-18 13:58:34,225 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------5-----------------------
2017-03-18 13:58:34,226 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-18 13:58:34,226 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-18 13:58:34,227 = handlers.result_handler.AirtimeHandler - DEBUG - 18/03/17 13:55:46
2017-03-18 13:58:34,227 = handlers.result_handler.AirtimeHandler - DEBUG - 18/03/17 13:55:46
DEBUG:handlers.result_handler.AirtimeHandler:18/03/17 13:55:46
2017-03-18 13:58:34,228 = handlers.result_handler.AirtimeHandler - DEBUG - a9ae6f3326f245e69ae121652043f17f
2017-03-18 13:58:34,228 = handlers.result_handler.AirtimeHandler - DEBUG - a9ae6f3326f245e69ae121652043f17f
DEBUG:handlers.result_handler.AirtimeHandler:a9ae6f3326f245e69ae121652043f17f
2017-03-18 13:58:34,228 = handlers.result_handler.AirtimeHandler - DEBUG - R170318.1355.140037
2017-03-18 13:58:34,228 = handlers.result_handler.AirtimeHandler - DEBUG - R170318.1355.140037
DEBUG:handlers.result_handler.AirtimeHandler:R170318.1355.140037
2017-03-18 13:58:34,229 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'18/03/17 13:55:46', 'amount': '5', 'external_ref': u'R170318.1355.140037', 'msisdn_2': u'0721799582', 'internal_ref': 'CTRO1DYUKO'}
2017-03-18 13:58:34,229 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'18/03/17 13:55:46', 'amount': '5', 'external_ref': u'R170318.1355.140037', 'msisdn_2': u'0721799582', 'internal_ref': 'CTRO1DYUKO'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'18/03/17 13:55:46', 'amount': '5', 'external_ref': u'R170318.1355.140037', 'msisdn_2': u'0721799582', 'internal_ref': 'CTRO1DYUKO'}
2017-03-18 13:58:34,230 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-18 13:58:34,230 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-18 13:58:34,353 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-18 13:58:34,354 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-18 13:58:34,358 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-18 13:58:34,359 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 13:58:34,363 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-18 13:58:34,363 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-18 13:58:34,366 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-18 13:58:34,367 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-18 13:58:34,373 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-18 13:58:34,374 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 13:58:34,377 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-18 13:58:34,378 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 13:58:34,384 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-18 13:58:34,385 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-18 13:58:34,389 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-18 13:58:34,390 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 13:58:34,397 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-18 13:58:34,398 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 13:58:34,401 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-18 13:58:34,402 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f881e5f9e90>
2017-03-18 13:58:34,411 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-18 13:58:34,411 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-18 13:58:34,414 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-18 13:58:34,414 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-18 13:58:34,415 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 0  Safaricom Airtime. Your transaction number is CTRO1DYUKO
2017-03-18 13:58:34,415 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 0  Safaricom Airtime. Your transaction number is CTRO1DYUKO
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 0  Safaricom Airtime. Your transaction number is CTRO1DYUKO
2017-03-18 13:58:34,416 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 0  Safaricom Airtime. Your transaction number is CTRO1DYUKO to 0721799582
2017-03-18 13:58:34,416 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 0  Safaricom Airtime. Your transaction number is CTRO1DYUKO to 0721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 0  Safaricom Airtime. Your transaction number is CTRO1DYUKO to 0721799582
2017-03-18 13:58:34,417 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-18 13:58:34,417 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-18 13:58:34,418 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 0  Safaricom Airtime. Your transaction number is CTRO1DYUKO to 8
2017-03-18 13:58:34,418 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 0  Safaricom Airtime. Your transaction number is CTRO1DYUKO to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 0  Safaricom Airtime. Your transaction number is CTRO1DYUKO to 8
2017-03-18 13:58:34,420 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 0  Safaricom Airtime. Your transaction number is CTRO1DYUKO", "user": "8", "title": "Safaricom  Airtime"}
2017-03-18 13:58:34,420 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 0  Safaricom Airtime. Your transaction number is CTRO1DYUKO", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 0  Safaricom Airtime. Your transaction number is CTRO1DYUKO", "user": "8", "title": "Safaricom  Airtime"}
2017-03-18 13:58:34,421 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-18 13:58:34,421 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-18 13:58:34,422 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 0  Safaricom Airtime. Your transaction number is CTRO1DYUKO
2017-03-18 13:58:34,422 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 0  Safaricom Airtime. Your transaction number is CTRO1DYUKO
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 0  Safaricom Airtime. Your transaction number is CTRO1DYUKO
2017-03-18 13:58:34,479 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":52,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 0  Safaricom Airtime. Your transaction number is CTRO1DYUKO","image_url":"","date":"2017-03-18T13:55:47.190901Z"}
2017-03-18 13:58:34,479 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":52,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 0  Safaricom Airtime. Your transaction number is CTRO1DYUKO","image_url":"","date":"2017-03-18T13:55:47.190901Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":52,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 0  Safaricom Airtime. Your transaction number is CTRO1DYUKO","image_url":"","date":"2017-03-18T13:55:47.190901Z"}
2017-03-18 13:58:34,481 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-18 13:58:34,481 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-18 13:58:34,482 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":52,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 0  Safaricom Airtime. Your transaction number is CTRO1DYUKO","image_url":"","date":"2017-03-18T13:55:47.190901Z"}
2017-03-18 13:58:34,482 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":52,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 0  Safaricom Airtime. Your transaction number is CTRO1DYUKO","image_url":"","date":"2017-03-18T13:55:47.190901Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":52,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 0  Safaricom Airtime. Your transaction number is CTRO1DYUKO","image_url":"","date":"2017-03-18T13:55:47.190901Z"}
2017-03-18 13:58:34,483 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-18 13:58:34,483 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-18 13:58:34,484 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-18 13:58:34,484 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-18 13:58:34,485 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-18 13:58:34,485 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-18 13:58:34,485 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-18 13:58:34,485 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-18 13:58:34,486 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "1799582", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "0", "service_provider_id": 1}
2017-03-18 13:58:34,486 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "1799582", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "0", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "1799582", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "0", "service_provider_id": 1}
2017-03-18 13:58:34,487 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-18 13:58:34,487 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-18 13:58:34,549 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 13:58:34,549 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-18 13:58:34,550 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":27,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"1799582","request":null,"amount":0.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-18 13:58:34,550 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":27,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"1799582","request":null,"amount":0.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":27,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"1799582","request":null,"amount":0.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-18 13:58:34,551 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 13:58:34,551 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 13:58:34,552 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
2017-03-18 13:58:34,552 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": "LC323322"}
2017-03-18 13:58:34,575 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 13:58:34,575 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-18 13:58:34,576 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
2017-03-18 13:58:34,576 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
DEBUG:handlers.result_handler.AirtimeHandler:{"status": 1, "message": "Transaction not found"}
{"status": 1, "message": "Transaction not found"}
2017-03-18 13:58:34,577 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 13:58:34,577 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 13:58:34,578 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-18 13:58:34,578 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-18 13:58:34,580 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 1324.93ms
2017-03-18 13:58:34,580 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 1324.93ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 1324.93ms
2017-03-18 14:00:39,180 = __main__ - INFO - Creating server
2017-03-18 14:00:39,180 = __main__ - INFO - Creating server
2017-03-18 14:00:39,184 = __main__ - INFO - Created server
2017-03-18 14:00:39,184 = __main__ - INFO - Created server
2017-03-18 14:00:39,185 = __main__ - INFO - Listening on port 8080
2017-03-18 14:00:39,185 = __main__ - INFO - Listening on port 8080
2017-03-18 14:00:39,186 = __main__ - INFO - Starting event loop
2017-03-18 14:00:39,186 = __main__ - INFO - Starting event loop
2017-03-18 14:00:53,297 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-18 14:00:53,297 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-18 14:00:53,297 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
2017-03-18 14:00:53,297 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-18 14:00:53,297 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 14:00:53
2017-03-18 14:00:53,297 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 14:00:53
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 18/03/2017 14:00:53
2017-03-18 14:00:53,297 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-18 14:00:53,297 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-18 14:00:53,298 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-18 14:00:53,298 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-18 14:00:53,298 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 5cc6fab5f68749d0a115df9c03ffc0d4
2017-03-18 14:00:53,298 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 5cc6fab5f68749d0a115df9c03ffc0d4
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 5cc6fab5f68749d0a115df9c03ffc0d4
2017-03-18 14:00:53,298 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-18 14:00:53,298 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-18 14:00:53,298 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-18 14:00:53,298 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-18 14:00:53,299 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 14:00:53</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5cc6fab5f68749d0a115df9c03ffc0d4</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 14:00:53,299 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 14:00:53</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5cc6fab5f68749d0a115df9c03ffc0d4</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 14:00:53</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5cc6fab5f68749d0a115df9c03ffc0d4</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 14:00:53,299 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-18 14:00:53,299 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-18 14:00:53,299 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-18 14:00:53,299 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-18 14:00:53,299 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 14:00:53</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5cc6fab5f68749d0a115df9c03ffc0d4</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 14:00:53,299 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 14:00:53</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5cc6fab5f68749d0a115df9c03ffc0d4</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 14:00:53</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5cc6fab5f68749d0a115df9c03ffc0d4</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 14:00:53,300 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-18 14:00:53,300 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-18 14:00:53,935 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-18 14:00:53,935 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-18 14:00:53,936 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:58:06</ns0:DATE><ns0:EXTREFNUM>5cc6fab5f68749d0a115df9c03ffc0d4</ns0:EXTREFNUM><ns0:TXNID>R170318.1358.140007</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 14:00:53,936 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:58:06</ns0:DATE><ns0:EXTREFNUM>5cc6fab5f68749d0a115df9c03ffc0d4</ns0:EXTREFNUM><ns0:TXNID>R170318.1358.140007</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 14:00:53,936 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:58:06</ns0:DATE><ns0:EXTREFNUM>5cc6fab5f68749d0a115df9c03ffc0d4</ns0:EXTREFNUM><ns0:TXNID>R170318.1358.140007</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 14:00:53,936 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-18 14:00:53,937 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-18 14:00:53,937 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-18 14:00:53,937 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-18 14:00:53,937 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-18 14:00:53,938 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 8
2017-03-18 14:00:53,938 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-18 14:00:53,938 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-18 14:00:53,938 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^5
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 8
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-18 14:00:53,937 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-18 14:00:53,937 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-18 14:00:53,937 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-18 14:00:53,937 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-18 14:00:53,938 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 8
2017-03-18 14:00:53,938 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-18 14:00:53,938 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-18 14:00:53,938 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-18 14:00:55,170 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":53,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-18T13:58:07.879324Z"}
2017-03-18 14:00:55,170 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":53,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-18T13:58:07.879324Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":53,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-18T13:58:07.879324Z"}
2017-03-18 14:00:55,170 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-18 14:00:55,170 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-18 14:00:55,170 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-18 14:00:55,170 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-18 14:00:55,171 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-18 14:00:55,171 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-18 14:00:55,171 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-18 14:00:55,171 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "5", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-18 14:00:56,356 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 14:00:56,356 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-18 14:00:56,357 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":1125.0}
2017-03-18 14:00:56,357 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":1125.0}
2017-03-18 14:00:56,357 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:{"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":1125.0}
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
{"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":1125.0}
2017-03-18 14:00:56,357 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 14:00:56,358 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-18 14:00:56,358 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-18 14:00:56,358 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-18 14:00:56,358 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-18 14:00:56,358 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-18 14:00:56,358 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-18 14:00:56,359 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "1799582", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-18 14:00:56,359 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "1799582", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "1799582", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-18 14:00:56,359 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-18 14:00:56,359 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-18 14:00:57,515 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 14:00:57,515 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-18 14:00:57,517 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":28,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"1799582","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-18 14:00:57,517 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":28,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"1799582","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":28,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"1799582","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-18 14:00:57,518 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 14:00:57,518 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 14:00:57,518 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-18 14:00:57,518 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-18 14:00:57,519 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4223.58ms
2017-03-18 14:00:57,519 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4223.58ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 4223.58ms
2017-03-18 14:02:06,607 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-18 14:02:06,607 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
2017-03-18 14:02:06,608 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-18 14:02:06,608 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-18 14:02:06,609 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 14:02:06
2017-03-18 14:02:06,609 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 18/03/2017 14:02:06
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 18/03/2017 14:02:06
2017-03-18 14:02:06,610 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-18 14:02:06,610 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-18 14:02:06,610 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-18 14:02:06,610 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-18 14:02:06,611 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 9da9fc6a72f047d2b739512a8781e063
2017-03-18 14:02:06,611 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 9da9fc6a72f047d2b739512a8781e063
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 9da9fc6a72f047d2b739512a8781e063
2017-03-18 14:02:06,611 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-18 14:02:06,611 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-18 14:02:06,612 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-18 14:02:06,612 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-18 14:02:06,612 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 14:02:06</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9da9fc6a72f047d2b739512a8781e063</ns0:EXTREFNUM><ns0:MSISDN2>0702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 14:02:06,612 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 14:02:06</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9da9fc6a72f047d2b739512a8781e063</ns0:EXTREFNUM><ns0:MSISDN2>0702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 14:02:06</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9da9fc6a72f047d2b739512a8781e063</ns0:EXTREFNUM><ns0:MSISDN2>0702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 14:02:06,612 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-18 14:02:06,612 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-18 14:02:06,613 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-18 14:02:06,613 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-18 14:02:06,613 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 14:02:06</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9da9fc6a72f047d2b739512a8781e063</ns0:EXTREFNUM><ns0:MSISDN2>0702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 14:02:06,613 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 14:02:06</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9da9fc6a72f047d2b739512a8781e063</ns0:EXTREFNUM><ns0:MSISDN2>0702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>18/03/2017 14:02:06</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9da9fc6a72f047d2b739512a8781e063</ns0:EXTREFNUM><ns0:MSISDN2>0702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-18 14:02:06,614 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-18 14:02:06,614 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-18 14:02:07,414 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-18 14:02:07,414 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-18 14:02:07,414 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:59:20</ns0:DATE><ns0:EXTREFNUM>9da9fc6a72f047d2b739512a8781e063</ns0:EXTREFNUM><ns0:TXNID>R170318.1359.140023</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 1195</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 14:02:07,414 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:59:20</ns0:DATE><ns0:EXTREFNUM>9da9fc6a72f047d2b739512a8781e063</ns0:EXTREFNUM><ns0:TXNID>R170318.1359.140023</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 1195</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>18/03/17 13:59:20</ns0:DATE><ns0:EXTREFNUM>9da9fc6a72f047d2b739512a8781e063</ns0:EXTREFNUM><ns0:TXNID>R170318.1359.140023</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 1195</ns0:MESSAGE></ns0:COMMAND>

2017-03-18 14:02:07,415 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-18 14:02:07,415 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-18 14:02:07,415 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
2017-03-18 14:02:07,415 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------5-----------------------
2017-03-18 14:02:07,416 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-18 14:02:07,416 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-18 14:02:07,416 = handlers.result_handler.AirtimeHandler - DEBUG - 18/03/17 13:59:20
2017-03-18 14:02:07,416 = handlers.result_handler.AirtimeHandler - DEBUG - 18/03/17 13:59:20
DEBUG:handlers.result_handler.AirtimeHandler:18/03/17 13:59:20
2017-03-18 14:02:07,417 = handlers.result_handler.AirtimeHandler - DEBUG - 9da9fc6a72f047d2b739512a8781e063
2017-03-18 14:02:07,417 = handlers.result_handler.AirtimeHandler - DEBUG - 9da9fc6a72f047d2b739512a8781e063
DEBUG:handlers.result_handler.AirtimeHandler:9da9fc6a72f047d2b739512a8781e063
2017-03-18 14:02:07,417 = handlers.result_handler.AirtimeHandler - DEBUG - R170318.1359.140023
2017-03-18 14:02:07,417 = handlers.result_handler.AirtimeHandler - DEBUG - R170318.1359.140023
DEBUG:handlers.result_handler.AirtimeHandler:R170318.1359.140023
2017-03-18 14:02:07,418 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'18/03/17 13:59:20', 'amount': '5', 'external_ref': u'R170318.1359.140023', 'msisdn_2': u'0702935200', 'internal_ref': 'IAYCKZFIJ2'}
2017-03-18 14:02:07,418 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'18/03/17 13:59:20', 'amount': '5', 'external_ref': u'R170318.1359.140023', 'msisdn_2': u'0702935200', 'internal_ref': 'IAYCKZFIJ2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'18/03/17 13:59:20', 'amount': '5', 'external_ref': u'R170318.1359.140023', 'msisdn_2': u'0702935200', 'internal_ref': 'IAYCKZFIJ2'}
2017-03-18 14:02:07,418 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-18 14:02:07,418 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-18 14:02:07,522 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-18 14:02:07,522 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-18 14:02:07,526 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-18 14:02:07,526 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 14:02:07,530 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-18 14:02:07,530 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-18 14:02:07,532 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-18 14:02:07,532 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-18 14:02:07,538 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-18 14:02:07,538 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 14:02:07,541 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-18 14:02:07,541 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 14:02:07,545 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-18 14:02:07,545 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-18 14:02:07,547 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-18 14:02:07,547 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-18 14:02:07,550 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-18 14:02:07,550 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-18 14:02:07,551 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-18 14:02:07,552 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7ffa265ace90>
2017-03-18 14:02:07,557 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-18 14:02:07,557 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-18 14:02:07,557 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-18 14:02:07,557 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-18 14:02:07,558 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is IAYCKZFIJ2
2017-03-18 14:02:07,558 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is IAYCKZFIJ2
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is IAYCKZFIJ2
2017-03-18 14:02:07,558 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is IAYCKZFIJ2 to 0702935200
2017-03-18 14:02:07,558 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is IAYCKZFIJ2 to 0702935200
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is IAYCKZFIJ2 to 0702935200
2017-03-18 14:02:07,559 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-18 14:02:07,559 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-18 14:02:07,560 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is IAYCKZFIJ2 to 8
2017-03-18 14:02:07,560 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is IAYCKZFIJ2 to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is IAYCKZFIJ2 to 8
2017-03-18 14:02:07,560 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is IAYCKZFIJ2", "user": "8", "title": "Safaricom  Airtime"}
2017-03-18 14:02:07,560 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is IAYCKZFIJ2", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is IAYCKZFIJ2", "user": "8", "title": "Safaricom  Airtime"}
2017-03-18 14:02:07,561 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-18 14:02:07,561 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-18 14:02:07,561 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 5  Safaricom Airtime. Your transaction number is IAYCKZFIJ2
2017-03-18 14:02:07,561 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 5  Safaricom Airtime. Your transaction number is IAYCKZFIJ2
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 5  Safaricom Airtime. Your transaction number is IAYCKZFIJ2
2017-03-18 14:02:07,601 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":54,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is IAYCKZFIJ2","image_url":"","date":"2017-03-18T13:59:20.309277Z"}
2017-03-18 14:02:07,601 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":54,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is IAYCKZFIJ2","image_url":"","date":"2017-03-18T13:59:20.309277Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":54,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is IAYCKZFIJ2","image_url":"","date":"2017-03-18T13:59:20.309277Z"}
2017-03-18 14:02:07,602 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-18 14:02:07,602 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-18 14:02:07,603 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":54,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is IAYCKZFIJ2","image_url":"","date":"2017-03-18T13:59:20.309277Z"}
2017-03-18 14:02:07,603 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":54,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is IAYCKZFIJ2","image_url":"","date":"2017-03-18T13:59:20.309277Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":54,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is IAYCKZFIJ2","image_url":"","date":"2017-03-18T13:59:20.309277Z"}
2017-03-18 14:02:07,603 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-18 14:02:07,603 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-18 14:02:07,604 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-18 14:02:07,604 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-18 14:02:07,605 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-18 14:02:07,605 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-18 14:02:07,605 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-18 14:02:07,605 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-18 14:02:07,606 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "2935200", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-18 14:02:07,606 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "2935200", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "2935200", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-18 14:02:07,607 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-18 14:02:07,607 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-18 14:02:07,660 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 14:02:07,660 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-18 14:02:07,661 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":29,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"2935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-18 14:02:07,661 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":29,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"2935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":29,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"2935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-18 14:02:07,661 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 14:02:07,661 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
2017-03-18 14:02:07,661 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 14:02:07,661 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": "LC323322"}
2017-03-18 14:02:07,675 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 14:02:07,676 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
2017-03-18 14:02:07,675 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-18 14:02:07,676 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"status": 1, "message": "Transaction not found"}
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 14:02:07,676 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-18 14:02:07,676 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
{"status": 1, "message": "Transaction not found"}
2017-03-18 14:02:07,676 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-18 14:02:07,676 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-18 14:02:07,677 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 1070.40ms
2017-03-18 14:02:07,677 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 1070.40ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 1070.40ms
2017-03-18 14:30:36,615 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.70.63) 0.77ms
WARNING:tornado.access:404 GET http://www.baidu.com/favicon.ico (123.59.70.63) 0.77ms
2017-03-18 14:30:36,615 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.70.63) 0.77ms
2017-03-18 15:26:02,634 = tornado.access - WARNING - 404 GET / (36.232.234.181) 0.48ms
2017-03-18 15:26:02,634 = tornado.access - WARNING - 404 GET / (36.232.234.181) 0.48ms
WARNING:tornado.access:404 GET / (36.232.234.181) 0.48ms
2017-03-18 15:36:13,958 = tornado.access - WARNING - 404 GET / (185.40.4.18) 0.97ms
2017-03-18 15:36:13,958 = tornado.access - WARNING - 404 GET / (185.40.4.18) 0.97ms
WARNING:tornado.access:404 GET / (185.40.4.18) 0.97ms
2017-03-18 15:47:34,464 = tornado.access - WARNING - 404 GET / (62.28.50.225) 0.72ms
2017-03-18 15:47:34,464 = tornado.access - WARNING - 404 GET / (62.28.50.225) 0.72ms
WARNING:tornado.access:404 GET / (62.28.50.225) 0.72ms
2017-03-18 16:31:56,989 = tornado.access - WARNING - 404 GET / (168.1.128.35) 0.76ms
WARNING:tornado.access:404 GET / (168.1.128.35) 0.76ms
2017-03-18 16:31:56,989 = tornado.access - WARNING - 404 GET / (168.1.128.35) 0.76ms
2017-03-18 18:04:29,793 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.68ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.68ms
2017-03-18 18:04:29,793 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.68ms
2017-03-18 19:16:28,021 = tornado.access - WARNING - 404 GET / (219.151.7.149) 0.78ms
WARNING:tornado.access:404 GET / (219.151.7.149) 0.78ms
2017-03-18 19:16:28,021 = tornado.access - WARNING - 404 GET / (219.151.7.149) 0.78ms
2017-03-18 19:54:30,604 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.58ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.58ms
2017-03-18 19:54:30,604 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.58ms
2017-03-18 19:58:08,502 = tornado.access - WARNING - 404 GET / (113.190.97.53) 0.80ms
2017-03-18 19:58:08,502 = tornado.access - WARNING - 404 GET / (113.190.97.53) 0.80ms
WARNING:tornado.access:404 GET / (113.190.97.53) 0.80ms
2017-03-18 21:48:22,758 = tornado.access - WARNING - 404 GET / (176.109.8.77) 0.74ms
WARNING:tornado.access:404 GET / (176.109.8.77) 0.74ms
2017-03-18 21:48:22,758 = tornado.access - WARNING - 404 GET / (176.109.8.77) 0.74ms
2017-03-18 21:48:23,983 = tornado.access - WARNING - 404 GET http://www.msftncsi.com/ncsi.txt (176.109.8.77) 0.66ms
WARNING:tornado.access:404 GET http://www.msftncsi.com/ncsi.txt (176.109.8.77) 0.66ms
2017-03-18 21:48:23,983 = tornado.access - WARNING - 404 GET http://www.msftncsi.com/ncsi.txt (176.109.8.77) 0.66ms
2017-03-18 21:48:25,930 = tornado.access - WARNING - 404 GET /HNAP1/ (176.109.8.77) 0.77ms
WARNING:tornado.access:404 GET /HNAP1/ (176.109.8.77) 0.77ms
2017-03-18 21:48:25,930 = tornado.access - WARNING - 404 GET /HNAP1/ (176.109.8.77) 0.77ms
2017-03-18 22:18:59,377 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.46ms
WARNING:tornado.access:404 GET http://www.google.com/ (91.236.75.4) 0.46ms
2017-03-18 22:18:59,377 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.46ms
2017-03-19 03:02:04,804 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.46ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.46ms
2017-03-19 03:02:04,804 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.46ms
2017-03-19 06:49:19,958 = tornado.access - WARNING - 404 GET http://cdnjs.cloudflare.com/ajax/libs/6px/1.0.3/6px.min.js (89.249.247.149) 0.78ms
2017-03-19 06:49:19,958 = tornado.access - WARNING - 404 GET http://cdnjs.cloudflare.com/ajax/libs/6px/1.0.3/6px.min.js (89.249.247.149) 0.78ms
WARNING:tornado.access:404 GET http://cdnjs.cloudflare.com/ajax/libs/6px/1.0.3/6px.min.js (89.249.247.149) 0.78ms
2017-03-19 07:00:54,710 = tornado.access - WARNING - 404 GET /cgi-bin/authLogin.cgi (89.216.18.251) 0.79ms
2017-03-19 07:00:54,711 = tornado.general - INFO - Malformed HTTP message from 89.216.18.251: Malformed HTTP version in HTTP Request-Line: ''
WARNING:tornado.access:404 GET /cgi-bin/authLogin.cgi (89.216.18.251) 0.79ms
INFO:tornado.general:Malformed HTTP message from 89.216.18.251: Malformed HTTP version in HTTP Request-Line: ''
2017-03-19 07:00:54,710 = tornado.access - WARNING - 404 GET /cgi-bin/authLogin.cgi (89.216.18.251) 0.79ms
2017-03-19 07:00:54,711 = tornado.general - INFO - Malformed HTTP message from 89.216.18.251: Malformed HTTP version in HTTP Request-Line: ''
2017-03-19 07:28:53,958 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.57.251) 0.66ms
WARNING:tornado.access:404 GET http://www.baidu.com/favicon.ico (123.59.57.251) 0.66ms
2017-03-19 07:28:53,958 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.57.251) 0.66ms
2017-03-19 09:31:57,082 = tornado.access - WARNING - 404 GET /manager/html (14.152.95.39) 0.56ms
WARNING:tornado.access:404 GET /manager/html (14.152.95.39) 0.56ms
2017-03-19 09:31:57,082 = tornado.access - WARNING - 404 GET /manager/html (14.152.95.39) 0.56ms
2017-03-19 10:30:31,582 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.67ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.67ms
2017-03-19 10:30:31,582 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.67ms
2017-03-19 10:40:00,488 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.44ms
WARNING:tornado.access:404 GET http://www.google.com/ (91.236.75.4) 0.44ms
2017-03-19 10:40:00,488 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.44ms
2017-03-19 11:31:24,352 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.54ms
WARNING:tornado.access:404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.54ms
2017-03-19 11:31:24,352 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.54ms
2017-03-19 11:56:02,297 = tornado.access - WARNING - 404 GET / (198.20.69.74) 0.73ms
2017-03-19 11:56:02,297 = tornado.access - WARNING - 404 GET / (198.20.69.74) 0.73ms
WARNING:tornado.access:404 GET / (198.20.69.74) 0.73ms
2017-03-19 12:51:18,130 = tornado.access - WARNING - 404 GET http://cdnjs.cloudflare.com/ajax/libs/6px/1.0.3/6px.min.js (89.249.247.149) 0.54ms
WARNING:tornado.access:404 GET http://cdnjs.cloudflare.com/ajax/libs/6px/1.0.3/6px.min.js (89.249.247.149) 0.54ms
2017-03-19 12:51:18,130 = tornado.access - WARNING - 404 GET http://cdnjs.cloudflare.com/ajax/libs/6px/1.0.3/6px.min.js (89.249.247.149) 0.54ms
2017-03-19 13:20:47,247 = tornado.access - WARNING - 404 GET / (139.162.111.98) 0.70ms
WARNING:tornado.access:404 GET / (139.162.111.98) 0.70ms
2017-03-19 13:20:47,247 = tornado.access - WARNING - 404 GET / (139.162.111.98) 0.70ms
2017-03-19 17:43:09,103 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.53ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.53ms
2017-03-19 17:43:09,103 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.53ms
2017-03-19 18:59:52,870 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.55ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.55ms
2017-03-19 18:59:52,870 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.55ms
2017-03-19 19:37:51,387 = tornado.access - WARNING - 404 GET / (185.40.4.18) 0.71ms
WARNING:tornado.access:404 GET / (185.40.4.18) 0.71ms
2017-03-19 19:37:51,387 = tornado.access - WARNING - 404 GET / (185.40.4.18) 0.71ms
2017-03-19 21:30:55,214 = tornado.access - WARNING - 404 GET /index.action (222.186.15.111) 1.19ms
2017-03-19 21:30:55,214 = tornado.access - WARNING - 404 GET /index.action (222.186.15.111) 1.19ms
WARNING:tornado.access:404 GET /index.action (222.186.15.111) 1.19ms
2017-03-19 23:17:25,073 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.63ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.63ms
2017-03-19 23:17:25,073 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.63ms
2017-03-20 08:09:25,213 = tornado.access - WARNING - 404 GET /script (103.242.2.71) 0.49ms
WARNING:tornado.access:404 GET /script (103.242.2.71) 0.49ms
2017-03-20 08:09:25,213 = tornado.access - WARNING - 404 GET /script (103.242.2.71) 0.49ms
2017-03-20 09:32:39,419 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.56ms
2017-03-20 09:32:39,419 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.56ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.56ms
2017-03-20 09:55:32,374 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.70.63) 0.53ms
WARNING:tornado.access:404 GET http://www.baidu.com/favicon.ico (123.59.70.63) 0.53ms
2017-03-20 09:55:32,374 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.70.63) 0.53ms
2017-03-20 10:40:27,194 = tornado.access - WARNING - 404 GET /script (221.194.44.252) 0.84ms
WARNING:tornado.access:404 GET /script (221.194.44.252) 0.84ms
2017-03-20 10:40:27,194 = tornado.access - WARNING - 404 GET /script (221.194.44.252) 0.84ms
2017-03-20 10:48:31,767 = tornado.access - WARNING - 404 GET /manager/html (14.152.95.39) 0.52ms
WARNING:tornado.access:404 GET /manager/html (14.152.95.39) 0.52ms
2017-03-20 10:48:31,767 = tornado.access - WARNING - 404 GET /manager/html (14.152.95.39) 0.52ms
2017-03-20 11:20:50,240 = tornado.access - WARNING - 404 GET / (198.20.69.74) 0.75ms
WARNING:tornado.access:404 GET / (198.20.69.74) 0.75ms
2017-03-20 11:20:50,240 = tornado.access - WARNING - 404 GET / (198.20.69.74) 0.75ms
2017-03-20 11:30:10,605 = tornado.access - WARNING - 404 GET / (219.246.36.252) 0.56ms
WARNING:tornado.access:404 GET / (219.246.36.252) 0.56ms
2017-03-20 11:30:10,605 = tornado.access - WARNING - 404 GET / (219.246.36.252) 0.56ms
2017-03-20 14:32:49,796 = tornado.access - WARNING - 404 GET / (93.233.111.131) 0.77ms
WARNING:tornado.access:404 GET / (93.233.111.131) 0.77ms
2017-03-20 14:32:49,796 = tornado.access - WARNING - 404 GET / (93.233.111.131) 0.77ms
2017-03-20 14:49:35,994 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/50000/-------------------
2017-03-20 14:49:35,995 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-20 14:49:35,995 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 20/03/2017 14:49:35
2017-03-20 14:49:35,995 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-20 14:49:35,995 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-20 14:49:35,996 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 5e209787991445ea8b94cec90416a2ab
2017-03-20 14:49:35,996 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-20 14:49:35,996 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-20 14:49:35,996 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>20/03/2017 14:49:35</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5e209787991445ea8b94cec90416a2ab</ns0:EXTREFNUM><ns0:MSISDN2>254705091831</ns0:MSISDN2><ns0:AMOUNT>50000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-20 14:49:35,997 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-20 14:49:35,997 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-20 14:49:35,997 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>20/03/2017 14:49:35</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5e209787991445ea8b94cec90416a2ab</ns0:EXTREFNUM><ns0:MSISDN2>254705091831</ns0:MSISDN2><ns0:AMOUNT>50000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-20 14:49:35,997 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/50000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 20/03/2017 14:49:35
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 5e209787991445ea8b94cec90416a2ab
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>20/03/2017 14:49:35</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5e209787991445ea8b94cec90416a2ab</ns0:EXTREFNUM><ns0:MSISDN2>254705091831</ns0:MSISDN2><ns0:AMOUNT>50000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>20/03/2017 14:49:35</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5e209787991445ea8b94cec90416a2ab</ns0:EXTREFNUM><ns0:MSISDN2>254705091831</ns0:MSISDN2><ns0:AMOUNT>50000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-20 14:49:35,994 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/50000/-------------------
2017-03-20 14:49:35,995 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-20 14:49:35,995 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 20/03/2017 14:49:35
2017-03-20 14:49:35,995 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-20 14:49:35,995 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-20 14:49:35,996 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 5e209787991445ea8b94cec90416a2ab
2017-03-20 14:49:35,996 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-20 14:49:35,996 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-20 14:49:35,996 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>20/03/2017 14:49:35</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5e209787991445ea8b94cec90416a2ab</ns0:EXTREFNUM><ns0:MSISDN2>254705091831</ns0:MSISDN2><ns0:AMOUNT>50000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-20 14:49:35,997 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-20 14:49:35,997 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-20 14:49:35,997 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>20/03/2017 14:49:35</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5e209787991445ea8b94cec90416a2ab</ns0:EXTREFNUM><ns0:MSISDN2>254705091831</ns0:MSISDN2><ns0:AMOUNT>50000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-20 14:49:35,997 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-20 14:49:36,829 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-20 14:49:36,829 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-20 14:49:36,831 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>20/03/17 14:46:43</ns0:DATE><ns0:EXTREFNUM>5e209787991445ea8b94cec90416a2ab</ns0:EXTREFNUM><ns0:TXNID>R170320.1446.140054</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 500 to 705091831 is successful. Your new balance is KSH 695</ns0:MESSAGE></ns0:COMMAND>

2017-03-20 14:49:36,831 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>20/03/17 14:46:43</ns0:DATE><ns0:EXTREFNUM>5e209787991445ea8b94cec90416a2ab</ns0:EXTREFNUM><ns0:TXNID>R170320.1446.140054</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 500 to 705091831 is successful. Your new balance is KSH 695</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>20/03/17 14:46:43</ns0:DATE><ns0:EXTREFNUM>5e209787991445ea8b94cec90416a2ab</ns0:EXTREFNUM><ns0:TXNID>R170320.1446.140054</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 500 to 705091831 is successful. Your new balance is KSH 695</ns0:MESSAGE></ns0:COMMAND>

2017-03-20 14:49:36,831 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-20 14:49:36,831 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-20 14:49:36,832 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------500-----------------------
2017-03-20 14:49:36,832 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------500-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------500-----------------------
2017-03-20 14:49:36,833 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-20 14:49:36,833 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-20 14:49:36,833 = handlers.result_handler.AirtimeHandler - DEBUG - 20/03/17 14:46:43
2017-03-20 14:49:36,833 = handlers.result_handler.AirtimeHandler - DEBUG - 20/03/17 14:46:43
DEBUG:handlers.result_handler.AirtimeHandler:20/03/17 14:46:43
2017-03-20 14:49:36,834 = handlers.result_handler.AirtimeHandler - DEBUG - 5e209787991445ea8b94cec90416a2ab
2017-03-20 14:49:36,834 = handlers.result_handler.AirtimeHandler - DEBUG - 5e209787991445ea8b94cec90416a2ab
DEBUG:handlers.result_handler.AirtimeHandler:5e209787991445ea8b94cec90416a2ab
2017-03-20 14:49:36,835 = handlers.result_handler.AirtimeHandler - DEBUG - R170320.1446.140054
2017-03-20 14:49:36,835 = handlers.result_handler.AirtimeHandler - DEBUG - R170320.1446.140054
DEBUG:handlers.result_handler.AirtimeHandler:R170320.1446.140054
2017-03-20 14:49:36,836 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'20/03/17 14:46:43', 'amount': '500', 'external_ref': u'R170320.1446.140054', 'msisdn_2': u'254705091831', 'internal_ref': 'UAYV5C7U98'}
2017-03-20 14:49:36,836 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'20/03/17 14:46:43', 'amount': '500', 'external_ref': u'R170320.1446.140054', 'msisdn_2': u'254705091831', 'internal_ref': 'UAYV5C7U98'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'20/03/17 14:46:43', 'amount': '500', 'external_ref': u'R170320.1446.140054', 'msisdn_2': u'254705091831', 'internal_ref': 'UAYV5C7U98'}
2017-03-20 14:49:36,836 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-20 14:49:36,836 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-20 14:49:36,887 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-20 14:49:36,897 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-20 14:49:36,902 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-20 14:49:36,902 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-20 14:49:36,906 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-20 14:49:36,908 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-20 14:49:36,911 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-20 14:49:36,911 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-20 14:49:36,916 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-20 14:49:36,917 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-20 14:49:36,920 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-20 14:49:36,920 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-20 14:49:36,923 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-20 14:49:36,924 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-20 14:49:36,926 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-20 14:49:36,927 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-20 14:49:36,931 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-20 14:49:36,932 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-20 14:49:36,934 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-20 14:49:36,935 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7ffa264f85d0>
2017-03-20 14:49:36,942 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-20 14:49:36,942 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-20 14:49:36,943 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-20 14:49:36,943 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-20 14:49:36,944 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 500  Safaricom Airtime. Your transaction number is UAYV5C7U98
2017-03-20 14:49:36,944 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 500  Safaricom Airtime. Your transaction number is UAYV5C7U98
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 500  Safaricom Airtime. Your transaction number is UAYV5C7U98
2017-03-20 14:49:36,944 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 500  Safaricom Airtime. Your transaction number is UAYV5C7U98 to 254705091831
2017-03-20 14:49:36,944 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 500  Safaricom Airtime. Your transaction number is UAYV5C7U98 to 254705091831
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 500  Safaricom Airtime. Your transaction number is UAYV5C7U98 to 254705091831
2017-03-20 14:49:36,945 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-20 14:49:36,945 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-20 14:49:36,945 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 500  Safaricom Airtime. Your transaction number is UAYV5C7U98 to 8
2017-03-20 14:49:36,945 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 500  Safaricom Airtime. Your transaction number is UAYV5C7U98 to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 500  Safaricom Airtime. Your transaction number is UAYV5C7U98 to 8
2017-03-20 14:49:36,946 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 500  Safaricom Airtime. Your transaction number is UAYV5C7U98", "user": "8", "title": "Safaricom  Airtime"}
2017-03-20 14:49:36,946 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 500  Safaricom Airtime. Your transaction number is UAYV5C7U98", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 500  Safaricom Airtime. Your transaction number is UAYV5C7U98", "user": "8", "title": "Safaricom  Airtime"}
2017-03-20 14:49:36,946 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-20 14:49:36,946 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-20 14:49:36,947 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 500  Safaricom Airtime. Your transaction number is UAYV5C7U98
2017-03-20 14:49:36,947 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 500  Safaricom Airtime. Your transaction number is UAYV5C7U98
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 500  Safaricom Airtime. Your transaction number is UAYV5C7U98
2017-03-20 14:49:38,141 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":68,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 500  Safaricom Airtime. Your transaction number is UAYV5C7U98","image_url":"","date":"2017-03-20T14:46:45.365361Z"}
2017-03-20 14:49:38,141 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":68,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 500  Safaricom Airtime. Your transaction number is UAYV5C7U98","image_url":"","date":"2017-03-20T14:46:45.365361Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":68,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 500  Safaricom Airtime. Your transaction number is UAYV5C7U98","image_url":"","date":"2017-03-20T14:46:45.365361Z"}
2017-03-20 14:49:38,143 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-20 14:49:38,143 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-20 14:49:38,144 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":68,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 500  Safaricom Airtime. Your transaction number is UAYV5C7U98","image_url":"","date":"2017-03-20T14:46:45.365361Z"}
2017-03-20 14:49:38,144 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":68,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 500  Safaricom Airtime. Your transaction number is UAYV5C7U98","image_url":"","date":"2017-03-20T14:46:45.365361Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":68,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 500  Safaricom Airtime. Your transaction number is UAYV5C7U98","image_url":"","date":"2017-03-20T14:46:45.365361Z"}
2017-03-20 14:49:38,144 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-20 14:49:38,144 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-20 14:49:38,145 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-20 14:49:38,145 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-20 14:49:38,146 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-20 14:49:38,146 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-20 14:49:38,146 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-20 14:49:38,146 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-20 14:49:38,147 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "705091831", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "500", "service_provider_id": 1}
2017-03-20 14:49:38,147 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "705091831", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "500", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "705091831", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "500", "service_provider_id": 1}
2017-03-20 14:49:38,148 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-20 14:49:38,148 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-20 14:49:39,359 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-20 14:49:39,359 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-20 14:49:39,360 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":41,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"705091831","request":null,"amount":500.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-20 14:49:39,360 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":41,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"705091831","request":null,"amount":500.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":41,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"705091831","request":null,"amount":500.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-20 14:49:39,361 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-20 14:49:39,361 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-20 14:49:39,362 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-20 14:49:39,362 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-20 14:49:39,364 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3370.05ms
2017-03-20 14:49:39,364 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3370.05ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3370.05ms
2017-03-20 14:49:59,495 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/50000/-------------------
2017-03-20 14:49:59,495 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/50000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/50000/-------------------
2017-03-20 14:49:59,496 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-20 14:49:59,496 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-20 14:49:59,497 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 20/03/2017 14:49:59
2017-03-20 14:49:59,497 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 20/03/2017 14:49:59
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 20/03/2017 14:49:59
2017-03-20 14:49:59,498 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-20 14:49:59,498 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-20 14:49:59,498 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-20 14:49:59,498 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-20 14:49:59,499 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = ae5bdfd6160540bfab21b675efa26b7d
2017-03-20 14:49:59,499 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = ae5bdfd6160540bfab21b675efa26b7d
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = ae5bdfd6160540bfab21b675efa26b7d
2017-03-20 14:49:59,499 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-20 14:49:59,499 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-20 14:49:59,500 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-20 14:49:59,500 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-20 14:49:59,501 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>20/03/2017 14:49:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ae5bdfd6160540bfab21b675efa26b7d</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>50000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-20 14:49:59,501 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>20/03/2017 14:49:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ae5bdfd6160540bfab21b675efa26b7d</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>50000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>20/03/2017 14:49:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ae5bdfd6160540bfab21b675efa26b7d</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>50000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-20 14:49:59,501 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-20 14:49:59,501 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-20 14:49:59,502 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-20 14:49:59,502 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-20 14:49:59,503 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>20/03/2017 14:49:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ae5bdfd6160540bfab21b675efa26b7d</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>50000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-20 14:49:59,503 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>20/03/2017 14:49:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ae5bdfd6160540bfab21b675efa26b7d</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>50000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>20/03/2017 14:49:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ae5bdfd6160540bfab21b675efa26b7d</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>50000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-20 14:49:59,503 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-20 14:49:59,503 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-20 14:50:00,336 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-20 14:50:00,336 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-20 14:50:00,337 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>20/03/17 14:47:07</ns0:DATE><ns0:EXTREFNUM>ae5bdfd6160540bfab21b675efa26b7d</ns0:EXTREFNUM><ns0:TXNID>R170320.1447.140008</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 500 to 720384396 is successful. Your new balance is KSH 195</ns0:MESSAGE></ns0:COMMAND>

2017-03-20 14:50:00,337 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>20/03/17 14:47:07</ns0:DATE><ns0:EXTREFNUM>ae5bdfd6160540bfab21b675efa26b7d</ns0:EXTREFNUM><ns0:TXNID>R170320.1447.140008</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 500 to 720384396 is successful. Your new balance is KSH 195</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>20/03/17 14:47:07</ns0:DATE><ns0:EXTREFNUM>ae5bdfd6160540bfab21b675efa26b7d</ns0:EXTREFNUM><ns0:TXNID>R170320.1447.140008</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 500 to 720384396 is successful. Your new balance is KSH 195</ns0:MESSAGE></ns0:COMMAND>

2017-03-20 14:50:00,337 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-20 14:50:00,337 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-20 14:50:00,338 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------500-----------------------
2017-03-20 14:50:00,338 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------500-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------500-----------------------
2017-03-20 14:50:00,338 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-20 14:50:00,338 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-20 14:50:00,339 = handlers.result_handler.AirtimeHandler - DEBUG - 20/03/17 14:47:07
2017-03-20 14:50:00,339 = handlers.result_handler.AirtimeHandler - DEBUG - 20/03/17 14:47:07
DEBUG:handlers.result_handler.AirtimeHandler:20/03/17 14:47:07
2017-03-20 14:50:00,339 = handlers.result_handler.AirtimeHandler - DEBUG - ae5bdfd6160540bfab21b675efa26b7d
2017-03-20 14:50:00,339 = handlers.result_handler.AirtimeHandler - DEBUG - ae5bdfd6160540bfab21b675efa26b7d
DEBUG:handlers.result_handler.AirtimeHandler:ae5bdfd6160540bfab21b675efa26b7d
2017-03-20 14:50:00,340 = handlers.result_handler.AirtimeHandler - DEBUG - R170320.1447.140008
2017-03-20 14:50:00,340 = handlers.result_handler.AirtimeHandler - DEBUG - R170320.1447.140008
DEBUG:handlers.result_handler.AirtimeHandler:R170320.1447.140008
2017-03-20 14:50:00,340 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'20/03/17 14:47:07', 'amount': '500', 'external_ref': u'R170320.1447.140008', 'msisdn_2': u'254720384396', 'internal_ref': '75WLO742C0'}
2017-03-20 14:50:00,340 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'20/03/17 14:47:07', 'amount': '500', 'external_ref': u'R170320.1447.140008', 'msisdn_2': u'254720384396', 'internal_ref': '75WLO742C0'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'20/03/17 14:47:07', 'amount': '500', 'external_ref': u'R170320.1447.140008', 'msisdn_2': u'254720384396', 'internal_ref': '75WLO742C0'}
2017-03-20 14:50:00,341 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-20 14:50:00,341 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-20 14:50:00,381 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-20 14:50:00,381 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-20 14:50:00,385 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-20 14:50:00,386 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-20 14:50:00,389 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-20 14:50:00,390 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-20 14:50:00,393 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-20 14:50:00,394 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-20 14:50:00,397 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-20 14:50:00,398 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-20 14:50:00,401 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-20 14:50:00,402 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-20 14:50:00,405 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-20 14:50:00,406 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-20 14:50:00,409 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-20 14:50:00,409 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-20 14:50:00,413 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-20 14:50:00,414 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-20 14:50:00,416 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-20 14:50:00,416 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7ffa265ac310>
2017-03-20 14:50:00,422 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-20 14:50:00,422 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-20 14:50:00,423 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-20 14:50:00,423 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-20 14:50:00,424 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 500  Safaricom Airtime. Your transaction number is 75WLO742C0
2017-03-20 14:50:00,424 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 500  Safaricom Airtime. Your transaction number is 75WLO742C0
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 500  Safaricom Airtime. Your transaction number is 75WLO742C0
2017-03-20 14:50:00,424 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 500  Safaricom Airtime. Your transaction number is 75WLO742C0 to 254720384396
2017-03-20 14:50:00,424 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 500  Safaricom Airtime. Your transaction number is 75WLO742C0 to 254720384396
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 500  Safaricom Airtime. Your transaction number is 75WLO742C0 to 254720384396
2017-03-20 14:50:00,425 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-20 14:50:00,425 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-20 14:50:00,425 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 500  Safaricom Airtime. Your transaction number is 75WLO742C0 to 8
2017-03-20 14:50:00,425 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 500  Safaricom Airtime. Your transaction number is 75WLO742C0 to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 500  Safaricom Airtime. Your transaction number is 75WLO742C0 to 8
2017-03-20 14:50:00,426 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 500  Safaricom Airtime. Your transaction number is 75WLO742C0", "user": "8", "title": "Safaricom  Airtime"}
2017-03-20 14:50:00,426 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 500  Safaricom Airtime. Your transaction number is 75WLO742C0", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 500  Safaricom Airtime. Your transaction number is 75WLO742C0", "user": "8", "title": "Safaricom  Airtime"}
2017-03-20 14:50:00,426 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-20 14:50:00,426 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-20 14:50:00,426 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 500  Safaricom Airtime. Your transaction number is 75WLO742C0
2017-03-20 14:50:00,426 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 500  Safaricom Airtime. Your transaction number is 75WLO742C0
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 500  Safaricom Airtime. Your transaction number is 75WLO742C0
2017-03-20 14:50:01,685 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":69,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 500  Safaricom Airtime. Your transaction number is 75WLO742C0","image_url":"","date":"2017-03-20T14:47:08.906336Z"}
2017-03-20 14:50:01,685 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":69,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 500  Safaricom Airtime. Your transaction number is 75WLO742C0","image_url":"","date":"2017-03-20T14:47:08.906336Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":69,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 500  Safaricom Airtime. Your transaction number is 75WLO742C0","image_url":"","date":"2017-03-20T14:47:08.906336Z"}
2017-03-20 14:50:01,687 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-20 14:50:01,687 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-20 14:50:01,687 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":69,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 500  Safaricom Airtime. Your transaction number is 75WLO742C0","image_url":"","date":"2017-03-20T14:47:08.906336Z"}
2017-03-20 14:50:01,687 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":69,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 500  Safaricom Airtime. Your transaction number is 75WLO742C0","image_url":"","date":"2017-03-20T14:47:08.906336Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":69,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 500  Safaricom Airtime. Your transaction number is 75WLO742C0","image_url":"","date":"2017-03-20T14:47:08.906336Z"}
2017-03-20 14:50:01,688 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-20 14:50:01,688 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-20 14:50:01,689 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-20 14:50:01,689 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-20 14:50:01,689 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-20 14:50:01,689 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-20 14:50:01,690 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-20 14:50:01,690 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-20 14:50:01,690 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "720384396", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "500", "service_provider_id": 1}
2017-03-20 14:50:01,690 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "720384396", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "500", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "720384396", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "500", "service_provider_id": 1}
2017-03-20 14:50:01,691 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-20 14:50:01,691 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-20 14:50:01,749 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-20 14:50:01,749 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-20 14:50:01,750 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":42,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"720384396","request":null,"amount":500.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-20 14:50:01,750 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":42,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"720384396","request":null,"amount":500.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":42,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"720384396","request":null,"amount":500.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-20 14:50:01,750 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-20 14:50:01,750 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-20 14:50:01,751 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-20 14:50:01,751 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-20 14:50:01,752 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2256.85ms
2017-03-20 14:50:01,752 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2256.85ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 2256.85ms
2017-03-20 15:30:08,395 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.63ms
WARNING:tornado.access:404 GET http://www.google.com/ (91.236.75.4) 0.63ms
2017-03-20 15:30:08,395 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.63ms
2017-03-20 15:47:15,018 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.46ms
WARNING:tornado.access:404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.46ms
2017-03-20 15:47:15,018 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.46ms
2017-03-20 16:31:20,792 = tornado.access - WARNING - 404 GET / (50.196.197.54) 0.61ms
WARNING:tornado.access:404 GET / (50.196.197.54) 0.61ms
2017-03-20 16:31:20,792 = tornado.access - WARNING - 404 GET / (50.196.197.54) 0.61ms
2017-03-20 17:03:21,426 = tornado.access - WARNING - 404 GET / (198.20.69.74) 0.66ms
2017-03-20 17:03:21,426 = tornado.access - WARNING - 404 GET / (198.20.69.74) 0.66ms
WARNING:tornado.access:404 GET / (198.20.69.74) 0.66ms
2017-03-20 17:36:40,724 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.69ms
2017-03-20 17:36:40,724 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.69ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.69ms
2017-03-20 18:17:43,563 = tornado.access - WARNING - 404 GET /struts2-showcase/ (189.126.63.50) 0.64ms
WARNING:tornado.access:404 GET /struts2-showcase/ (189.126.63.50) 0.64ms
2017-03-20 18:17:43,563 = tornado.access - WARNING - 404 GET /struts2-showcase/ (189.126.63.50) 0.64ms
2017-03-20 20:07:24,019 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.58ms
WARNING:tornado.access:404 GET http://www.google.com/ (91.236.75.4) 0.58ms
2017-03-20 20:07:24,019 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.58ms
2017-03-20 20:30:48,259 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.52ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.52ms
2017-03-20 20:30:48,259 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.52ms
2017-03-20 21:30:18,614 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.62ms
WARNING:tornado.access:404 GET http://www.google.com/ (91.236.75.4) 0.62ms
2017-03-20 21:30:18,614 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.62ms
2017-03-21 04:22:37,204 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.56ms
WARNING:tornado.access:404 GET http://www.google.com/ (91.236.75.4) 0.56ms
2017-03-21 04:22:37,204 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.56ms
2017-03-21 05:36:06,404 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.45ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.45ms
2017-03-21 05:36:06,404 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.45ms
2017-03-21 06:24:25,170 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.69.128) 0.69ms
WARNING:tornado.access:404 GET http://www.baidu.com/favicon.ico (123.59.69.128) 0.69ms
2017-03-21 06:24:25,170 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.69.128) 0.69ms
2017-03-21 06:44:14,851 = tornado.access - WARNING - 404 GET / (24.37.148.250) 0.51ms
WARNING:tornado.access:404 GET / (24.37.148.250) 0.51ms
2017-03-21 06:44:14,851 = tornado.access - WARNING - 404 GET / (24.37.148.250) 0.51ms
2017-03-21 08:06:50,064 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.72.185) 0.70ms
WARNING:tornado.access:404 GET http://www.baidu.com/favicon.ico (123.59.72.185) 0.70ms
2017-03-21 08:06:50,064 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.72.185) 0.70ms
2017-03-21 09:35:25,581 = tornado.access - WARNING - 404 GET / (188.0.236.191) 0.58ms
WARNING:tornado.access:404 GET / (188.0.236.191) 0.58ms
2017-03-21 09:35:25,581 = tornado.access - WARNING - 404 GET / (188.0.236.191) 0.58ms
2017-03-21 09:35:25,709 = tornado.access - WARNING - 404 GET /HNAP1/ (188.0.236.191) 0.43ms
WARNING:tornado.access:404 GET /HNAP1/ (188.0.236.191) 0.43ms
2017-03-21 09:35:25,709 = tornado.access - WARNING - 404 GET /HNAP1/ (188.0.236.191) 0.43ms
2017-03-21 10:55:31,187 = tornado.access - WARNING - 404 GET /script (103.242.2.71) 0.70ms
WARNING:tornado.access:404 GET /script (103.242.2.71) 0.70ms
2017-03-21 10:55:31,187 = tornado.access - WARNING - 404 GET /script (103.242.2.71) 0.70ms
2017-03-21 11:17:13,063 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.51ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.51ms
2017-03-21 11:17:13,063 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.51ms
2017-03-21 11:39:49,367 = tornado.access - WARNING - 404 GET / (163.172.67.180) 0.71ms
WARNING:tornado.access:404 GET / (163.172.67.180) 0.71ms
2017-03-21 11:39:49,367 = tornado.access - WARNING - 404 GET / (163.172.67.180) 0.71ms
2017-03-21 13:06:16,958 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.75ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.75ms
2017-03-21 13:06:16,958 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.75ms
2017-03-21 13:42:48,610 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.54ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.54ms
2017-03-21 13:42:48,610 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.54ms
2017-03-21 14:22:48,376 = tornado.access - WARNING - 404 GET / (78.228.18.155) 0.70ms
WARNING:tornado.access:404 GET / (78.228.18.155) 0.70ms
2017-03-21 14:22:48,376 = tornado.access - WARNING - 404 GET / (78.228.18.155) 0.70ms
2017-03-21 14:59:59,707 = tornado.access - WARNING - 404 GET http://proxyjudge.info/ (47.203.88.36) 0.63ms
WARNING:tornado.access:404 GET http://proxyjudge.info/ (47.203.88.36) 0.63ms
2017-03-21 14:59:59,707 = tornado.access - WARNING - 404 GET http://proxyjudge.info/ (47.203.88.36) 0.63ms
2017-03-21 15:12:57,256 = tornado.access - WARNING - 404 GET /manager/html (180.97.215.139) 0.74ms
2017-03-21 15:12:57,256 = tornado.access - WARNING - 404 GET /manager/html (180.97.215.139) 0.74ms
WARNING:tornado.access:404 GET /manager/html (180.97.215.139) 0.74ms
2017-03-21 16:14:41,101 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.45ms
WARNING:tornado.access:404 GET http://www.google.com/ (91.236.75.4) 0.45ms
2017-03-21 16:14:41,101 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.45ms
2017-03-21 18:19:26,405 = tornado.access - WARNING - 404 GET /script (103.242.2.71) 0.71ms
WARNING:tornado.access:404 GET /script (103.242.2.71) 0.71ms
2017-03-21 18:19:26,405 = tornado.access - WARNING - 404 GET /script (103.242.2.71) 0.71ms
2017-03-21 18:31:42,400 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.64ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.64ms
2017-03-21 18:31:42,400 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.64ms
2017-03-21 19:43:26,594 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.57ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.57ms
2017-03-21 19:43:26,594 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.57ms
2017-03-21 20:04:29,670 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.73ms
WARNING:tornado.access:404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.73ms
2017-03-21 20:04:29,670 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.73ms
2017-03-21 20:52:52,841 = tornado.access - WARNING - 404 GET /script (103.242.2.71) 0.59ms
WARNING:tornado.access:404 GET /script (103.242.2.71) 0.59ms
2017-03-21 20:52:52,841 = tornado.access - WARNING - 404 GET /script (103.242.2.71) 0.59ms
2017-03-22 02:06:23,762 = tornado.access - WARNING - 404 GET / (139.162.79.87) 0.82ms
WARNING:tornado.access:404 GET / (139.162.79.87) 0.82ms
2017-03-22 02:06:23,762 = tornado.access - WARNING - 404 GET / (139.162.79.87) 0.82ms
2017-03-22 02:38:41,938 = tornado.access - WARNING - 404 GET /manager/html (58.221.58.113) 0.61ms
WARNING:tornado.access:404 GET /manager/html (58.221.58.113) 0.61ms
2017-03-22 02:38:41,938 = tornado.access - WARNING - 404 GET /manager/html (58.221.58.113) 0.61ms
2017-03-22 03:06:20,870 = tornado.access - WARNING - 404 GET / (192.168.165.223) 0.64ms
WARNING:tornado.access:404 GET / (192.168.165.223) 0.64ms
2017-03-22 03:06:20,870 = tornado.access - WARNING - 404 GET / (192.168.165.223) 0.64ms
2017-03-22 03:06:20,875 = tornado.access - WARNING - 404 OPTIONS / (192.168.165.223) 0.46ms
2017-03-22 03:06:20,875 = tornado.access - WARNING - 404 OPTIONS / (192.168.165.223) 0.46ms
WARNING:tornado.access:404 OPTIONS / (192.168.165.223) 0.46ms
2017-03-22 03:06:20,878 = tornado.general - INFO - Malformed HTTP message from 192.168.165.223: Malformed HTTP version in HTTP Request-Line: 'RTSP/1.0'
2017-03-22 03:06:20,878 = tornado.general - INFO - Malformed HTTP message from 192.168.165.223: Malformed HTTP version in HTTP Request-Line: 'RTSP/1.0'
INFO:tornado.general:Malformed HTTP message from 192.168.165.223: Malformed HTTP version in HTTP Request-Line: 'RTSP/1.0'
2017-03-22 03:06:20,880 = tornado.access - WARNING - 404 GET /nice%20ports%2C/Tri%6Eity.txt%2ebak (192.168.165.223) 0.43ms
2017-03-22 03:06:20,880 = tornado.access - WARNING - 404 GET /nice%20ports%2C/Tri%6Eity.txt%2ebak (192.168.165.223) 0.43ms
WARNING:tornado.access:404 GET /nice%20ports%2C/Tri%6Eity.txt%2ebak (192.168.165.223) 0.43ms
2017-03-22 03:06:20,883 = tornado.general - INFO - Malformed HTTP message from 192.168.165.223: Malformed HTTP headers: '\ngoogle.com\x00PGET / HTTP/1.0\r\n\r\n'
2017-03-22 03:06:20,883 = tornado.general - INFO - Malformed HTTP message from 192.168.165.223: Malformed HTTP headers: '\ngoogle.com\x00PGET / HTTP/1.0\r\n\r\n'
INFO:tornado.general:Malformed HTTP message from 192.168.165.223: Malformed HTTP headers: '\ngoogle.com\x00PGET / HTTP/1.0\r\n\r\n'
2017-03-22 03:06:25,888 = tornado.general - INFO - Malformed HTTP message from 192.168.165.223: Malformed HTTP request line
2017-03-22 03:06:25,888 = tornado.general - INFO - Malformed HTTP message from 192.168.165.223: Malformed HTTP request line
INFO:tornado.general:Malformed HTTP message from 192.168.165.223: Malformed HTTP request line
2017-03-22 03:07:18,411 = tornado.general - INFO - Malformed HTTP message from 192.168.165.223: Malformed HTTP version in HTTP Request-Line: 'SIP/2.0'
2017-03-22 03:07:18,411 = tornado.general - INFO - Malformed HTTP message from 192.168.165.223: Malformed HTTP version in HTTP Request-Line: 'SIP/2.0'
INFO:tornado.general:Malformed HTTP message from 192.168.165.223: Malformed HTTP version in HTTP Request-Line: 'SIP/2.0'
2017-03-22 03:09:08,274 = tornado.access - WARNING - 404 GET /robots.txt (192.168.165.223) 0.63ms
2017-03-22 03:09:08,275 = tornado.access - WARNING - 404 OPTIONS / (192.168.165.223) 0.38ms
WARNING:tornado.access:404 GET /robots.txt (192.168.165.223) 0.63ms
WARNING:tornado.access:404 OPTIONS / (192.168.165.223) 0.38ms
2017-03-22 03:09:08,274 = tornado.access - WARNING - 404 GET /robots.txt (192.168.165.223) 0.63ms
2017-03-22 03:09:08,275 = tornado.access - WARNING - 404 OPTIONS / (192.168.165.223) 0.38ms
2017-03-22 03:09:08,450 = tornado.access - WARNING - 404 OPTIONS / (192.168.165.223) 0.57ms
2017-03-22 03:09:08,450 = tornado.access - WARNING - 404 OPTIONS / (192.168.165.223) 0.57ms
WARNING:tornado.access:404 OPTIONS / (192.168.165.223) 0.57ms
2017-03-22 03:09:08,626 = tornado.access - WARNING - 404 OPTIONS / (192.168.165.223) 0.56ms
2017-03-22 03:09:08,626 = tornado.access - WARNING - 404 OPTIONS / (192.168.165.223) 0.56ms
WARNING:tornado.access:404 OPTIONS / (192.168.165.223) 0.56ms
2017-03-22 03:09:08,688 = tornado.access - WARNING - 404 GET http://www.google.com (192.168.165.223) 0.70ms
2017-03-22 03:09:08,688 = tornado.access - WARNING - 404 GET http://www.google.com (192.168.165.223) 0.70ms
WARNING:tornado.access:404 GET http://www.google.com (192.168.165.223) 0.70ms
2017-03-22 03:09:08,800 = tornado.access - WARNING - 404 OPTIONS / (192.168.165.223) 0.56ms
2017-03-22 03:09:08,800 = tornado.access - WARNING - 404 OPTIONS / (192.168.165.223) 0.56ms
WARNING:tornado.access:404 OPTIONS / (192.168.165.223) 0.56ms
2017-03-22 03:09:08,863 = tornado.access - WARNING - 404 HEAD http://www.google.com (192.168.165.223) 0.63ms
2017-03-22 03:09:08,863 = tornado.access - WARNING - 404 HEAD http://www.google.com (192.168.165.223) 0.63ms
WARNING:tornado.access:404 HEAD http://www.google.com (192.168.165.223) 0.63ms
2017-03-22 03:09:08,990 = tornado.access - WARNING - 404 OPTIONS / (192.168.165.223) 0.60ms
2017-03-22 03:09:08,990 = tornado.access - WARNING - 404 OPTIONS / (192.168.165.223) 0.60ms
WARNING:tornado.access:404 OPTIONS / (192.168.165.223) 0.60ms
2017-03-22 03:09:09,046 = tornado.access - WARNING - 405 CONNECT www.google.com:80 (192.168.165.223) 0.61ms
2017-03-22 03:09:09,046 = tornado.access - WARNING - 405 CONNECT www.google.com:80 (192.168.165.223) 0.61ms
WARNING:tornado.access:405 CONNECT www.google.com:80 (192.168.165.223) 0.61ms
2017-03-22 03:09:09,193 = tornado.access - WARNING - 404 OPTIONS / (192.168.165.223) 0.70ms
2017-03-22 03:09:09,193 = tornado.access - WARNING - 404 OPTIONS / (192.168.165.223) 0.70ms
WARNING:tornado.access:404 OPTIONS / (192.168.165.223) 0.70ms
2017-03-22 03:09:09,371 = tornado.access - WARNING - 404 OPTIONS / (192.168.165.223) 0.70ms
2017-03-22 03:09:09,371 = tornado.access - WARNING - 404 OPTIONS / (192.168.165.223) 0.70ms
WARNING:tornado.access:404 OPTIONS / (192.168.165.223) 0.70ms
2017-03-22 03:09:09,544 = tornado.access - WARNING - 404 OPTIONS / (192.168.165.223) 0.67ms
2017-03-22 03:09:09,544 = tornado.access - WARNING - 404 OPTIONS / (192.168.165.223) 0.67ms
WARNING:tornado.access:404 OPTIONS / (192.168.165.223) 0.67ms
2017-03-22 03:09:09,722 = tornado.access - WARNING - 404 OPTIONS / (192.168.165.223) 0.61ms
2017-03-22 03:09:09,722 = tornado.access - WARNING - 404 OPTIONS / (192.168.165.223) 0.61ms
WARNING:tornado.access:404 OPTIONS / (192.168.165.223) 0.61ms
2017-03-22 03:09:36,450 = tornado.access - WARNING - 404 OPTIONS / (192.168.165.223) 0.62ms
WARNING:tornado.access:404 OPTIONS / (192.168.165.223) 0.62ms
2017-03-22 03:09:36,450 = tornado.access - WARNING - 404 OPTIONS / (192.168.165.223) 0.62ms
2017-03-22 03:09:37,108 = tornado.access - WARNING - 404 GET / (192.168.165.223) 0.61ms
2017-03-22 03:09:37,108 = tornado.access - WARNING - 404 GET / (192.168.165.223) 0.61ms
WARNING:tornado.access:404 GET / (192.168.165.223) 0.61ms
2017-03-22 03:09:37,437 = tornado.access - WARNING - 404 GET / (192.168.165.223) 0.65ms
2017-03-22 03:09:37,437 = tornado.access - WARNING - 404 GET / (192.168.165.223) 0.65ms
WARNING:tornado.access:404 GET / (192.168.165.223) 0.65ms
2017-03-22 03:09:46,939 = tornado.access - WARNING - 404 GET /favicon.ico (192.168.165.223) 1.03ms
2017-03-22 03:09:46,939 = tornado.access - WARNING - 404 GET /favicon.ico (192.168.165.223) 1.03ms
WARNING:tornado.access:404 GET /favicon.ico (192.168.165.223) 1.03ms
2017-03-22 03:09:53,746 = tornado.access - WARNING - 404 GET / (192.168.165.223) 0.66ms
2017-03-22 03:09:53,746 = tornado.access - WARNING - 404 GET / (192.168.165.223) 0.66ms
WARNING:tornado.access:404 GET / (192.168.165.223) 0.66ms
2017-03-22 03:10:16,471 = tornado.access - WARNING - 404 GET /.git/HEAD (192.168.165.223) 0.60ms
2017-03-22 03:10:16,471 = tornado.access - WARNING - 404 GET /.git/HEAD (192.168.165.223) 0.60ms
WARNING:tornado.access:404 GET /.git/HEAD (192.168.165.223) 0.60ms
2017-03-22 07:31:16,473 = tornado.access - WARNING - 404 GET /script (103.242.2.71) 0.51ms
WARNING:tornado.access:404 GET /script (103.242.2.71) 0.51ms
2017-03-22 07:31:16,473 = tornado.access - WARNING - 404 GET /script (103.242.2.71) 0.51ms
2017-03-22 08:37:54,109 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.82.147) 1.02ms
WARNING:tornado.access:404 GET http://www.baidu.com/favicon.ico (123.59.82.147) 1.02ms
2017-03-22 08:37:54,109 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.82.147) 1.02ms
2017-03-22 08:49:09,682 = tornado.access - WARNING - 404 GET / (5.188.211.68) 0.59ms
WARNING:tornado.access:404 GET / (5.188.211.68) 0.59ms
2017-03-22 08:49:09,682 = tornado.access - WARNING - 404 GET / (5.188.211.68) 0.59ms
2017-03-22 10:17:56,486 = tornado.access - WARNING - 404 GET /index.action (222.186.34.77) 0.47ms
WARNING:tornado.access:404 GET /index.action (222.186.34.77) 0.47ms
2017-03-22 10:17:56,486 = tornado.access - WARNING - 404 GET /index.action (222.186.34.77) 0.47ms
2017-03-22 10:35:05,202 = tornado.access - WARNING - 404 GET /zecmd/zecmd.jsp (86.122.27.241) 0.46ms
WARNING:tornado.access:404 GET /zecmd/zecmd.jsp (86.122.27.241) 0.46ms
2017-03-22 10:35:05,202 = tornado.access - WARNING - 404 GET /zecmd/zecmd.jsp (86.122.27.241) 0.46ms
2017-03-22 10:35:05,325 = tornado.access - WARNING - 404 GET /jexws3/jexws3.jsp (86.122.27.241) 0.49ms
2017-03-22 10:35:05,325 = tornado.access - WARNING - 404 GET /jexws3/jexws3.jsp (86.122.27.241) 0.49ms
WARNING:tornado.access:404 GET /jexws3/jexws3.jsp (86.122.27.241) 0.49ms
2017-03-22 10:35:05,446 = tornado.access - WARNING - 404 GET /jexinv3/jexinv3.jsp (86.122.27.241) 0.48ms
2017-03-22 10:35:05,446 = tornado.access - WARNING - 404 GET /jexinv3/jexinv3.jsp (86.122.27.241) 0.48ms
WARNING:tornado.access:404 GET /jexinv3/jexinv3.jsp (86.122.27.241) 0.48ms
2017-03-22 10:35:05,568 = tornado.access - WARNING - 404 GET /jbossass/jbossass.jsp (86.122.27.241) 0.50ms
2017-03-22 10:35:05,568 = tornado.access - WARNING - 404 GET /jbossass/jbossass.jsp (86.122.27.241) 0.50ms
WARNING:tornado.access:404 GET /jbossass/jbossass.jsp (86.122.27.241) 0.50ms
2017-03-22 10:35:05,698 = tornado.access - WARNING - 404 GET /jexws4/jexws4.jsp (86.122.27.241) 0.47ms
2017-03-22 10:35:05,698 = tornado.access - WARNING - 404 GET /jexws4/jexws4.jsp (86.122.27.241) 0.47ms
WARNING:tornado.access:404 GET /jexws4/jexws4.jsp (86.122.27.241) 0.47ms
2017-03-22 10:35:05,828 = tornado.access - WARNING - 404 GET /iddqd/iddqd.jsp (86.122.27.241) 0.51ms
2017-03-22 10:35:05,828 = tornado.access - WARNING - 404 GET /iddqd/iddqd.jsp (86.122.27.241) 0.51ms
WARNING:tornado.access:404 GET /iddqd/iddqd.jsp (86.122.27.241) 0.51ms
2017-03-22 10:35:05,948 = tornado.access - WARNING - 404 GET /iesvc/iesvc.jsp (86.122.27.241) 0.99ms
2017-03-22 10:35:05,948 = tornado.access - WARNING - 404 GET /iesvc/iesvc.jsp (86.122.27.241) 0.99ms
WARNING:tornado.access:404 GET /iesvc/iesvc.jsp (86.122.27.241) 0.99ms
2017-03-22 11:14:27,641 = tornado.access - WARNING - 404 GET / (202.194.207.101) 0.72ms
2017-03-22 11:14:27,641 = tornado.access - WARNING - 404 GET / (202.194.207.101) 0.72ms
WARNING:tornado.access:404 GET / (202.194.207.101) 0.72ms
2017-03-22 11:14:27,642 = tornado.access - WARNING - 404 GET / (202.194.207.101) 0.51ms
2017-03-22 11:14:27,642 = tornado.access - WARNING - 404 GET / (202.194.207.101) 0.51ms
WARNING:tornado.access:404 GET / (202.194.207.101) 0.51ms
2017-03-22 11:37:25,601 = tornado.access - WARNING - 404 GET /manager/html (221.194.44.252) 0.64ms
2017-03-22 11:37:25,601 = tornado.access - WARNING - 404 GET /manager/html (221.194.44.252) 0.64ms
WARNING:tornado.access:404 GET /manager/html (221.194.44.252) 0.64ms
2017-03-22 11:49:17,494 = tornado.access - WARNING - 404 GET /manager/html (203.123.23.156) 0.72ms
2017-03-22 11:49:17,494 = tornado.access - WARNING - 404 GET /manager/html (203.123.23.156) 0.72ms
WARNING:tornado.access:404 GET /manager/html (203.123.23.156) 0.72ms
2017-03-22 12:13:30,401 = tornado.access - WARNING - 404 GET / (88.248.58.93) 0.93ms
WARNING:tornado.access:404 GET / (88.248.58.93) 0.93ms
2017-03-22 12:13:30,401 = tornado.access - WARNING - 404 GET / (88.248.58.93) 0.93ms
2017-03-22 13:54:43,621 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-22 13:54:43,621 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-22 13:54:43,621 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 13:54:43
2017-03-22 13:54:43,622 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-22 13:54:43,622 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-22 13:54:43,622 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 652ea97953814be8aaddbbc6fdb12b9c
2017-03-22 13:54:43,623 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-22 13:54:43,623 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-22 13:54:43,623 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 13:54:43</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>652ea97953814be8aaddbbc6fdb12b9c</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 13:54:43,624 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-22 13:54:43,624 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-22 13:54:43,624 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 13:54:43</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>652ea97953814be8aaddbbc6fdb12b9c</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 13:54:43,625 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 22/03/2017 13:54:43
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 652ea97953814be8aaddbbc6fdb12b9c
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 13:54:43</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>652ea97953814be8aaddbbc6fdb12b9c</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 13:54:43</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>652ea97953814be8aaddbbc6fdb12b9c</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-22 13:54:43,621 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-22 13:54:43,621 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-22 13:54:43,621 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 13:54:43
2017-03-22 13:54:43,622 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-22 13:54:43,622 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-22 13:54:43,622 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 652ea97953814be8aaddbbc6fdb12b9c
2017-03-22 13:54:43,623 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-22 13:54:43,623 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-22 13:54:43,623 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 13:54:43</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>652ea97953814be8aaddbbc6fdb12b9c</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 13:54:43,624 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-22 13:54:43,624 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-22 13:54:43,624 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 13:54:43</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>652ea97953814be8aaddbbc6fdb12b9c</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 13:54:43,625 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-22 13:54:44,528 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-22 13:54:44,528 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-22 13:54:44,529 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 13:51:46</ns0:DATE><ns0:EXTREFNUM>652ea97953814be8aaddbbc6fdb12b9c</ns0:EXTREFNUM><ns0:TXNID>R170322.1351.140048</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 190</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 13:54:44,529 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 13:51:46</ns0:DATE><ns0:EXTREFNUM>652ea97953814be8aaddbbc6fdb12b9c</ns0:EXTREFNUM><ns0:TXNID>R170322.1351.140048</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 190</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 13:51:46</ns0:DATE><ns0:EXTREFNUM>652ea97953814be8aaddbbc6fdb12b9c</ns0:EXTREFNUM><ns0:TXNID>R170322.1351.140048</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 190</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 13:54:44,529 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-22 13:54:44,529 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-22 13:54:44,530 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
2017-03-22 13:54:44,530 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------5-----------------------
2017-03-22 13:54:44,531 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-22 13:54:44,531 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-22 13:54:44,531 = handlers.result_handler.AirtimeHandler - DEBUG - 22/03/17 13:51:46
2017-03-22 13:54:44,531 = handlers.result_handler.AirtimeHandler - DEBUG - 22/03/17 13:51:46
DEBUG:handlers.result_handler.AirtimeHandler:22/03/17 13:51:46
2017-03-22 13:54:44,532 = handlers.result_handler.AirtimeHandler - DEBUG - 652ea97953814be8aaddbbc6fdb12b9c
2017-03-22 13:54:44,532 = handlers.result_handler.AirtimeHandler - DEBUG - 652ea97953814be8aaddbbc6fdb12b9c
DEBUG:handlers.result_handler.AirtimeHandler:652ea97953814be8aaddbbc6fdb12b9c
2017-03-22 13:54:44,533 = handlers.result_handler.AirtimeHandler - DEBUG - R170322.1351.140048
2017-03-22 13:54:44,533 = handlers.result_handler.AirtimeHandler - DEBUG - R170322.1351.140048
DEBUG:handlers.result_handler.AirtimeHandler:R170322.1351.140048
2017-03-22 13:54:44,533 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'22/03/17 13:51:46', 'amount': '5', 'external_ref': u'R170322.1351.140048', 'msisdn_2': u'254702935200', 'internal_ref': '4LYOQ1TY9V'}
2017-03-22 13:54:44,533 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'22/03/17 13:51:46', 'amount': '5', 'external_ref': u'R170322.1351.140048', 'msisdn_2': u'254702935200', 'internal_ref': '4LYOQ1TY9V'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'22/03/17 13:51:46', 'amount': '5', 'external_ref': u'R170322.1351.140048', 'msisdn_2': u'254702935200', 'internal_ref': '4LYOQ1TY9V'}
2017-03-22 13:54:44,534 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-22 13:54:44,534 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-22 13:54:44,586 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-22 13:54:44,587 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-22 13:54:44,592 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-22 13:54:44,592 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 13:54:44,597 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-22 13:54:44,598 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-22 13:54:44,601 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-22 13:54:44,601 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-22 13:54:44,605 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-22 13:54:44,606 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 13:54:44,609 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-22 13:54:44,609 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 13:54:44,611 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-22 13:54:44,612 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-22 13:54:44,614 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-22 13:54:44,615 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 13:54:44,619 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-22 13:54:44,619 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 13:54:44,621 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-22 13:54:44,621 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7ffa26501710>
2017-03-22 13:54:44,628 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-22 13:54:44,628 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-22 13:54:44,629 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-22 13:54:44,629 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-22 13:54:44,629 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 4LYOQ1TY9V
2017-03-22 13:54:44,629 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 4LYOQ1TY9V
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 4LYOQ1TY9V
2017-03-22 13:54:44,630 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 4LYOQ1TY9V to 254702935200
2017-03-22 13:54:44,630 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 4LYOQ1TY9V to 254702935200
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 4LYOQ1TY9V to 254702935200
2017-03-22 13:54:44,631 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-22 13:54:44,631 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-22 13:54:44,631 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 4LYOQ1TY9V to 3
2017-03-22 13:54:44,631 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 4LYOQ1TY9V to 3
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 4LYOQ1TY9V to 3
2017-03-22 13:54:44,632 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 4LYOQ1TY9V", "user": "3", "title": "Safaricom  Airtime"}
2017-03-22 13:54:44,632 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 4LYOQ1TY9V", "user": "3", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 4LYOQ1TY9V", "user": "3", "title": "Safaricom  Airtime"}
2017-03-22 13:54:44,632 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-22 13:54:44,632 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-22 13:54:44,633 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 4LYOQ1TY9V
2017-03-22 13:54:44,633 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 4LYOQ1TY9V
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 4LYOQ1TY9V
2017-03-22 13:54:45,892 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":74,"user":3,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 4LYOQ1TY9V","image_url":"","date":"2017-03-22T13:51:47.823809Z"}
2017-03-22 13:54:45,892 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":74,"user":3,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 4LYOQ1TY9V","image_url":"","date":"2017-03-22T13:51:47.823809Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":74,"user":3,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 4LYOQ1TY9V","image_url":"","date":"2017-03-22T13:51:47.823809Z"}
2017-03-22 13:54:45,893 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-22 13:54:45,893 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-22 13:54:45,893 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":74,"user":3,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 4LYOQ1TY9V","image_url":"","date":"2017-03-22T13:51:47.823809Z"}
2017-03-22 13:54:45,893 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":74,"user":3,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 4LYOQ1TY9V","image_url":"","date":"2017-03-22T13:51:47.823809Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":74,"user":3,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 4LYOQ1TY9V","image_url":"","date":"2017-03-22T13:51:47.823809Z"}
2017-03-22 13:54:45,894 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-22 13:54:45,894 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-22 13:54:45,895 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-22 13:54:45,895 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-22 13:54:45,895 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-22 13:54:45,895 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-22 13:54:45,896 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-22 13:54:45,896 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-22 13:54:45,896 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 3, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-22 13:54:45,896 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 3, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 3, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-22 13:54:45,897 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-22 13:54:45,897 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-22 13:54:47,055 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 13:54:47,055 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-22 13:54:47,056 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":54,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-22 13:54:47,056 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":54,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":54,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-22 13:54:47,057 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 13:54:47,057 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 13:54:47,057 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-22 13:54:47,057 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-22 13:54:47,058 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3438.48ms
2017-03-22 13:54:47,058 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3438.48ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3438.48ms
2017-03-22 13:59:50,810 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-22 13:59:50,810 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-22 13:59:50,811 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 13:59:50
2017-03-22 13:59:50,811 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-22 13:59:50,811 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-22 13:59:50,812 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 490310d09add4ca9bb49b30600acac52
2017-03-22 13:59:50,812 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-22 13:59:50,813 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-22 13:59:50,813 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 13:59:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>490310d09add4ca9bb49b30600acac52</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 13:59:50,813 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-22 13:59:50,814 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-22 13:59:50,814 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 13:59:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>490310d09add4ca9bb49b30600acac52</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 13:59:50,814 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 22/03/2017 13:59:50
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 490310d09add4ca9bb49b30600acac52
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 13:59:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>490310d09add4ca9bb49b30600acac52</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 13:59:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>490310d09add4ca9bb49b30600acac52</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-22 13:59:50,810 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-22 13:59:50,810 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-22 13:59:50,811 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 13:59:50
2017-03-22 13:59:50,811 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-22 13:59:50,811 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-22 13:59:50,812 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 490310d09add4ca9bb49b30600acac52
2017-03-22 13:59:50,812 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-22 13:59:50,813 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-22 13:59:50,813 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 13:59:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>490310d09add4ca9bb49b30600acac52</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 13:59:50,813 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-22 13:59:50,814 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-22 13:59:50,814 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 13:59:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>490310d09add4ca9bb49b30600acac52</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 13:59:50,814 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-22 13:59:51,571 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-22 13:59:51,571 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-22 13:59:51,572 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 13:56:53</ns0:DATE><ns0:EXTREFNUM>490310d09add4ca9bb49b30600acac52</ns0:EXTREFNUM><ns0:TXNID>R170322.1356.140055</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 180</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 13:59:51,572 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 13:56:53</ns0:DATE><ns0:EXTREFNUM>490310d09add4ca9bb49b30600acac52</ns0:EXTREFNUM><ns0:TXNID>R170322.1356.140055</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 180</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 13:56:53</ns0:DATE><ns0:EXTREFNUM>490310d09add4ca9bb49b30600acac52</ns0:EXTREFNUM><ns0:TXNID>R170322.1356.140055</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 180</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 13:59:51,573 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-22 13:59:51,573 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-22 13:59:51,573 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-22 13:59:51,573 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
2017-03-22 13:59:51,574 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-22 13:59:51,574 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-22 13:59:51,574 = handlers.result_handler.AirtimeHandler - DEBUG - 22/03/17 13:56:53
2017-03-22 13:59:51,574 = handlers.result_handler.AirtimeHandler - DEBUG - 22/03/17 13:56:53
DEBUG:handlers.result_handler.AirtimeHandler:22/03/17 13:56:53
2017-03-22 13:59:51,575 = handlers.result_handler.AirtimeHandler - DEBUG - 490310d09add4ca9bb49b30600acac52
2017-03-22 13:59:51,575 = handlers.result_handler.AirtimeHandler - DEBUG - 490310d09add4ca9bb49b30600acac52
DEBUG:handlers.result_handler.AirtimeHandler:490310d09add4ca9bb49b30600acac52
2017-03-22 13:59:51,575 = handlers.result_handler.AirtimeHandler - DEBUG - R170322.1356.140055
2017-03-22 13:59:51,575 = handlers.result_handler.AirtimeHandler - DEBUG - R170322.1356.140055
DEBUG:handlers.result_handler.AirtimeHandler:R170322.1356.140055
2017-03-22 13:59:51,576 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'22/03/17 13:56:53', 'amount': '10', 'external_ref': u'R170322.1356.140055', 'msisdn_2': u'254721799582', 'internal_ref': 'A10UPPXBRK'}
2017-03-22 13:59:51,576 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'22/03/17 13:56:53', 'amount': '10', 'external_ref': u'R170322.1356.140055', 'msisdn_2': u'254721799582', 'internal_ref': 'A10UPPXBRK'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'22/03/17 13:56:53', 'amount': '10', 'external_ref': u'R170322.1356.140055', 'msisdn_2': u'254721799582', 'internal_ref': 'A10UPPXBRK'}
2017-03-22 13:59:51,577 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-22 13:59:51,577 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-22 13:59:51,621 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-22 13:59:51,622 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-22 13:59:51,626 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-22 13:59:51,627 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 13:59:51,631 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-22 13:59:51,632 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-22 13:59:51,636 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-22 13:59:51,637 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-22 13:59:51,642 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-22 13:59:51,643 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 13:59:51,647 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-22 13:59:51,648 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 13:59:51,651 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-22 13:59:51,652 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-22 13:59:51,655 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-22 13:59:51,655 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 13:59:51,660 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-22 13:59:51,660 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 13:59:51,663 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-22 13:59:51,664 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7ffa2ab44fd0>
2017-03-22 13:59:51,671 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-22 13:59:51,671 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-22 13:59:51,672 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-22 13:59:51,672 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-22 13:59:51,673 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is A10UPPXBRK
2017-03-22 13:59:51,673 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is A10UPPXBRK
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is A10UPPXBRK
2017-03-22 13:59:51,673 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is A10UPPXBRK to 254721799582
2017-03-22 13:59:51,673 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is A10UPPXBRK to 254721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is A10UPPXBRK to 254721799582
2017-03-22 13:59:51,674 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-22 13:59:51,674 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-22 13:59:51,674 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is A10UPPXBRK to 4
2017-03-22 13:59:51,674 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is A10UPPXBRK to 4
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is A10UPPXBRK to 4
2017-03-22 13:59:51,675 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is A10UPPXBRK", "user": "4", "title": "Safaricom  Airtime"}
2017-03-22 13:59:51,675 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is A10UPPXBRK", "user": "4", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is A10UPPXBRK", "user": "4", "title": "Safaricom  Airtime"}
2017-03-22 13:59:51,675 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-22 13:59:51,675 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-22 13:59:51,676 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 10  Safaricom Airtime. Your transaction number is A10UPPXBRK
2017-03-22 13:59:51,676 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 10  Safaricom Airtime. Your transaction number is A10UPPXBRK
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 10  Safaricom Airtime. Your transaction number is A10UPPXBRK
2017-03-22 13:59:52,777 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":75,"user":4,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is A10UPPXBRK","image_url":"","date":"2017-03-22T13:56:54.699836Z"}
2017-03-22 13:59:52,777 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":75,"user":4,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is A10UPPXBRK","image_url":"","date":"2017-03-22T13:56:54.699836Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":75,"user":4,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is A10UPPXBRK","image_url":"","date":"2017-03-22T13:56:54.699836Z"}
2017-03-22 13:59:52,778 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-22 13:59:52,778 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-22 13:59:52,779 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":75,"user":4,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is A10UPPXBRK","image_url":"","date":"2017-03-22T13:56:54.699836Z"}
2017-03-22 13:59:52,779 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":75,"user":4,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is A10UPPXBRK","image_url":"","date":"2017-03-22T13:56:54.699836Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":75,"user":4,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is A10UPPXBRK","image_url":"","date":"2017-03-22T13:56:54.699836Z"}
2017-03-22 13:59:52,780 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-22 13:59:52,780 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-22 13:59:52,780 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-22 13:59:52,780 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-22 13:59:52,781 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-22 13:59:52,781 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-22 13:59:52,782 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-22 13:59:52,782 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-22 13:59:52,782 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 4, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-22 13:59:52,782 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 4, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "721799582", "user": 4, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-22 13:59:52,783 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-22 13:59:52,783 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-22 13:59:53,909 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 13:59:53,909 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-22 13:59:53,910 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":55,"user":4,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-22 13:59:53,910 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":55,"user":4,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":55,"user":4,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-22 13:59:53,911 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 13:59:53,911 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 13:59:53,912 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-22 13:59:53,912 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-22 13:59:53,913 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3104.24ms
2017-03-22 13:59:53,913 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3104.24ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3104.24ms
2017-03-22 14:08:45,265 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-22 14:08:45,265 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-22 14:08:45,266 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 14:08:45
2017-03-22 14:08:45,266 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-22 14:08:45,266 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-22 14:08:45,267 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 9d366fa4a81b4c1aa2ad4674d06befd7
2017-03-22 14:08:45,267 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-22 14:08:45,267 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-22 14:08:45,268 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:08:45</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9d366fa4a81b4c1aa2ad4674d06befd7</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:08:45,268 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-22 14:08:45,268 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-22 14:08:45,269 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:08:45</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9d366fa4a81b4c1aa2ad4674d06befd7</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 22/03/2017 14:08:45
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 9d366fa4a81b4c1aa2ad4674d06befd7
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:08:45</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9d366fa4a81b4c1aa2ad4674d06befd7</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:08:45</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9d366fa4a81b4c1aa2ad4674d06befd7</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:08:45,265 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-22 14:08:45,265 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-22 14:08:45,266 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 14:08:45
2017-03-22 14:08:45,266 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-22 14:08:45,266 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-22 14:08:45,267 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 9d366fa4a81b4c1aa2ad4674d06befd7
2017-03-22 14:08:45,267 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-22 14:08:45,267 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-22 14:08:45,268 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:08:45</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9d366fa4a81b4c1aa2ad4674d06befd7</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:08:45,268 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-22 14:08:45,268 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-22 14:08:45,269 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:08:45</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9d366fa4a81b4c1aa2ad4674d06befd7</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:08:45,270 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-22 14:08:45,270 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-22 14:08:46,109 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-22 14:08:46,109 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-22 14:08:46,110 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:05:47</ns0:DATE><ns0:EXTREFNUM>9d366fa4a81b4c1aa2ad4674d06befd7</ns0:EXTREFNUM><ns0:TXNID>R170322.1405.140041</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 175</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 14:08:46,110 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:05:47</ns0:DATE><ns0:EXTREFNUM>9d366fa4a81b4c1aa2ad4674d06befd7</ns0:EXTREFNUM><ns0:TXNID>R170322.1405.140041</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 175</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:05:47</ns0:DATE><ns0:EXTREFNUM>9d366fa4a81b4c1aa2ad4674d06befd7</ns0:EXTREFNUM><ns0:TXNID>R170322.1405.140041</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 175</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 14:08:46,111 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-22 14:08:46,111 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-22 14:08:46,111 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
2017-03-22 14:08:46,111 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------5-----------------------
2017-03-22 14:08:46,112 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-22 14:08:46,112 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-22 14:08:46,112 = handlers.result_handler.AirtimeHandler - DEBUG - 22/03/17 14:05:47
2017-03-22 14:08:46,112 = handlers.result_handler.AirtimeHandler - DEBUG - 22/03/17 14:05:47
DEBUG:handlers.result_handler.AirtimeHandler:22/03/17 14:05:47
2017-03-22 14:08:46,113 = handlers.result_handler.AirtimeHandler - DEBUG - 9d366fa4a81b4c1aa2ad4674d06befd7
2017-03-22 14:08:46,113 = handlers.result_handler.AirtimeHandler - DEBUG - 9d366fa4a81b4c1aa2ad4674d06befd7
DEBUG:handlers.result_handler.AirtimeHandler:9d366fa4a81b4c1aa2ad4674d06befd7
2017-03-22 14:08:46,113 = handlers.result_handler.AirtimeHandler - DEBUG - R170322.1405.140041
2017-03-22 14:08:46,113 = handlers.result_handler.AirtimeHandler - DEBUG - R170322.1405.140041
DEBUG:handlers.result_handler.AirtimeHandler:R170322.1405.140041
2017-03-22 14:08:46,114 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'22/03/17 14:05:47', 'amount': '5', 'external_ref': u'R170322.1405.140041', 'msisdn_2': u'254702935200', 'internal_ref': 'KRY9GJ04FK'}
2017-03-22 14:08:46,114 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'22/03/17 14:05:47', 'amount': '5', 'external_ref': u'R170322.1405.140041', 'msisdn_2': u'254702935200', 'internal_ref': 'KRY9GJ04FK'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'22/03/17 14:05:47', 'amount': '5', 'external_ref': u'R170322.1405.140041', 'msisdn_2': u'254702935200', 'internal_ref': 'KRY9GJ04FK'}
2017-03-22 14:08:46,114 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-22 14:08:46,114 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-22 14:08:46,151 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-22 14:08:46,152 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-22 14:08:46,155 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-22 14:08:46,156 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:08:46,158 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-22 14:08:46,159 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-22 14:08:46,161 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-22 14:08:46,161 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-22 14:08:46,164 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-22 14:08:46,164 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:08:46,167 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-22 14:08:46,167 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:08:46,169 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-22 14:08:46,169 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-22 14:08:46,171 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-22 14:08:46,172 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:08:46,175 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-22 14:08:46,175 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:08:46,177 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-22 14:08:46,177 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7ffa265e28d0>
2017-03-22 14:08:46,183 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-22 14:08:46,183 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-22 14:08:46,184 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-22 14:08:46,184 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-22 14:08:46,184 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is KRY9GJ04FK
2017-03-22 14:08:46,184 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is KRY9GJ04FK
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is KRY9GJ04FK
2017-03-22 14:08:46,185 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is KRY9GJ04FK to 254702935200
2017-03-22 14:08:46,185 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is KRY9GJ04FK to 254702935200
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is KRY9GJ04FK to 254702935200
2017-03-22 14:08:46,185 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-22 14:08:46,185 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-22 14:08:46,186 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is KRY9GJ04FK to 3
2017-03-22 14:08:46,186 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is KRY9GJ04FK to 3
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is KRY9GJ04FK to 3
2017-03-22 14:08:46,186 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is KRY9GJ04FK", "user": "3", "title": "Safaricom  Airtime"}
2017-03-22 14:08:46,186 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is KRY9GJ04FK", "user": "3", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is KRY9GJ04FK", "user": "3", "title": "Safaricom  Airtime"}
2017-03-22 14:08:46,187 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-22 14:08:46,187 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-22 14:08:46,187 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 5  Safaricom Airtime. Your transaction number is KRY9GJ04FK
2017-03-22 14:08:46,187 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 5  Safaricom Airtime. Your transaction number is KRY9GJ04FK
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 5  Safaricom Airtime. Your transaction number is KRY9GJ04FK
2017-03-22 14:08:47,540 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":76,"user":3,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is KRY9GJ04FK","image_url":"","date":"2017-03-22T14:05:49.445933Z"}
2017-03-22 14:08:47,540 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":76,"user":3,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is KRY9GJ04FK","image_url":"","date":"2017-03-22T14:05:49.445933Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":76,"user":3,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is KRY9GJ04FK","image_url":"","date":"2017-03-22T14:05:49.445933Z"}
2017-03-22 14:08:47,542 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-22 14:08:47,542 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-22 14:08:47,542 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":76,"user":3,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is KRY9GJ04FK","image_url":"","date":"2017-03-22T14:05:49.445933Z"}
2017-03-22 14:08:47,542 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":76,"user":3,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is KRY9GJ04FK","image_url":"","date":"2017-03-22T14:05:49.445933Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":76,"user":3,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is KRY9GJ04FK","image_url":"","date":"2017-03-22T14:05:49.445933Z"}
2017-03-22 14:08:47,543 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-22 14:08:47,543 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-22 14:08:47,544 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-22 14:08:47,544 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-22 14:08:47,544 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-22 14:08:47,544 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-22 14:08:47,545 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-22 14:08:47,545 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-22 14:08:47,546 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 3, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-22 14:08:47,546 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 3, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 3, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-22 14:08:47,547 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-22 14:08:47,547 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-22 14:08:48,587 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 14:08:48,587 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-22 14:08:48,588 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":56,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-22 14:08:48,588 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":56,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":56,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-22 14:08:48,588 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:08:48,588 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:08:48,589 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-22 14:08:48,589 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-22 14:08:48,590 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3326.45ms
2017-03-22 14:08:48,590 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3326.45ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3326.45ms
2017-03-22 14:09:31,742 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-22 14:09:31,743 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-22 14:09:31,743 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 14:09:31
2017-03-22 14:09:31,743 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-22 14:09:31,744 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-22 14:09:31,744 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 45bce2f9f42c4c67b790a06fbe458af7
2017-03-22 14:09:31,744 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-22 14:09:31,745 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-22 14:09:31,745 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:09:31</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>45bce2f9f42c4c67b790a06fbe458af7</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:09:31,746 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-22 14:09:31,746 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 22/03/2017 14:09:31
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 45bce2f9f42c4c67b790a06fbe458af7
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:09:31</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>45bce2f9f42c4c67b790a06fbe458af7</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-22 14:09:31,742 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-22 14:09:31,743 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-22 14:09:31,743 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 14:09:31
2017-03-22 14:09:31,743 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-22 14:09:31,744 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-22 14:09:31,744 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 45bce2f9f42c4c67b790a06fbe458af7
2017-03-22 14:09:31,744 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-22 14:09:31,745 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-22 14:09:31,745 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:09:31</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>45bce2f9f42c4c67b790a06fbe458af7</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:09:31,746 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-22 14:09:31,746 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-22 14:09:31,746 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:09:31</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>45bce2f9f42c4c67b790a06fbe458af7</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:09:31,747 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:09:31</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>45bce2f9f42c4c67b790a06fbe458af7</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-22 14:09:31,746 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:09:31</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>45bce2f9f42c4c67b790a06fbe458af7</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:09:31,747 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-22 14:09:32,562 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-22 14:09:32,562 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-22 14:09:32,563 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:06:34</ns0:DATE><ns0:EXTREFNUM>45bce2f9f42c4c67b790a06fbe458af7</ns0:EXTREFNUM><ns0:TXNID>R170322.1406.140035</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 165</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 14:09:32,563 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:06:34</ns0:DATE><ns0:EXTREFNUM>45bce2f9f42c4c67b790a06fbe458af7</ns0:EXTREFNUM><ns0:TXNID>R170322.1406.140035</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 165</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:06:34</ns0:DATE><ns0:EXTREFNUM>45bce2f9f42c4c67b790a06fbe458af7</ns0:EXTREFNUM><ns0:TXNID>R170322.1406.140035</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 165</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 14:09:32,563 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-22 14:09:32,563 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-22 14:09:32,564 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-22 14:09:32,564 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
2017-03-22 14:09:32,565 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-22 14:09:32,565 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-22 14:09:32,565 = handlers.result_handler.AirtimeHandler - DEBUG - 22/03/17 14:06:34
2017-03-22 14:09:32,565 = handlers.result_handler.AirtimeHandler - DEBUG - 22/03/17 14:06:34
DEBUG:handlers.result_handler.AirtimeHandler:22/03/17 14:06:34
2017-03-22 14:09:32,566 = handlers.result_handler.AirtimeHandler - DEBUG - 45bce2f9f42c4c67b790a06fbe458af7
2017-03-22 14:09:32,566 = handlers.result_handler.AirtimeHandler - DEBUG - 45bce2f9f42c4c67b790a06fbe458af7
DEBUG:handlers.result_handler.AirtimeHandler:45bce2f9f42c4c67b790a06fbe458af7
2017-03-22 14:09:32,566 = handlers.result_handler.AirtimeHandler - DEBUG - R170322.1406.140035
2017-03-22 14:09:32,566 = handlers.result_handler.AirtimeHandler - DEBUG - R170322.1406.140035
DEBUG:handlers.result_handler.AirtimeHandler:R170322.1406.140035
2017-03-22 14:09:32,567 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'22/03/17 14:06:34', 'amount': '10', 'external_ref': u'R170322.1406.140035', 'msisdn_2': u'254721799582', 'internal_ref': 'D9NEC6TU8X'}
2017-03-22 14:09:32,567 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'22/03/17 14:06:34', 'amount': '10', 'external_ref': u'R170322.1406.140035', 'msisdn_2': u'254721799582', 'internal_ref': 'D9NEC6TU8X'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'22/03/17 14:06:34', 'amount': '10', 'external_ref': u'R170322.1406.140035', 'msisdn_2': u'254721799582', 'internal_ref': 'D9NEC6TU8X'}
2017-03-22 14:09:32,567 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-22 14:09:32,567 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-22 14:09:32,614 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-22 14:09:32,614 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-22 14:09:32,619 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-22 14:09:32,620 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:09:32,626 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-22 14:09:32,627 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-22 14:09:32,630 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-22 14:09:32,630 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-22 14:09:32,635 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-22 14:09:32,636 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:09:32,639 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-22 14:09:32,639 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:09:32,641 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-22 14:09:32,642 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-22 14:09:32,645 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-22 14:09:32,645 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:09:32,652 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-22 14:09:32,653 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:09:32,659 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-22 14:09:32,660 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7ffa2ab44fd0>
2017-03-22 14:09:32,668 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-22 14:09:32,668 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-22 14:09:32,669 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-22 14:09:32,669 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-22 14:09:32,670 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is D9NEC6TU8X
2017-03-22 14:09:32,670 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is D9NEC6TU8X
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is D9NEC6TU8X
2017-03-22 14:09:32,671 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is D9NEC6TU8X to 254721799582
2017-03-22 14:09:32,671 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is D9NEC6TU8X to 254721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is D9NEC6TU8X to 254721799582
2017-03-22 14:09:32,671 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-22 14:09:32,671 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-22 14:09:32,672 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is D9NEC6TU8X to 3
2017-03-22 14:09:32,672 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is D9NEC6TU8X to 3
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is D9NEC6TU8X to 3
2017-03-22 14:09:32,673 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is D9NEC6TU8X", "user": "3", "title": "Safaricom  Airtime"}
2017-03-22 14:09:32,673 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is D9NEC6TU8X", "user": "3", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is D9NEC6TU8X", "user": "3", "title": "Safaricom  Airtime"}
2017-03-22 14:09:32,674 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-22 14:09:32,674 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-22 14:09:32,674 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 10  Safaricom Airtime. Your transaction number is D9NEC6TU8X
2017-03-22 14:09:32,674 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 10  Safaricom Airtime. Your transaction number is D9NEC6TU8X
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 10  Safaricom Airtime. Your transaction number is D9NEC6TU8X
2017-03-22 14:09:33,639 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":77,"user":3,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is D9NEC6TU8X","image_url":"","date":"2017-03-22T14:06:35.541523Z"}
2017-03-22 14:09:33,639 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":77,"user":3,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is D9NEC6TU8X","image_url":"","date":"2017-03-22T14:06:35.541523Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":77,"user":3,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is D9NEC6TU8X","image_url":"","date":"2017-03-22T14:06:35.541523Z"}
2017-03-22 14:09:33,641 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-22 14:09:33,641 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-22 14:09:33,641 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":77,"user":3,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is D9NEC6TU8X","image_url":"","date":"2017-03-22T14:06:35.541523Z"}
2017-03-22 14:09:33,641 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":77,"user":3,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is D9NEC6TU8X","image_url":"","date":"2017-03-22T14:06:35.541523Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":77,"user":3,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is D9NEC6TU8X","image_url":"","date":"2017-03-22T14:06:35.541523Z"}
2017-03-22 14:09:33,642 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-22 14:09:33,642 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-22 14:09:33,643 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-22 14:09:33,643 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-22 14:09:33,643 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-22 14:09:33,643 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-22 14:09:33,644 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-22 14:09:33,644 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-22 14:09:33,645 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 3, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-22 14:09:33,645 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 3, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "721799582", "user": 3, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-22 14:09:33,646 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-22 14:09:33,646 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-22 14:09:33,707 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 14:09:33,707 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-22 14:09:33,708 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":57,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-22 14:09:33,708 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":57,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":57,"user":3,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-22 14:09:33,708 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:09:33,708 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:09:33,709 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-22 14:09:33,709 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-22 14:09:33,710 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 1968.54ms
2017-03-22 14:09:33,710 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 1968.54ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 1968.54ms
2017-03-22 14:11:44,812 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-22 14:11:44,812 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-22 14:11:44,813 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 14:11:44
2017-03-22 14:11:44,813 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-22 14:11:44,813 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-22 14:11:44,814 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 3063765283bf4607af37e5e24d098f1e
2017-03-22 14:11:44,814 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-22 14:11:44,814 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-22 14:11:44,814 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:11:44</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3063765283bf4607af37e5e24d098f1e</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:11:44,815 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-22 14:11:44,815 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-22 14:11:44,815 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:11:44</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3063765283bf4607af37e5e24d098f1e</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:11:44,815 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 22/03/2017 14:11:44
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 3063765283bf4607af37e5e24d098f1e
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:11:44</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3063765283bf4607af37e5e24d098f1e</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:11:44</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3063765283bf4607af37e5e24d098f1e</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-22 14:11:44,812 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-22 14:11:44,812 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-22 14:11:44,813 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 14:11:44
2017-03-22 14:11:44,813 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-22 14:11:44,813 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-22 14:11:44,814 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 3063765283bf4607af37e5e24d098f1e
2017-03-22 14:11:44,814 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-22 14:11:44,814 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-22 14:11:44,814 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:11:44</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3063765283bf4607af37e5e24d098f1e</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:11:44,815 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-22 14:11:44,815 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-22 14:11:44,815 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:11:44</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3063765283bf4607af37e5e24d098f1e</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:11:44,815 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-22 14:11:45,454 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-22 14:11:45,454 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-22 14:11:45,455 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:08:47</ns0:DATE><ns0:EXTREFNUM>3063765283bf4607af37e5e24d098f1e</ns0:EXTREFNUM><ns0:TXNID>R170322.1408.140049</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 14:11:45,455 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:08:47</ns0:DATE><ns0:EXTREFNUM>3063765283bf4607af37e5e24d098f1e</ns0:EXTREFNUM><ns0:TXNID>R170322.1408.140049</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:08:47</ns0:DATE><ns0:EXTREFNUM>3063765283bf4607af37e5e24d098f1e</ns0:EXTREFNUM><ns0:TXNID>R170322.1408.140049</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 14:11:45,456 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-22 14:11:45,456 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-22 14:11:45,457 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-22 14:11:45,457 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-22 14:11:45,457 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^10
2017-03-22 14:11:45,457 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^10
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^10
2017-03-22 14:11:45,458 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-22 14:11:45,458 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-22 14:11:45,459 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-22 14:11:45,459 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-22 14:11:45,459 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 8
2017-03-22 14:11:45,459 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 8
2017-03-22 14:11:45,460 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-22 14:11:45,460 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-22 14:11:45,460 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-22 14:11:45,460 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-22 14:11:45,461 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-22 14:11:45,461 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-22 14:11:45,504 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":78,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-22T14:08:47.406608Z"}
2017-03-22 14:11:45,504 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":78,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-22T14:08:47.406608Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":78,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-22T14:08:47.406608Z"}
2017-03-22 14:11:45,505 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-22 14:11:45,505 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-22 14:11:45,506 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-22 14:11:45,506 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-22 14:11:45,506 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-22 14:11:45,506 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-22 14:11:45,507 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "10", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-22 14:11:45,507 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "10", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "10", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-22 14:11:45,549 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 14:11:45,549 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-22 14:11:45,550 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":1170.0}
2017-03-22 14:11:45,550 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":1170.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":8,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":1170.0}
{"user":8,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":1170.0}
2017-03-22 14:11:45,551 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:11:45,551 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:11:45,552 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-22 14:11:45,552 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-22 14:11:45,552 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-22 14:11:45,552 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-22 14:11:45,553 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-22 14:11:45,553 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-22 14:11:45,553 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 2, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-22 14:11:45,553 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 2, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 2, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-22 14:11:45,554 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-22 14:11:45,554 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-22 14:11:45,607 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 14:11:45,607 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-22 14:11:45,608 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":58,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-22 14:11:45,608 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":58,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":58,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-22 14:11:45,609 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:11:45,609 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:11:45,610 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-22 14:11:45,610 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-22 14:11:45,611 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 799.92ms
2017-03-22 14:11:45,611 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 799.92ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 799.92ms
2017-03-22 14:12:13,876 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-22 14:12:13,877 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-22 14:12:13,877 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 14:12:13
2017-03-22 14:12:13,878 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-22 14:12:13,878 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-22 14:12:13,878 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = caa9b5a12209443c8c935d67f7756a94
2017-03-22 14:12:13,879 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-22 14:12:13,879 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-22 14:12:13,880 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:12:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>caa9b5a12209443c8c935d67f7756a94</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:12:13,880 = handlers.result_handler.AirtimeHandler - INFO - Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 22/03/2017 14:12:13
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = caa9b5a12209443c8c935d67f7756a94
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:12:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>caa9b5a12209443c8c935d67f7756a94</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:12:13,876 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-22 14:12:13,877 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-22 14:12:13,877 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 14:12:13
2017-03-22 14:12:13,878 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-22 14:12:13,878 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-22 14:12:13,878 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = caa9b5a12209443c8c935d67f7756a94
2017-03-22 14:12:13,879 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-22 14:12:13,879 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-22 14:12:13,880 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:12:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>caa9b5a12209443c8c935d67f7756a94</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:12:13,880 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-22 14:12:13,881 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-22 14:12:13,881 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-22 14:12:13,881 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:12:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>caa9b5a12209443c8c935d67f7756a94</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:12:13,881 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:12:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>caa9b5a12209443c8c935d67f7756a94</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:12:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>caa9b5a12209443c8c935d67f7756a94</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:12:13,881 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-22 14:12:13,881 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-22 14:12:14,480 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-22 14:12:14,480 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-22 14:12:14,480 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:09:16</ns0:DATE><ns0:EXTREFNUM>caa9b5a12209443c8c935d67f7756a94</ns0:EXTREFNUM><ns0:TXNID>R170322.1409.140014</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 14:12:14,480 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:09:16</ns0:DATE><ns0:EXTREFNUM>caa9b5a12209443c8c935d67f7756a94</ns0:EXTREFNUM><ns0:TXNID>R170322.1409.140014</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:09:16</ns0:DATE><ns0:EXTREFNUM>caa9b5a12209443c8c935d67f7756a94</ns0:EXTREFNUM><ns0:TXNID>R170322.1409.140014</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 14:12:14,481 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-22 14:12:14,481 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-22 14:12:14,481 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-22 14:12:14,481 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-22 14:12:14,481 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^10
2017-03-22 14:12:14,481 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^10
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^10
2017-03-22 14:12:14,482 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-22 14:12:14,482 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-22 14:12:14,482 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-22 14:12:14,482 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-22 14:12:14,482 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 8
2017-03-22 14:12:14,482 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 8
2017-03-22 14:12:14,482 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-22 14:12:14,482 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-22 14:12:14,483 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-22 14:12:14,483 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-22 14:12:14,483 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-22 14:12:14,483 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-22 14:12:14,537 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":79,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-22T14:09:16.434801Z"}
2017-03-22 14:12:14,537 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":79,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-22T14:09:16.434801Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":79,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-22T14:09:16.434801Z"}
2017-03-22 14:12:14,538 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-22 14:12:14,538 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-22 14:12:14,538 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-22 14:12:14,538 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-22 14:12:14,538 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-22 14:12:14,538 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-22 14:12:14,539 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "10", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-22 14:12:14,539 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "10", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "10", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-22 14:12:14,585 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 14:12:14,585 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-22 14:12:14,586 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":1180.0}
2017-03-22 14:12:14,586 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":1180.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":8,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":1180.0}
{"user":8,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":1180.0}
2017-03-22 14:12:14,586 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:12:14,586 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:12:14,587 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-22 14:12:14,587 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-22 14:12:14,589 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-22 14:12:14,589 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-22 14:12:14,591 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-22 14:12:14,591 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-22 14:12:14,593 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 2, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-22 14:12:14,593 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 2, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 2, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-22 14:12:14,593 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-22 14:12:14,593 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-22 14:12:14,649 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 14:12:14,649 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-22 14:12:14,650 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":59,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-22 14:12:14,650 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":59,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":59,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-22 14:12:14,651 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:12:14,651 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:12:14,651 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-22 14:12:14,651 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-22 14:12:14,653 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 777.10ms
2017-03-22 14:12:14,653 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 777.10ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 777.10ms
2017-03-22 14:15:37,545 = __main__ - INFO - Creating server
2017-03-22 14:15:37,545 = __main__ - INFO - Creating server
2017-03-22 14:15:37,550 = __main__ - INFO - Created server
2017-03-22 14:15:37,550 = __main__ - INFO - Created server
2017-03-22 14:15:37,550 = __main__ - INFO - Listening on port 8080
2017-03-22 14:15:37,550 = __main__ - INFO - Listening on port 8080
2017-03-22 14:15:37,551 = __main__ - INFO - Starting event loop
2017-03-22 14:15:37,551 = __main__ - INFO - Starting event loop
2017-03-22 14:16:36,837 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-22 14:16:36,837 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-22 14:16:36,838 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-22 14:16:36,838 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-22 14:16:36,838 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 14:16:36
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-22 14:16:36,838 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 14:16:36
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 22/03/2017 14:16:36
2017-03-22 14:16:36,838 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-22 14:16:36,838 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-22 14:16:36,838 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-22 14:16:36,838 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-22 14:16:36,839 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = f96f8004ba524b5bbe000d398fee05db
2017-03-22 14:16:36,839 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = f96f8004ba524b5bbe000d398fee05db
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = f96f8004ba524b5bbe000d398fee05db
2017-03-22 14:16:36,839 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-22 14:16:36,839 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-22 14:16:36,839 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-22 14:16:36,839 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-22 14:16:36,840 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:16:36</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f96f8004ba524b5bbe000d398fee05db</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:16:36,840 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:16:36</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f96f8004ba524b5bbe000d398fee05db</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:16:36</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f96f8004ba524b5bbe000d398fee05db</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:16:36,840 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-22 14:16:36,840 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-22 14:16:36,840 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-22 14:16:36,840 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-22 14:16:36,840 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:16:36</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f96f8004ba524b5bbe000d398fee05db</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:16:36,840 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:16:36</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f96f8004ba524b5bbe000d398fee05db</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:16:36</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f96f8004ba524b5bbe000d398fee05db</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:16:36,841 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-22 14:16:36,841 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-22 14:16:37,697 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-22 14:16:37,697 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-22 14:16:37,698 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:13:39</ns0:DATE><ns0:EXTREFNUM>f96f8004ba524b5bbe000d398fee05db</ns0:EXTREFNUM><ns0:TXNID>R170322.1413.140036</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 155</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 14:16:37,698 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:13:39</ns0:DATE><ns0:EXTREFNUM>f96f8004ba524b5bbe000d398fee05db</ns0:EXTREFNUM><ns0:TXNID>R170322.1413.140036</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 155</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:13:39</ns0:DATE><ns0:EXTREFNUM>f96f8004ba524b5bbe000d398fee05db</ns0:EXTREFNUM><ns0:TXNID>R170322.1413.140036</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 155</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 14:16:37,698 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-22 14:16:37,698 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-22 14:16:37,698 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-22 14:16:37,698 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
2017-03-22 14:16:37,699 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-22 14:16:37,699 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-22 14:16:37,699 = handlers.result_handler.AirtimeHandler - DEBUG - 22/03/17 14:13:39
2017-03-22 14:16:37,699 = handlers.result_handler.AirtimeHandler - DEBUG - 22/03/17 14:13:39
DEBUG:handlers.result_handler.AirtimeHandler:22/03/17 14:13:39
2017-03-22 14:16:37,699 = handlers.result_handler.AirtimeHandler - DEBUG - f96f8004ba524b5bbe000d398fee05db
2017-03-22 14:16:37,699 = handlers.result_handler.AirtimeHandler - DEBUG - f96f8004ba524b5bbe000d398fee05db
DEBUG:handlers.result_handler.AirtimeHandler:f96f8004ba524b5bbe000d398fee05db
2017-03-22 14:16:37,700 = handlers.result_handler.AirtimeHandler - DEBUG - R170322.1413.140036
2017-03-22 14:16:37,700 = handlers.result_handler.AirtimeHandler - DEBUG - R170322.1413.140036
DEBUG:handlers.result_handler.AirtimeHandler:R170322.1413.140036
2017-03-22 14:16:37,700 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'22/03/17 14:13:39', 'amount': '10', 'external_ref': u'R170322.1413.140036', 'msisdn_2': u'254721799582', 'internal_ref': 'G10B4L0A6W'}
2017-03-22 14:16:37,700 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'22/03/17 14:13:39', 'amount': '10', 'external_ref': u'R170322.1413.140036', 'msisdn_2': u'254721799582', 'internal_ref': 'G10B4L0A6W'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'22/03/17 14:13:39', 'amount': '10', 'external_ref': u'R170322.1413.140036', 'msisdn_2': u'254721799582', 'internal_ref': 'G10B4L0A6W'}
2017-03-22 14:16:37,700 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-22 14:16:37,700 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-22 14:16:37,812 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-22 14:16:37,812 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-22 14:16:37,816 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-22 14:16:37,816 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:16:37,819 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-22 14:16:37,819 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-22 14:16:37,822 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-22 14:16:37,822 INFO sqlalchemy.engine.base.Engine {}
2017-03-22 14:16:37,828 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-22 14:16:37,828 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:16:37,831 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-22 14:16:37,831 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:16:37,836 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-22 14:16:37,837 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-22 14:16:37,839 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:16:37,840 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-22 14:16:37,844 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:16:37,844 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-22 14:16:37,846 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-22 14:16:37,846 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:16:37,852 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f0a35c19ed0>
2017-03-22 14:16:37,852 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-22 14:16:37,853 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-22 14:16:37,853 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-22 14:16:37,853 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is G10B4L0A6W
2017-03-22 14:16:37,853 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is G10B4L0A6W
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is G10B4L0A6W
2017-03-22 14:16:37,854 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is G10B4L0A6W to 254721799582
2017-03-22 14:16:37,854 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is G10B4L0A6W to 254721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is G10B4L0A6W to 254721799582
2017-03-22 14:16:37,854 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-22 14:16:37,854 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-22 14:16:37,855 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is G10B4L0A6W to 8
2017-03-22 14:16:37,855 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is G10B4L0A6W to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is G10B4L0A6W to 8
2017-03-22 14:16:37,856 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is G10B4L0A6W", "user": "8", "title": "Safaricom  Airtime"}
2017-03-22 14:16:37,856 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is G10B4L0A6W", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is G10B4L0A6W", "user": "8", "title": "Safaricom  Airtime"}
2017-03-22 14:16:37,856 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-22 14:16:37,856 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-22 14:16:37,857 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 10  Safaricom Airtime. Your transaction number is G10B4L0A6W
2017-03-22 14:16:37,857 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 10  Safaricom Airtime. Your transaction number is G10B4L0A6W
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 10  Safaricom Airtime. Your transaction number is G10B4L0A6W
2017-03-22 14:16:38,956 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":80,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is G10B4L0A6W","image_url":"","date":"2017-03-22T14:13:40.848405Z"}
2017-03-22 14:16:38,956 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":80,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is G10B4L0A6W","image_url":"","date":"2017-03-22T14:13:40.848405Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":80,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is G10B4L0A6W","image_url":"","date":"2017-03-22T14:13:40.848405Z"}
2017-03-22 14:16:38,957 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-22 14:16:38,957 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-22 14:16:38,958 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":80,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is G10B4L0A6W","image_url":"","date":"2017-03-22T14:13:40.848405Z"}
2017-03-22 14:16:38,958 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":80,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is G10B4L0A6W","image_url":"","date":"2017-03-22T14:13:40.848405Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":80,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is G10B4L0A6W","image_url":"","date":"2017-03-22T14:13:40.848405Z"}
2017-03-22 14:16:38,958 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-22 14:16:38,958 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-22 14:16:38,959 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-22 14:16:38,959 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-22 14:16:38,959 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-22 14:16:38,959 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-22 14:16:38,959 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-22 14:16:38,959 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-22 14:16:38,960 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-22 14:16:38,960 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-22 14:16:38,960 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-22 14:16:38,960 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-22 14:16:40,170 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 14:16:40,170 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-22 14:16:40,171 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":60,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-22 14:16:40,171 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":60,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":60,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-22 14:16:40,172 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:16:40,172 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:16:40,172 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-22 14:16:40,172 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-22 14:16:40,173 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3337.23ms
2017-03-22 14:16:40,173 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3337.23ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3337.23ms
2017-03-22 14:17:25,103 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-22 14:17:25,104 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-22 14:17:25,103 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-22 14:17:25,104 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-22 14:17:25,104 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 14:17:25
2017-03-22 14:17:25,104 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 14:17:25
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 22/03/2017 14:17:25
2017-03-22 14:17:25,105 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-22 14:17:25,105 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-22 14:17:25,105 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-22 14:17:25,105 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-22 14:17:25,106 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 2298c06a77354febbb6f07122785a8e2
2017-03-22 14:17:25,106 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 2298c06a77354febbb6f07122785a8e2
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 2298c06a77354febbb6f07122785a8e2
2017-03-22 14:17:25,106 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-22 14:17:25,106 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-22 14:17:25,107 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-22 14:17:25,107 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-22 14:17:25,107 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:17:25</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2298c06a77354febbb6f07122785a8e2</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:17:25,107 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:17:25</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2298c06a77354febbb6f07122785a8e2</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:17:25,107 = handlers.result_handler.AirtimeHandler - INFO - Built XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:17:25</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2298c06a77354febbb6f07122785a8e2</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:17:25,107 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-22 14:17:25,108 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-22 14:17:25,108 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-22 14:17:25,108 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:17:25</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2298c06a77354febbb6f07122785a8e2</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:17:25,108 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:17:25</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2298c06a77354febbb6f07122785a8e2</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:17:25</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2298c06a77354febbb6f07122785a8e2</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:17:25,108 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-22 14:17:25,108 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-22 14:17:25,698 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-22 14:17:25,698 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:14:27</ns0:DATE><ns0:EXTREFNUM>2298c06a77354febbb6f07122785a8e2</ns0:EXTREFNUM><ns0:TXNID>R170322.1414.140026</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 14:17:25,699 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-22 14:17:25,699 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-22 14:17:25,700 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^10
2017-03-22 14:17:25,700 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-22 14:17:25,700 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-22 14:17:25,700 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 8
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:14:27</ns0:DATE><ns0:EXTREFNUM>2298c06a77354febbb6f07122785a8e2</ns0:EXTREFNUM><ns0:TXNID>R170322.1414.140026</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^10
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-22 14:17:25,701 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-22 14:17:25,698 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-22 14:17:25,698 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:14:27</ns0:DATE><ns0:EXTREFNUM>2298c06a77354febbb6f07122785a8e2</ns0:EXTREFNUM><ns0:TXNID>R170322.1414.140026</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 14:17:25,699 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-22 14:17:25,699 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-22 14:17:25,700 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^10
2017-03-22 14:17:25,700 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-22 14:17:25,700 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-22 14:17:25,700 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 8
2017-03-22 14:17:25,701 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-22 14:17:25,701 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 8
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-22 14:17:25,702 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-22 14:17:25,701 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-22 14:17:25,702 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-22 14:17:26,806 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":81,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-22T14:14:28.696969Z"}
2017-03-22 14:17:26,806 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":81,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-22T14:14:28.696969Z"}
2017-03-22 14:17:26,807 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-22 14:17:26,807 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:{"id":81,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-22T14:14:28.696969Z"}
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-22 14:17:26,807 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-22 14:17:26,807 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-22 14:17:26,807 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-22 14:17:26,808 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "10", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-22 14:17:26,807 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-22 14:17:26,808 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "10", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "10", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-22 14:17:26,855 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 14:17:26,856 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":1190.0}
2017-03-22 14:17:26,856 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:17:26,855 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 14:17:26,856 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":1190.0}
2017-03-22 14:17:26,856 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"user":8,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":1190.0}
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
{"user":8,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":1190.0}
2017-03-22 14:17:26,856 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:17:26,856 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-22 14:17:26,856 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-22 14:17:26,856 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-22 14:17:26,857 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-22 14:17:26,857 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 2, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-22 14:17:26,857 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-22 14:17:26,857 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 2, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-22 14:17:26,857 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-22 14:17:26,857 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 2, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-22 14:17:26,907 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 14:17:26,907 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":61,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-22 14:17:26,907 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 14:17:26,908 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"id":61,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:17:26,907 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":61,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-22 14:17:26,908 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:17:26,908 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-22 14:17:26,908 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-22 14:17:26,909 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 1806.06ms
2017-03-22 14:17:26,909 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 1806.06ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 1806.06ms
2017-03-22 14:23:29,252 = __main__ - INFO - Creating server
2017-03-22 14:23:29,252 = __main__ - INFO - Creating server
2017-03-22 14:23:29,256 = __main__ - INFO - Created server
2017-03-22 14:23:29,256 = __main__ - INFO - Created server
2017-03-22 14:23:29,257 = __main__ - INFO - Listening on port 8080
2017-03-22 14:23:29,257 = __main__ - INFO - Listening on port 8080
2017-03-22 14:23:29,258 = __main__ - INFO - Starting event loop
2017-03-22 14:23:29,258 = __main__ - INFO - Starting event loop
2017-03-22 14:25:46,700 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-22 14:25:46,700 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-22 14:25:46,701 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-22 14:25:46,701 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-22 14:25:46,701 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 14:25:46
2017-03-22 14:25:46,701 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 14:25:46
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 22/03/2017 14:25:46
2017-03-22 14:25:46,701 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-22 14:25:46,701 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-22 14:25:46,702 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-22 14:25:46,702 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 3306fbcad6fa46eca5b5e00266c354c3
2017-03-22 14:25:46,702 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-22 14:25:46,702 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 3306fbcad6fa46eca5b5e00266c354c3
2017-03-22 14:25:46,703 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 3306fbcad6fa46eca5b5e00266c354c3
2017-03-22 14:25:46,703 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-22 14:25:46,703 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-22 14:25:46,703 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-22 14:25:46,703 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:25:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3306fbcad6fa46eca5b5e00266c354c3</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-22 14:25:46,703 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:25:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3306fbcad6fa46eca5b5e00266c354c3</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:25:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3306fbcad6fa46eca5b5e00266c354c3</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:25:46,704 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-22 14:25:46,704 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-22 14:25:46,704 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-22 14:25:46,704 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-22 14:25:46,704 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:25:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3306fbcad6fa46eca5b5e00266c354c3</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-22 14:25:46,704 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:25:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3306fbcad6fa46eca5b5e00266c354c3</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:25:46,705 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:25:46</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>3306fbcad6fa46eca5b5e00266c354c3</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:25:46,705 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-22 14:25:47,567 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-22 14:25:47,567 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-22 14:25:47,567 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:22:49</ns0:DATE><ns0:EXTREFNUM>3306fbcad6fa46eca5b5e00266c354c3</ns0:EXTREFNUM><ns0:TXNID>R170322.1422.140046</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 145</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-22 14:25:47,567 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:22:49</ns0:DATE><ns0:EXTREFNUM>3306fbcad6fa46eca5b5e00266c354c3</ns0:EXTREFNUM><ns0:TXNID>R170322.1422.140046</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 145</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 14:25:47,568 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:22:49</ns0:DATE><ns0:EXTREFNUM>3306fbcad6fa46eca5b5e00266c354c3</ns0:EXTREFNUM><ns0:TXNID>R170322.1422.140046</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 145</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-22 14:25:47,568 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-22 14:25:47,568 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-22 14:25:47,568 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
2017-03-22 14:25:47,569 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-22 14:25:47,569 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-22 14:25:47,569 = handlers.result_handler.AirtimeHandler - DEBUG - 22/03/17 14:22:49
2017-03-22 14:25:47,569 = handlers.result_handler.AirtimeHandler - DEBUG - 22/03/17 14:22:49
DEBUG:handlers.result_handler.AirtimeHandler:22/03/17 14:22:49
2017-03-22 14:25:47,570 = handlers.result_handler.AirtimeHandler - DEBUG - 3306fbcad6fa46eca5b5e00266c354c3
2017-03-22 14:25:47,570 = handlers.result_handler.AirtimeHandler - DEBUG - 3306fbcad6fa46eca5b5e00266c354c3
DEBUG:handlers.result_handler.AirtimeHandler:3306fbcad6fa46eca5b5e00266c354c3
2017-03-22 14:25:47,570 = handlers.result_handler.AirtimeHandler - DEBUG - R170322.1422.140046
2017-03-22 14:25:47,570 = handlers.result_handler.AirtimeHandler - DEBUG - R170322.1422.140046
DEBUG:handlers.result_handler.AirtimeHandler:R170322.1422.140046
2017-03-22 14:25:47,570 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'22/03/17 14:22:49', 'amount': '10', 'external_ref': u'R170322.1422.140046', 'msisdn_2': u'254721799582', 'internal_ref': '2SN0HLPR1E'}
2017-03-22 14:25:47,570 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'22/03/17 14:22:49', 'amount': '10', 'external_ref': u'R170322.1422.140046', 'msisdn_2': u'254721799582', 'internal_ref': '2SN0HLPR1E'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'22/03/17 14:22:49', 'amount': '10', 'external_ref': u'R170322.1422.140046', 'msisdn_2': u'254721799582', 'internal_ref': '2SN0HLPR1E'}
2017-03-22 14:25:47,570 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-22 14:25:47,570 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-22 14:25:47,687 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-22 14:25:47,688 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-22 14:25:47,692 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:25:47,693 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-22 14:25:47,697 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-22 14:25:47,698 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-22 14:25:47,700 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-22 14:25:47,701 INFO sqlalchemy.engine.base.Engine {}
2017-03-22 14:25:47,706 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:25:47,706 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-22 14:25:47,709 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:25:47,709 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-22 14:25:47,712 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-22 14:25:47,713 INFO sqlalchemy.engine.base.Engine {'table': 23559}
2017-03-22 14:25:47,715 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:25:47,715 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-22 14:25:47,720 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-22 14:25:47,720 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:25:47,722 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:25:47,722 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-22 14:25:47,727 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7fbcecb44ed0>
2017-03-22 14:25:47,727 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-22 14:25:47,728 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-22 14:25:47,728 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is 2SN0HLPR1E
2017-03-22 14:25:47,728 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-22 14:25:47,728 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is 2SN0HLPR1E
2017-03-22 14:25:47,728 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is 2SN0HLPR1E to 254721799582
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is 2SN0HLPR1E
2017-03-22 14:25:47,728 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is 2SN0HLPR1E to 254721799582
2017-03-22 14:25:47,729 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is 2SN0HLPR1E to 254721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-22 14:25:47,729 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is 2SN0HLPR1E to 8
2017-03-22 14:25:47,729 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-22 14:25:47,729 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is 2SN0HLPR1E to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is 2SN0HLPR1E to 8
2017-03-22 14:25:47,729 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is 2SN0HLPR1E", "user": "8", "title": "Safaricom  Airtime"}
2017-03-22 14:25:47,729 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is 2SN0HLPR1E", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is 2SN0HLPR1E", "user": "8", "title": "Safaricom  Airtime"}
2017-03-22 14:25:47,729 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-22 14:25:47,729 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-22 14:25:47,730 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 10  Safaricom Airtime. Your transaction number is 2SN0HLPR1E
2017-03-22 14:25:47,730 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 10  Safaricom Airtime. Your transaction number is 2SN0HLPR1E
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 10  Safaricom Airtime. Your transaction number is 2SN0HLPR1E
2017-03-22 14:25:49,046 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":82,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is 2SN0HLPR1E","image_url":"","date":"2017-03-22T14:22:50.922273Z"}
2017-03-22 14:25:49,046 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":82,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is 2SN0HLPR1E","image_url":"","date":"2017-03-22T14:22:50.922273Z"}
2017-03-22 14:25:49,047 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-22 14:25:49,047 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":82,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is 2SN0HLPR1E","image_url":"","date":"2017-03-22T14:22:50.922273Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":82,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is 2SN0HLPR1E","image_url":"","date":"2017-03-22T14:22:50.922273Z"}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-22 14:25:49,047 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-22 14:25:49,047 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-22 14:25:49,047 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":82,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is 2SN0HLPR1E","image_url":"","date":"2017-03-22T14:22:50.922273Z"}
2017-03-22 14:25:49,047 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-22 14:25:49,048 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-22 14:25:49,048 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-22 14:25:49,048 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:{"id":82,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is 2SN0HLPR1E","image_url":"","date":"2017-03-22T14:22:50.922273Z"}
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-22 14:25:49,048 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-22 14:25:49,048 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-22 14:25:49,048 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-22 14:25:49,048 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-22 14:25:49,048 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-22 14:25:49,048 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-22 14:25:49,048 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-22 14:25:50,205 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 14:25:50,205 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-22 14:25:50,208 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":62,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-22 14:25:50,208 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":62,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":62,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-22 14:25:50,211 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:25:50,211 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:25:50,211 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-22 14:25:50,211 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-22 14:25:50,212 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 319, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-22 14:25:50,212 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 319, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 319, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-22 14:25:50,218 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-22 14:25:50,218 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-22 14:25:50,219 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3520.33ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3520.33ms
2017-03-22 14:25:50,219 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3520.33ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-22 14:30:28,978 = __main__ - INFO - Creating server
2017-03-22 14:30:28,978 = __main__ - INFO - Creating server
2017-03-22 14:30:28,985 = __main__ - INFO - Created server
2017-03-22 14:30:28,985 = __main__ - INFO - Created server
2017-03-22 14:30:28,985 = __main__ - INFO - Listening on port 8080
2017-03-22 14:30:28,985 = __main__ - INFO - Listening on port 8080
2017-03-22 14:30:28,987 = __main__ - INFO - Starting event loop
2017-03-22 14:30:28,987 = __main__ - INFO - Starting event loop
2017-03-22 14:31:38,155 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-22 14:31:38,155 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-22 14:31:38,155 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-22 14:31:38,156 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 14:31:38
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-22 14:31:38,155 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-22 14:31:38,156 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 14:31:38
2017-03-22 14:31:38,156 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 22/03/2017 14:31:38
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-22 14:31:38,156 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-22 14:31:38,156 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-22 14:31:38,156 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-22 14:31:38,156 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = bf5e508bbe154472aadbca6d68780da3
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = bf5e508bbe154472aadbca6d68780da3
2017-03-22 14:31:38,157 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-22 14:31:38,156 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = bf5e508bbe154472aadbca6d68780da3
2017-03-22 14:31:38,157 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-22 14:31:38,157 = handlers.result_handler.AirtimeHandler - DEBUG - -------------------------------------------------------++++++++++++++
2017-03-22 14:31:38,157 = handlers.result_handler.AirtimeHandler - DEBUG - -------------------------------------------------------++++++++++++++
2017-03-22 14:31:38,157 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:-------------------------------------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-22 14:31:38,157 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-22 14:31:38,157 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-22 14:31:38,157 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-22 14:31:38,157 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:31:38</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>bf5e508bbe154472aadbca6d68780da3</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-22 14:31:38,158 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-22 14:31:38,157 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:31:38</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>bf5e508bbe154472aadbca6d68780da3</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:31:38,158 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-22 14:31:38,158 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:31:38</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>bf5e508bbe154472aadbca6d68780da3</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-22 14:31:38,158 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:31:38</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>bf5e508bbe154472aadbca6d68780da3</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:31:38,158 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-22 14:31:38,158 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:31:38</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>bf5e508bbe154472aadbca6d68780da3</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:31:38,158 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:31:38</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>bf5e508bbe154472aadbca6d68780da3</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-22 14:31:38,158 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-22 14:31:39,040 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-22 14:31:39,040 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-22 14:31:39,040 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:28:40</ns0:DATE><ns0:EXTREFNUM>bf5e508bbe154472aadbca6d68780da3</ns0:EXTREFNUM><ns0:TXNID>R170322.1428.140036</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 721799582 is successful. Your new balance is KSH 140</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-22 14:31:39,040 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:28:40</ns0:DATE><ns0:EXTREFNUM>bf5e508bbe154472aadbca6d68780da3</ns0:EXTREFNUM><ns0:TXNID>R170322.1428.140036</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 721799582 is successful. Your new balance is KSH 140</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 14:31:39,041 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-22 14:31:39,041 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:28:40</ns0:DATE><ns0:EXTREFNUM>bf5e508bbe154472aadbca6d68780da3</ns0:EXTREFNUM><ns0:TXNID>R170322.1428.140036</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 721799582 is successful. Your new balance is KSH 140</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-22 14:31:39,041 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
2017-03-22 14:31:39,041 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------5-----------------------
2017-03-22 14:31:39,042 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-22 14:31:39,042 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-22 14:31:39,042 = handlers.result_handler.AirtimeHandler - DEBUG - 22/03/17 14:28:40
2017-03-22 14:31:39,042 = handlers.result_handler.AirtimeHandler - DEBUG - 22/03/17 14:28:40
DEBUG:handlers.result_handler.AirtimeHandler:22/03/17 14:28:40
2017-03-22 14:31:39,043 = handlers.result_handler.AirtimeHandler - DEBUG - bf5e508bbe154472aadbca6d68780da3
2017-03-22 14:31:39,043 = handlers.result_handler.AirtimeHandler - DEBUG - bf5e508bbe154472aadbca6d68780da3
DEBUG:handlers.result_handler.AirtimeHandler:bf5e508bbe154472aadbca6d68780da3
2017-03-22 14:31:39,043 = handlers.result_handler.AirtimeHandler - DEBUG - R170322.1428.140036
2017-03-22 14:31:39,043 = handlers.result_handler.AirtimeHandler - DEBUG - R170322.1428.140036
DEBUG:handlers.result_handler.AirtimeHandler:R170322.1428.140036
2017-03-22 14:31:39,044 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'22/03/17 14:28:40', 'amount': '5', 'external_ref': u'R170322.1428.140036', 'msisdn_2': u'254721799582', 'internal_ref': 'T0XY0M1EH0'}
2017-03-22 14:31:39,044 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'22/03/17 14:28:40', 'amount': '5', 'external_ref': u'R170322.1428.140036', 'msisdn_2': u'254721799582', 'internal_ref': 'T0XY0M1EH0'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'22/03/17 14:28:40', 'amount': '5', 'external_ref': u'R170322.1428.140036', 'msisdn_2': u'254721799582', 'internal_ref': 'T0XY0M1EH0'}
2017-03-22 14:31:39,044 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-22 14:31:39,044 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-22 14:31:39,144 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-22 14:31:39,145 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-22 14:31:39,148 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:31:39,148 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-22 14:31:39,153 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-22 14:31:39,153 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-22 14:31:39,155 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-22 14:31:39,155 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-22 14:31:39,162 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:31:39,162 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-22 14:31:39,165 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:31:39,165 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-22 14:31:39,169 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-22 14:31:39,169 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-22 14:31:39,171 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:31:39,171 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-22 14:31:39,175 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-22 14:31:39,175 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:31:39,176 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:31:39,176 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-22 14:31:39,183 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f35c720ced0>
2017-03-22 14:31:39,183 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-22 14:31:39,184 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-22 14:31:39,184 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is T0XY0M1EH0
2017-03-22 14:31:39,184 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-22 14:31:39,184 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is T0XY0M1EH0
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is T0XY0M1EH0
2017-03-22 14:31:39,184 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is T0XY0M1EH0 to 254721799582
2017-03-22 14:31:39,184 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is T0XY0M1EH0 to 254721799582
2017-03-22 14:31:39,184 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is T0XY0M1EH0 to 254721799582
2017-03-22 14:31:39,184 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-22 14:31:39,185 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is T0XY0M1EH0 to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-22 14:31:39,185 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is T0XY0M1EH0 to 8
2017-03-22 14:31:39,185 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is T0XY0M1EH0", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is T0XY0M1EH0 to 8
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is T0XY0M1EH0", "user": "8", "title": "Safaricom  Airtime"}
2017-03-22 14:31:39,185 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is T0XY0M1EH0", "user": "8", "title": "Safaricom  Airtime"}
2017-03-22 14:31:39,185 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-22 14:31:39,185 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-22 14:31:39,185 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 5  Safaricom Airtime. Your transaction number is T0XY0M1EH0
2017-03-22 14:31:39,185 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 5  Safaricom Airtime. Your transaction number is T0XY0M1EH0
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 5  Safaricom Airtime. Your transaction number is T0XY0M1EH0
2017-03-22 14:31:40,275 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":83,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is T0XY0M1EH0","image_url":"","date":"2017-03-22T14:28:42.139427Z"}
2017-03-22 14:31:40,275 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-22 14:31:40,275 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":83,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is T0XY0M1EH0","image_url":"","date":"2017-03-22T14:28:42.139427Z"}
2017-03-22 14:31:40,276 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":83,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is T0XY0M1EH0","image_url":"","date":"2017-03-22T14:28:42.139427Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":83,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is T0XY0M1EH0","image_url":"","date":"2017-03-22T14:28:42.139427Z"}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:{"id":83,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is T0XY0M1EH0","image_url":"","date":"2017-03-22T14:28:42.139427Z"}
2017-03-22 14:31:40,276 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-22 14:31:40,276 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-22 14:31:40,275 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-22 14:31:40,276 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":83,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is T0XY0M1EH0","image_url":"","date":"2017-03-22T14:28:42.139427Z"}
2017-03-22 14:31:40,276 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-22 14:31:40,276 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-22 14:31:40,276 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-22 14:31:40,276 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-22 14:31:40,276 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-22 14:31:40,276 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-22 14:31:40,277 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-22 14:31:40,277 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-22 14:31:40,277 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-22 14:31:40,277 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-22 14:31:41,471 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 14:31:41,471 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 14:31:41,472 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":63,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":5.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"id":63,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":5.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-22 14:31:41,472 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:31:41,472 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":63,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":5.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-22 14:31:41,472 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:31:41,472 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-22 14:31:41,472 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-22 14:31:41,473 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-22 14:31:41,473 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-22 14:31:41,480 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-22 14:31:41,480 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-22 14:31:41,481 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3326.78ms
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3326.78ms
2017-03-22 14:31:41,481 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3326.78ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-22 14:36:32,202 = __main__ - INFO - Creating server
2017-03-22 14:36:32,202 = __main__ - INFO - Creating server
2017-03-22 14:36:32,209 = __main__ - INFO - Created server
2017-03-22 14:36:32,209 = __main__ - INFO - Created server
2017-03-22 14:36:32,209 = __main__ - INFO - Listening on port 8080
2017-03-22 14:36:32,209 = __main__ - INFO - Listening on port 8080
2017-03-22 14:36:32,211 = __main__ - INFO - Starting event loop
2017-03-22 14:36:32,211 = __main__ - INFO - Starting event loop
2017-03-22 14:37:59,554 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-22 14:37:59,554 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-22 14:37:59,555 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-22 14:37:59,555 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-22 14:37:59,556 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 14:37:59
2017-03-22 14:37:59,556 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 14:37:59
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 22/03/2017 14:37:59
2017-03-22 14:37:59,556 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-22 14:37:59,556 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-22 14:37:59,557 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-22 14:37:59,557 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-22 14:37:59,557 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 9c196344d79c4869afd42a3ab3a4408c
2017-03-22 14:37:59,557 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 9c196344d79c4869afd42a3ab3a4408c
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 9c196344d79c4869afd42a3ab3a4408c
2017-03-22 14:37:59,558 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-22 14:37:59,558 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-22 14:37:59,558 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': u'x', u'amount': 10, u'account_number': None, u'mobile_number': u'254721799582', u'bundle_id': None, u'payment_method_id': 3}-----------------------------++++++++++++++
2017-03-22 14:37:59,558 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': u'x', u'amount': 10, u'account_number': None, u'mobile_number': u'254721799582', u'bundle_id': None, u'payment_method_id': 3}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': u'x', u'amount': 10, u'account_number': None, u'mobile_number': u'254721799582', u'bundle_id': None, u'payment_method_id': 3}-----------------------------++++++++++++++
2017-03-22 14:37:59,558 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-22 14:37:59,558 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-22 14:37:59,559 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-22 14:37:59,559 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-22 14:37:59,559 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:37:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9c196344d79c4869afd42a3ab3a4408c</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:37:59,559 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:37:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9c196344d79c4869afd42a3ab3a4408c</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:37:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9c196344d79c4869afd42a3ab3a4408c</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:37:59,559 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-22 14:37:59,559 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-22 14:37:59,560 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-22 14:37:59,560 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-22 14:37:59,560 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:37:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9c196344d79c4869afd42a3ab3a4408c</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:37:59,560 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:37:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9c196344d79c4869afd42a3ab3a4408c</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:37:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9c196344d79c4869afd42a3ab3a4408c</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:37:59,560 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-22 14:37:59,560 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-22 14:38:00,419 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-22 14:38:00,419 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:35:02</ns0:DATE><ns0:EXTREFNUM>9c196344d79c4869afd42a3ab3a4408c</ns0:EXTREFNUM><ns0:TXNID>R170322.1435.140004</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 130</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 14:38:00,420 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-22 14:38:00,421 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-22 14:38:00,421 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:35:02</ns0:DATE><ns0:EXTREFNUM>9c196344d79c4869afd42a3ab3a4408c</ns0:EXTREFNUM><ns0:TXNID>R170322.1435.140004</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 130</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-22 14:38:00,419 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-22 14:38:00,419 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:35:02</ns0:DATE><ns0:EXTREFNUM>9c196344d79c4869afd42a3ab3a4408c</ns0:EXTREFNUM><ns0:TXNID>R170322.1435.140004</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 130</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 14:38:00,420 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-22 14:38:00,421 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-22 14:38:00,421 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-22 14:38:00,422 = handlers.result_handler.AirtimeHandler - DEBUG - 22/03/17 14:35:02
2017-03-22 14:38:00,422 = handlers.result_handler.AirtimeHandler - DEBUG - 22/03/17 14:35:02
DEBUG:handlers.result_handler.AirtimeHandler:22/03/17 14:35:02
2017-03-22 14:38:00,424 = handlers.result_handler.AirtimeHandler - DEBUG - 9c196344d79c4869afd42a3ab3a4408c
2017-03-22 14:38:00,424 = handlers.result_handler.AirtimeHandler - DEBUG - 9c196344d79c4869afd42a3ab3a4408c
DEBUG:handlers.result_handler.AirtimeHandler:9c196344d79c4869afd42a3ab3a4408c
2017-03-22 14:38:00,424 = handlers.result_handler.AirtimeHandler - DEBUG - R170322.1435.140004
2017-03-22 14:38:00,424 = handlers.result_handler.AirtimeHandler - DEBUG - R170322.1435.140004
DEBUG:handlers.result_handler.AirtimeHandler:R170322.1435.140004
2017-03-22 14:38:00,426 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'22/03/17 14:35:02', 'amount': '10', 'external_ref': u'R170322.1435.140004', 'msisdn_2': u'254721799582', 'internal_ref': 'YICLYD8C57'}
2017-03-22 14:38:00,426 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'22/03/17 14:35:02', 'amount': '10', 'external_ref': u'R170322.1435.140004', 'msisdn_2': u'254721799582', 'internal_ref': 'YICLYD8C57'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'22/03/17 14:35:02', 'amount': '10', 'external_ref': u'R170322.1435.140004', 'msisdn_2': u'254721799582', 'internal_ref': 'YICLYD8C57'}
2017-03-22 14:38:00,426 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-22 14:38:00,426 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-22 14:38:00,579 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-22 14:38:00,579 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-22 14:38:00,583 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-22 14:38:00,583 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-22 14:38:00,587 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-22 14:38:00,587 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-22 14:38:00,590 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-22 14:38:00,590 INFO sqlalchemy.engine.base.Engine {}
2017-03-22 14:38:00,596 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:38:00,596 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-22 14:38:00,600 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:38:00,600 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-22 14:38:00,603 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-22 14:38:00,603 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-22 14:38:00,606 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:38:00,606 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-22 14:38:00,611 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-22 14:38:00,611 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-22 14:38:00,613 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-22 14:38:00,613 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 14:38:00,620 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7fbe44b89ed0>
2017-03-22 14:38:00,620 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-22 14:38:00,620 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-22 14:38:00,620 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is YICLYD8C57
2017-03-22 14:38:00,620 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-22 14:38:00,620 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is YICLYD8C57
2017-03-22 14:38:00,620 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is YICLYD8C57 to 254721799582
2017-03-22 14:38:00,620 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is YICLYD8C57 to 254721799582
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is YICLYD8C57
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is YICLYD8C57 to 254721799582
2017-03-22 14:38:00,621 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-22 14:38:00,621 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is YICLYD8C57 to 8
2017-03-22 14:38:00,621 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-22 14:38:00,621 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is YICLYD8C57 to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is YICLYD8C57 to 8
2017-03-22 14:38:00,621 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is YICLYD8C57", "user": "8", "title": "Safaricom  Airtime"}
2017-03-22 14:38:00,621 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is YICLYD8C57", "user": "8", "title": "Safaricom  Airtime"}
2017-03-22 14:38:00,621 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is YICLYD8C57", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-22 14:38:00,621 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-22 14:38:00,622 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 10  Safaricom Airtime. Your transaction number is YICLYD8C57
2017-03-22 14:38:00,622 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 10  Safaricom Airtime. Your transaction number is YICLYD8C57
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 10  Safaricom Airtime. Your transaction number is YICLYD8C57
2017-03-22 14:38:01,921 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":84,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is YICLYD8C57","image_url":"","date":"2017-03-22T14:35:03.771029Z"}
2017-03-22 14:38:01,921 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":84,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is YICLYD8C57","image_url":"","date":"2017-03-22T14:35:03.771029Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":84,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is YICLYD8C57","image_url":"","date":"2017-03-22T14:35:03.771029Z"}
2017-03-22 14:38:01,922 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-22 14:38:01,922 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-22 14:38:01,922 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":84,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is YICLYD8C57","image_url":"","date":"2017-03-22T14:35:03.771029Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":84,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is YICLYD8C57","image_url":"","date":"2017-03-22T14:35:03.771029Z"}
2017-03-22 14:38:01,922 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":84,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is YICLYD8C57","image_url":"","date":"2017-03-22T14:35:03.771029Z"}
2017-03-22 14:38:01,923 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-22 14:38:01,923 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-22 14:38:01,923 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-22 14:38:01,923 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-22 14:38:01,923 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-22 14:38:01,923 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-22 14:38:01,924 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-22 14:38:01,924 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-22 14:38:01,924 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-22 14:38:01,924 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-22 14:38:01,925 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-22 14:38:01,925 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-22 14:38:03,160 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 14:38:03,161 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":64,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-22 14:38:03,160 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 14:38:03,161 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"id":64,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-22 14:38:03,161 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":64,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-22 14:38:03,161 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:38:03,161 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-22 14:38:03,161 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-22 14:38:03,162 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-22 14:38:03,162 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-22 14:38:03,177 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-22 14:38:03,177 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-22 14:38:03,178 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3625.39ms
2017-03-22 14:38:03,178 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3625.39ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3625.39ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-22 14:41:07,377 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-22 14:41:07,377 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
2017-03-22 14:41:07,378 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-22 14:41:07,378 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-22 14:41:07,378 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 14:41:07
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 22/03/2017 14:41:07
2017-03-22 14:41:07,378 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-22 14:41:07,378 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 14:41:07
2017-03-22 14:41:07,378 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-22 14:41:07,379 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-22 14:41:07,379 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-22 14:41:07,379 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 36fc5ff7e9cd4f5d8091b7ac40371922
2017-03-22 14:41:07,379 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 36fc5ff7e9cd4f5d8091b7ac40371922
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 36fc5ff7e9cd4f5d8091b7ac40371922
2017-03-22 14:41:07,379 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-22 14:41:07,379 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-22 14:41:07,380 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'mobile_money_transaction_number': u'LC323322', u'service_type_id': 1, u'service_provider_id': 1, u'amount': u'5', u'mobile_money_provider_id': 1, u'account_number': u'1535654', u'mobile_number': u'0721799582', u'payment_method_id': u'1'}-----------------------------++++++++++++++
2017-03-22 14:41:07,380 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'mobile_money_transaction_number': u'LC323322', u'service_type_id': 1, u'service_provider_id': 1, u'amount': u'5', u'mobile_money_provider_id': 1, u'account_number': u'1535654', u'mobile_number': u'0721799582', u'payment_method_id': u'1'}-----------------------------++++++++++++++
2017-03-22 14:41:07,380 = handlers.result_handler.AirtimeHandler - DEBUG - LC323322
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 8, u'mobile_money_transaction_number': u'LC323322', u'service_type_id': 1, u'service_provider_id': 1, u'amount': u'5', u'mobile_money_provider_id': 1, u'account_number': u'1535654', u'mobile_number': u'0721799582', u'payment_method_id': u'1'}-----------------------------++++++++++++++
2017-03-22 14:41:07,380 = handlers.result_handler.AirtimeHandler - DEBUG - LC323322
2017-03-22 14:41:07,380 = handlers.result_handler.AirtimeHandler - INFO - Building XML
DEBUG:handlers.result_handler.AirtimeHandler:LC323322
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-22 14:41:07,380 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-22 14:41:07,380 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:41:07</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>36fc5ff7e9cd4f5d8091b7ac40371922</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:41:07,380 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:41:07</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>36fc5ff7e9cd4f5d8091b7ac40371922</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:41:07</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>36fc5ff7e9cd4f5d8091b7ac40371922</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:41:07,381 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-22 14:41:07,381 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-22 14:41:07,381 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-22 14:41:07,381 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-22 14:41:07,381 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:41:07</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>36fc5ff7e9cd4f5d8091b7ac40371922</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-22 14:41:07,381 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:41:07</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>36fc5ff7e9cd4f5d8091b7ac40371922</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 14:41:07,382 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-22 14:41:07,382 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 14:41:07</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>36fc5ff7e9cd4f5d8091b7ac40371922</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-22 14:41:08,009 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-22 14:41:08,009 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-22 14:41:08,009 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:38:09</ns0:DATE><ns0:EXTREFNUM>36fc5ff7e9cd4f5d8091b7ac40371922</ns0:EXTREFNUM><ns0:TXNID>R170322.1438.140012</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:38:09</ns0:DATE><ns0:EXTREFNUM>36fc5ff7e9cd4f5d8091b7ac40371922</ns0:EXTREFNUM><ns0:TXNID>R170322.1438.140012</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 14:41:08,010 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-22 14:41:08,009 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>22/03/17 14:38:09</ns0:DATE><ns0:EXTREFNUM>36fc5ff7e9cd4f5d8091b7ac40371922</ns0:EXTREFNUM><ns0:TXNID>R170322.1438.140012</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 14:41:08,010 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-22 14:41:08,010 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-22 14:41:08,010 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-22 14:41:08,010 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-22 14:41:08,010 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-22 14:41:08,011 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-22 14:41:08,011 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-22 14:41:08,011 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-22 14:41:08,011 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-22 14:41:08,012 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 8
2017-03-22 14:41:08,012 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 8
2017-03-22 14:41:08,012 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-22 14:41:08,012 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-22 14:41:08,012 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-22 14:41:08,012 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-22 14:41:08,013 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-22 14:41:08,013 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-22 14:41:08,078 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":85,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-22T14:38:09.921957Z"}
2017-03-22 14:41:08,078 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":85,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-22T14:38:09.921957Z"}
2017-03-22 14:41:08,080 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:{"id":85,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-22T14:38:09.921957Z"}
2017-03-22 14:41:08,080 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-22 14:41:08,081 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-22 14:41:08,081 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-22 14:41:08,082 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "5", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-22 14:41:08,081 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-22 14:41:08,081 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-22 14:41:08,082 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-22 14:41:08,134 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 14:41:08,134 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 14:41:08,135 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":1195.0}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-22 14:41:08,135 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":1195.0}
2017-03-22 14:41:08,135 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:{"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":1195.0}
{"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":1195.0}
2017-03-22 14:41:08,135 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:41:08,136 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-22 14:41:08,136 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-22 14:41:08,136 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-22 14:41:08,136 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-22 14:41:08,137 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-22 14:41:08,137 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-22 14:41:08,138 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "1799582", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-22 14:41:08,138 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "1799582", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "1799582", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-22 14:41:08,138 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-22 14:41:08,138 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-22 14:41:09,332 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 14:41:09,333 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":65,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"1799582","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-22 14:41:09,332 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 14:41:09,333 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"id":65,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"1799582","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:41:09,334 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
2017-03-22 14:41:09,333 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":65,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"1799582","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-22 14:41:09,333 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:41:09,334 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": "LC323322"}
2017-03-22 14:41:09,455 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 14:41:09,455 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
2017-03-22 14:41:09,455 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:41:09,456 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"status": 1, "message": "Transaction not found"}
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:41:09,455 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 14:41:09,455 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
{"status": 1, "message": "Transaction not found"}
2017-03-22 14:41:09,455 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 14:41:09,456 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-22 14:41:09,457 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2080.29ms
2017-03-22 14:41:09,457 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2080.29ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 2080.29ms
2017-03-22 14:42:03,308 = __main__ - INFO - Creating server
2017-03-22 14:42:03,308 = __main__ - INFO - Creating server
2017-03-22 14:42:03,314 = __main__ - INFO - Created server
2017-03-22 14:42:03,314 = __main__ - INFO - Created server
2017-03-22 14:42:03,315 = __main__ - INFO - Listening on port 8080
2017-03-22 14:42:03,315 = __main__ - INFO - Listening on port 8080
2017-03-22 14:42:03,316 = __main__ - INFO - Starting event loop
2017-03-22 14:42:03,316 = __main__ - INFO - Starting event loop
2017-03-22 15:02:59,630 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-22 15:02:59,630 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-22 15:02:59,631 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-22 15:02:59,631 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-22 15:02:59,631 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 15:02:59
2017-03-22 15:02:59,631 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 22/03/2017 15:02:59
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 22/03/2017 15:02:59
2017-03-22 15:02:59,631 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-22 15:02:59,631 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-22 15:02:59,632 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-22 15:02:59,632 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-22 15:02:59,632 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = aba6808ef32d488e8e21fd6de4e7d89f
2017-03-22 15:02:59,632 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = aba6808ef32d488e8e21fd6de4e7d89f
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = aba6808ef32d488e8e21fd6de4e7d89f
2017-03-22 15:02:59,633 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-22 15:02:59,633 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-22 15:02:59,633 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 10, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 3}-----------------------------++++++++++++++
2017-03-22 15:02:59,633 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 10, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 3}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 10, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 3}-----------------------------++++++++++++++
2017-03-22 15:02:59,633 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-22 15:02:59,633 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-22 15:02:59,634 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-22 15:02:59,634 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-22 15:02:59,634 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 15:02:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>aba6808ef32d488e8e21fd6de4e7d89f</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 15:02:59,634 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 15:02:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>aba6808ef32d488e8e21fd6de4e7d89f</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 15:02:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>aba6808ef32d488e8e21fd6de4e7d89f</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 15:02:59,634 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-22 15:02:59,634 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-22 15:02:59,635 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-22 15:02:59,635 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-22 15:02:59,635 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 15:02:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>aba6808ef32d488e8e21fd6de4e7d89f</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 15:02:59,635 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 15:02:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>aba6808ef32d488e8e21fd6de4e7d89f</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>22/03/2017 15:02:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>aba6808ef32d488e8e21fd6de4e7d89f</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-22 15:02:59,635 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-22 15:02:59,635 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-22 15:03:00,622 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-22 15:03:00,622 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-22 15:03:00,623 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 15:00:02</ns0:DATE><ns0:EXTREFNUM>aba6808ef32d488e8e21fd6de4e7d89f</ns0:EXTREFNUM><ns0:TXNID>R170322.1500.140004</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 702935200 is successful. Your new balance is KSH 120</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 15:03:00,623 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 15:00:02</ns0:DATE><ns0:EXTREFNUM>aba6808ef32d488e8e21fd6de4e7d89f</ns0:EXTREFNUM><ns0:TXNID>R170322.1500.140004</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 702935200 is successful. Your new balance is KSH 120</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>22/03/17 15:00:02</ns0:DATE><ns0:EXTREFNUM>aba6808ef32d488e8e21fd6de4e7d89f</ns0:EXTREFNUM><ns0:TXNID>R170322.1500.140004</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 702935200 is successful. Your new balance is KSH 120</ns0:MESSAGE></ns0:COMMAND>

2017-03-22 15:03:00,623 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-22 15:03:00,623 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-22 15:03:00,624 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-22 15:03:00,624 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
2017-03-22 15:03:00,625 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-22 15:03:00,625 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-22 15:03:00,625 = handlers.result_handler.AirtimeHandler - DEBUG - 22/03/17 15:00:02
2017-03-22 15:03:00,625 = handlers.result_handler.AirtimeHandler - DEBUG - 22/03/17 15:00:02
DEBUG:handlers.result_handler.AirtimeHandler:22/03/17 15:00:02
2017-03-22 15:03:00,626 = handlers.result_handler.AirtimeHandler - DEBUG - aba6808ef32d488e8e21fd6de4e7d89f
2017-03-22 15:03:00,626 = handlers.result_handler.AirtimeHandler - DEBUG - aba6808ef32d488e8e21fd6de4e7d89f
DEBUG:handlers.result_handler.AirtimeHandler:aba6808ef32d488e8e21fd6de4e7d89f
2017-03-22 15:03:00,627 = handlers.result_handler.AirtimeHandler - DEBUG - R170322.1500.140004
2017-03-22 15:03:00,627 = handlers.result_handler.AirtimeHandler - DEBUG - R170322.1500.140004
DEBUG:handlers.result_handler.AirtimeHandler:R170322.1500.140004
2017-03-22 15:03:00,627 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'22/03/17 15:00:02', 'amount': '10', 'external_ref': u'R170322.1500.140004', 'msisdn_2': u'254702935200', 'internal_ref': 'P40M4WRLTH'}
2017-03-22 15:03:00,627 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'22/03/17 15:00:02', 'amount': '10', 'external_ref': u'R170322.1500.140004', 'msisdn_2': u'254702935200', 'internal_ref': 'P40M4WRLTH'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'22/03/17 15:00:02', 'amount': '10', 'external_ref': u'R170322.1500.140004', 'msisdn_2': u'254702935200', 'internal_ref': 'P40M4WRLTH'}
2017-03-22 15:03:00,628 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-22 15:03:00,628 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-22 15:03:00,796 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-22 15:03:00,796 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-22 15:03:00,803 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 15:03:00,803 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-22 15:03:00,809 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-22 15:03:00,809 INFO sqlalchemy.engine.base.Engine {}
2017-03-22 15:03:00,813 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-22 15:03:00,813 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-22 15:03:00,820 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-22 15:03:00,821 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 15:03:00,824 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 15:03:00,825 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-22 15:03:00,830 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-22 15:03:00,830 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-22 15:03:00,834 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 15:03:00,834 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-22 15:03:00,840 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-22 15:03:00,841 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 15:03:00,844 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-22 15:03:00,844 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-22 15:03:00,852 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f1e87158ed0>
2017-03-22 15:03:00,852 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-22 15:03:00,853 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-22 15:03:00,853 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-22 15:03:00,854 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is P40M4WRLTH
2017-03-22 15:03:00,854 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is P40M4WRLTH
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is P40M4WRLTH
2017-03-22 15:03:00,854 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is P40M4WRLTH to 254702935200
2017-03-22 15:03:00,854 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is P40M4WRLTH to 254702935200
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is P40M4WRLTH to 254702935200
2017-03-22 15:03:00,854 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-22 15:03:00,854 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-22 15:03:00,855 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is P40M4WRLTH to 7
2017-03-22 15:03:00,855 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is P40M4WRLTH to 7
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is P40M4WRLTH to 7
2017-03-22 15:03:00,855 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is P40M4WRLTH", "user": "7", "title": "Safaricom  Airtime"}
2017-03-22 15:03:00,855 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is P40M4WRLTH", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is P40M4WRLTH", "user": "7", "title": "Safaricom  Airtime"}
2017-03-22 15:03:00,856 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-22 15:03:00,856 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-22 15:03:00,856 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 10  Safaricom Airtime. Your transaction number is P40M4WRLTH
2017-03-22 15:03:00,856 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 10  Safaricom Airtime. Your transaction number is P40M4WRLTH
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 10  Safaricom Airtime. Your transaction number is P40M4WRLTH
2017-03-22 15:03:02,048 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":88,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is P40M4WRLTH","image_url":"","date":"2017-03-22T15:00:03.848277Z"}
2017-03-22 15:03:02,048 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":88,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is P40M4WRLTH","image_url":"","date":"2017-03-22T15:00:03.848277Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":88,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is P40M4WRLTH","image_url":"","date":"2017-03-22T15:00:03.848277Z"}
2017-03-22 15:03:02,049 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-22 15:03:02,049 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-22 15:03:02,049 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":88,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is P40M4WRLTH","image_url":"","date":"2017-03-22T15:00:03.848277Z"}
2017-03-22 15:03:02,049 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":88,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is P40M4WRLTH","image_url":"","date":"2017-03-22T15:00:03.848277Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":88,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is P40M4WRLTH","image_url":"","date":"2017-03-22T15:00:03.848277Z"}
2017-03-22 15:03:02,049 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-22 15:03:02,049 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-22 15:03:02,050 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-22 15:03:02,050 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-22 15:03:02,050 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-22 15:03:02,050 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-22 15:03:02,050 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-22 15:03:02,050 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-22 15:03:02,050 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-22 15:03:02,050 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-22 15:03:02,051 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-22 15:03:02,051 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-22 15:03:03,083 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-22 15:03:03,083 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-22 15:03:03,083 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":68,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-22 15:03:03,083 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":68,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":68,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-22 15:03:03,084 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 15:03:03,084 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-22 15:03:03,085 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-22 15:03:03,085 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-22 15:03:03,085 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-22 15:03:03,085 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-22 15:03:03,101 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-22 15:03:03,101 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-22 15:03:03,103 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3473.44ms
2017-03-22 15:03:03,103 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3473.44ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3473.44ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-22 18:09:30,166 = tornado.access - WARNING - 404 GET / (168.1.128.59) 0.82ms
WARNING:tornado.access:404 GET / (168.1.128.59) 0.82ms
2017-03-22 18:09:30,166 = tornado.access - WARNING - 404 GET / (168.1.128.59) 0.82ms
2017-03-22 18:40:01,176 = tornado.access - WARNING - 404 GET / (222.186.58.67) 0.85ms
WARNING:tornado.access:404 GET / (222.186.58.67) 0.85ms
2017-03-22 18:40:01,176 = tornado.access - WARNING - 404 GET / (222.186.58.67) 0.85ms
2017-03-22 20:39:04,082 = tornado.access - WARNING - 404 HEAD http://180.163.113.82/check_proxy (180.97.106.37) 0.93ms
WARNING:tornado.access:404 HEAD http://180.163.113.82/check_proxy (180.97.106.37) 0.93ms
2017-03-22 20:39:04,082 = tornado.access - WARNING - 404 HEAD http://180.163.113.82/check_proxy (180.97.106.37) 0.93ms
2017-03-22 22:22:14,573 = tornado.access - WARNING - 404 GET //admin/config.php (195.154.214.162) 0.69ms
WARNING:tornado.access:404 GET //admin/config.php (195.154.214.162) 0.69ms
2017-03-22 22:22:14,573 = tornado.access - WARNING - 404 GET //admin/config.php (195.154.214.162) 0.69ms
2017-03-22 22:29:28,596 = tornado.access - WARNING - 404 GET //recordings/theme/main.css (195.154.214.162) 0.46ms
WARNING:tornado.access:404 GET //recordings/theme/main.css (195.154.214.162) 0.46ms
2017-03-22 22:29:28,596 = tornado.access - WARNING - 404 GET //recordings/theme/main.css (195.154.214.162) 0.46ms
2017-03-22 22:36:33,470 = tornado.access - WARNING - 404 GET //a2billing/customer/form_data/FG_var_callerid.inc (195.154.214.162) 0.74ms
WARNING:tornado.access:404 GET //a2billing/customer/form_data/FG_var_callerid.inc (195.154.214.162) 0.74ms
2017-03-22 22:36:33,470 = tornado.access - WARNING - 404 GET //a2billing/customer/form_data/FG_var_callerid.inc (195.154.214.162) 0.74ms
2017-03-22 23:31:26,031 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.57.251) 0.56ms
WARNING:tornado.access:404 GET http://www.baidu.com/favicon.ico (123.59.57.251) 0.56ms
2017-03-22 23:31:26,031 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.57.251) 0.56ms
2017-03-22 23:49:58,057 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.76ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.76ms
2017-03-22 23:49:58,057 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.76ms
2017-03-23 00:22:36,160 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.51ms
WARNING:tornado.access:404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.51ms
2017-03-23 00:22:36,160 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.51ms
2017-03-23 00:43:41,400 = tornado.access - WARNING - 404 GET / (139.162.79.87) 0.65ms
WARNING:tornado.access:404 GET / (139.162.79.87) 0.65ms
2017-03-23 00:43:41,400 = tornado.access - WARNING - 404 GET / (139.162.79.87) 0.65ms
2017-03-23 01:13:37,273 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.63ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.63ms
2017-03-23 01:13:37,273 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.63ms
2017-03-23 02:41:26,218 = tornado.access - WARNING - 404 GET / (222.186.58.145) 0.59ms
WARNING:tornado.access:404 GET / (222.186.58.145) 0.59ms
2017-03-23 02:41:26,218 = tornado.access - WARNING - 404 GET / (222.186.58.145) 0.59ms
2017-03-23 06:21:05,929 = tornado.access - WARNING - 404 GET / (139.162.111.98) 0.96ms
WARNING:tornado.access:404 GET / (139.162.111.98) 0.96ms
2017-03-23 06:21:05,929 = tornado.access - WARNING - 404 GET / (139.162.111.98) 0.96ms
2017-03-23 07:29:06,815 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.43ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.43ms
2017-03-23 07:29:06,815 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.43ms
2017-03-23 07:34:27,933 = tornado.access - WARNING - 404 GET / (59.53.137.161) 0.53ms
WARNING:tornado.access:404 GET / (59.53.137.161) 0.53ms
2017-03-23 07:34:27,933 = tornado.access - WARNING - 404 GET / (59.53.137.161) 0.53ms
2017-03-23 07:36:35,935 = tornado.access - WARNING - 404 GET /script (221.194.44.252) 0.61ms
WARNING:tornado.access:404 GET /script (221.194.44.252) 0.61ms
2017-03-23 07:36:35,935 = tornado.access - WARNING - 404 GET /script (221.194.44.252) 0.61ms
2017-03-23 12:12:42,468 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.57.251) 0.47ms
WARNING:tornado.access:404 GET http://www.baidu.com/favicon.ico (123.59.57.251) 0.47ms
2017-03-23 12:12:42,468 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.57.251) 0.47ms
2017-03-23 13:44:38,179 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.69ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.69ms
2017-03-23 13:44:38,179 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.69ms
2017-03-23 14:22:42,657 = tornado.access - WARNING - 404 GET /manager/html (186.232.30.2) 0.50ms
WARNING:tornado.access:404 GET /manager/html (186.232.30.2) 0.50ms
2017-03-23 14:22:42,657 = tornado.access - WARNING - 404 GET /manager/html (186.232.30.2) 0.50ms
2017-03-23 20:32:17,995 = tornado.access - WARNING - 404 GET / (110.169.62.141) 0.66ms
2017-03-23 20:32:17,995 = tornado.access - WARNING - 404 GET / (110.169.62.141) 0.66ms
WARNING:tornado.access:404 GET / (110.169.62.141) 0.66ms
2017-03-23 20:32:19,815 = tornado.access - WARNING - 404 GET / (110.169.62.141) 0.88ms
WARNING:tornado.access:404 GET / (110.169.62.141) 0.88ms
2017-03-23 20:32:19,815 = tornado.access - WARNING - 404 GET / (110.169.62.141) 0.88ms
2017-03-23 20:32:23,480 = tornado.access - WARNING - 404 GET / (110.169.62.141) 0.63ms
2017-03-23 20:32:23,480 = tornado.access - WARNING - 404 GET / (110.169.62.141) 0.63ms
WARNING:tornado.access:404 GET / (110.169.62.141) 0.63ms
2017-03-23 20:32:25,772 = tornado.access - WARNING - 404 GET / (110.169.62.141) 0.72ms
WARNING:tornado.access:404 GET / (110.169.62.141) 0.72ms
2017-03-23 20:32:25,772 = tornado.access - WARNING - 404 GET / (110.169.62.141) 0.72ms
2017-03-23 20:32:49,083 = tornado.access - WARNING - 404 GET / (110.169.62.141) 0.80ms
WARNING:tornado.access:404 GET / (110.169.62.141) 0.80ms
2017-03-23 20:32:49,083 = tornado.access - WARNING - 404 GET / (110.169.62.141) 0.80ms
2017-03-23 20:33:12,256 = tornado.access - WARNING - 404 GET / (110.169.62.141) 0.56ms
WARNING:tornado.access:404 GET / (110.169.62.141) 0.56ms
2017-03-23 20:33:12,256 = tornado.access - WARNING - 404 GET / (110.169.62.141) 0.56ms
2017-03-23 20:37:02,922 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.52ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.52ms
2017-03-23 20:37:02,922 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.52ms
2017-03-23 23:05:42,507 = tornado.access - WARNING - 404 GET /script (103.200.30.200) 0.73ms
WARNING:tornado.access:404 GET /script (103.200.30.200) 0.73ms
2017-03-23 23:05:42,507 = tornado.access - WARNING - 404 GET /script (103.200.30.200) 0.73ms
2017-03-24 00:13:16,034 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.52ms
2017-03-24 00:13:16,034 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.52ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.52ms
2017-03-24 02:44:40,218 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.66ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.66ms
2017-03-24 02:44:40,218 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.66ms
2017-03-24 03:49:46,741 = tornado.access - WARNING - 404 GET /manager/html (58.221.58.113) 0.63ms
WARNING:tornado.access:404 GET /manager/html (58.221.58.113) 0.63ms
2017-03-24 03:49:46,741 = tornado.access - WARNING - 404 GET /manager/html (58.221.58.113) 0.63ms
2017-03-24 04:34:17,445 = tornado.access - WARNING - 404 GET /cgi-bin/authLogin.cgi (101.167.34.22) 0.75ms
2017-03-24 04:34:17,446 = tornado.general - INFO - Malformed HTTP message from 101.167.34.22: Malformed HTTP version in HTTP Request-Line: ''
WARNING:tornado.access:404 GET /cgi-bin/authLogin.cgi (101.167.34.22) 0.75ms
INFO:tornado.general:Malformed HTTP message from 101.167.34.22: Malformed HTTP version in HTTP Request-Line: ''
2017-03-24 04:34:17,445 = tornado.access - WARNING - 404 GET /cgi-bin/authLogin.cgi (101.167.34.22) 0.75ms
2017-03-24 04:34:17,446 = tornado.general - INFO - Malformed HTTP message from 101.167.34.22: Malformed HTTP version in HTTP Request-Line: ''
2017-03-24 04:39:08,177 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.52ms
WARNING:tornado.access:404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.52ms
2017-03-24 04:39:08,177 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.52ms
2017-03-24 05:06:57,806 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.53ms
WARNING:tornado.access:404 GET http://www.google.com/ (91.236.75.4) 0.53ms
2017-03-24 05:06:57,806 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.53ms
2017-03-24 09:44:58,950 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/10000/-------------------
2017-03-24 09:44:58,951 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-24 09:44:58,951 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 24/03/2017 09:44:58
2017-03-24 09:44:58,951 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-24 09:44:58,951 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-24 09:44:58,952 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = dce3b60be8434eec8c45cd108700a84e
2017-03-24 09:44:58,952 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-24 09:44:58,952 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': u'Yes', u'amount': 100, u'account_number': None, u'mobile_number': u'254701585831', u'bundle_id': None, u'payment_method_id': 3}-----------------------------++++++++++++++
2017-03-24 09:44:58,952 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-24 09:44:58,953 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-24 09:44:58,953 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 09:44:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>dce3b60be8434eec8c45cd108700a84e</ns0:EXTREFNUM><ns0:MSISDN2>254701585831</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-24 09:44:58,953 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-24 09:44:58,953 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-24 09:44:58,953 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 09:44:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>dce3b60be8434eec8c45cd108700a84e</ns0:EXTREFNUM><ns0:MSISDN2>254701585831</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-24 09:44:58,954 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/10000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 24/03/2017 09:44:58
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = dce3b60be8434eec8c45cd108700a84e
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': u'Yes', u'amount': 100, u'account_number': None, u'mobile_number': u'254701585831', u'bundle_id': None, u'payment_method_id': 3}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 09:44:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>dce3b60be8434eec8c45cd108700a84e</ns0:EXTREFNUM><ns0:MSISDN2>254701585831</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 09:44:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>dce3b60be8434eec8c45cd108700a84e</ns0:EXTREFNUM><ns0:MSISDN2>254701585831</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-24 09:44:58,950 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/10000/-------------------
2017-03-24 09:44:58,951 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-24 09:44:58,951 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 24/03/2017 09:44:58
2017-03-24 09:44:58,951 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-24 09:44:58,951 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-24 09:44:58,952 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = dce3b60be8434eec8c45cd108700a84e
2017-03-24 09:44:58,952 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-24 09:44:58,952 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': u'Yes', u'amount': 100, u'account_number': None, u'mobile_number': u'254701585831', u'bundle_id': None, u'payment_method_id': 3}-----------------------------++++++++++++++
2017-03-24 09:44:58,952 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-24 09:44:58,953 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-24 09:44:58,953 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 09:44:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>dce3b60be8434eec8c45cd108700a84e</ns0:EXTREFNUM><ns0:MSISDN2>254701585831</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-24 09:44:58,953 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-24 09:44:58,953 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-24 09:44:58,953 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 09:44:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>dce3b60be8434eec8c45cd108700a84e</ns0:EXTREFNUM><ns0:MSISDN2>254701585831</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-24 09:44:58,954 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-24 09:44:59,566 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-24 09:44:59,566 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-24 09:44:59,567 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>24/03/17 09:44:57</ns0:DATE><ns0:EXTREFNUM>dce3b60be8434eec8c45cd108700a84e</ns0:EXTREFNUM><ns0:TXNID>R170324.0944.130073</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 100 to 701585831 is successful. Your new balance is KSH 20</ns0:MESSAGE></ns0:COMMAND>

2017-03-24 09:44:59,567 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>24/03/17 09:44:57</ns0:DATE><ns0:EXTREFNUM>dce3b60be8434eec8c45cd108700a84e</ns0:EXTREFNUM><ns0:TXNID>R170324.0944.130073</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 100 to 701585831 is successful. Your new balance is KSH 20</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>24/03/17 09:44:57</ns0:DATE><ns0:EXTREFNUM>dce3b60be8434eec8c45cd108700a84e</ns0:EXTREFNUM><ns0:TXNID>R170324.0944.130073</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 100 to 701585831 is successful. Your new balance is KSH 20</ns0:MESSAGE></ns0:COMMAND>

2017-03-24 09:44:59,568 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-24 09:44:59,568 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-24 09:44:59,568 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------100-----------------------
2017-03-24 09:44:59,568 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------100-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------100-----------------------
2017-03-24 09:44:59,569 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-24 09:44:59,569 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-24 09:44:59,569 = handlers.result_handler.AirtimeHandler - DEBUG - 24/03/17 09:44:57
2017-03-24 09:44:59,569 = handlers.result_handler.AirtimeHandler - DEBUG - 24/03/17 09:44:57
DEBUG:handlers.result_handler.AirtimeHandler:24/03/17 09:44:57
2017-03-24 09:44:59,570 = handlers.result_handler.AirtimeHandler - DEBUG - dce3b60be8434eec8c45cd108700a84e
2017-03-24 09:44:59,570 = handlers.result_handler.AirtimeHandler - DEBUG - dce3b60be8434eec8c45cd108700a84e
DEBUG:handlers.result_handler.AirtimeHandler:dce3b60be8434eec8c45cd108700a84e
2017-03-24 09:44:59,570 = handlers.result_handler.AirtimeHandler - DEBUG - R170324.0944.130073
2017-03-24 09:44:59,570 = handlers.result_handler.AirtimeHandler - DEBUG - R170324.0944.130073
DEBUG:handlers.result_handler.AirtimeHandler:R170324.0944.130073
2017-03-24 09:44:59,571 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'24/03/17 09:44:57', 'amount': '100', 'external_ref': u'R170324.0944.130073', 'msisdn_2': u'254701585831', 'internal_ref': 'HQQLEZXI25'}
2017-03-24 09:44:59,571 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'24/03/17 09:44:57', 'amount': '100', 'external_ref': u'R170324.0944.130073', 'msisdn_2': u'254701585831', 'internal_ref': 'HQQLEZXI25'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'24/03/17 09:44:57', 'amount': '100', 'external_ref': u'R170324.0944.130073', 'msisdn_2': u'254701585831', 'internal_ref': 'HQQLEZXI25'}
2017-03-24 09:44:59,571 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-24 09:44:59,571 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-24 09:44:59,616 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-24 09:44:59,616 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-24 09:44:59,620 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-24 09:44:59,620 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-24 09:44:59,623 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-24 09:44:59,624 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-24 09:44:59,626 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-24 09:44:59,626 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-24 09:44:59,630 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-24 09:44:59,630 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-24 09:44:59,632 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-24 09:44:59,633 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-24 09:44:59,635 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-24 09:44:59,636 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-24 09:44:59,638 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-24 09:44:59,638 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-24 09:44:59,643 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-24 09:44:59,643 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-24 09:44:59,645 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-24 09:44:59,646 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f1e86e99290>
2017-03-24 09:44:59,653 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-24 09:44:59,653 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-24 09:44:59,654 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-24 09:44:59,654 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-24 09:44:59,655 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 100  Safaricom Airtime. Your transaction number is HQQLEZXI25
2017-03-24 09:44:59,655 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 100  Safaricom Airtime. Your transaction number is HQQLEZXI25
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 100  Safaricom Airtime. Your transaction number is HQQLEZXI25
2017-03-24 09:44:59,656 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 100  Safaricom Airtime. Your transaction number is HQQLEZXI25 to 254701585831
2017-03-24 09:44:59,656 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 100  Safaricom Airtime. Your transaction number is HQQLEZXI25 to 254701585831
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 100  Safaricom Airtime. Your transaction number is HQQLEZXI25 to 254701585831
2017-03-24 09:44:59,656 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-24 09:44:59,656 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-24 09:44:59,657 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 100  Safaricom Airtime. Your transaction number is HQQLEZXI25 to 8
2017-03-24 09:44:59,657 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 100  Safaricom Airtime. Your transaction number is HQQLEZXI25 to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 100  Safaricom Airtime. Your transaction number is HQQLEZXI25 to 8
2017-03-24 09:44:59,658 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 100  Safaricom Airtime. Your transaction number is HQQLEZXI25", "user": "8", "title": "Safaricom  Airtime"}
2017-03-24 09:44:59,658 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 100  Safaricom Airtime. Your transaction number is HQQLEZXI25", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 100  Safaricom Airtime. Your transaction number is HQQLEZXI25", "user": "8", "title": "Safaricom  Airtime"}
2017-03-24 09:44:59,659 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-24 09:44:59,659 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-24 09:44:59,659 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 100  Safaricom Airtime. Your transaction number is HQQLEZXI25
2017-03-24 09:44:59,659 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 100  Safaricom Airtime. Your transaction number is HQQLEZXI25
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 100  Safaricom Airtime. Your transaction number is HQQLEZXI25
2017-03-24 09:45:01,012 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":89,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 100  Safaricom Airtime. Your transaction number is HQQLEZXI25","image_url":"","date":"2017-03-24T09:44:58.906131Z"}
2017-03-24 09:45:01,012 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":89,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 100  Safaricom Airtime. Your transaction number is HQQLEZXI25","image_url":"","date":"2017-03-24T09:44:58.906131Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":89,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 100  Safaricom Airtime. Your transaction number is HQQLEZXI25","image_url":"","date":"2017-03-24T09:44:58.906131Z"}
2017-03-24 09:45:01,013 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-24 09:45:01,013 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-24 09:45:01,014 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":89,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 100  Safaricom Airtime. Your transaction number is HQQLEZXI25","image_url":"","date":"2017-03-24T09:44:58.906131Z"}
2017-03-24 09:45:01,014 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":89,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 100  Safaricom Airtime. Your transaction number is HQQLEZXI25","image_url":"","date":"2017-03-24T09:44:58.906131Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":89,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 100  Safaricom Airtime. Your transaction number is HQQLEZXI25","image_url":"","date":"2017-03-24T09:44:58.906131Z"}
2017-03-24 09:45:01,015 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-24 09:45:01,015 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-24 09:45:01,015 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-24 09:45:01,015 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-24 09:45:01,016 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-24 09:45:01,016 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-24 09:45:01,016 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-24 09:45:01,016 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-24 09:45:01,017 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "701585831", "user": 8, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "100", "service_provider_id": 1}
2017-03-24 09:45:01,017 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "701585831", "user": 8, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "100", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "701585831", "user": 8, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "100", "service_provider_id": 1}
2017-03-24 09:45:01,017 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-24 09:45:01,017 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-24 09:45:02,230 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-24 09:45:02,230 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-24 09:45:02,231 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":69,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"701585831","request":null,"amount":100.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-24 09:45:02,231 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":69,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"701585831","request":null,"amount":100.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":69,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"701585831","request":null,"amount":100.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-24 09:45:02,232 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-24 09:45:02,232 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-24 09:45:02,233 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-24 09:45:02,233 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-24 09:45:02,233 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-24 09:45:02,233 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-24 09:45:02,239 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-24 09:45:02,239 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-24 09:45:02,241 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3291.57ms
2017-03-24 09:45:02,241 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3291.57ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3291.57ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-24 09:50:29,601 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.69.128) 0.60ms
WARNING:tornado.access:404 GET http://www.baidu.com/favicon.ico (123.59.69.128) 0.60ms
2017-03-24 09:50:29,601 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.69.128) 0.60ms
2017-03-24 11:55:50,159 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-24 11:55:50,159 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-24 11:55:50,159 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 24/03/2017 11:55:50
2017-03-24 11:55:50,160 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-24 11:55:50,160 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-24 11:55:50,160 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 8612f99e67c243119d5fae4de6ed7912
2017-03-24 11:55:50,161 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-24 11:55:50,161 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 4, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': 65, u'note': None, u'amount': 10, u'account_number': None, u'mobile_number': u'254721799582', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-24 11:55:50,161 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-24 11:55:50,161 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-24 11:55:50,162 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 11:55:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8612f99e67c243119d5fae4de6ed7912</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-24 11:55:50,162 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-24 11:55:50,162 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-24 11:55:50,162 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 11:55:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8612f99e67c243119d5fae4de6ed7912</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-24 11:55:50,163 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 24/03/2017 11:55:50
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 8612f99e67c243119d5fae4de6ed7912
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 4, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': 65, u'note': None, u'amount': 10, u'account_number': None, u'mobile_number': u'254721799582', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 11:55:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8612f99e67c243119d5fae4de6ed7912</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 11:55:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8612f99e67c243119d5fae4de6ed7912</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-24 11:55:50,159 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-24 11:55:50,159 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-24 11:55:50,159 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 24/03/2017 11:55:50
2017-03-24 11:55:50,160 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-24 11:55:50,160 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-24 11:55:50,160 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 8612f99e67c243119d5fae4de6ed7912
2017-03-24 11:55:50,161 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-24 11:55:50,161 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 4, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': 65, u'note': None, u'amount': 10, u'account_number': None, u'mobile_number': u'254721799582', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-24 11:55:50,161 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-24 11:55:50,161 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-24 11:55:50,162 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 11:55:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8612f99e67c243119d5fae4de6ed7912</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-24 11:55:50,162 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-24 11:55:50,162 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-24 11:55:50,162 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 11:55:50</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8612f99e67c243119d5fae4de6ed7912</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-24 11:55:50,163 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-24 11:55:50,808 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-24 11:55:50,808 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-24 11:55:50,809 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>24/03/17 11:55:48</ns0:DATE><ns0:EXTREFNUM>8612f99e67c243119d5fae4de6ed7912</ns0:EXTREFNUM><ns0:TXNID>R170324.1155.130065</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 10</ns0:MESSAGE></ns0:COMMAND>

2017-03-24 11:55:50,809 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>24/03/17 11:55:48</ns0:DATE><ns0:EXTREFNUM>8612f99e67c243119d5fae4de6ed7912</ns0:EXTREFNUM><ns0:TXNID>R170324.1155.130065</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 10</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>24/03/17 11:55:48</ns0:DATE><ns0:EXTREFNUM>8612f99e67c243119d5fae4de6ed7912</ns0:EXTREFNUM><ns0:TXNID>R170324.1155.130065</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 721799582 is successful. Your new balance is KSH 10</ns0:MESSAGE></ns0:COMMAND>

2017-03-24 11:55:50,810 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-24 11:55:50,810 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-24 11:55:50,811 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-24 11:55:50,811 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
2017-03-24 11:55:50,812 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-24 11:55:50,812 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-24 11:55:50,812 = handlers.result_handler.AirtimeHandler - DEBUG - 24/03/17 11:55:48
2017-03-24 11:55:50,812 = handlers.result_handler.AirtimeHandler - DEBUG - 24/03/17 11:55:48
DEBUG:handlers.result_handler.AirtimeHandler:24/03/17 11:55:48
2017-03-24 11:55:50,813 = handlers.result_handler.AirtimeHandler - DEBUG - 8612f99e67c243119d5fae4de6ed7912
2017-03-24 11:55:50,813 = handlers.result_handler.AirtimeHandler - DEBUG - 8612f99e67c243119d5fae4de6ed7912
DEBUG:handlers.result_handler.AirtimeHandler:8612f99e67c243119d5fae4de6ed7912
2017-03-24 11:55:50,814 = handlers.result_handler.AirtimeHandler - DEBUG - R170324.1155.130065
2017-03-24 11:55:50,814 = handlers.result_handler.AirtimeHandler - DEBUG - R170324.1155.130065
DEBUG:handlers.result_handler.AirtimeHandler:R170324.1155.130065
2017-03-24 11:55:50,815 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'24/03/17 11:55:48', 'amount': '10', 'external_ref': u'R170324.1155.130065', 'msisdn_2': u'254721799582', 'internal_ref': 'CZB86ZBD2S'}
2017-03-24 11:55:50,815 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'24/03/17 11:55:48', 'amount': '10', 'external_ref': u'R170324.1155.130065', 'msisdn_2': u'254721799582', 'internal_ref': 'CZB86ZBD2S'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'24/03/17 11:55:48', 'amount': '10', 'external_ref': u'R170324.1155.130065', 'msisdn_2': u'254721799582', 'internal_ref': 'CZB86ZBD2S'}
2017-03-24 11:55:50,816 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-24 11:55:50,816 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-24 11:55:50,865 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-24 11:55:50,866 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-24 11:55:50,870 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-24 11:55:50,870 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-24 11:55:50,874 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-24 11:55:50,875 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-24 11:55:50,878 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-24 11:55:50,879 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-24 11:55:50,884 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-24 11:55:50,885 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-24 11:55:50,889 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-24 11:55:50,890 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-24 11:55:50,894 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-24 11:55:50,895 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-24 11:55:50,898 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-24 11:55:50,899 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-24 11:55:50,904 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-24 11:55:50,905 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-24 11:55:50,907 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-24 11:55:50,908 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f1e86e82450>
2017-03-24 11:55:50,916 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-24 11:55:50,916 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-24 11:55:50,917 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-24 11:55:50,917 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-24 11:55:50,918 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is CZB86ZBD2S
2017-03-24 11:55:50,918 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is CZB86ZBD2S
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is CZB86ZBD2S
2017-03-24 11:55:50,919 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is CZB86ZBD2S to 254721799582
2017-03-24 11:55:50,919 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is CZB86ZBD2S to 254721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is CZB86ZBD2S to 254721799582
2017-03-24 11:55:50,919 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-24 11:55:50,919 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-24 11:55:50,920 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is CZB86ZBD2S to 4
2017-03-24 11:55:50,920 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is CZB86ZBD2S to 4
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is CZB86ZBD2S to 4
2017-03-24 11:55:50,921 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is CZB86ZBD2S", "user": "4", "title": "Safaricom  Airtime"}
2017-03-24 11:55:50,921 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is CZB86ZBD2S", "user": "4", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is CZB86ZBD2S", "user": "4", "title": "Safaricom  Airtime"}
2017-03-24 11:55:50,921 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-24 11:55:50,921 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-24 11:55:50,922 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 10  Safaricom Airtime. Your transaction number is CZB86ZBD2S
2017-03-24 11:55:50,922 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 10  Safaricom Airtime. Your transaction number is CZB86ZBD2S
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 10  Safaricom Airtime. Your transaction number is CZB86ZBD2S
2017-03-24 11:55:52,136 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":90,"user":4,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is CZB86ZBD2S","image_url":"","date":"2017-03-24T11:55:49.781791Z"}
2017-03-24 11:55:52,136 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":90,"user":4,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is CZB86ZBD2S","image_url":"","date":"2017-03-24T11:55:49.781791Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":90,"user":4,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is CZB86ZBD2S","image_url":"","date":"2017-03-24T11:55:49.781791Z"}
2017-03-24 11:55:52,137 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-24 11:55:52,137 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-24 11:55:52,138 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":90,"user":4,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is CZB86ZBD2S","image_url":"","date":"2017-03-24T11:55:49.781791Z"}
2017-03-24 11:55:52,138 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":90,"user":4,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is CZB86ZBD2S","image_url":"","date":"2017-03-24T11:55:49.781791Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":90,"user":4,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is CZB86ZBD2S","image_url":"","date":"2017-03-24T11:55:49.781791Z"}
2017-03-24 11:55:52,138 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-24 11:55:52,138 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-24 11:55:52,139 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-24 11:55:52,139 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-24 11:55:52,140 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-24 11:55:52,140 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-24 11:55:52,140 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-24 11:55:52,140 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-24 11:55:52,141 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 4, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-24 11:55:52,141 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 4, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "721799582", "user": 4, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-24 11:55:52,142 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-24 11:55:52,142 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-24 11:55:53,363 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-24 11:55:53,363 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-24 11:55:53,365 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":70,"user":4,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-24 11:55:53,365 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":70,"user":4,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":70,"user":4,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-24 11:55:53,366 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-24 11:55:53,366 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-24 11:55:53,367 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-24 11:55:53,367 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-24 11:55:53,368 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-24 11:55:53,368 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-24 11:55:53,379 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-24 11:55:53,379 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-24 11:55:53,381 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3222.97ms
2017-03-24 11:55:53,381 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3222.97ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3222.97ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-24 11:56:15,353 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-24 11:56:15,354 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-24 11:56:15,354 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 24/03/2017 11:56:15
2017-03-24 11:56:15,354 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-24 11:56:15,355 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-24 11:56:15,355 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 0d6c9cfbc0f4484597bfc9866ef39a45
2017-03-24 11:56:15,355 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-24 11:56:15,356 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 4, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': 66, u'note': None, u'amount': 50, u'account_number': None, u'mobile_number': u'254721799582', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-24 11:56:15,356 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-24 11:56:15,356 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-24 11:56:15,357 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 11:56:15</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0d6c9cfbc0f4484597bfc9866ef39a45</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-24 11:56:15,357 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-24 11:56:15,357 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-24 11:56:15,358 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 11:56:15</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0d6c9cfbc0f4484597bfc9866ef39a45</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-24 11:56:15,358 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/5000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 24/03/2017 11:56:15
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 0d6c9cfbc0f4484597bfc9866ef39a45
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 4, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': 66, u'note': None, u'amount': 50, u'account_number': None, u'mobile_number': u'254721799582', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 11:56:15</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0d6c9cfbc0f4484597bfc9866ef39a45</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 11:56:15</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0d6c9cfbc0f4484597bfc9866ef39a45</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-24 11:56:15,353 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-24 11:56:15,354 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-24 11:56:15,354 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 24/03/2017 11:56:15
2017-03-24 11:56:15,354 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-24 11:56:15,355 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-24 11:56:15,355 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 0d6c9cfbc0f4484597bfc9866ef39a45
2017-03-24 11:56:15,355 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-24 11:56:15,356 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 4, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': 66, u'note': None, u'amount': 50, u'account_number': None, u'mobile_number': u'254721799582', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-24 11:56:15,356 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-24 11:56:15,356 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-24 11:56:15,357 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 11:56:15</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0d6c9cfbc0f4484597bfc9866ef39a45</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-24 11:56:15,357 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-24 11:56:15,357 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-24 11:56:15,358 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 11:56:15</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0d6c9cfbc0f4484597bfc9866ef39a45</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-24 11:56:15,358 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-24 11:56:15,884 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-24 11:56:15,884 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-24 11:56:15,886 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>24/03/17 11:56:13</ns0:DATE><ns0:EXTREFNUM>0d6c9cfbc0f4484597bfc9866ef39a45</ns0:EXTREFNUM><ns0:TXNID>R170324.1156.130018</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 50 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-24 11:56:15,886 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>24/03/17 11:56:13</ns0:DATE><ns0:EXTREFNUM>0d6c9cfbc0f4484597bfc9866ef39a45</ns0:EXTREFNUM><ns0:TXNID>R170324.1156.130018</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 50 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>24/03/17 11:56:13</ns0:DATE><ns0:EXTREFNUM>0d6c9cfbc0f4484597bfc9866ef39a45</ns0:EXTREFNUM><ns0:TXNID>R170324.1156.130018</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 50 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-24 11:56:15,886 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-24 11:56:15,886 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-24 11:56:15,887 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-24 11:56:15,887 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-24 11:56:15,887 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^50
2017-03-24 11:56:15,887 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^50
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^50
2017-03-24 11:56:15,888 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 50 has failed. Your account has been refunded with KES 50 Saiba Credits which can be used to transact on Saiba
2017-03-24 11:56:15,888 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 50 has failed. Your account has been refunded with KES 50 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 50 has failed. Your account has been refunded with KES 50 Saiba Credits which can be used to transact on Saiba
2017-03-24 11:56:15,888 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-24 11:56:15,888 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-24 11:56:15,889 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 50 has failed. Your account has been refunded with KES 50 Saiba Credits which can be used to transact on Saiba to 4
2017-03-24 11:56:15,889 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 50 has failed. Your account has been refunded with KES 50 Saiba Credits which can be used to transact on Saiba to 4
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 50 has failed. Your account has been refunded with KES 50 Saiba Credits which can be used to transact on Saiba to 4
2017-03-24 11:56:15,889 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 50 has failed. Your account has been refunded with KES 50 Saiba Credits which can be used to transact on Saiba", "user": "4", "title": "Safaricom  Airtime"}
2017-03-24 11:56:15,889 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 50 has failed. Your account has been refunded with KES 50 Saiba Credits which can be used to transact on Saiba", "user": "4", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 50 has failed. Your account has been refunded with KES 50 Saiba Credits which can be used to transact on Saiba", "user": "4", "title": "Safaricom  Airtime"}
2017-03-24 11:56:15,890 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-24 11:56:15,890 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-24 11:56:15,890 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 50 has failed. Your account has been refunded with KES 50 Saiba Credits which can be used to transact on Saiba
2017-03-24 11:56:15,890 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 50 has failed. Your account has been refunded with KES 50 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 50 has failed. Your account has been refunded with KES 50 Saiba Credits which can be used to transact on Saiba
2017-03-24 11:56:15,932 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":91,"user":4,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 50 has failed. Your account has been refunded with KES 50 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-24T11:56:13.581526Z"}
2017-03-24 11:56:15,932 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":91,"user":4,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 50 has failed. Your account has been refunded with KES 50 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-24T11:56:13.581526Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":91,"user":4,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 50 has failed. Your account has been refunded with KES 50 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-24T11:56:13.581526Z"}
2017-03-24 11:56:15,934 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-24 11:56:15,934 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-24 11:56:15,935 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-24 11:56:15,935 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-24 11:56:15,935 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-24 11:56:15,935 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-24 11:56:15,936 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "50", "user": 4, "user_credit_type": 1, "debit": "0"}
2017-03-24 11:56:15,936 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "50", "user": 4, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "50", "user": 4, "user_credit_type": 1, "debit": "0"}
2017-03-24 11:56:15,992 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-24 11:56:15,992 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-24 11:56:15,993 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":4,"user_credit_type":1,"debit":0.0,"credit":50.0,"balance":50.0}
2017-03-24 11:56:15,993 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":4,"user_credit_type":1,"debit":0.0,"credit":50.0,"balance":50.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":4,"user_credit_type":1,"debit":0.0,"credit":50.0,"balance":50.0}
{"user":4,"user_credit_type":1,"debit":0.0,"credit":50.0,"balance":50.0}
2017-03-24 11:56:15,994 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-24 11:56:15,994 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-24 11:56:15,995 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-24 11:56:15,995 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-24 11:56:15,995 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-24 11:56:15,995 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-24 11:56:15,996 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-24 11:56:15,996 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-24 11:56:15,997 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 4, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "50", "service_provider_id": 1}
2017-03-24 11:56:15,997 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 4, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "50", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "721799582", "user": 4, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "50", "service_provider_id": 1}
2017-03-24 11:56:15,997 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-24 11:56:15,997 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-24 11:56:17,205 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-24 11:56:17,205 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-24 11:56:17,206 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":71,"user":4,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"721799582","request":null,"amount":50.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-24 11:56:17,206 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":71,"user":4,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"721799582","request":null,"amount":50.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":71,"user":4,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"721799582","request":null,"amount":50.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-24 11:56:17,207 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-24 11:56:17,207 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-24 11:56:17,208 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-24 11:56:17,208 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-24 11:56:17,209 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-24 11:56:17,209 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-24 11:56:17,219 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-24 11:56:17,219 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-24 11:56:17,220 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 1867.77ms
2017-03-24 11:56:17,220 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 1867.77ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 1867.77ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-24 12:40:56,097 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-24 12:40:56,098 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-24 12:40:56,098 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 24/03/2017 12:40:56
2017-03-24 12:40:56,099 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-24 12:40:56,099 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-24 12:40:56,100 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = ed070f311af94af1a7d020a8078c761a
2017-03-24 12:40:56,101 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-24 12:40:56,101 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 4, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 5, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-24 12:40:56,101 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-24 12:40:56,102 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-24 12:40:56,102 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 12:40:56</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ed070f311af94af1a7d020a8078c761a</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-24 12:40:56,102 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-24 12:40:56,103 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-24 12:40:56,103 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 12:40:56</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ed070f311af94af1a7d020a8078c761a</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-24 12:40:56,103 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 24/03/2017 12:40:56
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = ed070f311af94af1a7d020a8078c761a
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 4, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 5, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 12:40:56</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ed070f311af94af1a7d020a8078c761a</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 12:40:56</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ed070f311af94af1a7d020a8078c761a</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-24 12:40:56,097 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-24 12:40:56,098 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-24 12:40:56,098 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 24/03/2017 12:40:56
2017-03-24 12:40:56,099 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-24 12:40:56,099 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-24 12:40:56,100 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = ed070f311af94af1a7d020a8078c761a
2017-03-24 12:40:56,101 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-24 12:40:56,101 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 4, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 5, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-24 12:40:56,101 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-24 12:40:56,102 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-24 12:40:56,102 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 12:40:56</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ed070f311af94af1a7d020a8078c761a</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-24 12:40:56,102 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-24 12:40:56,103 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-24 12:40:56,103 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>24/03/2017 12:40:56</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ed070f311af94af1a7d020a8078c761a</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-24 12:40:56,103 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-24 12:40:56,766 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-24 12:40:56,767 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>24/03/17 12:40:54</ns0:DATE><ns0:EXTREFNUM>ed070f311af94af1a7d020a8078c761a</ns0:EXTREFNUM><ns0:TXNID>R170324.1240.130054</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 5</ns0:MESSAGE></ns0:COMMAND>

2017-03-24 12:40:56,767 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-24 12:40:56,767 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
2017-03-24 12:40:56,767 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-24 12:40:56,767 = handlers.result_handler.AirtimeHandler - DEBUG - 24/03/17 12:40:54
2017-03-24 12:40:56,768 = handlers.result_handler.AirtimeHandler - DEBUG - ed070f311af94af1a7d020a8078c761a
2017-03-24 12:40:56,768 = handlers.result_handler.AirtimeHandler - DEBUG - R170324.1240.130054
2017-03-24 12:40:56,768 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'24/03/17 12:40:54', 'amount': '5', 'external_ref': u'R170324.1240.130054', 'msisdn_2': u'254702935200', 'internal_ref': 'S2X126I1L4'}
2017-03-24 12:40:56,768 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>24/03/17 12:40:54</ns0:DATE><ns0:EXTREFNUM>ed070f311af94af1a7d020a8078c761a</ns0:EXTREFNUM><ns0:TXNID>R170324.1240.130054</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 5</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------5-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:24/03/17 12:40:54
DEBUG:handlers.result_handler.AirtimeHandler:ed070f311af94af1a7d020a8078c761a
DEBUG:handlers.result_handler.AirtimeHandler:R170324.1240.130054
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'24/03/17 12:40:54', 'amount': '5', 'external_ref': u'R170324.1240.130054', 'msisdn_2': u'254702935200', 'internal_ref': 'S2X126I1L4'}
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-24 12:40:56,766 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-24 12:40:56,767 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>24/03/17 12:40:54</ns0:DATE><ns0:EXTREFNUM>ed070f311af94af1a7d020a8078c761a</ns0:EXTREFNUM><ns0:TXNID>R170324.1240.130054</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 5</ns0:MESSAGE></ns0:COMMAND>

2017-03-24 12:40:56,767 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-24 12:40:56,767 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
2017-03-24 12:40:56,767 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-24 12:40:56,767 = handlers.result_handler.AirtimeHandler - DEBUG - 24/03/17 12:40:54
2017-03-24 12:40:56,768 = handlers.result_handler.AirtimeHandler - DEBUG - ed070f311af94af1a7d020a8078c761a
2017-03-24 12:40:56,768 = handlers.result_handler.AirtimeHandler - DEBUG - R170324.1240.130054
2017-03-24 12:40:56,768 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'24/03/17 12:40:54', 'amount': '5', 'external_ref': u'R170324.1240.130054', 'msisdn_2': u'254702935200', 'internal_ref': 'S2X126I1L4'}
2017-03-24 12:40:56,768 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-24 12:40:56,811 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-24 12:40:56,812 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-24 12:40:56,817 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-24 12:40:56,821 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-24 12:40:56,825 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-24 12:40:56,826 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-24 12:40:56,869 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-24 12:40:56,870 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-24 12:40:56,876 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-24 12:40:56,877 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-24 12:40:56,880 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-24 12:40:56,881 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-24 12:40:56,883 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-24 12:40:56,884 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-24 12:40:56,886 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-24 12:40:56,887 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-24 12:40:56,891 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-24 12:40:56,891 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-24 12:40:56,894 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-24 12:40:56,894 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f1e87209850>
2017-03-24 12:40:56,902 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-24 12:40:56,902 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-24 12:40:56,903 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-24 12:40:56,903 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-24 12:40:56,904 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is S2X126I1L4
2017-03-24 12:40:56,904 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is S2X126I1L4
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is S2X126I1L4
2017-03-24 12:40:56,905 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is S2X126I1L4 to 254702935200
2017-03-24 12:40:56,905 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is S2X126I1L4 to 254702935200
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is S2X126I1L4 to 254702935200
2017-03-24 12:40:56,905 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-24 12:40:56,905 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-24 12:40:56,906 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is S2X126I1L4 to 4
2017-03-24 12:40:56,906 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is S2X126I1L4 to 4
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is S2X126I1L4 to 4
2017-03-24 12:40:56,906 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is S2X126I1L4", "user": "4", "title": "Safaricom  Airtime"}
2017-03-24 12:40:56,906 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is S2X126I1L4", "user": "4", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is S2X126I1L4", "user": "4", "title": "Safaricom  Airtime"}
2017-03-24 12:40:56,907 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-24 12:40:56,907 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-24 12:40:56,908 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 5  Safaricom Airtime. Your transaction number is S2X126I1L4
2017-03-24 12:40:56,908 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 5  Safaricom Airtime. Your transaction number is S2X126I1L4
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 5  Safaricom Airtime. Your transaction number is S2X126I1L4
2017-03-24 12:40:58,091 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":93,"user":4,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is S2X126I1L4","image_url":"","date":"2017-03-24T12:40:55.652416Z"}
2017-03-24 12:40:58,091 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":93,"user":4,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is S2X126I1L4","image_url":"","date":"2017-03-24T12:40:55.652416Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":93,"user":4,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is S2X126I1L4","image_url":"","date":"2017-03-24T12:40:55.652416Z"}
2017-03-24 12:40:58,092 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-24 12:40:58,092 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-24 12:40:58,093 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":93,"user":4,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is S2X126I1L4","image_url":"","date":"2017-03-24T12:40:55.652416Z"}
2017-03-24 12:40:58,093 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":93,"user":4,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is S2X126I1L4","image_url":"","date":"2017-03-24T12:40:55.652416Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":93,"user":4,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is S2X126I1L4","image_url":"","date":"2017-03-24T12:40:55.652416Z"}
2017-03-24 12:40:58,094 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-24 12:40:58,094 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-24 12:40:58,095 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-24 12:40:58,095 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-24 12:40:58,095 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-24 12:40:58,095 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-24 12:40:58,096 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-24 12:40:58,096 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-24 12:40:58,097 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 4, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-24 12:40:58,097 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 4, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 4, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-24 12:40:58,098 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-24 12:40:58,098 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-24 12:40:58,300 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-24 12:40:58,300 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-24 12:40:58,301 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":73,"user":4,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-24 12:40:58,301 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":73,"user":4,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":73,"user":4,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-24 12:40:58,301 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-24 12:40:58,301 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-24 12:40:58,302 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-24 12:40:58,302 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-24 12:40:58,303 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-24 12:40:58,303 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-24 12:40:58,315 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-24 12:40:58,315 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-24 12:40:58,317 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2220.31ms
2017-03-24 12:40:58,317 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2220.31ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 2220.31ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-24 13:17:58,909 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.74ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.74ms
2017-03-24 13:17:58,909 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.74ms
2017-03-24 13:45:34,572 = tornado.access - WARNING - 404 GET /manager/html (58.221.58.113) 0.45ms
WARNING:tornado.access:404 GET /manager/html (58.221.58.113) 0.45ms
2017-03-24 13:45:34,572 = tornado.access - WARNING - 404 GET /manager/html (58.221.58.113) 0.45ms
2017-03-24 13:58:43,400 = tornado.access - WARNING - 404 GET /manager/html (221.194.44.252) 0.49ms
WARNING:tornado.access:404 GET /manager/html (221.194.44.252) 0.49ms
2017-03-24 13:58:43,400 = tornado.access - WARNING - 404 GET /manager/html (221.194.44.252) 0.49ms
2017-03-24 16:55:26,183 = tornado.access - WARNING - 404 GET /manager/html (157.52.205.63) 0.73ms
WARNING:tornado.access:404 GET /manager/html (157.52.205.63) 0.73ms
2017-03-24 16:55:26,183 = tornado.access - WARNING - 404 GET /manager/html (157.52.205.63) 0.73ms
2017-03-24 19:13:09,028 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.80ms
2017-03-24 19:13:09,028 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.80ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.80ms
2017-03-24 19:34:56,657 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.65ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.65ms
2017-03-24 19:34:56,657 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.65ms
2017-03-24 22:08:53,826 = tornado.access - WARNING - 404 GET /manager/html (42.51.33.200) 0.63ms
WARNING:tornado.access:404 GET /manager/html (42.51.33.200) 0.63ms
2017-03-24 22:08:53,826 = tornado.access - WARNING - 404 GET /manager/html (42.51.33.200) 0.63ms
2017-03-25 00:45:28,645 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.76ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.76ms
2017-03-25 00:45:28,645 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.76ms
2017-03-25 01:44:23,042 = tornado.access - WARNING - 404 GET / (113.189.211.99) 0.52ms
WARNING:tornado.access:404 GET / (113.189.211.99) 0.52ms
2017-03-25 01:44:23,042 = tornado.access - WARNING - 404 GET / (113.189.211.99) 0.52ms
2017-03-25 02:51:17,143 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.51ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.51ms
2017-03-25 02:51:17,143 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.51ms
2017-03-25 05:26:00,252 = tornado.access - WARNING - 404 GET /manager/html (49.4.142.203) 1.01ms
WARNING:tornado.access:404 GET /manager/html (49.4.142.203) 1.01ms
2017-03-25 05:26:00,252 = tornado.access - WARNING - 404 GET /manager/html (49.4.142.203) 1.01ms
2017-03-25 08:55:49,902 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.52ms
WARNING:tornado.access:404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.52ms
2017-03-25 08:55:49,902 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.52ms
2017-03-25 09:18:45,218 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.79ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.79ms
2017-03-25 09:18:45,218 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.79ms
2017-03-25 13:29:30,531 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.89ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.89ms
2017-03-25 13:29:30,531 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.89ms
2017-03-25 14:09:58,218 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (103.37.144.252) 0.50ms
2017-03-25 14:09:58,218 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (103.37.144.252) 0.50ms
WARNING:tornado.access:404 GET http://www.baidu.com/favicon.ico (103.37.144.252) 0.50ms
2017-03-25 14:19:57,592 = tornado.access - WARNING - 404 GET / (196.52.43.51) 0.90ms
WARNING:tornado.access:404 GET / (196.52.43.51) 0.90ms
2017-03-25 14:19:57,592 = tornado.access - WARNING - 404 GET / (196.52.43.51) 0.90ms
2017-03-25 15:14:57,227 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.47ms
2017-03-25 15:14:57,227 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.47ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.47ms
2017-03-25 16:26:57,265 = tornado.access - WARNING - 404 GET http://baidu.com/ (59.111.32.13) 0.76ms
WARNING:tornado.access:404 GET http://baidu.com/ (59.111.32.13) 0.76ms
2017-03-25 16:26:57,265 = tornado.access - WARNING - 404 GET http://baidu.com/ (59.111.32.13) 0.76ms
2017-03-25 20:27:34,462 = tornado.access - WARNING - 404 GET / (122.11.160.54) 0.68ms
WARNING:tornado.access:404 GET / (122.11.160.54) 0.68ms
2017-03-25 20:27:34,462 = tornado.access - WARNING - 404 GET / (122.11.160.54) 0.68ms
2017-03-25 22:14:00,935 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.86ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.86ms
2017-03-25 22:14:00,935 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.86ms
2017-03-26 04:45:49,963 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.49ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.49ms
2017-03-26 04:45:49,963 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.49ms
2017-03-26 05:41:16,159 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.57.251) 0.53ms
WARNING:tornado.access:404 GET http://www.baidu.com/favicon.ico (123.59.57.251) 0.53ms
2017-03-26 05:41:16,159 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.57.251) 0.53ms
2017-03-26 10:16:39,785 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.47ms
2017-03-26 10:16:39,785 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.47ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.47ms
2017-03-26 10:25:04,675 = tornado.access - WARNING - 404 GET / (101.108.243.61) 0.83ms
2017-03-26 10:25:04,675 = tornado.access - WARNING - 404 GET / (101.108.243.61) 0.83ms
WARNING:tornado.access:404 GET / (101.108.243.61) 0.83ms
2017-03-26 12:25:58,115 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.85ms
2017-03-26 12:25:58,115 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.85ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.85ms
2017-03-26 13:13:47,155 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.66ms
2017-03-26 13:13:47,155 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.66ms
WARNING:tornado.access:404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.66ms
2017-03-26 16:51:42,228 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.49ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.49ms
2017-03-26 16:51:42,228 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.49ms
2017-03-26 17:06:54,418 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.77ms
WARNING:tornado.access:404 GET http://www.google.com/ (91.236.75.4) 0.77ms
2017-03-26 17:06:54,418 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.77ms
2017-03-26 18:28:44,753 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/100000/-------------------
2017-03-26 18:28:44,754 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-26 18:28:44,754 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 26/03/2017 18:28:44
2017-03-26 18:28:44,755 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-26 18:28:44,756 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-26 18:28:44,756 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 23fce8336de74456a3c975d3e4d4af3f
2017-03-26 18:28:44,756 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-26 18:28:44,757 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 1000, u'account_number': None, u'mobile_number': u'254720384396', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-26 18:28:44,757 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-26 18:28:44,758 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-26 18:28:44,758 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>26/03/2017 18:28:44</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>23fce8336de74456a3c975d3e4d4af3f</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>100000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-26 18:28:44,759 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-26 18:28:44,759 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-26 18:28:44,759 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>26/03/2017 18:28:44</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>23fce8336de74456a3c975d3e4d4af3f</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>100000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-26 18:28:44,759 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/100000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 26/03/2017 18:28:44
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 23fce8336de74456a3c975d3e4d4af3f
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 1000, u'account_number': None, u'mobile_number': u'254720384396', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>26/03/2017 18:28:44</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>23fce8336de74456a3c975d3e4d4af3f</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>100000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>26/03/2017 18:28:44</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>23fce8336de74456a3c975d3e4d4af3f</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>100000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-26 18:28:44,753 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/100000/-------------------
2017-03-26 18:28:44,754 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-26 18:28:44,754 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 26/03/2017 18:28:44
2017-03-26 18:28:44,755 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-26 18:28:44,756 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-26 18:28:44,756 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 23fce8336de74456a3c975d3e4d4af3f
2017-03-26 18:28:44,756 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-26 18:28:44,757 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 1000, u'account_number': None, u'mobile_number': u'254720384396', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-26 18:28:44,757 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-26 18:28:44,758 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-26 18:28:44,758 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>26/03/2017 18:28:44</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>23fce8336de74456a3c975d3e4d4af3f</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>100000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-26 18:28:44,759 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-26 18:28:44,759 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-26 18:28:44,759 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>26/03/2017 18:28:44</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>23fce8336de74456a3c975d3e4d4af3f</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>100000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-26 18:28:44,759 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-26 18:28:45,278 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-26 18:28:45,278 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-26 18:28:45,279 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>26/03/17 18:28:36</ns0:DATE><ns0:EXTREFNUM>23fce8336de74456a3c975d3e4d4af3f</ns0:EXTREFNUM><ns0:TXNID>R170326.1828.130012</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 1000 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-26 18:28:45,279 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>26/03/17 18:28:36</ns0:DATE><ns0:EXTREFNUM>23fce8336de74456a3c975d3e4d4af3f</ns0:EXTREFNUM><ns0:TXNID>R170326.1828.130012</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 1000 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>26/03/17 18:28:36</ns0:DATE><ns0:EXTREFNUM>23fce8336de74456a3c975d3e4d4af3f</ns0:EXTREFNUM><ns0:TXNID>R170326.1828.130012</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 1000 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-26 18:28:45,280 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-26 18:28:45,280 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-26 18:28:45,280 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-26 18:28:45,280 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-26 18:28:45,281 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^1000
2017-03-26 18:28:45,281 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^1000
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^1000
2017-03-26 18:28:45,281 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 1000 has failed. Your account has been refunded with KES 1000 Saiba Credits which can be used to transact on Saiba
2017-03-26 18:28:45,281 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 1000 has failed. Your account has been refunded with KES 1000 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 1000 has failed. Your account has been refunded with KES 1000 Saiba Credits which can be used to transact on Saiba
2017-03-26 18:28:45,282 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-26 18:28:45,282 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-26 18:28:45,282 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 1000 has failed. Your account has been refunded with KES 1000 Saiba Credits which can be used to transact on Saiba to 8
2017-03-26 18:28:45,282 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 1000 has failed. Your account has been refunded with KES 1000 Saiba Credits which can be used to transact on Saiba to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 1000 has failed. Your account has been refunded with KES 1000 Saiba Credits which can be used to transact on Saiba to 8
2017-03-26 18:28:45,283 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 1000 has failed. Your account has been refunded with KES 1000 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-26 18:28:45,283 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 1000 has failed. Your account has been refunded with KES 1000 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 1000 has failed. Your account has been refunded with KES 1000 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-26 18:28:45,283 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-26 18:28:45,283 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-26 18:28:45,283 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 1000 has failed. Your account has been refunded with KES 1000 Saiba Credits which can be used to transact on Saiba
2017-03-26 18:28:45,283 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 1000 has failed. Your account has been refunded with KES 1000 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 1000 has failed. Your account has been refunded with KES 1000 Saiba Credits which can be used to transact on Saiba
2017-03-26 18:28:46,565 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":94,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 1000 has failed. Your account has been refunded with KES 1000 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-26T18:28:38.082947Z"}
2017-03-26 18:28:46,565 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":94,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 1000 has failed. Your account has been refunded with KES 1000 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-26T18:28:38.082947Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":94,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 1000 has failed. Your account has been refunded with KES 1000 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-26T18:28:38.082947Z"}
2017-03-26 18:28:46,566 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-26 18:28:46,566 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-26 18:28:46,567 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-26 18:28:46,567 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-26 18:28:46,567 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-26 18:28:46,567 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-26 18:28:46,568 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "1000", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-26 18:28:46,568 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "1000", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "1000", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-26 18:28:47,911 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-26 18:28:47,911 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-26 18:28:47,912 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":1000.0,"balance":2200.0}
2017-03-26 18:28:47,912 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":1000.0,"balance":2200.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":8,"user_credit_type":1,"debit":0.0,"credit":1000.0,"balance":2200.0}
{"user":8,"user_credit_type":1,"debit":0.0,"credit":1000.0,"balance":2200.0}
2017-03-26 18:28:47,912 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-26 18:28:47,912 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-26 18:28:47,913 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-26 18:28:47,913 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-26 18:28:47,914 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-26 18:28:47,914 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-26 18:28:47,915 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-26 18:28:47,915 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-26 18:28:47,915 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "720384396", "user": 8, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-26 18:28:47,915 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "720384396", "user": 8, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "720384396", "user": 8, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "1000", "service_provider_id": 1}
2017-03-26 18:28:47,916 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-26 18:28:47,916 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-26 18:28:48,985 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-26 18:28:48,985 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-26 18:28:48,986 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":75,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"720384396","request":null,"amount":1000.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-26 18:28:48,986 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":75,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"720384396","request":null,"amount":1000.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":75,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"720384396","request":null,"amount":1000.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-26 18:28:48,987 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-26 18:28:48,987 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-26 18:28:48,987 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-26 18:28:48,987 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-26 18:28:48,988 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-26 18:28:48,988 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-26 18:28:49,004 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-26 18:28:49,004 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-26 18:28:49,006 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4253.53ms
2017-03-26 18:28:49,006 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4253.53ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 4253.53ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-26 18:43:03,321 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/10000/-------------------
2017-03-26 18:43:03,322 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-26 18:43:03,322 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 26/03/2017 18:43:03
2017-03-26 18:43:03,322 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-26 18:43:03,322 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-26 18:43:03,323 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = c966202c1697434c81d713e1b607bc91
2017-03-26 18:43:03,323 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-26 18:43:03,323 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 100, u'account_number': None, u'mobile_number': u'254720384396', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-26 18:43:03,323 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-26 18:43:03,324 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-26 18:43:03,324 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>26/03/2017 18:43:03</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c966202c1697434c81d713e1b607bc91</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-26 18:43:03,324 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-26 18:43:03,324 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-26 18:43:03,324 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>26/03/2017 18:43:03</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c966202c1697434c81d713e1b607bc91</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-26 18:43:03,325 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/10000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 26/03/2017 18:43:03
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = c966202c1697434c81d713e1b607bc91
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 100, u'account_number': None, u'mobile_number': u'254720384396', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>26/03/2017 18:43:03</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c966202c1697434c81d713e1b607bc91</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>26/03/2017 18:43:03</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c966202c1697434c81d713e1b607bc91</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-26 18:43:03,321 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/10000/-------------------
2017-03-26 18:43:03,322 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-26 18:43:03,322 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 26/03/2017 18:43:03
2017-03-26 18:43:03,322 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-26 18:43:03,322 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-26 18:43:03,323 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = c966202c1697434c81d713e1b607bc91
2017-03-26 18:43:03,323 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-26 18:43:03,323 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 100, u'account_number': None, u'mobile_number': u'254720384396', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-26 18:43:03,323 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-26 18:43:03,324 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-26 18:43:03,324 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>26/03/2017 18:43:03</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c966202c1697434c81d713e1b607bc91</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-26 18:43:03,324 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-26 18:43:03,324 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-26 18:43:03,324 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>26/03/2017 18:43:03</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c966202c1697434c81d713e1b607bc91</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-26 18:43:03,325 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-26 18:43:03,844 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-26 18:43:03,844 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-26 18:43:03,845 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>26/03/17 18:42:55</ns0:DATE><ns0:EXTREFNUM>c966202c1697434c81d713e1b607bc91</ns0:EXTREFNUM><ns0:TXNID>R170326.1842.130019</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 100 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-26 18:43:03,845 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>26/03/17 18:42:55</ns0:DATE><ns0:EXTREFNUM>c966202c1697434c81d713e1b607bc91</ns0:EXTREFNUM><ns0:TXNID>R170326.1842.130019</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 100 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>26/03/17 18:42:55</ns0:DATE><ns0:EXTREFNUM>c966202c1697434c81d713e1b607bc91</ns0:EXTREFNUM><ns0:TXNID>R170326.1842.130019</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 100 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-26 18:43:03,846 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-26 18:43:03,846 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-26 18:43:03,847 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-26 18:43:03,847 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-26 18:43:03,847 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^100
2017-03-26 18:43:03,847 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^100
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^100
2017-03-26 18:43:03,848 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba
2017-03-26 18:43:03,848 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba
2017-03-26 18:43:03,849 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-26 18:43:03,849 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-26 18:43:03,850 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba to 8
2017-03-26 18:43:03,850 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba to 8
2017-03-26 18:43:03,851 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-26 18:43:03,851 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-26 18:43:03,852 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-26 18:43:03,852 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-26 18:43:03,852 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba
2017-03-26 18:43:03,852 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba
2017-03-26 18:43:05,114 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":95,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-26T18:42:56.601769Z"}
2017-03-26 18:43:05,114 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":95,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-26T18:42:56.601769Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":95,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-26T18:42:56.601769Z"}
2017-03-26 18:43:05,115 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-26 18:43:05,115 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-26 18:43:05,116 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-26 18:43:05,116 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-26 18:43:05,117 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-26 18:43:05,117 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-26 18:43:05,118 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "100", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-26 18:43:05,118 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "100", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "100", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-26 18:43:06,171 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-26 18:43:06,171 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-26 18:43:06,172 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":100.0,"balance":2300.0}
2017-03-26 18:43:06,172 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":100.0,"balance":2300.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":8,"user_credit_type":1,"debit":0.0,"credit":100.0,"balance":2300.0}
{"user":8,"user_credit_type":1,"debit":0.0,"credit":100.0,"balance":2300.0}
2017-03-26 18:43:06,172 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-26 18:43:06,172 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-26 18:43:06,173 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-26 18:43:06,173 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-26 18:43:06,173 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-26 18:43:06,173 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-26 18:43:06,174 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-26 18:43:06,174 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-26 18:43:06,174 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "720384396", "user": 8, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "100", "service_provider_id": 1}
2017-03-26 18:43:06,174 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "720384396", "user": 8, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "100", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "720384396", "user": 8, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "100", "service_provider_id": 1}
2017-03-26 18:43:06,174 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-26 18:43:06,174 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-26 18:43:07,393 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-26 18:43:07,393 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-26 18:43:07,394 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":76,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"720384396","request":null,"amount":100.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-26 18:43:07,394 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":76,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"720384396","request":null,"amount":100.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":76,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"720384396","request":null,"amount":100.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-26 18:43:07,395 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-26 18:43:07,395 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-26 18:43:07,396 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-26 18:43:07,396 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-26 18:43:07,397 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-26 18:43:07,397 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-26 18:43:07,407 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-26 18:43:07,407 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-26 18:43:07,409 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4088.19ms
2017-03-26 18:43:07,409 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4088.19ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 4088.19ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-26 18:49:39,974 = tornado.access - WARNING - 404 GET //index.php (222.186.134.86) 0.75ms
WARNING:tornado.access:404 GET //index.php (222.186.134.86) 0.75ms
2017-03-26 18:49:39,974 = tornado.access - WARNING - 404 GET //index.php (222.186.134.86) 0.75ms
2017-03-26 22:24:34,507 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.75ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.75ms
2017-03-26 22:24:34,507 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.75ms
2017-03-26 23:17:39,809 = tornado.access - WARNING - 404 GET / (139.162.79.87) 0.69ms
WARNING:tornado.access:404 GET / (139.162.79.87) 0.69ms
2017-03-26 23:17:39,809 = tornado.access - WARNING - 404 GET / (139.162.79.87) 0.69ms
2017-03-26 23:55:34,987 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.57.251) 0.49ms
WARNING:tornado.access:404 GET http://www.baidu.com/favicon.ico (123.59.57.251) 0.49ms
2017-03-26 23:55:34,987 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.57.251) 0.49ms
2017-03-27 02:47:49,966 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (180.150.188.118) 0.75ms
WARNING:tornado.access:404 GET http://www.baidu.com/favicon.ico (180.150.188.118) 0.75ms
2017-03-27 02:47:49,966 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (180.150.188.118) 0.75ms
2017-03-27 03:34:14,641 = tornado.access - WARNING - 404 GET / (68.187.29.159) 0.59ms
WARNING:tornado.access:404 GET / (68.187.29.159) 0.59ms
2017-03-27 03:34:14,641 = tornado.access - WARNING - 404 GET / (68.187.29.159) 0.59ms
2017-03-27 05:58:37,286 = tornado.access - WARNING - 404 GET / (139.162.111.98) 0.63ms
WARNING:tornado.access:404 GET / (139.162.111.98) 0.63ms
2017-03-27 05:58:37,286 = tornado.access - WARNING - 404 GET / (139.162.111.98) 0.63ms
2017-03-27 06:08:57,482 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.58ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.58ms
2017-03-27 06:08:57,482 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.58ms
2017-03-27 06:25:06,219 = tornado.access - WARNING - 404 GET / (80.82.77.139) 0.72ms
2017-03-27 06:25:06,219 = tornado.access - WARNING - 404 GET / (80.82.77.139) 0.72ms
WARNING:tornado.access:404 GET / (80.82.77.139) 0.72ms
2017-03-27 08:54:57,358 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-27 08:54:57,359 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-27 08:54:57,359 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 08:54:57
2017-03-27 08:54:57,359 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-27 08:54:57,360 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-27 08:54:57,360 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 0c3750da6fee467e857157fe787e9de7
2017-03-27 08:54:57,361 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-27 08:54:57,361 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 4, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 10, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-27 08:54:57,361 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 27/03/2017 08:54:57
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 0c3750da6fee467e857157fe787e9de7
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 4, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 10, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-27 08:54:57,358 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-27 08:54:57,359 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-27 08:54:57,359 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 08:54:57
2017-03-27 08:54:57,359 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-27 08:54:57,360 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-27 08:54:57,360 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 0c3750da6fee467e857157fe787e9de7
2017-03-27 08:54:57,361 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-27 08:54:57,361 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 4, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 10, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-27 08:54:57,361 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 08:54:57,362 = handlers.result_handler.AirtimeHandler - INFO - Building XML
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-27 08:54:57,362 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-27 08:54:57,362 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 08:54:57</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0c3750da6fee467e857157fe787e9de7</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 08:54:57,362 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 08:54:57</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0c3750da6fee467e857157fe787e9de7</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 08:54:57</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0c3750da6fee467e857157fe787e9de7</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 08:54:57,363 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-27 08:54:57,363 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-27 08:54:57,363 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-27 08:54:57,363 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-27 08:54:57,364 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 08:54:57</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0c3750da6fee467e857157fe787e9de7</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 08:54:57,364 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 08:54:57</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0c3750da6fee467e857157fe787e9de7</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 08:54:57</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>0c3750da6fee467e857157fe787e9de7</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 08:54:57,364 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-27 08:54:57,364 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-27 08:54:57,869 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-27 08:54:57,869 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-27 08:54:57,869 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 08:54:47</ns0:DATE><ns0:EXTREFNUM>0c3750da6fee467e857157fe787e9de7</ns0:EXTREFNUM><ns0:TXNID>R170327.0854.130081</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 10 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-27 08:54:57,869 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 08:54:47</ns0:DATE><ns0:EXTREFNUM>0c3750da6fee467e857157fe787e9de7</ns0:EXTREFNUM><ns0:TXNID>R170327.0854.130081</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 10 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 08:54:57,869 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 08:54:47</ns0:DATE><ns0:EXTREFNUM>0c3750da6fee467e857157fe787e9de7</ns0:EXTREFNUM><ns0:TXNID>R170327.0854.130081</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 10 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 08:54:57,869 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-27 08:54:57,869 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 08:54:57,869 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 08:54:57,870 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^10
2017-03-27 08:54:57,870 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^10
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^10
2017-03-27 08:54:57,870 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-27 08:54:57,870 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-27 08:54:57,870 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-27 08:54:57,870 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-27 08:54:57,870 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 4
2017-03-27 08:54:57,870 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 4
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 4
2017-03-27 08:54:57,871 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "4", "title": "Safaricom  Airtime"}
2017-03-27 08:54:57,871 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "4", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "4", "title": "Safaricom  Airtime"}
2017-03-27 08:54:57,871 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-27 08:54:57,871 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-27 08:54:57,871 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-27 08:54:57,871 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-27 08:54:58,982 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":96,"user":4,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T08:54:48.875060Z"}
2017-03-27 08:54:58,982 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":96,"user":4,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T08:54:48.875060Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":96,"user":4,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T08:54:48.875060Z"}
2017-03-27 08:54:58,982 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 08:54:58,982 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 08:54:58,983 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-27 08:54:58,983 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-27 08:54:58,983 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 08:54:58,983 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 08:54:58,984 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "10", "user": 4, "user_credit_type": 1, "debit": "0"}
2017-03-27 08:54:58,984 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "10", "user": 4, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "10", "user": 4, "user_credit_type": 1, "debit": "0"}
2017-03-27 08:55:00,184 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 08:55:00,184 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-27 08:55:00,185 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":4,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":60.0}
2017-03-27 08:55:00,185 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":4,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":60.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":4,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":60.0}
{"user":4,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":60.0}
2017-03-27 08:55:00,185 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 08:55:00,185 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 08:55:00,187 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 08:55:00,187 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-27 08:55:00,187 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-27 08:55:00,187 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-27 08:55:00,187 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-27 08:55:00,187 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-27 08:55:00,188 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 4, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-27 08:55:00,188 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 4, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 4, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-27 08:55:00,188 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-27 08:55:00,188 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-27 08:55:01,355 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 08:55:01,355 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-27 08:55:01,356 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":77,"user":4,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":77,"user":4,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-27 08:55:01,356 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":77,"user":4,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-27 08:55:01,356 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 08:55:01,356 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 08:55:01,356 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-27 08:55:01,356 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-27 08:55:01,357 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-27 08:55:01,357 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-27 08:55:01,369 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-27 08:55:01,369 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-27 08:55:01,370 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4012.65ms
2017-03-27 08:55:01,370 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4012.65ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 4012.65ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-27 08:56:19,983 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-27 08:56:19,983 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-27 08:56:19,983 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-27 08:56:19,983 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-27 08:56:19,984 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 08:56:19
2017-03-27 08:56:19,984 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-27 08:56:19,984 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-27 08:56:19,984 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 8ab194ce6866496397aa0f505da37771
2017-03-27 08:56:19,985 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-27 08:56:19,985 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 4, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 10, u'account_number': None, u'mobile_number': u'254721799582', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-27 08:56:19,985 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 08:56:19,985 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-27 08:56:19,986 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 08:56:19</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8ab194ce6866496397aa0f505da37771</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 08:56:19,986 = handlers.result_handler.AirtimeHandler - INFO - Built XML
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 27/03/2017 08:56:19
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 8ab194ce6866496397aa0f505da37771
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 4, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 10, u'account_number': None, u'mobile_number': u'254721799582', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 08:56:19</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8ab194ce6866496397aa0f505da37771</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-27 08:56:19,984 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 08:56:19
2017-03-27 08:56:19,984 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-27 08:56:19,984 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-27 08:56:19,984 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 8ab194ce6866496397aa0f505da37771
2017-03-27 08:56:19,985 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-27 08:56:19,985 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 4, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 10, u'account_number': None, u'mobile_number': u'254721799582', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-27 08:56:19,985 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 08:56:19,985 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-27 08:56:19,986 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 08:56:19</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8ab194ce6866496397aa0f505da37771</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 08:56:19,986 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-27 08:56:19,986 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-27 08:56:19,986 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-27 08:56:19,989 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 08:56:19</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8ab194ce6866496397aa0f505da37771</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 08:56:19,989 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 08:56:19</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8ab194ce6866496397aa0f505da37771</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 08:56:19</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>8ab194ce6866496397aa0f505da37771</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 08:56:19,989 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-27 08:56:19,989 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-27 08:56:20,503 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-27 08:56:20,503 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-27 08:56:20,503 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 08:56:10</ns0:DATE><ns0:EXTREFNUM>8ab194ce6866496397aa0f505da37771</ns0:EXTREFNUM><ns0:TXNID>R170327.0856.130022</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 10 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 08:56:20,503 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 08:56:10</ns0:DATE><ns0:EXTREFNUM>8ab194ce6866496397aa0f505da37771</ns0:EXTREFNUM><ns0:TXNID>R170327.0856.130022</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 10 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 08:56:20,504 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-27 08:56:20,504 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 08:56:20,505 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^10
2017-03-27 08:56:20,505 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-27 08:56:20,505 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-27 08:56:20,506 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 4
2017-03-27 08:56:20,506 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "4", "title": "Safaricom  Airtime"}
2017-03-27 08:56:20,506 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-27 08:56:20,507 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 08:56:10</ns0:DATE><ns0:EXTREFNUM>8ab194ce6866496397aa0f505da37771</ns0:EXTREFNUM><ns0:TXNID>R170327.0856.130022</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 10 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^10
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 4
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "4", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-27 08:56:20,504 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-27 08:56:20,504 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 08:56:20,505 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^10
2017-03-27 08:56:20,505 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-27 08:56:20,505 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-27 08:56:20,506 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 4
2017-03-27 08:56:20,506 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "4", "title": "Safaricom  Airtime"}
2017-03-27 08:56:20,506 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-27 08:56:20,507 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-27 08:56:20,547 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":97,"user":4,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T08:56:10.438106Z"}
2017-03-27 08:56:20,547 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":97,"user":4,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T08:56:10.438106Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":97,"user":4,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T08:56:10.438106Z"}
2017-03-27 08:56:20,548 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 08:56:20,548 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 08:56:20,548 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-27 08:56:20,548 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-27 08:56:20,548 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 08:56:20,548 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 08:56:20,549 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "10", "user": 4, "user_credit_type": 1, "debit": "0"}
2017-03-27 08:56:20,549 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "10", "user": 4, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "10", "user": 4, "user_credit_type": 1, "debit": "0"}
2017-03-27 08:56:20,763 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 08:56:20,763 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-27 08:56:20,763 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":4,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":70.0}
2017-03-27 08:56:20,763 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":4,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":70.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":4,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":70.0}
{"user":4,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":70.0}
2017-03-27 08:56:20,763 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 08:56:20,763 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 08:56:20,765 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 08:56:20,765 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-27 08:56:20,765 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-27 08:56:20,765 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-27 08:56:20,765 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-27 08:56:20,765 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-27 08:56:20,765 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 4, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-27 08:56:20,765 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 4, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "721799582", "user": 4, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-27 08:56:20,765 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-27 08:56:20,765 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-27 08:56:20,811 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 08:56:20,811 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-27 08:56:20,812 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":78,"user":4,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-27 08:56:20,812 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":78,"user":4,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":78,"user":4,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-27 08:56:20,812 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 08:56:20,812 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 08:56:20,812 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-27 08:56:20,812 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-27 08:56:20,812 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-27 08:56:20,812 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-27 08:56:20,823 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-27 08:56:20,823 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-27 08:56:20,824 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 841.89ms
2017-03-27 08:56:20,824 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 841.89ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 841.89ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-27 09:38:59,325 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/10000/-------------------
2017-03-27 09:38:59,325 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/10000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/10000/-------------------
2017-03-27 09:38:59,325 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-27 09:38:59,325 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-27 09:38:59,326 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 09:38:59
2017-03-27 09:38:59,326 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 09:38:59
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 27/03/2017 09:38:59
2017-03-27 09:38:59,326 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-27 09:38:59,326 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-27 09:38:59,326 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-27 09:38:59,326 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-27 09:38:59,327 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 1c1d0cc4a2dc43c399fb55b7c174287a
2017-03-27 09:38:59,327 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-27 09:38:59,328 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 100, u'account_number': None, u'mobile_number': u'254720384396', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-27 09:38:59,328 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 09:38:59,329 = handlers.result_handler.AirtimeHandler - INFO - Building XML
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 1c1d0cc4a2dc43c399fb55b7c174287a
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 100, u'account_number': None, u'mobile_number': u'254720384396', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-27 09:38:59,327 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 1c1d0cc4a2dc43c399fb55b7c174287a
2017-03-27 09:38:59,327 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-27 09:38:59,328 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 100, u'account_number': None, u'mobile_number': u'254720384396', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-27 09:38:59,328 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 09:38:59,329 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-27 09:38:59,329 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 09:38:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1c1d0cc4a2dc43c399fb55b7c174287a</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 09:38:59,329 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 09:38:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1c1d0cc4a2dc43c399fb55b7c174287a</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 09:38:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1c1d0cc4a2dc43c399fb55b7c174287a</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 09:38:59,330 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-27 09:38:59,330 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-27 09:38:59,330 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-27 09:38:59,330 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-27 09:38:59,331 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 09:38:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1c1d0cc4a2dc43c399fb55b7c174287a</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 09:38:59,331 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 09:38:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1c1d0cc4a2dc43c399fb55b7c174287a</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 09:38:59</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1c1d0cc4a2dc43c399fb55b7c174287a</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>10000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 09:38:59,331 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-27 09:38:59,331 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-27 09:38:59,853 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-27 09:38:59,853 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-27 09:38:59,853 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 09:38:49</ns0:DATE><ns0:EXTREFNUM>1c1d0cc4a2dc43c399fb55b7c174287a</ns0:EXTREFNUM><ns0:TXNID>R170327.0938.130067</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 100 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 09:38:59,853 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 09:38:49</ns0:DATE><ns0:EXTREFNUM>1c1d0cc4a2dc43c399fb55b7c174287a</ns0:EXTREFNUM><ns0:TXNID>R170327.0938.130067</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 100 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 09:38:49</ns0:DATE><ns0:EXTREFNUM>1c1d0cc4a2dc43c399fb55b7c174287a</ns0:EXTREFNUM><ns0:TXNID>R170327.0938.130067</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 100 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 09:38:59,853 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-27 09:38:59,853 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-27 09:38:59,854 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 09:38:59,854 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 09:38:59,854 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^100
2017-03-27 09:38:59,854 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^100
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^100
2017-03-27 09:38:59,854 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba
2017-03-27 09:38:59,854 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba
2017-03-27 09:38:59,854 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-27 09:38:59,854 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-27 09:38:59,855 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba to 8
2017-03-27 09:38:59,855 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba to 8
2017-03-27 09:38:59,855 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-27 09:38:59,855 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-27 09:38:59,855 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-27 09:38:59,855 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-27 09:38:59,855 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba
2017-03-27 09:38:59,855 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba
2017-03-27 09:39:01,216 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":98,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T09:38:51.026151Z"}
2017-03-27 09:39:01,216 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":98,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T09:38:51.026151Z"}
2017-03-27 09:39:01,216 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:{"id":98,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 100 has failed. Your account has been refunded with KES 100 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T09:38:51.026151Z"}
2017-03-27 09:39:01,216 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 09:39:01,216 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-27 09:39:01,216 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-27 09:39:01,217 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 09:39:01,217 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 09:39:01,217 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "100", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-27 09:39:01,217 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "100", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "100", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-27 09:39:02,296 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 09:39:02,296 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 09:39:02,296 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":100.0,"balance":2400.0}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-27 09:39:02,296 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":100.0,"balance":2400.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":8,"user_credit_type":1,"debit":0.0,"credit":100.0,"balance":2400.0}
2017-03-27 09:39:02,297 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
{"user":8,"user_credit_type":1,"debit":0.0,"credit":100.0,"balance":2400.0}
2017-03-27 09:39:02,297 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 09:39:02,297 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 09:39:02,297 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 09:39:02,297 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-27 09:39:02,297 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-27 09:39:02,297 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-27 09:39:02,297 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-27 09:39:02,298 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "720384396", "user": 8, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "100", "service_provider_id": 1}
2017-03-27 09:39:02,298 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "720384396", "user": 8, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "100", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "720384396", "user": 8, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "100", "service_provider_id": 1}
2017-03-27 09:39:02,298 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-27 09:39:02,298 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-27 09:39:03,533 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 09:39:03,533 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-27 09:39:03,533 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":79,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"720384396","request":null,"amount":100.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-27 09:39:03,533 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":79,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"720384396","request":null,"amount":100.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":79,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"720384396","request":null,"amount":100.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-27 09:39:03,533 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 09:39:03,533 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 09:39:03,534 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-27 09:39:03,534 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-27 09:39:03,536 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-27 09:39:03,536 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-27 09:39:03,559 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-27 09:39:03,559 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-27 09:39:03,560 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4236.76ms
2017-03-27 09:39:03,560 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4236.76ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 4236.76ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-27 09:39:52,829 = __main__ - INFO - Creating server
2017-03-27 09:39:52,835 = __main__ - INFO - Created server
2017-03-27 09:39:52,836 = __main__ - INFO - Listening on port 8080
2017-03-27 10:03:43,149 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.83.40) 0.68ms
2017-03-27 10:03:43,149 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.83.40) 0.68ms
WARNING:tornado.access:404 GET http://www.baidu.com/favicon.ico (123.59.83.40) 0.68ms
2017-03-27 11:55:12,186 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-27 11:55:12,186 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-27 11:55:12,186 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
2017-03-27 11:55:12,186 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-27 11:55:12,186 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 11:55:12
2017-03-27 11:55:12,186 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 11:55:12
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 27/03/2017 11:55:12
2017-03-27 11:55:12,187 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-27 11:55:12,187 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-27 11:55:12,187 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-27 11:55:12,187 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-27 11:55:12,187 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = c37e7675a5ff478d8ef54fbe541bb7e6
2017-03-27 11:55:12,187 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = c37e7675a5ff478d8ef54fbe541bb7e6
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = c37e7675a5ff478d8ef54fbe541bb7e6
2017-03-27 11:55:12,188 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-27 11:55:12,188 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-27 11:55:12,188 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 4, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 10, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-27 11:55:12,188 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 4, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 10, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 4, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 10, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-27 11:55:12,188 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-27 11:55:12,188 = handlers.result_handler.AirtimeHandler - DEBUG - None
DEBUG:handlers.result_handler.AirtimeHandler:None
2017-03-27 11:55:12,188 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-27 11:55:12,188 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-27 11:55:12,189 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 11:55:12</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c37e7675a5ff478d8ef54fbe541bb7e6</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 11:55:12,189 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 11:55:12</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c37e7675a5ff478d8ef54fbe541bb7e6</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 11:55:12</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c37e7675a5ff478d8ef54fbe541bb7e6</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 11:55:12,189 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-27 11:55:12,189 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-27 11:55:12,189 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-27 11:55:12,189 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-27 11:55:12,189 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 11:55:12</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c37e7675a5ff478d8ef54fbe541bb7e6</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 11:55:12,189 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 11:55:12</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c37e7675a5ff478d8ef54fbe541bb7e6</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 11:55:12</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c37e7675a5ff478d8ef54fbe541bb7e6</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 11:55:12,190 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-27 11:55:12,190 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-27 11:55:12,701 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-27 11:55:12,701 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-27 11:55:12,701 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 11:55:02</ns0:DATE><ns0:EXTREFNUM>c37e7675a5ff478d8ef54fbe541bb7e6</ns0:EXTREFNUM><ns0:TXNID>R170327.1155.130004</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 10 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 11:55:12,701 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 11:55:02</ns0:DATE><ns0:EXTREFNUM>c37e7675a5ff478d8ef54fbe541bb7e6</ns0:EXTREFNUM><ns0:TXNID>R170327.1155.130004</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 10 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 11:55:02</ns0:DATE><ns0:EXTREFNUM>c37e7675a5ff478d8ef54fbe541bb7e6</ns0:EXTREFNUM><ns0:TXNID>R170327.1155.130004</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 10 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 11:55:12,702 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-27 11:55:12,702 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-27 11:55:12,702 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 11:55:12,702 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 11:55:12,702 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^10
2017-03-27 11:55:12,702 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^10
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^10
2017-03-27 11:55:12,702 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-27 11:55:12,702 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-27 11:55:12,703 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-27 11:55:12,703 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-27 11:55:12,703 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 4
2017-03-27 11:55:12,703 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 4
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 4
2017-03-27 11:55:12,703 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "4", "title": "Safaricom  Airtime"}
2017-03-27 11:55:12,703 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "4", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "4", "title": "Safaricom  Airtime"}
2017-03-27 11:55:12,703 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-27 11:55:12,703 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-27 11:55:12,703 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-27 11:55:12,703 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-27 11:55:13,062 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":104,"user":4,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T11:55:02.618116+03:00"}
2017-03-27 11:55:13,062 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":104,"user":4,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T11:55:02.618116+03:00"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":104,"user":4,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T11:55:02.618116+03:00"}
2017-03-27 11:55:13,062 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 11:55:13,062 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 11:55:13,063 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-27 11:55:13,063 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-27 11:55:13,063 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 11:55:13,063 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 11:55:13,063 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "10", "user": 4, "user_credit_type": 1, "debit": "0"}
2017-03-27 11:55:13,063 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "10", "user": 4, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "10", "user": 4, "user_credit_type": 1, "debit": "0"}
2017-03-27 11:55:14,309 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 11:55:14,309 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-27 11:55:14,310 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":4,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":80.0}
2017-03-27 11:55:14,310 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":4,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":80.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":4,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":80.0}
{"user":4,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":80.0}
2017-03-27 11:55:14,310 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 11:55:14,310 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 11:55:14,310 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 11:55:14,310 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-27 11:55:14,311 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-27 11:55:14,311 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-27 11:55:14,311 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-27 11:55:14,311 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-27 11:55:14,311 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 4, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-27 11:55:14,311 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 4, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 4, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-27 11:55:14,312 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-27 11:55:14,312 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-27 11:55:14,573 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 11:55:14,573 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 11:55:14,575 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":85,"user":4,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"id":85,"user":4,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-27 11:55:14,575 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":85,"user":4,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-27 11:55:14,576 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 11:55:14,578 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
2017-03-27 11:55:14,579 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-27 11:55:14,576 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 11:55:14,578 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
2017-03-27 11:55:14,579 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": null}
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 321, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-27 11:55:14,606 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-27 11:55:14,606 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-27 11:55:14,608 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2423.28ms
2017-03-27 11:55:14,608 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2423.28ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 2423.28ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-27 12:16:22,356 = __main__ - INFO - Creating server
2017-03-27 12:16:22,356 = __main__ - INFO - Creating server
2017-03-27 12:16:22,360 = __main__ - INFO - Created server
2017-03-27 12:16:22,360 = __main__ - INFO - Created server
2017-03-27 12:16:22,361 = __main__ - INFO - Listening on port 8080
2017-03-27 12:16:22,361 = __main__ - INFO - Listening on port 8080
2017-03-27 12:16:22,362 = __main__ - INFO - Starting event loop
2017-03-27 12:16:22,362 = __main__ - INFO - Starting event loop
2017-03-27 12:16:34,747 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-27 12:16:34,747 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
2017-03-27 12:16:34,747 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-27 12:16:34,747 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-27 12:16:34,748 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 12:16:34
2017-03-27 12:16:34,748 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 12:16:34
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 27/03/2017 12:16:34
2017-03-27 12:16:34,748 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-27 12:16:34,748 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-27 12:16:34,748 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-27 12:16:34,748 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-27 12:16:34,749 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 79b06a1b829f495382ac7e2e11dfe500
2017-03-27 12:16:34,749 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 79b06a1b829f495382ac7e2e11dfe500
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 79b06a1b829f495382ac7e2e11dfe500
2017-03-27 12:16:34,749 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-27 12:16:34,749 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-27 12:16:34,750 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 5, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 3}-----------------------------++++++++++++++
2017-03-27 12:16:34,750 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 5, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 3}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 5, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 3}-----------------------------++++++++++++++
2017-03-27 12:16:34,750 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 12:16:34,750 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-27 12:16:34,750 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-27 12:16:34,750 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-27 12:16:34,751 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:16:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>79b06a1b829f495382ac7e2e11dfe500</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 12:16:34,751 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:16:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>79b06a1b829f495382ac7e2e11dfe500</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:16:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>79b06a1b829f495382ac7e2e11dfe500</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 12:16:34,751 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-27 12:16:34,751 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-27 12:16:34,752 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-27 12:16:34,752 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-27 12:16:34,752 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:16:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>79b06a1b829f495382ac7e2e11dfe500</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-27 12:16:34,752 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:16:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>79b06a1b829f495382ac7e2e11dfe500</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:16:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>79b06a1b829f495382ac7e2e11dfe500</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 12:16:34,752 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-27 12:16:34,752 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-27 12:16:35,527 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-27 12:16:35,527 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-27 12:16:35,528 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>27/03/17 12:16:24</ns0:DATE><ns0:EXTREFNUM>79b06a1b829f495382ac7e2e11dfe500</ns0:EXTREFNUM><ns0:TXNID>R170327.1216.130041</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 0</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-27 12:16:35,528 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>27/03/17 12:16:24</ns0:DATE><ns0:EXTREFNUM>79b06a1b829f495382ac7e2e11dfe500</ns0:EXTREFNUM><ns0:TXNID>R170327.1216.130041</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 0</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 12:16:35,528 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>27/03/17 12:16:24</ns0:DATE><ns0:EXTREFNUM>79b06a1b829f495382ac7e2e11dfe500</ns0:EXTREFNUM><ns0:TXNID>R170327.1216.130041</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 0</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 12:16:35,528 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-27 12:16:35,528 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
2017-03-27 12:16:35,528 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------5-----------------------
2017-03-27 12:16:35,529 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-27 12:16:35,529 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-27 12:16:35,529 = handlers.result_handler.AirtimeHandler - DEBUG - 27/03/17 12:16:24
2017-03-27 12:16:35,529 = handlers.result_handler.AirtimeHandler - DEBUG - 27/03/17 12:16:24
DEBUG:handlers.result_handler.AirtimeHandler:27/03/17 12:16:24
2017-03-27 12:16:35,530 = handlers.result_handler.AirtimeHandler - DEBUG - 79b06a1b829f495382ac7e2e11dfe500
2017-03-27 12:16:35,530 = handlers.result_handler.AirtimeHandler - DEBUG - 79b06a1b829f495382ac7e2e11dfe500
DEBUG:handlers.result_handler.AirtimeHandler:79b06a1b829f495382ac7e2e11dfe500
2017-03-27 12:16:35,530 = handlers.result_handler.AirtimeHandler - DEBUG - R170327.1216.130041
2017-03-27 12:16:35,530 = handlers.result_handler.AirtimeHandler - DEBUG - R170327.1216.130041
DEBUG:handlers.result_handler.AirtimeHandler:R170327.1216.130041
2017-03-27 12:16:35,531 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'27/03/17 12:16:24', 'amount': '5', 'external_ref': u'R170327.1216.130041', 'msisdn_2': u'254702935200', 'internal_ref': 'ACFDEK8I8X'}
2017-03-27 12:16:35,531 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'27/03/17 12:16:24', 'amount': '5', 'external_ref': u'R170327.1216.130041', 'msisdn_2': u'254702935200', 'internal_ref': 'ACFDEK8I8X'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'27/03/17 12:16:24', 'amount': '5', 'external_ref': u'R170327.1216.130041', 'msisdn_2': u'254702935200', 'internal_ref': 'ACFDEK8I8X'}
2017-03-27 12:16:35,531 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-27 12:16:35,531 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-27 12:16:35,713 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-27 12:16:35,713 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-27 12:16:35,717 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-27 12:16:35,717 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-27 12:16:35,724 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-27 12:16:35,724 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-27 12:16:35,729 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-27 12:16:35,729 INFO sqlalchemy.engine.base.Engine {}
2017-03-27 12:16:35,744 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-27 12:16:35,744 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-27 12:16:35,747 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-27 12:16:35,747 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-27 12:16:35,752 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-27 12:16:35,753 INFO sqlalchemy.engine.base.Engine {'table': 23559}
2017-03-27 12:16:35,755 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-27 12:16:35,755 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-27 12:16:35,759 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-27 12:16:35,760 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-27 12:16:35,761 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-27 12:16:35,761 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-27 12:16:35,768 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7fc13f2ee890>
2017-03-27 12:16:35,768 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-27 12:16:35,768 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-27 12:16:35,768 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-27 12:16:35,768 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is ACFDEK8I8X
2017-03-27 12:16:35,768 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is ACFDEK8I8X
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is ACFDEK8I8X
2017-03-27 12:16:35,768 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is ACFDEK8I8X to 254702935200
2017-03-27 12:16:35,768 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is ACFDEK8I8X to 254702935200
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is ACFDEK8I8X to 254702935200
2017-03-27 12:16:35,769 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-27 12:16:35,769 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-27 12:16:35,769 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is ACFDEK8I8X to 7
2017-03-27 12:16:35,769 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is ACFDEK8I8X to 7
2017-03-27 12:16:35,769 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is ACFDEK8I8X", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is ACFDEK8I8X to 7
2017-03-27 12:16:35,769 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is ACFDEK8I8X", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is ACFDEK8I8X", "user": "7", "title": "Safaricom  Airtime"}
2017-03-27 12:16:35,769 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-27 12:16:35,769 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-27 12:16:35,770 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 5  Safaricom Airtime. Your transaction number is ACFDEK8I8X
2017-03-27 12:16:35,770 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 5  Safaricom Airtime. Your transaction number is ACFDEK8I8X
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 5  Safaricom Airtime. Your transaction number is ACFDEK8I8X
2017-03-27 12:16:37,072 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":110,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is ACFDEK8I8X","image_url":"","date":"2017-03-27T12:16:26.589278+03:00"}
2017-03-27 12:16:37,072 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":110,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is ACFDEK8I8X","image_url":"","date":"2017-03-27T12:16:26.589278+03:00"}
2017-03-27 12:16:37,073 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:{"id":110,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is ACFDEK8I8X","image_url":"","date":"2017-03-27T12:16:26.589278+03:00"}
2017-03-27 12:16:37,073 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-27 12:16:37,073 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":110,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is ACFDEK8I8X","image_url":"","date":"2017-03-27T12:16:26.589278+03:00"}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:{"id":110,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is ACFDEK8I8X","image_url":"","date":"2017-03-27T12:16:26.589278+03:00"}
2017-03-27 12:16:37,073 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-27 12:16:37,073 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":110,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is ACFDEK8I8X","image_url":"","date":"2017-03-27T12:16:26.589278+03:00"}
2017-03-27 12:16:37,073 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-27 12:16:37,073 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-27 12:16:37,073 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 12:16:37,073 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-27 12:16:37,073 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-27 12:16:37,074 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-27 12:16:37,074 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-27 12:16:37,074 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-27 12:16:37,074 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-27 12:16:37,074 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-27 12:16:37,074 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-27 12:16:38,079 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 12:16:38,080 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":91,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-27 12:16:38,079 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"id":91,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-27 12:16:38,080 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:16:38,080 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":91,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-27 12:16:38,080 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:16:38,081 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-27 12:16:38,081 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-27 12:16:38,081 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 322, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-27 12:16:38,081 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 322, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 322, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-27 12:16:38,089 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-27 12:16:38,089 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-27 12:16:38,090 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3344.75ms
2017-03-27 12:16:38,090 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3344.75ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3344.75ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-27 12:22:14,420 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-27 12:22:14,420 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-27 12:22:14,421 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 12:22:14
2017-03-27 12:22:14,421 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-27 12:22:14,421 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-27 12:22:14,422 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = c863393820a64cf98d5041517c8d44a0
2017-03-27 12:22:14,422 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-27 12:22:14,422 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 5, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 3}-----------------------------++++++++++++++
2017-03-27 12:22:14,423 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 12:22:14,423 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-27 12:22:14,423 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:22:14</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c863393820a64cf98d5041517c8d44a0</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 12:22:14,424 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-27 12:22:14,424 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-27 12:22:14,424 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:22:14</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c863393820a64cf98d5041517c8d44a0</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 12:22:14,424 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 27/03/2017 12:22:14
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = c863393820a64cf98d5041517c8d44a0
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 5, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 3}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:22:14</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c863393820a64cf98d5041517c8d44a0</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:22:14</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c863393820a64cf98d5041517c8d44a0</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-27 12:22:14,420 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-27 12:22:14,420 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-27 12:22:14,421 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 12:22:14
2017-03-27 12:22:14,421 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-27 12:22:14,421 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-27 12:22:14,422 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = c863393820a64cf98d5041517c8d44a0
2017-03-27 12:22:14,422 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-27 12:22:14,422 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 5, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 3}-----------------------------++++++++++++++
2017-03-27 12:22:14,423 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 12:22:14,423 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-27 12:22:14,423 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:22:14</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c863393820a64cf98d5041517c8d44a0</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 12:22:14,424 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-27 12:22:14,424 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-27 12:22:14,424 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:22:14</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c863393820a64cf98d5041517c8d44a0</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 12:22:14,424 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-27 12:22:14,943 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-27 12:22:14,943 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-27 12:22:14,944 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 12:22:04</ns0:DATE><ns0:EXTREFNUM>c863393820a64cf98d5041517c8d44a0</ns0:EXTREFNUM><ns0:TXNID>R170327.1222.130004</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 5 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 12:22:14,944 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 12:22:04</ns0:DATE><ns0:EXTREFNUM>c863393820a64cf98d5041517c8d44a0</ns0:EXTREFNUM><ns0:TXNID>R170327.1222.130004</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 5 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 12:22:04</ns0:DATE><ns0:EXTREFNUM>c863393820a64cf98d5041517c8d44a0</ns0:EXTREFNUM><ns0:TXNID>R170327.1222.130004</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 5 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 12:22:14,944 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-27 12:22:14,944 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-27 12:22:14,945 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 12:22:14,945 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 12:22:14,945 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-27 12:22:14,945 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-27 12:22:14,946 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-27 12:22:14,946 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-27 12:22:14,947 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-27 12:22:14,947 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-27 12:22:14,947 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 7
2017-03-27 12:22:14,947 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 7
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 7
2017-03-27 12:22:14,948 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
2017-03-27 12:22:14,948 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
2017-03-27 12:22:14,949 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-27 12:22:14,949 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-27 12:22:14,949 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-27 12:22:14,949 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-27 12:22:16,064 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":111,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T12:22:05.569761+03:00"}
2017-03-27 12:22:16,064 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":111,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T12:22:05.569761+03:00"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":111,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T12:22:05.569761+03:00"}
2017-03-27 12:22:16,065 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 12:22:16,065 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 12:22:16,066 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-27 12:22:16,066 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-27 12:22:16,066 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 12:22:16,066 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 12:22:16,067 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5", "user": 7, "user_credit_type": 1, "debit": "0"}
2017-03-27 12:22:16,067 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5", "user": 7, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "5", "user": 7, "user_credit_type": 1, "debit": "0"}
2017-03-27 12:22:17,316 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 12:22:17,316 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-27 12:22:17,318 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":7,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":990.0}
2017-03-27 12:22:17,318 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":7,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":990.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":7,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":990.0}
{"user":7,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":990.0}
2017-03-27 12:22:17,318 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:22:17,318 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:22:17,319 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 12:22:17,319 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-27 12:22:17,320 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-27 12:22:17,320 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-27 12:22:17,321 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-27 12:22:17,321 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-27 12:22:17,321 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-27 12:22:17,321 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-27 12:22:17,322 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-27 12:22:17,322 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-27 12:22:18,544 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 12:22:18,544 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-27 12:22:18,545 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":92,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-27 12:22:18,545 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":92,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":92,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-27 12:22:18,546 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:22:18,546 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:22:18,547 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-27 12:22:18,547 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-27 12:22:18,547 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 322, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-27 12:22:18,547 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 322, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 322, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-27 12:22:18,555 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-27 12:22:18,555 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-27 12:22:18,557 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4138.30ms
2017-03-27 12:22:18,557 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4138.30ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 4138.30ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-27 12:25:34,170 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1600/-------------------
2017-03-27 12:25:34,171 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-27 12:25:34,171 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 12:25:34
2017-03-27 12:25:34,171 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-27 12:25:34,172 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-27 12:25:34,172 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = bb70a22520fb412e825cedc4dee7691b
2017-03-27 12:25:34,172 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-27 12:25:34,172 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 16, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 3}-----------------------------++++++++++++++
2017-03-27 12:25:34,172 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 12:25:34,173 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-27 12:25:34,173 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:25:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>bb70a22520fb412e825cedc4dee7691b</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1600</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 12:25:34,173 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-27 12:25:34,173 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-27 12:25:34,173 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:25:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>bb70a22520fb412e825cedc4dee7691b</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1600</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 12:25:34,174 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1600/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 27/03/2017 12:25:34
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = bb70a22520fb412e825cedc4dee7691b
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 16, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 3}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:25:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>bb70a22520fb412e825cedc4dee7691b</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1600</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:25:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>bb70a22520fb412e825cedc4dee7691b</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1600</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-27 12:25:34,170 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1600/-------------------
2017-03-27 12:25:34,171 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-27 12:25:34,171 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 12:25:34
2017-03-27 12:25:34,171 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-27 12:25:34,172 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-27 12:25:34,172 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = bb70a22520fb412e825cedc4dee7691b
2017-03-27 12:25:34,172 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-27 12:25:34,172 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'amount': 16, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 3}-----------------------------++++++++++++++
2017-03-27 12:25:34,172 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 12:25:34,173 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-27 12:25:34,173 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:25:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>bb70a22520fb412e825cedc4dee7691b</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1600</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 12:25:34,173 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-27 12:25:34,173 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-27 12:25:34,173 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:25:34</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>bb70a22520fb412e825cedc4dee7691b</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1600</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 12:25:34,174 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-27 12:25:34,746 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-27 12:25:34,746 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-27 12:25:34,748 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 12:25:24</ns0:DATE><ns0:EXTREFNUM>bb70a22520fb412e825cedc4dee7691b</ns0:EXTREFNUM><ns0:TXNID>R170327.1225.130024</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 16 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 12:25:34,748 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 12:25:24</ns0:DATE><ns0:EXTREFNUM>bb70a22520fb412e825cedc4dee7691b</ns0:EXTREFNUM><ns0:TXNID>R170327.1225.130024</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 16 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 12:25:24</ns0:DATE><ns0:EXTREFNUM>bb70a22520fb412e825cedc4dee7691b</ns0:EXTREFNUM><ns0:TXNID>R170327.1225.130024</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 16 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 12:25:34,748 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-27 12:25:34,748 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-27 12:25:34,749 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 12:25:34,749 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 12:25:34,750 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^16
2017-03-27 12:25:34,750 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^16
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^16
2017-03-27 12:25:34,751 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 16 has failed. Your account has been refunded with KES 16 Saiba Credits which can be used to transact on Saiba
2017-03-27 12:25:34,751 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 16 has failed. Your account has been refunded with KES 16 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 16 has failed. Your account has been refunded with KES 16 Saiba Credits which can be used to transact on Saiba
2017-03-27 12:25:34,751 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-27 12:25:34,751 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-27 12:25:34,752 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 16 has failed. Your account has been refunded with KES 16 Saiba Credits which can be used to transact on Saiba to 7
2017-03-27 12:25:34,752 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 16 has failed. Your account has been refunded with KES 16 Saiba Credits which can be used to transact on Saiba to 7
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 16 has failed. Your account has been refunded with KES 16 Saiba Credits which can be used to transact on Saiba to 7
2017-03-27 12:25:34,755 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 16 has failed. Your account has been refunded with KES 16 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
2017-03-27 12:25:34,755 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 16 has failed. Your account has been refunded with KES 16 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 16 has failed. Your account has been refunded with KES 16 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
2017-03-27 12:25:34,756 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-27 12:25:34,756 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-27 12:25:34,757 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 16 has failed. Your account has been refunded with KES 16 Saiba Credits which can be used to transact on Saiba
2017-03-27 12:25:34,757 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 16 has failed. Your account has been refunded with KES 16 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 16 has failed. Your account has been refunded with KES 16 Saiba Credits which can be used to transact on Saiba
2017-03-27 12:25:34,804 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":113,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 16 has failed. Your account has been refunded with KES 16 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T12:25:24.303964+03:00"}
2017-03-27 12:25:34,804 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":113,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 16 has failed. Your account has been refunded with KES 16 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T12:25:24.303964+03:00"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":113,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 16 has failed. Your account has been refunded with KES 16 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T12:25:24.303964+03:00"}
2017-03-27 12:25:34,805 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 12:25:34,805 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 12:25:34,806 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-27 12:25:34,806 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-27 12:25:34,806 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 12:25:34,806 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 12:25:34,807 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "16", "user": 7, "user_credit_type": 1, "debit": "0"}
2017-03-27 12:25:34,807 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "16", "user": 7, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "16", "user": 7, "user_credit_type": 1, "debit": "0"}
2017-03-27 12:25:34,865 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 12:25:34,865 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-27 12:25:34,866 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":7,"user_credit_type":1,"debit":0.0,"credit":16.0,"balance":1006.0}
2017-03-27 12:25:34,866 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":7,"user_credit_type":1,"debit":0.0,"credit":16.0,"balance":1006.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":7,"user_credit_type":1,"debit":0.0,"credit":16.0,"balance":1006.0}
{"user":7,"user_credit_type":1,"debit":0.0,"credit":16.0,"balance":1006.0}
2017-03-27 12:25:34,867 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:25:34,867 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:25:34,868 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 12:25:34,868 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-27 12:25:34,868 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-27 12:25:34,868 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-27 12:25:34,869 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-27 12:25:34,869 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-27 12:25:34,869 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "16", "service_provider_id": 1}
2017-03-27 12:25:34,869 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "16", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "16", "service_provider_id": 1}
2017-03-27 12:25:34,870 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-27 12:25:34,870 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-27 12:25:34,927 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 12:25:34,927 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-27 12:25:34,928 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":94,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":16.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-27 12:25:34,928 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":94,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":16.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":94,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":16.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-27 12:25:34,928 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:25:34,928 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:25:34,929 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
2017-03-27 12:25:34,929 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": ""}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": ""}
2017-03-27 12:25:34,930 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 322, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-27 12:25:34,930 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 322, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 322, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-27 12:25:34,939 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-27 12:25:34,939 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-27 12:25:34,941 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 770.83ms
2017-03-27 12:25:34,941 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 770.83ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 770.83ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-27 12:37:36,099 = __main__ - INFO - Creating server
2017-03-27 12:37:36,099 = __main__ - INFO - Creating server
2017-03-27 12:37:36,106 = __main__ - INFO - Created server
2017-03-27 12:37:36,106 = __main__ - INFO - Created server
2017-03-27 12:37:36,106 = __main__ - INFO - Listening on port 8080
2017-03-27 12:37:36,106 = __main__ - INFO - Listening on port 8080
2017-03-27 12:37:36,108 = __main__ - INFO - Starting event loop
2017-03-27 12:37:36,108 = __main__ - INFO - Starting event loop
2017-03-27 12:38:30,525 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-27 12:38:30,525 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-27 12:38:30,526 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-27 12:38:30,526 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-27 12:38:30,526 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 12:38:30
2017-03-27 12:38:30,526 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 12:38:30
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 27/03/2017 12:38:30
2017-03-27 12:38:30,526 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-27 12:38:30,526 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-27 12:38:30,527 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-27 12:38:30,527 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-27 12:38:30,528 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 230520a07129407d858f5af921cf5aea
2017-03-27 12:38:30,528 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 230520a07129407d858f5af921cf5aea
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 230520a07129407d858f5af921cf5aea
2017-03-27 12:38:30,528 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-27 12:38:30,528 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-27 12:38:30,528 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'mobile_money_transaction_number': u'LC323322', u'service_type_id': 1, u'service_provider_id': 1, u'amount': u'5', u'mobile_money_provider_id': 2, u'account_number': u'1535654', u'mobile_number': u'0721799582', u'payment_method_id': u'1'}-----------------------------++++++++++++++
2017-03-27 12:38:30,528 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'mobile_money_transaction_number': u'LC323322', u'service_type_id': 1, u'service_provider_id': 1, u'amount': u'5', u'mobile_money_provider_id': 2, u'account_number': u'1535654', u'mobile_number': u'0721799582', u'payment_method_id': u'1'}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 8, u'mobile_money_transaction_number': u'LC323322', u'service_type_id': 1, u'service_provider_id': 1, u'amount': u'5', u'mobile_money_provider_id': 2, u'account_number': u'1535654', u'mobile_number': u'0721799582', u'payment_method_id': u'1'}-----------------------------++++++++++++++
2017-03-27 12:38:30,529 = handlers.result_handler.AirtimeHandler - DEBUG - LC323322
2017-03-27 12:38:30,529 = handlers.result_handler.AirtimeHandler - DEBUG - LC323322
DEBUG:handlers.result_handler.AirtimeHandler:LC323322
2017-03-27 12:38:30,529 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-27 12:38:30,529 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-27 12:38:30,529 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:38:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>230520a07129407d858f5af921cf5aea</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 12:38:30,529 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:38:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>230520a07129407d858f5af921cf5aea</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:38:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>230520a07129407d858f5af921cf5aea</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 12:38:30,530 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-27 12:38:30,530 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-27 12:38:30,530 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-27 12:38:30,530 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-27 12:38:30,531 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:38:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>230520a07129407d858f5af921cf5aea</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 12:38:30,531 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:38:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>230520a07129407d858f5af921cf5aea</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:38:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>230520a07129407d858f5af921cf5aea</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 12:38:30,531 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-27 12:38:30,531 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-27 12:38:31,061 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-27 12:38:31,061 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-27 12:38:31,061 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 12:38:20</ns0:DATE><ns0:EXTREFNUM>230520a07129407d858f5af921cf5aea</ns0:EXTREFNUM><ns0:TXNID>R170327.1238.130023</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 5 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 12:38:31,061 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 12:38:20</ns0:DATE><ns0:EXTREFNUM>230520a07129407d858f5af921cf5aea</ns0:EXTREFNUM><ns0:TXNID>R170327.1238.130023</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 5 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 12:38:20</ns0:DATE><ns0:EXTREFNUM>230520a07129407d858f5af921cf5aea</ns0:EXTREFNUM><ns0:TXNID>R170327.1238.130023</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 5 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 12:38:31,062 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-27 12:38:31,062 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-27 12:38:31,063 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 12:38:31,063 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 12:38:31,063 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-27 12:38:31,063 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-27 12:38:31,064 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-27 12:38:31,064 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-27 12:38:31,065 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-27 12:38:31,065 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-27 12:38:31,065 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 8
2017-03-27 12:38:31,065 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 8
2017-03-27 12:38:31,066 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-27 12:38:31,066 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-27 12:38:31,066 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-27 12:38:31,066 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-27 12:38:31,067 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-27 12:38:31,067 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-27 12:38:32,382 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":116,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T12:38:21.854254+03:00"}
2017-03-27 12:38:32,382 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":116,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T12:38:21.854254+03:00"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":116,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T12:38:21.854254+03:00"}
2017-03-27 12:38:32,383 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 12:38:32,383 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 12:38:32,384 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-27 12:38:32,384 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-27 12:38:32,385 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 12:38:32,385 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 12:38:32,385 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-27 12:38:32,385 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "5", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-27 12:38:33,528 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 12:38:33,528 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 12:38:33,528 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":2410.0}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-27 12:38:33,528 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":2410.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":2410.0}
{"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":2410.0}
2017-03-27 12:38:33,529 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:38:33,529 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:38:33,529 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 12:38:33,529 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-27 12:38:33,530 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-27 12:38:33,530 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-27 12:38:33,530 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-27 12:38:33,530 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-27 12:38:33,530 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "1799582", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-27 12:38:33,530 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "1799582", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "1799582", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-27 12:38:33,531 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-27 12:38:33,531 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-27 12:38:34,698 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 12:38:34,698 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 12:38:34,699 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":95,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"1799582","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"id":95,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"1799582","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-27 12:38:34,699 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:38:34,699 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":95,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"1799582","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-27 12:38:34,699 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:38:34,700 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": "LC323322"}
2017-03-27 12:38:34,700 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
2017-03-27 12:38:34,853 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 12:38:34,854 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"status": 1, "message": "Transaction not found"}
2017-03-27 12:38:34,854 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:38:34,853 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 12:38:34,854 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
{"status": 1, "message": "Transaction not found"}
2017-03-27 12:38:34,854 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:38:34,854 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:38:34,854 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
DEBUG:handlers.result_handler.AirtimeHandler:Updating speadsheet......
/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/util/ssl_.py:334: SNIMissingWarning: An HTTPS request has been made, but the SNI (Subject Name Indication) extension to TLS is not available on this platform. This may cause the server to present an incorrect TLS certificate, which can cause validation failures. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
  SNIMissingWarning
/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
  InsecurePlatformWarning
2017-03-27 12:38:36,374 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-27 12:38:36,374 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-27 12:38:36,376 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 5851.70ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 5851.70ms
2017-03-27 12:38:36,376 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 5851.70ms
2017-03-27 12:40:59,939 = __main__ - INFO - Creating server
2017-03-27 12:40:59,939 = __main__ - INFO - Creating server
2017-03-27 12:40:59,943 = __main__ - INFO - Created server
2017-03-27 12:40:59,944 = __main__ - INFO - Listening on port 8080
2017-03-27 12:40:59,945 = __main__ - INFO - Starting event loop
2017-03-27 12:40:59,943 = __main__ - INFO - Created server
2017-03-27 12:40:59,944 = __main__ - INFO - Listening on port 8080
2017-03-27 12:40:59,945 = __main__ - INFO - Starting event loop
2017-03-27 12:41:12,131 = __main__ - INFO - Creating server
2017-03-27 12:41:12,131 = __main__ - INFO - Creating server
2017-03-27 12:41:12,138 = __main__ - INFO - Created server
2017-03-27 12:41:12,138 = __main__ - INFO - Created server
2017-03-27 12:41:12,138 = __main__ - INFO - Listening on port 8080
2017-03-27 12:41:12,138 = __main__ - INFO - Listening on port 8080
2017-03-27 12:41:12,139 = __main__ - INFO - Starting event loop
2017-03-27 12:41:12,139 = __main__ - INFO - Starting event loop
2017-03-27 12:41:19,876 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-27 12:41:19,877 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-27 12:41:19,877 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 12:41:19
2017-03-27 12:41:19,877 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-27 12:41:19,878 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 27/03/2017 12:41:19
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-27 12:41:19,876 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-27 12:41:19,877 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-27 12:41:19,877 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 12:41:19
2017-03-27 12:41:19,877 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-27 12:41:19,878 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-27 12:41:19,878 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = ce3085b543c74367a01d712b1f90329e
2017-03-27 12:41:19,878 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = ce3085b543c74367a01d712b1f90329e
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = ce3085b543c74367a01d712b1f90329e
2017-03-27 12:41:19,879 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-27 12:41:19,879 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-27 12:41:19,879 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'mobile_money_transaction_number': u'LC323322', u'service_type_id': 1, u'service_provider_id': 1, u'amount': u'5', u'mobile_money_provider_id': 2, u'account_number': u'1535654', u'mobile_number': u'0721799582', u'payment_method_id': u'1'}-----------------------------++++++++++++++
2017-03-27 12:41:19,879 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'mobile_money_transaction_number': u'LC323322', u'service_type_id': 1, u'service_provider_id': 1, u'amount': u'5', u'mobile_money_provider_id': 2, u'account_number': u'1535654', u'mobile_number': u'0721799582', u'payment_method_id': u'1'}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 8, u'mobile_money_transaction_number': u'LC323322', u'service_type_id': 1, u'service_provider_id': 1, u'amount': u'5', u'mobile_money_provider_id': 2, u'account_number': u'1535654', u'mobile_number': u'0721799582', u'payment_method_id': u'1'}-----------------------------++++++++++++++
2017-03-27 12:41:19,879 = handlers.result_handler.AirtimeHandler - DEBUG - LC323322
2017-03-27 12:41:19,879 = handlers.result_handler.AirtimeHandler - DEBUG - LC323322
DEBUG:handlers.result_handler.AirtimeHandler:LC323322
2017-03-27 12:41:19,880 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-27 12:41:19,880 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-27 12:41:19,880 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:41:19</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ce3085b543c74367a01d712b1f90329e</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 12:41:19,880 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:41:19</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ce3085b543c74367a01d712b1f90329e</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:41:19</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ce3085b543c74367a01d712b1f90329e</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 12:41:19,881 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-27 12:41:19,881 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-27 12:41:19,881 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-27 12:41:19,881 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-27 12:41:19,882 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:41:19</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ce3085b543c74367a01d712b1f90329e</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 12:41:19,882 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:41:19</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ce3085b543c74367a01d712b1f90329e</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:41:19</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ce3085b543c74367a01d712b1f90329e</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 12:41:19,882 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-27 12:41:19,882 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-27 12:41:20,455 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-27 12:41:20,455 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-27 12:41:20,456 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 12:41:09</ns0:DATE><ns0:EXTREFNUM>ce3085b543c74367a01d712b1f90329e</ns0:EXTREFNUM><ns0:TXNID>R170327.1241.130024</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 5 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 12:41:20,456 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 12:41:09</ns0:DATE><ns0:EXTREFNUM>ce3085b543c74367a01d712b1f90329e</ns0:EXTREFNUM><ns0:TXNID>R170327.1241.130024</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 5 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 12:41:09</ns0:DATE><ns0:EXTREFNUM>ce3085b543c74367a01d712b1f90329e</ns0:EXTREFNUM><ns0:TXNID>R170327.1241.130024</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 5 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 12:41:20,456 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-27 12:41:20,456 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-27 12:41:20,457 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 12:41:20,457 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 12:41:20,457 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-27 12:41:20,457 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-27 12:41:20,457 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-27 12:41:20,457 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-27 12:41:20,458 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-27 12:41:20,458 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-27 12:41:20,458 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 8
2017-03-27 12:41:20,458 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 8
2017-03-27 12:41:20,458 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-27 12:41:20,458 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-27 12:41:20,459 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-27 12:41:20,459 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-27 12:41:20,459 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-27 12:41:20,459 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-27 12:41:20,509 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":117,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T12:41:09.978676+03:00"}
2017-03-27 12:41:20,509 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":117,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T12:41:09.978676+03:00"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":117,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T12:41:09.978676+03:00"}
2017-03-27 12:41:20,510 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 12:41:20,510 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 12:41:20,510 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 12:41:20,510 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-27 12:41:20,510 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 12:41:20,510 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 12:41:20,510 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-27 12:41:20,510 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "5", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-27 12:41:20,563 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 12:41:20,563 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-27 12:41:20,564 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":2415.0}
2017-03-27 12:41:20,564 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":2415.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":2415.0}
2017-03-27 12:41:20,564 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
{"user":8,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":2415.0}
2017-03-27 12:41:20,564 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:41:20,564 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 12:41:20,564 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-27 12:41:20,564 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-27 12:41:20,564 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-27 12:41:20,565 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-27 12:41:20,565 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-27 12:41:20,565 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "1799582", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-27 12:41:20,565 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "1799582", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-27 12:41:20,565 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "1799582", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-27 12:41:20,565 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-27 12:41:20,632 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 12:41:20,632 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 12:41:20,633 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":96,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"1799582","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-27 12:41:20,633 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":96,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"1799582","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-27 12:41:20,633 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:{"id":96,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"1799582","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:41:20,633 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:41:20,634 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
2017-03-27 12:41:20,634 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": "LC323322"}
2017-03-27 12:41:20,651 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 12:41:20,651 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 12:41:20,652 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"status": 1, "message": "Transaction not found"}
2017-03-27 12:41:20,652 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:41:20,652 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
{"status": 1, "message": "Transaction not found"}
2017-03-27 12:41:20,652 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:41:20,653 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
2017-03-27 12:41:20,653 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
DEBUG:handlers.result_handler.AirtimeHandler:Updating speadsheet......
/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/util/ssl_.py:334: SNIMissingWarning: An HTTPS request has been made, but the SNI (Subject Name Indication) extension to TLS is not available on this platform. This may cause the server to present an incorrect TLS certificate, which can cause validation failures. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
  SNIMissingWarning
/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
  InsecurePlatformWarning
2017-03-27 12:41:22,843 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-27 12:41:22,844 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2969.19ms
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 2969.19ms
2017-03-27 12:41:22,843 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-27 12:41:22,844 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2969.19ms
2017-03-27 12:53:01,406 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-27 12:53:01,406 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-27 12:53:01,407 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 12:53:01
2017-03-27 12:53:01,407 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-27 12:53:01,407 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-27 12:53:01,407 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = dad060730a3c4bec80bee6b6d08e7c2a
2017-03-27 12:53:01,408 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-27 12:53:01,408 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-27 12:53:01,408 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-27 12:53:01,408 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-27 12:53:01,408 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:53:01</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>dad060730a3c4bec80bee6b6d08e7c2a</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 12:53:01,409 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-27 12:53:01,409 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-27 12:53:01,409 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:53:01</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>dad060730a3c4bec80bee6b6d08e7c2a</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 12:53:01,409 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 27/03/2017 12:53:01
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = dad060730a3c4bec80bee6b6d08e7c2a
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:None
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:53:01</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>dad060730a3c4bec80bee6b6d08e7c2a</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:53:01</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>dad060730a3c4bec80bee6b6d08e7c2a</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-27 12:53:01,406 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-27 12:53:01,406 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-27 12:53:01,407 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 12:53:01
2017-03-27 12:53:01,407 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-27 12:53:01,407 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-27 12:53:01,407 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = dad060730a3c4bec80bee6b6d08e7c2a
2017-03-27 12:53:01,408 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-27 12:53:01,408 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-27 12:53:01,408 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-27 12:53:01,408 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-27 12:53:01,408 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:53:01</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>dad060730a3c4bec80bee6b6d08e7c2a</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 12:53:01,409 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-27 12:53:01,409 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-27 12:53:01,409 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 12:53:01</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>dad060730a3c4bec80bee6b6d08e7c2a</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 12:53:01,409 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-27 12:53:01,979 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-27 12:53:01,979 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-27 12:53:01,981 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 12:52:51</ns0:DATE><ns0:EXTREFNUM>dad060730a3c4bec80bee6b6d08e7c2a</ns0:EXTREFNUM><ns0:TXNID>R170327.1252.130065</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 5 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 12:53:01,981 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 12:52:51</ns0:DATE><ns0:EXTREFNUM>dad060730a3c4bec80bee6b6d08e7c2a</ns0:EXTREFNUM><ns0:TXNID>R170327.1252.130065</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 5 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 12:52:51</ns0:DATE><ns0:EXTREFNUM>dad060730a3c4bec80bee6b6d08e7c2a</ns0:EXTREFNUM><ns0:TXNID>R170327.1252.130065</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 5 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 12:53:01,981 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-27 12:53:01,981 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-27 12:53:01,982 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 12:53:01,982 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 12:53:01,983 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-27 12:53:01,983 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-27 12:53:01,983 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-27 12:53:01,983 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-27 12:53:01,984 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-27 12:53:01,984 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-27 12:53:01,985 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 7
2017-03-27 12:53:01,985 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 7
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 7
2017-03-27 12:53:01,985 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
2017-03-27 12:53:01,985 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
2017-03-27 12:53:01,986 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-27 12:53:01,986 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-27 12:53:01,986 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-27 12:53:01,986 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-27 12:53:03,209 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":123,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T12:52:52.657790Z"}
2017-03-27 12:53:03,209 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":123,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T12:52:52.657790Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":123,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T12:52:52.657790Z"}
2017-03-27 12:53:03,211 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 12:53:03,211 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 12:53:03,212 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-27 12:53:03,212 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-27 12:53:03,212 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 12:53:03,212 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 12:53:03,213 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5", "user": 7, "user_credit_type": 1, "debit": "0"}
2017-03-27 12:53:03,213 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5", "user": 7, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "5", "user": 7, "user_credit_type": 1, "debit": "0"}
2017-03-27 12:53:04,468 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 12:53:04,468 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-27 12:53:04,470 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":7,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":856.0}
2017-03-27 12:53:04,470 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":7,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":856.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":7,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":856.0}
{"user":7,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":856.0}
2017-03-27 12:53:04,470 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:53:04,470 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:53:04,471 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 12:53:04,471 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-27 12:53:04,472 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-27 12:53:04,472 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-27 12:53:04,473 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-27 12:53:04,473 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-27 12:53:04,474 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-27 12:53:04,474 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-27 12:53:04,474 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-27 12:53:04,474 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-27 12:53:05,561 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 12:53:05,561 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-27 12:53:05,563 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":98,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-27 12:53:05,563 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":98,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":98,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-27 12:53:05,564 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:53:05,564 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 12:53:05,565 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
2017-03-27 12:53:05,565 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": null}
2017-03-27 12:53:05,566 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-27 12:53:05,566 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-27 12:53:05,575 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
2017-03-27 12:53:05,575 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
DEBUG:handlers.result_handler.AirtimeHandler:Updating speadsheet......
/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
  InsecurePlatformWarning
2017-03-27 12:53:07,099 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-27 12:53:07,099 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-27 12:53:07,103 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 5697.23ms
2017-03-27 12:53:07,103 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 5697.23ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 5697.23ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-27 13:00:28,589 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-27 13:00:28,590 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-27 13:00:28,590 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 13:00:28
2017-03-27 13:00:28,590 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-27 13:00:28,590 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-27 13:00:28,591 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 9a04e3b0e4214e6b9f7756f0c1af7228
2017-03-27 13:00:28,591 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-27 13:00:28,591 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-27 13:00:28,592 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-27 13:00:28,592 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-27 13:00:28,592 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 13:00:28</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9a04e3b0e4214e6b9f7756f0c1af7228</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 13:00:28,592 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-27 13:00:28,592 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-27 13:00:28,593 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 13:00:28</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9a04e3b0e4214e6b9f7756f0c1af7228</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 13:00:28,593 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 27/03/2017 13:00:28
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 9a04e3b0e4214e6b9f7756f0c1af7228
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:None
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 13:00:28</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9a04e3b0e4214e6b9f7756f0c1af7228</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 13:00:28</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9a04e3b0e4214e6b9f7756f0c1af7228</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-27 13:00:28,589 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-27 13:00:28,590 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-27 13:00:28,590 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 13:00:28
2017-03-27 13:00:28,590 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-27 13:00:28,590 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-27 13:00:28,591 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 9a04e3b0e4214e6b9f7756f0c1af7228
2017-03-27 13:00:28,591 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-27 13:00:28,591 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-27 13:00:28,592 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-27 13:00:28,592 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-27 13:00:28,592 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 13:00:28</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9a04e3b0e4214e6b9f7756f0c1af7228</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 13:00:28,592 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-27 13:00:28,592 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-27 13:00:28,593 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 13:00:28</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>9a04e3b0e4214e6b9f7756f0c1af7228</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 13:00:28,593 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-27 13:00:29,132 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-27 13:00:29,132 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-27 13:00:29,134 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 13:00:18</ns0:DATE><ns0:EXTREFNUM>9a04e3b0e4214e6b9f7756f0c1af7228</ns0:EXTREFNUM><ns0:TXNID>R170327.1300.130024</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 5 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 13:00:29,134 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 13:00:18</ns0:DATE><ns0:EXTREFNUM>9a04e3b0e4214e6b9f7756f0c1af7228</ns0:EXTREFNUM><ns0:TXNID>R170327.1300.130024</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 5 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 13:00:18</ns0:DATE><ns0:EXTREFNUM>9a04e3b0e4214e6b9f7756f0c1af7228</ns0:EXTREFNUM><ns0:TXNID>R170327.1300.130024</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 5 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 13:00:29,135 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-27 13:00:29,135 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-27 13:00:29,136 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 13:00:29,136 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 13:00:29,138 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-27 13:00:29,138 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-27 13:00:29,138 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-27 13:00:29,138 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-27 13:00:29,139 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-27 13:00:29,139 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-27 13:00:29,140 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 7
2017-03-27 13:00:29,140 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 7
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 7
2017-03-27 13:00:29,141 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
2017-03-27 13:00:29,141 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
2017-03-27 13:00:29,142 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-27 13:00:29,142 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-27 13:00:29,143 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-27 13:00:29,143 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-27 13:00:30,372 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":127,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T13:00:19.805066Z"}
2017-03-27 13:00:30,372 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":127,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T13:00:19.805066Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":127,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T13:00:19.805066Z"}
2017-03-27 13:00:30,374 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 13:00:30,374 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 13:00:30,375 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-27 13:00:30,375 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-27 13:00:30,376 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 13:00:30,376 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 13:00:30,377 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5", "user": 7, "user_credit_type": 1, "debit": "0"}
2017-03-27 13:00:30,377 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5", "user": 7, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "5", "user": 7, "user_credit_type": 1, "debit": "0"}
2017-03-27 13:00:31,557 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 13:00:31,557 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-27 13:00:31,559 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":7,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":906.0}
2017-03-27 13:00:31,559 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":7,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":906.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":7,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":906.0}
{"user":7,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":906.0}
2017-03-27 13:00:31,560 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 13:00:31,560 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 13:00:31,561 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 13:00:31,561 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-27 13:00:31,562 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-27 13:00:31,562 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-27 13:00:31,563 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-27 13:00:31,563 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-27 13:00:31,563 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-27 13:00:31,563 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-27 13:00:31,564 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-27 13:00:31,564 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-27 13:00:32,808 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 13:00:32,808 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-27 13:00:32,809 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":99,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-27 13:00:32,809 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":99,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":99,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-27 13:00:32,810 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 13:00:32,810 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 13:00:32,811 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
2017-03-27 13:00:32,811 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": null}
2017-03-27 13:00:32,812 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-27 13:00:32,812 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-27 13:00:32,829 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
2017-03-27 13:00:32,829 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
DEBUG:handlers.result_handler.AirtimeHandler:Updating speadsheet......
/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
  InsecurePlatformWarning
2017-03-27 13:00:34,265 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-27 13:00:34,265 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-27 13:00:34,269 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 5679.90ms
2017-03-27 13:00:34,269 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 5679.90ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 5679.90ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-27 13:21:49,170 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.83ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.83ms
2017-03-27 13:21:49,170 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.83ms
2017-03-27 16:02:48,982 = tornado.access - WARNING - 404 GET / (115.182.15.117) 0.63ms
WARNING:tornado.access:404 GET / (115.182.15.117) 0.63ms
2017-03-27 16:02:48,982 = tornado.access - WARNING - 404 GET / (115.182.15.117) 0.63ms
2017-03-27 17:31:53,132 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.60ms
WARNING:tornado.access:404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.60ms
2017-03-27 17:31:53,132 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.60ms
2017-03-27 18:22:58,059 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-27 18:22:58,060 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-27 18:22:58,061 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 18:22:58
2017-03-27 18:22:58,061 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-27 18:22:58,061 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-27 18:22:58,062 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = ff0b53833bc44f86abe4cf7aed1d0660
2017-03-27 18:22:58,062 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-27 18:22:58,063 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 20, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-27 18:22:58,063 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-27 18:22:58,063 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-27 18:22:58,064 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 18:22:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ff0b53833bc44f86abe4cf7aed1d0660</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 18:22:58,064 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-27 18:22:58,064 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-27 18:22:58,064 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 18:22:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ff0b53833bc44f86abe4cf7aed1d0660</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/2000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 27/03/2017 18:22:58
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = ff0b53833bc44f86abe4cf7aed1d0660
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 20, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:None
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 18:22:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ff0b53833bc44f86abe4cf7aed1d0660</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 18:22:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ff0b53833bc44f86abe4cf7aed1d0660</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 18:22:58,059 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-27 18:22:58,060 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-27 18:22:58,061 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 18:22:58
2017-03-27 18:22:58,061 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-27 18:22:58,061 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-27 18:22:58,062 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = ff0b53833bc44f86abe4cf7aed1d0660
2017-03-27 18:22:58,062 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-27 18:22:58,063 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 20, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-27 18:22:58,063 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-27 18:22:58,063 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-27 18:22:58,064 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 18:22:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ff0b53833bc44f86abe4cf7aed1d0660</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 18:22:58,064 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-27 18:22:58,064 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-27 18:22:58,064 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 18:22:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>ff0b53833bc44f86abe4cf7aed1d0660</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 18:22:58,065 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-27 18:22:58,065 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-27 18:22:58,564 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-27 18:22:58,564 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-27 18:22:58,565 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 18:22:47</ns0:DATE><ns0:EXTREFNUM>ff0b53833bc44f86abe4cf7aed1d0660</ns0:EXTREFNUM><ns0:TXNID>R170327.1822.130056</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 20 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 18:22:58,565 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 18:22:47</ns0:DATE><ns0:EXTREFNUM>ff0b53833bc44f86abe4cf7aed1d0660</ns0:EXTREFNUM><ns0:TXNID>R170327.1822.130056</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 20 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 18:22:47</ns0:DATE><ns0:EXTREFNUM>ff0b53833bc44f86abe4cf7aed1d0660</ns0:EXTREFNUM><ns0:TXNID>R170327.1822.130056</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 20 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 18:22:58,566 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-27 18:22:58,566 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-27 18:22:58,566 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 18:22:58,566 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 18:22:58,567 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^20
2017-03-27 18:22:58,567 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^20
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^20
2017-03-27 18:22:58,567 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
2017-03-27 18:22:58,567 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
2017-03-27 18:22:58,568 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-27 18:22:58,568 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-27 18:22:58,568 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba to 7
2017-03-27 18:22:58,568 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba to 7
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba to 7
2017-03-27 18:22:58,569 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
2017-03-27 18:22:58,569 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
2017-03-27 18:22:58,569 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-27 18:22:58,569 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-27 18:22:58,569 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
2017-03-27 18:22:58,569 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
2017-03-27 18:22:59,893 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":130,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T18:22:48.723510Z"}
2017-03-27 18:22:59,893 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":130,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T18:22:48.723510Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":130,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T18:22:48.723510Z"}
2017-03-27 18:22:59,895 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 18:22:59,895 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 18:22:59,895 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-27 18:22:59,895 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-27 18:22:59,896 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 18:22:59,896 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 18:22:59,897 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "20", "user": 7, "user_credit_type": 1, "debit": "0"}
2017-03-27 18:22:59,897 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "20", "user": 7, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "20", "user": 7, "user_credit_type": 1, "debit": "0"}
2017-03-27 18:23:01,076 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 18:23:01,076 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-27 18:23:01,077 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":7,"user_credit_type":1,"debit":0.0,"credit":20.0,"balance":856.0}
2017-03-27 18:23:01,077 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":7,"user_credit_type":1,"debit":0.0,"credit":20.0,"balance":856.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":7,"user_credit_type":1,"debit":0.0,"credit":20.0,"balance":856.0}
{"user":7,"user_credit_type":1,"debit":0.0,"credit":20.0,"balance":856.0}
2017-03-27 18:23:01,077 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 18:23:01,077 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 18:23:01,078 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 18:23:01,078 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-27 18:23:01,078 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-27 18:23:01,078 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-27 18:23:01,078 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-27 18:23:01,078 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-27 18:23:01,079 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
2017-03-27 18:23:01,079 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
2017-03-27 18:23:01,079 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-27 18:23:01,079 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-27 18:23:02,878 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 18:23:02,878 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-27 18:23:02,879 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":100,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-27 18:23:02,879 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":100,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":100,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-27 18:23:02,880 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 18:23:02,880 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 18:23:02,881 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
2017-03-27 18:23:02,881 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": null}
2017-03-27 18:23:02,882 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-27 18:23:02,882 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-27 18:23:02,892 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
2017-03-27 18:23:02,892 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
DEBUG:handlers.result_handler.AirtimeHandler:Updating speadsheet......
/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
  InsecurePlatformWarning
2017-03-27 18:23:04,542 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-27 18:23:04,542 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-27 18:23:04,544 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 6485.01ms
2017-03-27 18:23:04,544 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 6485.01ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 6485.01ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-27 18:23:33,636 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/3000/-------------------
2017-03-27 18:23:33,637 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-27 18:23:33,637 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 18:23:33
2017-03-27 18:23:33,637 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-27 18:23:33,637 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-27 18:23:33,638 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = b1c9673098ab4d90adc8a74353a54d23
2017-03-27 18:23:33,638 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-27 18:23:33,638 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 30, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-27 18:23:33,638 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-27 18:23:33,639 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-27 18:23:33,639 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 18:23:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>b1c9673098ab4d90adc8a74353a54d23</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>3000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 18:23:33,639 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-27 18:23:33,639 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-27 18:23:33,639 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 18:23:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>b1c9673098ab4d90adc8a74353a54d23</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>3000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 18:23:33,640 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/3000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 27/03/2017 18:23:33
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = b1c9673098ab4d90adc8a74353a54d23
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 30, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:None
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 18:23:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>b1c9673098ab4d90adc8a74353a54d23</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>3000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 18:23:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>b1c9673098ab4d90adc8a74353a54d23</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>3000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-27 18:23:33,636 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/3000/-------------------
2017-03-27 18:23:33,637 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-27 18:23:33,637 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 27/03/2017 18:23:33
2017-03-27 18:23:33,637 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-27 18:23:33,637 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-27 18:23:33,638 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = b1c9673098ab4d90adc8a74353a54d23
2017-03-27 18:23:33,638 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-27 18:23:33,638 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 30, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-27 18:23:33,638 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-27 18:23:33,639 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-27 18:23:33,639 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 18:23:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>b1c9673098ab4d90adc8a74353a54d23</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>3000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 18:23:33,639 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-27 18:23:33,639 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-27 18:23:33,639 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>27/03/2017 18:23:33</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>b1c9673098ab4d90adc8a74353a54d23</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>3000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-27 18:23:33,640 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-27 18:23:34,139 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-27 18:23:34,139 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-27 18:23:34,140 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 18:23:22</ns0:DATE><ns0:EXTREFNUM>b1c9673098ab4d90adc8a74353a54d23</ns0:EXTREFNUM><ns0:TXNID>R170327.1823.130033</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 30 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 18:23:34,140 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 18:23:22</ns0:DATE><ns0:EXTREFNUM>b1c9673098ab4d90adc8a74353a54d23</ns0:EXTREFNUM><ns0:TXNID>R170327.1823.130033</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 30 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>6010</ns0:TXNSTATUS><ns0:DATE>27/03/17 18:23:22</ns0:DATE><ns0:EXTREFNUM>b1c9673098ab4d90adc8a74353a54d23</ns0:EXTREFNUM><ns0:TXNID>R170327.1823.130033</ns0:TXNID><ns0:MESSAGE>Your request to transfer KSH 30 failed. Insufficient credit</ns0:MESSAGE></ns0:COMMAND>

2017-03-27 18:23:34,140 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-27 18:23:34,140 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-27 18:23:34,141 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 18:23:34,141 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-27 18:23:34,141 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^30
2017-03-27 18:23:34,141 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^30
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^30
2017-03-27 18:23:34,142 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 30 has failed. Your account has been refunded with KES 30 Saiba Credits which can be used to transact on Saiba
2017-03-27 18:23:34,142 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 30 has failed. Your account has been refunded with KES 30 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 30 has failed. Your account has been refunded with KES 30 Saiba Credits which can be used to transact on Saiba
2017-03-27 18:23:34,142 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-27 18:23:34,142 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-27 18:23:34,143 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 30 has failed. Your account has been refunded with KES 30 Saiba Credits which can be used to transact on Saiba to 7
2017-03-27 18:23:34,143 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 30 has failed. Your account has been refunded with KES 30 Saiba Credits which can be used to transact on Saiba to 7
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 30 has failed. Your account has been refunded with KES 30 Saiba Credits which can be used to transact on Saiba to 7
2017-03-27 18:23:34,143 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 30 has failed. Your account has been refunded with KES 30 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
2017-03-27 18:23:34,143 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 30 has failed. Your account has been refunded with KES 30 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 30 has failed. Your account has been refunded with KES 30 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
2017-03-27 18:23:34,144 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-27 18:23:34,144 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-27 18:23:34,144 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 30 has failed. Your account has been refunded with KES 30 Saiba Credits which can be used to transact on Saiba
2017-03-27 18:23:34,144 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 30 has failed. Your account has been refunded with KES 30 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 30 has failed. Your account has been refunded with KES 30 Saiba Credits which can be used to transact on Saiba
2017-03-27 18:23:34,185 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":131,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 30 has failed. Your account has been refunded with KES 30 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T18:23:23.017879Z"}
2017-03-27 18:23:34,185 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":131,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 30 has failed. Your account has been refunded with KES 30 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T18:23:23.017879Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":131,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 30 has failed. Your account has been refunded with KES 30 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-27T18:23:23.017879Z"}
2017-03-27 18:23:34,187 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 18:23:34,187 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-27 18:23:34,187 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-27 18:23:34,187 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-27 18:23:34,188 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 18:23:34,188 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-27 18:23:34,188 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "30", "user": 7, "user_credit_type": 1, "debit": "0"}
2017-03-27 18:23:34,188 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "30", "user": 7, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "30", "user": 7, "user_credit_type": 1, "debit": "0"}
2017-03-27 18:23:34,234 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 18:23:34,234 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-27 18:23:34,235 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":7,"user_credit_type":1,"debit":0.0,"credit":30.0,"balance":856.0}
2017-03-27 18:23:34,235 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":7,"user_credit_type":1,"debit":0.0,"credit":30.0,"balance":856.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":7,"user_credit_type":1,"debit":0.0,"credit":30.0,"balance":856.0}
{"user":7,"user_credit_type":1,"debit":0.0,"credit":30.0,"balance":856.0}
2017-03-27 18:23:34,235 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 18:23:34,235 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 18:23:34,236 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-27 18:23:34,236 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-27 18:23:34,237 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-27 18:23:34,237 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-27 18:23:34,238 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-27 18:23:34,238 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-27 18:23:34,239 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "30", "service_provider_id": 1}
2017-03-27 18:23:34,239 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "30", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "30", "service_provider_id": 1}
2017-03-27 18:23:34,239 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-27 18:23:34,239 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-27 18:23:34,291 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-27 18:23:34,291 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-27 18:23:34,292 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":101,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":30.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-27 18:23:34,292 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":101,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":30.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":101,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":30.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-27 18:23:34,293 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 18:23:34,293 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-27 18:23:34,294 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
2017-03-27 18:23:34,294 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": null}
2017-03-27 18:23:34,295 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-27 18:23:34,295 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-27 18:23:34,303 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
2017-03-27 18:23:34,303 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
DEBUG:handlers.result_handler.AirtimeHandler:Updating speadsheet......
/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
  InsecurePlatformWarning
2017-03-27 18:23:36,113 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-27 18:23:36,113 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-27 18:23:36,115 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2479.20ms
2017-03-27 18:23:36,115 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2479.20ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 2479.20ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-27 19:26:42,701 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.67ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.67ms
2017-03-27 19:26:42,701 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.67ms
2017-03-27 20:59:55,716 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.53ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.53ms
2017-03-27 20:59:55,716 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.53ms
2017-03-28 02:05:21,017 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.50ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.50ms
2017-03-28 02:05:21,017 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.50ms
2017-03-28 03:02:15,228 = tornado.access - WARNING - 404 GET / (92.8.115.188) 0.79ms
WARNING:tornado.access:404 GET / (92.8.115.188) 0.79ms
2017-03-28 03:02:15,228 = tornado.access - WARNING - 404 GET / (92.8.115.188) 0.79ms
2017-03-28 05:09:51,263 = tornado.access - WARNING - 404 GET / (210.187.194.48) 0.97ms
WARNING:tornado.access:404 GET / (210.187.194.48) 0.97ms
2017-03-28 05:09:51,263 = tornado.access - WARNING - 404 GET / (210.187.194.48) 0.97ms
2017-03-28 08:12:48,563 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.50ms
2017-03-28 08:12:48,563 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.50ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.50ms
2017-03-28 08:40:21,851 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.68ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.68ms
2017-03-28 08:40:21,851 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.68ms
2017-03-28 11:35:43,166 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-28 11:35:43,166 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 11:35:43,166 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 11:35:43
2017-03-28 11:35:43,167 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 11:35:43,167 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 11:35:43,167 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 5a5076d050814caab6cabbb3fac7311d
2017-03-28 11:35:43,168 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 11:35:43,168 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 11:35:43,168 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-28 11:35:43,168 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 11:35:43,169 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:35:43</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5a5076d050814caab6cabbb3fac7311d</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 11:35:43,169 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 11:35:43,169 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 11:35:43,169 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:35:43</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5a5076d050814caab6cabbb3fac7311d</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 11:35:43,169 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 28/03/2017 11:35:43
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 5a5076d050814caab6cabbb3fac7311d
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:None
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:35:43</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5a5076d050814caab6cabbb3fac7311d</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:35:43</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5a5076d050814caab6cabbb3fac7311d</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-28 11:35:43,166 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-28 11:35:43,166 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 11:35:43,166 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 11:35:43
2017-03-28 11:35:43,167 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 11:35:43,167 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 11:35:43,167 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 5a5076d050814caab6cabbb3fac7311d
2017-03-28 11:35:43,168 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 11:35:43,168 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 11:35:43,168 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-28 11:35:43,168 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 11:35:43,169 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:35:43</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5a5076d050814caab6cabbb3fac7311d</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 11:35:43,169 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 11:35:43,169 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 11:35:43,169 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:35:43</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5a5076d050814caab6cabbb3fac7311d</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 11:35:43,169 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-28 11:35:43,925 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-28 11:35:43,925 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-28 11:35:43,926 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 11:35:30</ns0:DATE><ns0:EXTREFNUM>5a5076d050814caab6cabbb3fac7311d</ns0:EXTREFNUM><ns0:TXNID>R170328.1135.130031</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 995</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 11:35:43,926 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 11:35:30</ns0:DATE><ns0:EXTREFNUM>5a5076d050814caab6cabbb3fac7311d</ns0:EXTREFNUM><ns0:TXNID>R170328.1135.130031</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 995</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 11:35:30</ns0:DATE><ns0:EXTREFNUM>5a5076d050814caab6cabbb3fac7311d</ns0:EXTREFNUM><ns0:TXNID>R170328.1135.130031</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 995</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 11:35:43,927 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-28 11:35:43,927 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-28 11:35:43,928 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
2017-03-28 11:35:43,928 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------5-----------------------
2017-03-28 11:35:43,929 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-28 11:35:43,929 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-28 11:35:43,930 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 11:35:30
2017-03-28 11:35:43,930 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 11:35:30
DEBUG:handlers.result_handler.AirtimeHandler:28/03/17 11:35:30
2017-03-28 11:35:43,931 = handlers.result_handler.AirtimeHandler - DEBUG - 5a5076d050814caab6cabbb3fac7311d
2017-03-28 11:35:43,931 = handlers.result_handler.AirtimeHandler - DEBUG - 5a5076d050814caab6cabbb3fac7311d
DEBUG:handlers.result_handler.AirtimeHandler:5a5076d050814caab6cabbb3fac7311d
2017-03-28 11:35:43,932 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1135.130031
2017-03-28 11:35:43,932 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1135.130031
DEBUG:handlers.result_handler.AirtimeHandler:R170328.1135.130031
2017-03-28 11:35:43,932 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 11:35:30', 'amount': '5', 'external_ref': u'R170328.1135.130031', 'msisdn_2': u'254702935200', 'internal_ref': '2D926KS0P0'}
2017-03-28 11:35:43,932 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 11:35:30', 'amount': '5', 'external_ref': u'R170328.1135.130031', 'msisdn_2': u'254702935200', 'internal_ref': '2D926KS0P0'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'28/03/17 11:35:30', 'amount': '5', 'external_ref': u'R170328.1135.130031', 'msisdn_2': u'254702935200', 'internal_ref': '2D926KS0P0'}
2017-03-28 11:35:43,934 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-28 11:35:43,934 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-28 11:35:44,112 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-28 11:35:44,113 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-28 11:35:44,117 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-28 11:35:44,117 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 11:35:44,122 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-28 11:35:44,123 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 11:35:44,126 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-28 11:35:44,127 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 11:35:44,132 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-28 11:35:44,133 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 11:35:44,136 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-28 11:35:44,136 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 11:35:44,141 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-28 11:35:44,143 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-28 11:35:44,148 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-28 11:35:44,149 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 11:35:44,155 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-28 11:35:44,156 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 11:35:44,158 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-28 11:35:44,159 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f358a06b490>
2017-03-28 11:35:44,167 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-28 11:35:44,167 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-28 11:35:44,168 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-28 11:35:44,168 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-28 11:35:44,168 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2D926KS0P0
2017-03-28 11:35:44,168 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2D926KS0P0
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2D926KS0P0
2017-03-28 11:35:44,169 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2D926KS0P0 to 254702935200
2017-03-28 11:35:44,169 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2D926KS0P0 to 254702935200
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2D926KS0P0 to 254702935200
2017-03-28 11:35:44,170 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-28 11:35:44,170 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-28 11:35:44,170 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2D926KS0P0 to 7
2017-03-28 11:35:44,170 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2D926KS0P0 to 7
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2D926KS0P0 to 7
2017-03-28 11:35:44,171 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2D926KS0P0", "user": "7", "title": "Safaricom  Airtime"}
2017-03-28 11:35:44,171 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2D926KS0P0", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2D926KS0P0", "user": "7", "title": "Safaricom  Airtime"}
2017-03-28 11:35:44,172 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-28 11:35:44,172 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-28 11:35:44,172 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2D926KS0P0
2017-03-28 11:35:44,172 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2D926KS0P0
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2D926KS0P0
2017-03-28 11:35:45,341 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":136,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2D926KS0P0","image_url":"","date":"2017-03-28T11:35:32.237345Z"}
2017-03-28 11:35:45,341 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":136,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2D926KS0P0","image_url":"","date":"2017-03-28T11:35:32.237345Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":136,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2D926KS0P0","image_url":"","date":"2017-03-28T11:35:32.237345Z"}
2017-03-28 11:35:45,343 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-28 11:35:45,343 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-28 11:35:45,344 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":136,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2D926KS0P0","image_url":"","date":"2017-03-28T11:35:32.237345Z"}
2017-03-28 11:35:45,344 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":136,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2D926KS0P0","image_url":"","date":"2017-03-28T11:35:32.237345Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":136,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is 2D926KS0P0","image_url":"","date":"2017-03-28T11:35:32.237345Z"}
2017-03-28 11:35:45,345 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-28 11:35:45,345 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-28 11:35:45,346 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-28 11:35:45,346 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-28 11:35:45,348 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-28 11:35:45,348 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-28 11:35:45,349 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-28 11:35:45,349 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-28 11:35:45,350 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-28 11:35:45,350 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-28 11:35:45,351 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-28 11:35:45,351 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-28 11:35:46,393 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 11:35:46,393 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 11:35:46,395 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":103,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 11:35:46,395 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":103,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":103,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 11:35:46,395 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 11:35:46,395 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 11:35:46,396 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
2017-03-28 11:35:46,396 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": null}
2017-03-28 11:35:46,397 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 11:35:46,397 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 11:35:46,412 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
2017-03-28 11:35:46,412 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
DEBUG:handlers.result_handler.AirtimeHandler:Updating speadsheet......
/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
  InsecurePlatformWarning
2017-03-28 11:35:48,200 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-28 11:35:48,200 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-28 11:35:48,203 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 5037.44ms
2017-03-28 11:35:48,203 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 5037.44ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 5037.44ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-28 11:37:22,798 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-28 11:37:22,799 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 11:37:22,799 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 11:37:22
2017-03-28 11:37:22,799 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 11:37:22,800 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 11:37:22,800 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 5570e7da806041a4a7ddfff4c043fffc
2017-03-28 11:37:22,800 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 11:37:22,801 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 4}-----------------------------++++++++++++++
2017-03-28 11:37:22,801 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-28 11:37:22,801 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 11:37:22,801 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:37:22</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5570e7da806041a4a7ddfff4c043fffc</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 11:37:22,802 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 11:37:22,803 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 11:37:22,803 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:37:22</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5570e7da806041a4a7ddfff4c043fffc</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 11:37:22,804 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 28/03/2017 11:37:22
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 5570e7da806041a4a7ddfff4c043fffc
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 4}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:None
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:37:22</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5570e7da806041a4a7ddfff4c043fffc</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:37:22</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5570e7da806041a4a7ddfff4c043fffc</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-28 11:37:22,798 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-28 11:37:22,799 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 11:37:22,799 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 11:37:22
2017-03-28 11:37:22,799 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 11:37:22,800 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 11:37:22,800 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 5570e7da806041a4a7ddfff4c043fffc
2017-03-28 11:37:22,800 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 11:37:22,801 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 4}-----------------------------++++++++++++++
2017-03-28 11:37:22,801 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-28 11:37:22,801 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 11:37:22,801 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:37:22</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5570e7da806041a4a7ddfff4c043fffc</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 11:37:22,802 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 11:37:22,803 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 11:37:22,803 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:37:22</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5570e7da806041a4a7ddfff4c043fffc</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 11:37:22,804 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-28 11:37:23,332 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-28 11:37:23,332 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-28 11:37:23,333 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>28/03/17 11:37:10</ns0:DATE><ns0:EXTREFNUM>5570e7da806041a4a7ddfff4c043fffc</ns0:EXTREFNUM><ns0:TXNID>R170328.1137.130007</ns0:TXNID><ns0:MESSAGE>The mobile number 702935200 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 11:37:23,333 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>28/03/17 11:37:10</ns0:DATE><ns0:EXTREFNUM>5570e7da806041a4a7ddfff4c043fffc</ns0:EXTREFNUM><ns0:TXNID>R170328.1137.130007</ns0:TXNID><ns0:MESSAGE>The mobile number 702935200 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>28/03/17 11:37:10</ns0:DATE><ns0:EXTREFNUM>5570e7da806041a4a7ddfff4c043fffc</ns0:EXTREFNUM><ns0:TXNID>R170328.1137.130007</ns0:TXNID><ns0:MESSAGE>The mobile number 702935200 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 11:37:23,334 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-28 11:37:23,334 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-28 11:37:23,334 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-28 11:37:23,334 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-28 11:37:23,335 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-28 11:37:23,335 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-28 11:37:23,336 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-28 11:37:23,336 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-28 11:37:23,336 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-28 11:37:23,336 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-28 11:37:23,337 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 7
2017-03-28 11:37:23,337 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 7
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 7
2017-03-28 11:37:23,338 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
2017-03-28 11:37:23,338 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
2017-03-28 11:37:23,338 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-28 11:37:23,338 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-28 11:37:23,339 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-28 11:37:23,339 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-28 11:37:23,388 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":137,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-28T11:37:10.282022Z"}
2017-03-28 11:37:23,388 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":137,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-28T11:37:10.282022Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":137,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-28T11:37:10.282022Z"}
2017-03-28 11:37:23,389 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-28 11:37:23,389 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-28 11:37:23,390 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-28 11:37:23,390 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-28 11:37:23,390 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-28 11:37:23,390 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-28 11:37:23,391 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5", "user": 7, "user_credit_type": 1, "debit": "0"}
2017-03-28 11:37:23,391 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5", "user": 7, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "5", "user": 7, "user_credit_type": 1, "debit": "0"}
2017-03-28 11:37:23,444 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 11:37:23,444 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 11:37:23,446 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":7,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":836.0}
2017-03-28 11:37:23,446 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":7,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":836.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":7,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":836.0}
{"user":7,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":836.0}
2017-03-28 11:37:23,447 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 11:37:23,447 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 11:37:23,448 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-28 11:37:23,448 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-28 11:37:23,448 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-28 11:37:23,448 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-28 11:37:23,449 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-28 11:37:23,449 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-28 11:37:23,449 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 4, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-28 11:37:23,449 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 4, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 4, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-28 11:37:23,450 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-28 11:37:23,450 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-28 11:37:25,412 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 11:37:25,412 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 11:37:25,413 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":104,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":4,"note":"null","bundle":null,"account_number":null}
2017-03-28 11:37:25,413 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":104,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":4,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":104,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":4,"note":"null","bundle":null,"account_number":null}
2017-03-28 11:37:25,414 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 11:37:25,414 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 11:37:25,415 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
2017-03-28 11:37:25,415 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": null}
2017-03-28 11:37:25,416 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 11:37:25,416 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 11:37:25,430 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-28 11:37:25,430 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-28 11:37:25,432 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2634.06ms
2017-03-28 11:37:25,432 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2634.06ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 2634.06ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-28 11:41:51,815 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-28 11:41:51,815 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 11:41:51,815 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 11:41:51
2017-03-28 11:41:51,816 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 11:41:51,816 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 11:41:51,816 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = e69859c3a18f41478683ed6f5d460d2f
2017-03-28 11:41:51,816 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 11:41:51,817 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': u'19722201', u'amount': 10, u'mobile_money_provider_id': 2, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 3}-----------------------------++++++++++++++
2017-03-28 11:41:51,817 = handlers.result_handler.AirtimeHandler - DEBUG - 19722201
2017-03-28 11:41:51,817 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 11:41:51,818 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:41:51</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e69859c3a18f41478683ed6f5d460d2f</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 11:41:51,818 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 11:41:51,818 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 11:41:51,819 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:41:51</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e69859c3a18f41478683ed6f5d460d2f</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 11:41:51,819 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 28/03/2017 11:41:51
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = e69859c3a18f41478683ed6f5d460d2f
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': u'19722201', u'amount': 10, u'mobile_money_provider_id': 2, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 3}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:19722201
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:41:51</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e69859c3a18f41478683ed6f5d460d2f</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:41:51</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e69859c3a18f41478683ed6f5d460d2f</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-28 11:41:51,815 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-28 11:41:51,815 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 11:41:51,815 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 11:41:51
2017-03-28 11:41:51,816 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 11:41:51,816 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 11:41:51,816 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = e69859c3a18f41478683ed6f5d460d2f
2017-03-28 11:41:51,816 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 11:41:51,817 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': u'19722201', u'amount': 10, u'mobile_money_provider_id': 2, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 3}-----------------------------++++++++++++++
2017-03-28 11:41:51,817 = handlers.result_handler.AirtimeHandler - DEBUG - 19722201
2017-03-28 11:41:51,817 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 11:41:51,818 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:41:51</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e69859c3a18f41478683ed6f5d460d2f</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 11:41:51,818 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 11:41:51,818 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 11:41:51,819 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:41:51</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e69859c3a18f41478683ed6f5d460d2f</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 11:41:51,819 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-28 11:41:52,554 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-28 11:41:52,554 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-28 11:41:52,555 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 11:41:39</ns0:DATE><ns0:EXTREFNUM>e69859c3a18f41478683ed6f5d460d2f</ns0:EXTREFNUM><ns0:TXNID>R170328.1141.130096</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 702935200 is successful. Your new balance is KSH 985</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 11:41:52,555 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 11:41:39</ns0:DATE><ns0:EXTREFNUM>e69859c3a18f41478683ed6f5d460d2f</ns0:EXTREFNUM><ns0:TXNID>R170328.1141.130096</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 702935200 is successful. Your new balance is KSH 985</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 11:41:39</ns0:DATE><ns0:EXTREFNUM>e69859c3a18f41478683ed6f5d460d2f</ns0:EXTREFNUM><ns0:TXNID>R170328.1141.130096</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 10 to 702935200 is successful. Your new balance is KSH 985</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 11:41:52,556 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-28 11:41:52,556 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-28 11:41:52,556 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
2017-03-28 11:41:52,556 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------10-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------10-----------------------
2017-03-28 11:41:52,557 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-28 11:41:52,557 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-28 11:41:52,557 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 11:41:39
2017-03-28 11:41:52,557 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 11:41:39
DEBUG:handlers.result_handler.AirtimeHandler:28/03/17 11:41:39
2017-03-28 11:41:52,558 = handlers.result_handler.AirtimeHandler - DEBUG - e69859c3a18f41478683ed6f5d460d2f
2017-03-28 11:41:52,558 = handlers.result_handler.AirtimeHandler - DEBUG - e69859c3a18f41478683ed6f5d460d2f
DEBUG:handlers.result_handler.AirtimeHandler:e69859c3a18f41478683ed6f5d460d2f
2017-03-28 11:41:52,558 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1141.130096
2017-03-28 11:41:52,558 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1141.130096
DEBUG:handlers.result_handler.AirtimeHandler:R170328.1141.130096
2017-03-28 11:41:52,559 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 11:41:39', 'amount': '10', 'external_ref': u'R170328.1141.130096', 'msisdn_2': u'254702935200', 'internal_ref': 'L1CHUHAGBU'}
2017-03-28 11:41:52,559 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 11:41:39', 'amount': '10', 'external_ref': u'R170328.1141.130096', 'msisdn_2': u'254702935200', 'internal_ref': 'L1CHUHAGBU'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'28/03/17 11:41:39', 'amount': '10', 'external_ref': u'R170328.1141.130096', 'msisdn_2': u'254702935200', 'internal_ref': 'L1CHUHAGBU'}
2017-03-28 11:41:52,560 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-28 11:41:52,560 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-28 11:41:52,611 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-28 11:41:52,612 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-28 11:41:52,617 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-28 11:41:52,618 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 11:41:52,623 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-28 11:41:52,623 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 11:41:52,627 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-28 11:41:52,628 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 11:41:52,633 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-28 11:41:52,634 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 11:41:52,637 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-28 11:41:52,638 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 11:41:52,641 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-28 11:41:52,642 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-28 11:41:52,645 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-28 11:41:52,646 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 11:41:52,650 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-28 11:41:52,651 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 11:41:52,654 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-28 11:41:52,655 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f3589f16ed0>
2017-03-28 11:41:52,664 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-28 11:41:52,664 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-28 11:41:52,664 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-28 11:41:52,664 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-28 11:41:52,665 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is L1CHUHAGBU
2017-03-28 11:41:52,665 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is L1CHUHAGBU
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 10  Safaricom Airtime. Your transaction number is L1CHUHAGBU
2017-03-28 11:41:52,665 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is L1CHUHAGBU to 254702935200
2017-03-28 11:41:52,665 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is L1CHUHAGBU to 254702935200
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 10  Safaricom Airtime. Your transaction number is L1CHUHAGBU to 254702935200
2017-03-28 11:41:52,666 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-28 11:41:52,666 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-28 11:41:52,666 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is L1CHUHAGBU to 7
2017-03-28 11:41:52,666 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is L1CHUHAGBU to 7
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 10  Safaricom Airtime. Your transaction number is L1CHUHAGBU to 7
2017-03-28 11:41:52,667 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is L1CHUHAGBU", "user": "7", "title": "Safaricom  Airtime"}
2017-03-28 11:41:52,667 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is L1CHUHAGBU", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 10  Safaricom Airtime. Your transaction number is L1CHUHAGBU", "user": "7", "title": "Safaricom  Airtime"}
2017-03-28 11:41:52,667 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-28 11:41:52,667 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-28 11:41:52,668 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 10  Safaricom Airtime. Your transaction number is L1CHUHAGBU
2017-03-28 11:41:52,668 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 10  Safaricom Airtime. Your transaction number is L1CHUHAGBU
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 10  Safaricom Airtime. Your transaction number is L1CHUHAGBU
2017-03-28 11:41:53,915 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":138,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is L1CHUHAGBU","image_url":"","date":"2017-03-28T11:41:40.801535Z"}
2017-03-28 11:41:53,915 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":138,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is L1CHUHAGBU","image_url":"","date":"2017-03-28T11:41:40.801535Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":138,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is L1CHUHAGBU","image_url":"","date":"2017-03-28T11:41:40.801535Z"}
2017-03-28 11:41:53,916 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-28 11:41:53,916 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-28 11:41:53,917 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":138,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is L1CHUHAGBU","image_url":"","date":"2017-03-28T11:41:40.801535Z"}
2017-03-28 11:41:53,917 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":138,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is L1CHUHAGBU","image_url":"","date":"2017-03-28T11:41:40.801535Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":138,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 10  Safaricom Airtime. Your transaction number is L1CHUHAGBU","image_url":"","date":"2017-03-28T11:41:40.801535Z"}
2017-03-28 11:41:53,917 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-28 11:41:53,917 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-28 11:41:53,918 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-28 11:41:53,918 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-28 11:41:53,918 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-28 11:41:53,918 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-28 11:41:53,919 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-28 11:41:53,919 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-28 11:41:53,920 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-28 11:41:53,920 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 3, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-28 11:41:53,920 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-28 11:41:53,920 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-28 11:41:53,996 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 11:41:53,996 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 11:41:53,997 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":105,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-28 11:41:53,997 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":105,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":105,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":10.0,"payment_method":3,"note":"null","bundle":null,"account_number":null}
2017-03-28 11:41:53,998 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 11:41:53,998 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 11:41:53,999 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "19722201"}
2017-03-28 11:41:53,999 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "19722201"}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": "19722201"}
2017-03-28 11:41:55,117 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 11:41:55,117 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 11:41:55,118 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 0, "message": "Success"}
2017-03-28 11:41:55,118 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 0, "message": "Success"}
DEBUG:handlers.result_handler.AirtimeHandler:{"status": 0, "message": "Success"}
{"status": 0, "message": "Success"}
2017-03-28 11:41:55,119 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 11:41:55,119 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 11:41:55,119 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
2017-03-28 11:41:55,119 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
DEBUG:handlers.result_handler.AirtimeHandler:Updating speadsheet......
/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
  InsecurePlatformWarning
2017-03-28 11:41:56,601 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-28 11:41:56,601 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-28 11:41:56,603 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4788.92ms
2017-03-28 11:41:56,603 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4788.92ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 4788.92ms
2017-03-28 11:42:41,664 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-28 11:42:41,665 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 11:42:41,665 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 11:42:41
2017-03-28 11:42:41,666 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 11:42:41,666 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 11:42:41,667 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = e5271327a4064d83bdb84a605874afe1
2017-03-28 11:42:41,667 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 11:42:41,667 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 11:42:41,668 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-28 11:42:41,668 = handlers.result_handler.AirtimeHandler - INFO - Building XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 28/03/2017 11:42:41
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = e5271327a4064d83bdb84a605874afe1
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:None
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-28 11:42:41,664 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-28 11:42:41,665 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 11:42:41,665 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 11:42:41
2017-03-28 11:42:41,666 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 11:42:41,666 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 11:42:41,667 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = e5271327a4064d83bdb84a605874afe1
2017-03-28 11:42:41,667 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 11:42:41,667 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 11:42:41,668 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-28 11:42:41,668 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 11:42:41,669 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:42:41</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e5271327a4064d83bdb84a605874afe1</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 11:42:41,669 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 11:42:41,670 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 11:42:41,670 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:42:41</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e5271327a4064d83bdb84a605874afe1</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 11:42:41,670 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:42:41</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e5271327a4064d83bdb84a605874afe1</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:42:41</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e5271327a4064d83bdb84a605874afe1</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-28 11:42:41,669 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:42:41</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e5271327a4064d83bdb84a605874afe1</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 11:42:41,669 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 11:42:41,670 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 11:42:41,670 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:42:41</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e5271327a4064d83bdb84a605874afe1</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 11:42:41,670 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-28 11:42:42,187 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-28 11:42:42,187 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-28 11:42:42,188 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>28/03/17 11:42:28</ns0:DATE><ns0:EXTREFNUM>e5271327a4064d83bdb84a605874afe1</ns0:EXTREFNUM><ns0:TXNID>R170328.1142.130074</ns0:TXNID><ns0:MESSAGE>The mobile number 702935200 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 11:42:42,188 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>28/03/17 11:42:28</ns0:DATE><ns0:EXTREFNUM>e5271327a4064d83bdb84a605874afe1</ns0:EXTREFNUM><ns0:TXNID>R170328.1142.130074</ns0:TXNID><ns0:MESSAGE>The mobile number 702935200 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>28/03/17 11:42:28</ns0:DATE><ns0:EXTREFNUM>e5271327a4064d83bdb84a605874afe1</ns0:EXTREFNUM><ns0:TXNID>R170328.1142.130074</ns0:TXNID><ns0:MESSAGE>The mobile number 702935200 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 11:42:42,189 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-28 11:42:42,189 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-28 11:42:42,190 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-28 11:42:42,190 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-28 11:42:42,191 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-28 11:42:42,191 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^5
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^5
2017-03-28 11:42:42,192 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-28 11:42:42,192 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-28 11:42:42,193 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-28 11:42:42,193 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-28 11:42:42,193 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 7
2017-03-28 11:42:42,193 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 7
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba to 7
2017-03-28 11:42:42,194 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
2017-03-28 11:42:42,194 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
2017-03-28 11:42:42,195 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-28 11:42:42,195 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-28 11:42:42,195 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-28 11:42:42,195 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba
2017-03-28 11:42:42,243 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":139,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-28T11:42:29.126566Z"}
2017-03-28 11:42:42,243 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":139,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-28T11:42:29.126566Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":139,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 5 has failed. Your account has been refunded with KES 5 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-28T11:42:29.126566Z"}
2017-03-28 11:42:42,244 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-28 11:42:42,244 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-28 11:42:42,244 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-28 11:42:42,244 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-28 11:42:42,245 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-28 11:42:42,245 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-28 11:42:42,245 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5", "user": 7, "user_credit_type": 1, "debit": "0"}
2017-03-28 11:42:42,245 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "5", "user": 7, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "5", "user": 7, "user_credit_type": 1, "debit": "0"}
2017-03-28 11:42:43,430 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 11:42:43,430 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 11:42:43,431 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":7,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":836.0}
2017-03-28 11:42:43,431 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":7,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":836.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":7,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":836.0}
{"user":7,"user_credit_type":1,"debit":0.0,"credit":5.0,"balance":836.0}
2017-03-28 11:42:43,432 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 11:42:43,432 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 11:42:43,432 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-28 11:42:43,432 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-28 11:42:43,433 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-28 11:42:43,433 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-28 11:42:43,433 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-28 11:42:43,433 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-28 11:42:43,434 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-28 11:42:43,434 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-28 11:42:43,434 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-28 11:42:43,434 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-28 11:42:43,619 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 11:42:43,619 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 11:42:43,620 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":106,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 11:42:43,620 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":106,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":106,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 11:42:43,621 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 11:42:43,621 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 11:42:43,622 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
2017-03-28 11:42:43,622 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": null}
2017-03-28 11:42:43,623 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 11:42:43,623 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 11:42:43,630 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-28 11:42:43,630 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-28 11:42:43,633 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 1968.92ms
2017-03-28 11:42:43,633 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 1968.92ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 1968.92ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-28 11:45:00,360 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-28 11:45:00,361 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 11:45:00,361 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 11:45:00
2017-03-28 11:45:00,361 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 11:45:00,362 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 11:45:00,362 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 1bac3d3554ef4cb5a6dbc9e2d01e4589
2017-03-28 11:45:00,363 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 11:45:00,363 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 10, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 11:45:00,363 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-28 11:45:00,364 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 11:45:00,364 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:45:00</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1bac3d3554ef4cb5a6dbc9e2d01e4589</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 11:45:00,364 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 11:45:00,365 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 28/03/2017 11:45:00
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 1bac3d3554ef4cb5a6dbc9e2d01e4589
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 10, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:None
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:45:00</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1bac3d3554ef4cb5a6dbc9e2d01e4589</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-28 11:45:00,360 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-28 11:45:00,361 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 11:45:00,361 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 11:45:00
2017-03-28 11:45:00,361 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 11:45:00,362 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 11:45:00,362 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 1bac3d3554ef4cb5a6dbc9e2d01e4589
2017-03-28 11:45:00,363 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 11:45:00,363 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 10, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 11:45:00,363 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-28 11:45:00,364 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 11:45:00,364 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:45:00</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1bac3d3554ef4cb5a6dbc9e2d01e4589</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 11:45:00,364 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 11:45:00,365 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 11:45:00,366 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:45:00</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1bac3d3554ef4cb5a6dbc9e2d01e4589</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 11:45:00,366 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:45:00</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1bac3d3554ef4cb5a6dbc9e2d01e4589</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-28 11:45:00,366 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 11:45:00</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>1bac3d3554ef4cb5a6dbc9e2d01e4589</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 11:45:00,366 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-28 11:45:00,889 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-28 11:45:00,889 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>28/03/17 11:44:47</ns0:DATE><ns0:EXTREFNUM>1bac3d3554ef4cb5a6dbc9e2d01e4589</ns0:EXTREFNUM><ns0:TXNID>R170328.1144.130067</ns0:TXNID><ns0:MESSAGE>The mobile number 702935200 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 11:45:00,890 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-28 11:45:00,890 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-28 11:45:00,890 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^10
2017-03-28 11:45:00,891 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-28 11:45:00,891 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-28 11:45:00,891 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 7
2017-03-28 11:45:00,891 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
2017-03-28 11:45:00,892 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>28/03/17 11:44:47</ns0:DATE><ns0:EXTREFNUM>1bac3d3554ef4cb5a6dbc9e2d01e4589</ns0:EXTREFNUM><ns0:TXNID>R170328.1144.130067</ns0:TXNID><ns0:MESSAGE>The mobile number 702935200 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^10
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 7
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
2017-03-28 11:45:00,889 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-28 11:45:00,889 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>28/03/17 11:44:47</ns0:DATE><ns0:EXTREFNUM>1bac3d3554ef4cb5a6dbc9e2d01e4589</ns0:EXTREFNUM><ns0:TXNID>R170328.1144.130067</ns0:TXNID><ns0:MESSAGE>The mobile number 702935200 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 11:45:00,890 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-28 11:45:00,890 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-28 11:45:00,890 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^10
2017-03-28 11:45:00,891 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-28 11:45:00,891 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-28 11:45:00,891 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 7
2017-03-28 11:45:00,891 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
2017-03-28 11:45:00,892 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-28 11:45:00,892 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-28 11:45:00,892 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-28 11:45:00,950 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":141,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-28T11:44:47.825700Z"}
2017-03-28 11:45:00,951 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-28 11:45:00,951 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-28 11:45:00,951 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":141,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-28T11:44:47.825700Z"}
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-28 11:45:00,950 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":141,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-28T11:44:47.825700Z"}
2017-03-28 11:45:00,951 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-28 11:45:00,951 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-28 11:45:00,951 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-28 11:45:00,952 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "10", "user": 7, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "10", "user": 7, "user_credit_type": 1, "debit": "0"}
2017-03-28 11:45:00,952 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "10", "user": 7, "user_credit_type": 1, "debit": "0"}
2017-03-28 11:45:01,013 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 11:45:01,013 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 11:45:01,014 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":7,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":826.0}
2017-03-28 11:45:01,014 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":7,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":826.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":7,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":826.0}
{"user":7,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":826.0}
2017-03-28 11:45:01,014 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 11:45:01,014 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 11:45:01,015 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-28 11:45:01,015 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-28 11:45:01,015 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-28 11:45:01,015 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-28 11:45:01,015 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-28 11:45:01,015 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-28 11:45:01,016 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-28 11:45:01,016 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-28 11:45:01,016 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-28 11:45:01,016 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-28 11:45:01,074 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 11:45:01,074 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":108,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 11:45:01,075 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 11:45:01,075 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
2017-03-28 11:45:01,076 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"id":108,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": null}
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 11:45:01,074 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 11:45:01,074 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":108,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 11:45:01,075 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 11:45:01,075 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
2017-03-28 11:45:01,076 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 11:45:01,083 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-28 11:45:01,083 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-28 11:45:01,085 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 726.07ms
2017-03-28 11:45:01,085 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 726.07ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 726.07ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-28 11:59:55,596 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.81ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.81ms
2017-03-28 11:59:55,596 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.81ms
2017-03-28 12:01:13,213 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-28 12:01:13,213 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 12:01:13,214 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 12:01:13
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 28/03/2017 12:01:13
2017-03-28 12:01:13,214 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 12:01:13,213 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-28 12:01:13,213 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 12:01:13,214 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 12:01:13
2017-03-28 12:01:13,214 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-28 12:01:13,215 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 12:01:13,215 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 12:01:13,215 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 2e74f3b7880d424cba2bb17eca889eb4
2017-03-28 12:01:13,216 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 12:01:13,216 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 12:01:13,216 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-28 12:01:13,217 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 12:01:13,217 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 12:01:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2e74f3b7880d424cba2bb17eca889eb4</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 12:01:13,217 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 12:01:13,218 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 12:01:13,218 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 12:01:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2e74f3b7880d424cba2bb17eca889eb4</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 12:01:13,218 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 2e74f3b7880d424cba2bb17eca889eb4
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:None
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 12:01:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2e74f3b7880d424cba2bb17eca889eb4</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 12:01:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2e74f3b7880d424cba2bb17eca889eb4</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-28 12:01:13,215 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 2e74f3b7880d424cba2bb17eca889eb4
2017-03-28 12:01:13,216 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 12:01:13,216 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 12:01:13,216 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-28 12:01:13,217 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 12:01:13,217 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 12:01:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2e74f3b7880d424cba2bb17eca889eb4</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 12:01:13,217 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 12:01:13,218 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 12:01:13,218 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 12:01:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>2e74f3b7880d424cba2bb17eca889eb4</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 12:01:13,218 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-28 12:01:14,018 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-28 12:01:14,018 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-28 12:01:14,019 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 12:01:00</ns0:DATE><ns0:EXTREFNUM>2e74f3b7880d424cba2bb17eca889eb4</ns0:EXTREFNUM><ns0:TXNID>R170328.1201.130002</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 980</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 12:01:14,019 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 12:01:00</ns0:DATE><ns0:EXTREFNUM>2e74f3b7880d424cba2bb17eca889eb4</ns0:EXTREFNUM><ns0:TXNID>R170328.1201.130002</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 980</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 12:01:00</ns0:DATE><ns0:EXTREFNUM>2e74f3b7880d424cba2bb17eca889eb4</ns0:EXTREFNUM><ns0:TXNID>R170328.1201.130002</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 980</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 12:01:14,019 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-28 12:01:14,019 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-28 12:01:14,020 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
2017-03-28 12:01:14,020 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------5-----------------------
2017-03-28 12:01:14,020 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-28 12:01:14,020 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-28 12:01:14,021 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 12:01:00
2017-03-28 12:01:14,021 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 12:01:00
DEBUG:handlers.result_handler.AirtimeHandler:28/03/17 12:01:00
2017-03-28 12:01:14,021 = handlers.result_handler.AirtimeHandler - DEBUG - 2e74f3b7880d424cba2bb17eca889eb4
2017-03-28 12:01:14,021 = handlers.result_handler.AirtimeHandler - DEBUG - 2e74f3b7880d424cba2bb17eca889eb4
DEBUG:handlers.result_handler.AirtimeHandler:2e74f3b7880d424cba2bb17eca889eb4
2017-03-28 12:01:14,021 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1201.130002
2017-03-28 12:01:14,021 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1201.130002
DEBUG:handlers.result_handler.AirtimeHandler:R170328.1201.130002
2017-03-28 12:01:14,022 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 12:01:00', 'amount': '5', 'external_ref': u'R170328.1201.130002', 'msisdn_2': u'254702935200', 'internal_ref': 'AUB2ES96BL'}
2017-03-28 12:01:14,022 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 12:01:00', 'amount': '5', 'external_ref': u'R170328.1201.130002', 'msisdn_2': u'254702935200', 'internal_ref': 'AUB2ES96BL'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'28/03/17 12:01:00', 'amount': '5', 'external_ref': u'R170328.1201.130002', 'msisdn_2': u'254702935200', 'internal_ref': 'AUB2ES96BL'}
2017-03-28 12:01:14,022 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-28 12:01:14,022 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-28 12:01:14,074 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-28 12:01:14,074 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-28 12:01:14,079 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 12:01:14,079 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-28 12:01:14,083 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 12:01:14,084 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-28 12:01:14,087 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-28 12:01:14,087 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 12:01:14,091 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-28 12:01:14,093 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 12:01:14,097 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 12:01:14,097 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-28 12:01:14,099 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-28 12:01:14,100 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 12:01:14,102 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-28 12:01:14,102 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-28 12:01:14,105 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 12:01:14,105 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-28 12:01:14,107 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 12:01:14,107 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-28 12:01:14,117 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f3589f16b90>
2017-03-28 12:01:14,117 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-28 12:01:14,117 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-28 12:01:14,117 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-28 12:01:14,118 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is AUB2ES96BL
2017-03-28 12:01:14,118 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is AUB2ES96BL
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is AUB2ES96BL
2017-03-28 12:01:14,118 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is AUB2ES96BL to 254702935200
2017-03-28 12:01:14,118 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is AUB2ES96BL to 254702935200
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is AUB2ES96BL to 254702935200
2017-03-28 12:01:14,118 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-28 12:01:14,118 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-28 12:01:14,119 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is AUB2ES96BL to 7
2017-03-28 12:01:14,119 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is AUB2ES96BL to 7
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is AUB2ES96BL to 7
2017-03-28 12:01:14,119 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is AUB2ES96BL", "user": "7", "title": "Safaricom  Airtime"}
2017-03-28 12:01:14,119 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is AUB2ES96BL", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is AUB2ES96BL", "user": "7", "title": "Safaricom  Airtime"}
2017-03-28 12:01:14,119 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-28 12:01:14,119 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-28 12:01:14,120 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 5  Safaricom Airtime. Your transaction number is AUB2ES96BL
2017-03-28 12:01:14,120 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 5  Safaricom Airtime. Your transaction number is AUB2ES96BL
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 5  Safaricom Airtime. Your transaction number is AUB2ES96BL
2017-03-28 12:01:15,519 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":142,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is AUB2ES96BL","image_url":"","date":"2017-03-28T12:01:02.366361Z"}
2017-03-28 12:01:15,519 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":142,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is AUB2ES96BL","image_url":"","date":"2017-03-28T12:01:02.366361Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":142,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is AUB2ES96BL","image_url":"","date":"2017-03-28T12:01:02.366361Z"}
2017-03-28 12:01:15,520 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-28 12:01:15,520 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-28 12:01:15,520 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":142,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is AUB2ES96BL","image_url":"","date":"2017-03-28T12:01:02.366361Z"}
2017-03-28 12:01:15,520 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":142,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is AUB2ES96BL","image_url":"","date":"2017-03-28T12:01:02.366361Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":142,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is AUB2ES96BL","image_url":"","date":"2017-03-28T12:01:02.366361Z"}
2017-03-28 12:01:15,520 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-28 12:01:15,520 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-28 12:01:15,521 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-28 12:01:15,521 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-28 12:01:15,521 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-28 12:01:15,521 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-28 12:01:15,522 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-28 12:01:15,522 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-28 12:01:15,522 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-28 12:01:15,522 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-28 12:01:15,522 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-28 12:01:15,522 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-28 12:01:16,718 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 12:01:16,718 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 12:01:16,718 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":109,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 12:01:16,718 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":109,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":109,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 12:01:16,719 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 12:01:16,719 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 12:01:16,719 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
2017-03-28 12:01:16,719 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": null}
2017-03-28 12:01:16,720 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 12:01:16,720 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 12:01:16,730 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
2017-03-28 12:01:16,730 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
DEBUG:handlers.result_handler.AirtimeHandler:Updating speadsheet......
/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
  InsecurePlatformWarning
2017-03-28 12:01:18,216 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-28 12:01:18,216 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-28 12:01:18,218 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 5006.18ms
2017-03-28 12:01:18,218 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 5006.18ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 5006.18ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-28 12:39:51,670 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-28 12:39:51,670 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/5000/-------------------
2017-03-28 12:39:51,671 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 12:39:51,671 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-28 12:39:51,671 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 12:39:51
2017-03-28 12:39:51,671 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 12:39:51
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 28/03/2017 12:39:51
2017-03-28 12:39:51,672 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 12:39:51,672 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-28 12:39:51,672 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 12:39:51,672 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-28 12:39:51,673 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = cf08dc9f40da4b6398875bf797c079a9
2017-03-28 12:39:51,673 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = cf08dc9f40da4b6398875bf797c079a9
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = cf08dc9f40da4b6398875bf797c079a9
2017-03-28 12:39:51,673 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 12:39:51,673 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-28 12:39:51,673 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'mobile_money_transaction_number': u'LC323322', u'service_type_id': 1, u'service_provider_id': 1, u'amount': u'50', u'mobile_money_provider_id': 2, u'account_number': u'1535654', u'mobile_number': u'0701585831', u'payment_method_id': u'1'}-----------------------------++++++++++++++
2017-03-28 12:39:51,673 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'mobile_money_transaction_number': u'LC323322', u'service_type_id': 1, u'service_provider_id': 1, u'amount': u'50', u'mobile_money_provider_id': 2, u'account_number': u'1535654', u'mobile_number': u'0701585831', u'payment_method_id': u'1'}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 8, u'mobile_money_transaction_number': u'LC323322', u'service_type_id': 1, u'service_provider_id': 1, u'amount': u'50', u'mobile_money_provider_id': 2, u'account_number': u'1535654', u'mobile_number': u'0701585831', u'payment_method_id': u'1'}-----------------------------++++++++++++++
2017-03-28 12:39:51,674 = handlers.result_handler.AirtimeHandler - DEBUG - LC323322
2017-03-28 12:39:51,674 = handlers.result_handler.AirtimeHandler - DEBUG - LC323322
DEBUG:handlers.result_handler.AirtimeHandler:LC323322
2017-03-28 12:39:51,674 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 12:39:51,674 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-28 12:39:51,674 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 12:39:51</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>cf08dc9f40da4b6398875bf797c079a9</ns0:EXTREFNUM><ns0:MSISDN2>0701585831</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 12:39:51,674 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 12:39:51</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>cf08dc9f40da4b6398875bf797c079a9</ns0:EXTREFNUM><ns0:MSISDN2>0701585831</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 12:39:51,675 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 12:39:51,675 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 12:39:51,676 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 12:39:51</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>cf08dc9f40da4b6398875bf797c079a9</ns0:EXTREFNUM><ns0:MSISDN2>0701585831</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 12:39:51,676 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 12:39:51</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>cf08dc9f40da4b6398875bf797c079a9</ns0:EXTREFNUM><ns0:MSISDN2>0701585831</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 12:39:51</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>cf08dc9f40da4b6398875bf797c079a9</ns0:EXTREFNUM><ns0:MSISDN2>0701585831</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-28 12:39:51,675 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 12:39:51,675 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 12:39:51,676 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 12:39:51</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>cf08dc9f40da4b6398875bf797c079a9</ns0:EXTREFNUM><ns0:MSISDN2>0701585831</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 12:39:51,676 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-28 12:39:52,466 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-28 12:39:52,466 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-28 12:39:52,467 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 12:39:39</ns0:DATE><ns0:EXTREFNUM>cf08dc9f40da4b6398875bf797c079a9</ns0:EXTREFNUM><ns0:TXNID>R170328.1239.130050</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 701585831 is successful. Your new balance is KSH 930</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 12:39:52,467 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 12:39:39</ns0:DATE><ns0:EXTREFNUM>cf08dc9f40da4b6398875bf797c079a9</ns0:EXTREFNUM><ns0:TXNID>R170328.1239.130050</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 701585831 is successful. Your new balance is KSH 930</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 12:39:39</ns0:DATE><ns0:EXTREFNUM>cf08dc9f40da4b6398875bf797c079a9</ns0:EXTREFNUM><ns0:TXNID>R170328.1239.130050</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 701585831 is successful. Your new balance is KSH 930</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 12:39:52,468 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-28 12:39:52,468 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-28 12:39:52,468 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
2017-03-28 12:39:52,468 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------50-----------------------
2017-03-28 12:39:52,469 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-28 12:39:52,469 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-28 12:39:52,469 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 12:39:39
2017-03-28 12:39:52,469 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 12:39:39
DEBUG:handlers.result_handler.AirtimeHandler:28/03/17 12:39:39
2017-03-28 12:39:52,469 = handlers.result_handler.AirtimeHandler - DEBUG - cf08dc9f40da4b6398875bf797c079a9
2017-03-28 12:39:52,469 = handlers.result_handler.AirtimeHandler - DEBUG - cf08dc9f40da4b6398875bf797c079a9
2017-03-28 12:39:52,470 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1239.130050
DEBUG:handlers.result_handler.AirtimeHandler:cf08dc9f40da4b6398875bf797c079a9
DEBUG:handlers.result_handler.AirtimeHandler:R170328.1239.130050
2017-03-28 12:39:52,470 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 12:39:39', 'amount': '50', 'external_ref': u'R170328.1239.130050', 'msisdn_2': u'0701585831', 'internal_ref': '2EJBJLZKTW'}
2017-03-28 12:39:52,470 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1239.130050
2017-03-28 12:39:52,470 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 12:39:39', 'amount': '50', 'external_ref': u'R170328.1239.130050', 'msisdn_2': u'0701585831', 'internal_ref': '2EJBJLZKTW'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'28/03/17 12:39:39', 'amount': '50', 'external_ref': u'R170328.1239.130050', 'msisdn_2': u'0701585831', 'internal_ref': '2EJBJLZKTW'}
2017-03-28 12:39:52,471 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-28 12:39:52,471 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-28 12:39:52,522 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-28 12:39:52,523 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-28 12:39:52,528 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 12:39:52,528 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-28 12:39:52,533 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-28 12:39:52,533 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 12:39:52,535 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 12:39:52,536 INFO sqlalchemy.engine.base.Engine {}
2017-03-28 12:39:52,540 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 12:39:52,540 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-28 12:39:52,542 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 12:39:52,543 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-28 12:39:52,547 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-28 12:39:52,547 INFO sqlalchemy.engine.base.Engine {'table': 23559}
2017-03-28 12:39:52,552 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 12:39:52,552 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-28 12:39:52,557 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 12:39:52,566 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-28 12:39:52,569 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 12:39:52,570 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-28 12:39:52,577 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f3589f0dc90>
2017-03-28 12:39:52,577 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-28 12:39:52,578 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-28 12:39:52,578 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-28 12:39:52,578 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 50  Safaricom Airtime. Your transaction number is 2EJBJLZKTW
2017-03-28 12:39:52,578 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 50  Safaricom Airtime. Your transaction number is 2EJBJLZKTW
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 50  Safaricom Airtime. Your transaction number is 2EJBJLZKTW
2017-03-28 12:39:52,578 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 50  Safaricom Airtime. Your transaction number is 2EJBJLZKTW to 0701585831
2017-03-28 12:39:52,578 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 50  Safaricom Airtime. Your transaction number is 2EJBJLZKTW to 0701585831
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 50  Safaricom Airtime. Your transaction number is 2EJBJLZKTW to 0701585831
2017-03-28 12:39:52,579 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-28 12:39:52,579 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-28 12:39:52,579 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 50  Safaricom Airtime. Your transaction number is 2EJBJLZKTW to 8
2017-03-28 12:39:52,579 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 50  Safaricom Airtime. Your transaction number is 2EJBJLZKTW to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 50  Safaricom Airtime. Your transaction number is 2EJBJLZKTW to 8
2017-03-28 12:39:52,580 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 50  Safaricom Airtime. Your transaction number is 2EJBJLZKTW", "user": "8", "title": "Safaricom  Airtime"}
2017-03-28 12:39:52,580 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 50  Safaricom Airtime. Your transaction number is 2EJBJLZKTW", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 50  Safaricom Airtime. Your transaction number is 2EJBJLZKTW", "user": "8", "title": "Safaricom  Airtime"}
2017-03-28 12:39:52,580 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-28 12:39:52,580 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-28 12:39:52,580 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 50  Safaricom Airtime. Your transaction number is 2EJBJLZKTW
2017-03-28 12:39:52,580 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 50  Safaricom Airtime. Your transaction number is 2EJBJLZKTW
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 50  Safaricom Airtime. Your transaction number is 2EJBJLZKTW
2017-03-28 12:39:54,001 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":143,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 50  Safaricom Airtime. Your transaction number is 2EJBJLZKTW","image_url":"","date":"2017-03-28T12:39:40.778260Z"}
2017-03-28 12:39:54,001 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":143,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 50  Safaricom Airtime. Your transaction number is 2EJBJLZKTW","image_url":"","date":"2017-03-28T12:39:40.778260Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":143,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 50  Safaricom Airtime. Your transaction number is 2EJBJLZKTW","image_url":"","date":"2017-03-28T12:39:40.778260Z"}
2017-03-28 12:39:54,001 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-28 12:39:54,001 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-28 12:39:54,002 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":143,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 50  Safaricom Airtime. Your transaction number is 2EJBJLZKTW","image_url":"","date":"2017-03-28T12:39:40.778260Z"}
2017-03-28 12:39:54,002 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":143,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 50  Safaricom Airtime. Your transaction number is 2EJBJLZKTW","image_url":"","date":"2017-03-28T12:39:40.778260Z"}
2017-03-28 12:39:54,002 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:{"id":143,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 50  Safaricom Airtime. Your transaction number is 2EJBJLZKTW","image_url":"","date":"2017-03-28T12:39:40.778260Z"}
2017-03-28 12:39:54,002 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-28 12:39:54,002 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-28 12:39:54,002 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-28 12:39:54,002 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-28 12:39:54,002 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-28 12:39:54,003 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-28 12:39:54,003 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-28 12:39:54,003 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "1585831", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "50", "service_provider_id": 1}
2017-03-28 12:39:54,003 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "1585831", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "50", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "1585831", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "50", "service_provider_id": 1}
2017-03-28 12:39:54,003 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-28 12:39:54,003 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-28 12:39:55,043 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 12:39:55,043 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 12:39:55,043 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":110,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"1585831","request":null,"amount":50.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 12:39:55,043 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":110,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"1585831","request":null,"amount":50.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":110,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"1585831","request":null,"amount":50.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 12:39:55,044 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 12:39:55,044 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 12:39:55,044 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
2017-03-28 12:39:55,044 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": "LC323322"}
2017-03-28 12:39:56,315 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 12:39:56,315 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 12:39:56,316 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
2017-03-28 12:39:56,316 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
DEBUG:handlers.result_handler.AirtimeHandler:{"status": 1, "message": "Transaction not found"}
{"status": 1, "message": "Transaction not found"}
2017-03-28 12:39:56,316 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 12:39:56,316 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 12:39:56,317 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:Updating speadsheet......
2017-03-28 12:39:56,317 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
  InsecurePlatformWarning
2017-03-28 12:39:57,773 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-28 12:39:57,775 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 6105.28ms
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 6105.28ms
2017-03-28 12:39:57,773 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-28 12:39:57,775 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 6105.28ms
2017-03-28 12:47:58,045 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-28 12:47:58,046 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 12:47:58,046 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 12:47:58
2017-03-28 12:47:58,046 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 28/03/2017 12:47:58
2017-03-28 12:47:58,045 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-28 12:47:58,046 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 12:47:58,046 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 12:47:58
2017-03-28 12:47:58,046 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 12:47:58,047 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-28 12:47:58,047 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 12:47:58,047 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 48fc851832ea4ac9813a7d15f1dd1fd5
2017-03-28 12:47:58,047 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 48fc851832ea4ac9813a7d15f1dd1fd5
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 48fc851832ea4ac9813a7d15f1dd1fd5
2017-03-28 12:47:58,047 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 12:47:58,047 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-28 12:47:58,047 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 12:47:58,047 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 12:47:58,048 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-28 12:47:58,048 = handlers.result_handler.AirtimeHandler - DEBUG - None
DEBUG:handlers.result_handler.AirtimeHandler:None
2017-03-28 12:47:58,048 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-28 12:47:58,048 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 12:47:58,048 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 12:47:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>48fc851832ea4ac9813a7d15f1dd1fd5</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 12:47:58,048 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 12:47:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>48fc851832ea4ac9813a7d15f1dd1fd5</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 12:47:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>48fc851832ea4ac9813a7d15f1dd1fd5</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 12:47:58,048 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-28 12:47:58,048 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 12:47:58,049 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-28 12:47:58,049 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 12:47:58,049 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 12:47:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>48fc851832ea4ac9813a7d15f1dd1fd5</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 12:47:58,049 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 12:47:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>48fc851832ea4ac9813a7d15f1dd1fd5</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 12:47:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>48fc851832ea4ac9813a7d15f1dd1fd5</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 12:47:58,052 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-28 12:47:58,052 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-28 12:47:58,751 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-28 12:47:58,752 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 12:47:45</ns0:DATE><ns0:EXTREFNUM>48fc851832ea4ac9813a7d15f1dd1fd5</ns0:EXTREFNUM><ns0:TXNID>R170328.1247.130053</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 925</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 12:47:58,753 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 12:47:45</ns0:DATE><ns0:EXTREFNUM>48fc851832ea4ac9813a7d15f1dd1fd5</ns0:EXTREFNUM><ns0:TXNID>R170328.1247.130053</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 925</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-28 12:47:58,751 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-28 12:47:58,752 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 12:47:45</ns0:DATE><ns0:EXTREFNUM>48fc851832ea4ac9813a7d15f1dd1fd5</ns0:EXTREFNUM><ns0:TXNID>R170328.1247.130053</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 925</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 12:47:58,753 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-28 12:47:58,754 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
2017-03-28 12:47:58,754 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------5-----------------------
2017-03-28 12:47:58,754 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-28 12:47:58,754 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-28 12:47:58,754 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 12:47:45
DEBUG:handlers.result_handler.AirtimeHandler:28/03/17 12:47:45
2017-03-28 12:47:58,754 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 12:47:45
2017-03-28 12:47:58,755 = handlers.result_handler.AirtimeHandler - DEBUG - 48fc851832ea4ac9813a7d15f1dd1fd5
2017-03-28 12:47:58,755 = handlers.result_handler.AirtimeHandler - DEBUG - 48fc851832ea4ac9813a7d15f1dd1fd5
DEBUG:handlers.result_handler.AirtimeHandler:48fc851832ea4ac9813a7d15f1dd1fd5
2017-03-28 12:47:58,755 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1247.130053
2017-03-28 12:47:58,755 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1247.130053
DEBUG:handlers.result_handler.AirtimeHandler:R170328.1247.130053
2017-03-28 12:47:58,755 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 12:47:45', 'amount': '5', 'external_ref': u'R170328.1247.130053', 'msisdn_2': u'254702935200', 'internal_ref': 'JV1QMJJC64'}
2017-03-28 12:47:58,755 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 12:47:45', 'amount': '5', 'external_ref': u'R170328.1247.130053', 'msisdn_2': u'254702935200', 'internal_ref': 'JV1QMJJC64'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'28/03/17 12:47:45', 'amount': '5', 'external_ref': u'R170328.1247.130053', 'msisdn_2': u'254702935200', 'internal_ref': 'JV1QMJJC64'}
2017-03-28 12:47:58,755 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-28 12:47:58,755 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-28 12:47:58,810 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-28 12:47:58,810 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-28 12:47:58,814 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 12:47:58,814 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-28 12:47:58,819 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 12:47:58,819 INFO sqlalchemy.engine.base.Engine {}
2017-03-28 12:47:58,822 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 12:47:58,822 INFO sqlalchemy.engine.base.Engine {}
2017-03-28 12:47:58,827 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 12:47:58,828 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-28 12:47:58,831 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-28 12:47:58,833 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 12:47:58,838 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-28 12:47:58,840 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-28 12:47:58,846 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-28 12:47:58,848 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 12:47:58,855 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 12:47:58,856 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-28 12:47:58,858 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-28 12:47:58,860 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f358e215e90>
2017-03-28 12:47:58,869 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-28 12:47:58,869 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-28 12:47:58,871 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-28 12:47:58,871 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-28 12:47:58,872 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is JV1QMJJC64
2017-03-28 12:47:58,872 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is JV1QMJJC64
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is JV1QMJJC64
2017-03-28 12:47:58,872 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is JV1QMJJC64 to 254702935200
2017-03-28 12:47:58,872 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is JV1QMJJC64 to 254702935200
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is JV1QMJJC64 to 254702935200
2017-03-28 12:47:58,872 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-28 12:47:58,872 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-28 12:47:58,873 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is JV1QMJJC64 to 7
2017-03-28 12:47:58,873 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is JV1QMJJC64 to 7
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is JV1QMJJC64 to 7
2017-03-28 12:47:58,873 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is JV1QMJJC64", "user": "7", "title": "Safaricom  Airtime"}
2017-03-28 12:47:58,873 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is JV1QMJJC64", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is JV1QMJJC64", "user": "7", "title": "Safaricom  Airtime"}
2017-03-28 12:47:58,874 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-28 12:47:58,874 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-28 12:47:58,874 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 5  Safaricom Airtime. Your transaction number is JV1QMJJC64
2017-03-28 12:47:58,874 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 5  Safaricom Airtime. Your transaction number is JV1QMJJC64
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 5  Safaricom Airtime. Your transaction number is JV1QMJJC64
2017-03-28 12:48:00,212 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":144,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is JV1QMJJC64","image_url":"","date":"2017-03-28T12:47:46.974109Z"}
2017-03-28 12:48:00,212 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":144,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is JV1QMJJC64","image_url":"","date":"2017-03-28T12:47:46.974109Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":144,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is JV1QMJJC64","image_url":"","date":"2017-03-28T12:47:46.974109Z"}
2017-03-28 12:48:00,212 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-28 12:48:00,212 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-28 12:48:00,212 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":144,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is JV1QMJJC64","image_url":"","date":"2017-03-28T12:47:46.974109Z"}
2017-03-28 12:48:00,212 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":144,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is JV1QMJJC64","image_url":"","date":"2017-03-28T12:47:46.974109Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":144,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is JV1QMJJC64","image_url":"","date":"2017-03-28T12:47:46.974109Z"}
2017-03-28 12:48:00,213 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-28 12:48:00,213 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-28 12:48:00,213 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-28 12:48:00,213 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-28 12:48:00,213 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-28 12:48:00,213 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-28 12:48:00,213 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-28 12:48:00,213 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-28 12:48:00,213 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-28 12:48:00,213 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-28 12:48:00,214 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-28 12:48:00,214 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-28 12:48:01,384 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 12:48:01,384 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 12:48:01,384 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":111,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 12:48:01,384 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":111,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":111,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 12:48:01,385 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 12:48:01,385 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 12:48:01,385 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
2017-03-28 12:48:01,385 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": null}
2017-03-28 12:48:01,386 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 12:48:01,386 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 12:48:01,392 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
2017-03-28 12:48:01,392 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
DEBUG:handlers.result_handler.AirtimeHandler:Updating speadsheet......
/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
  InsecurePlatformWarning
2017-03-28 12:48:02,727 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-28 12:48:02,727 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-28 12:48:02,728 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4683.59ms
2017-03-28 12:48:02,728 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4683.59ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 4683.59ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-28 13:57:53,155 = __main__ - INFO - Creating server
2017-03-28 13:57:53,160 = __main__ - INFO - Created server
2017-03-28 13:57:53,161 = __main__ - INFO - Listening on port 8080
2017-03-28 13:58:28,544 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-28 13:58:28,545 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/2000/-------------------
2017-03-28 13:58:28,544 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-28 13:58:28,545 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-28 13:58:28,545 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 13:58:28
2017-03-28 13:58:28,545 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 13:58:28
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 28/03/2017 13:58:28
2017-03-28 13:58:28,546 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 13:58:28,546 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-28 13:58:28,546 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 13:58:28,547 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = d782fb37fbee4ac59ae61965f609030d
2017-03-28 13:58:28,547 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 13:58:28,548 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'mobile_money_transaction_number': u'LC323322', u'service_type_id': 1, u'service_provider_id': 1, u'amount': u'20', u'mobile_money_provider_id': 2, u'account_number': u'1535654', u'mobile_number': u'0721799582', u'payment_method_id': u'1'}-----------------------------++++++++++++++
2017-03-28 13:58:28,548 = handlers.result_handler.AirtimeHandler - DEBUG - LC323322
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = d782fb37fbee4ac59ae61965f609030d
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 8, u'mobile_money_transaction_number': u'LC323322', u'service_type_id': 1, u'service_provider_id': 1, u'amount': u'20', u'mobile_money_provider_id': 2, u'account_number': u'1535654', u'mobile_number': u'0721799582', u'payment_method_id': u'1'}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:LC323322
2017-03-28 13:58:28,546 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 13:58:28,547 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = d782fb37fbee4ac59ae61965f609030d
2017-03-28 13:58:28,547 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 13:58:28,548 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'mobile_money_transaction_number': u'LC323322', u'service_type_id': 1, u'service_provider_id': 1, u'amount': u'20', u'mobile_money_provider_id': 2, u'account_number': u'1535654', u'mobile_number': u'0721799582', u'payment_method_id': u'1'}-----------------------------++++++++++++++
2017-03-28 13:58:28,548 = handlers.result_handler.AirtimeHandler - DEBUG - LC323322
2017-03-28 13:58:28,548 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-28 13:58:28,555 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 13:58:28</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>d782fb37fbee4ac59ae61965f609030d</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 13:58:28,548 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 13:58:28,555 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 13:58:28</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>d782fb37fbee4ac59ae61965f609030d</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 13:58:28,555 = handlers.result_handler.AirtimeHandler - INFO - Built XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 13:58:28</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>d782fb37fbee4ac59ae61965f609030d</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 13:58:28,555 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-28 13:58:28,556 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 13:58:28,556 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-28 13:58:28,556 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 13:58:28</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>d782fb37fbee4ac59ae61965f609030d</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 13:58:28,556 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 13:58:28</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>d782fb37fbee4ac59ae61965f609030d</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 13:58:28</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>d782fb37fbee4ac59ae61965f609030d</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 13:58:28,556 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-28 13:58:28,556 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-28 13:58:29,270 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-28 13:58:29,270 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-28 13:58:29,270 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 13:58:15</ns0:DATE><ns0:EXTREFNUM>d782fb37fbee4ac59ae61965f609030d</ns0:EXTREFNUM><ns0:TXNID>R170328.1358.130016</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 721799582 is successful. Your new balance is KSH 905</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 13:58:29,270 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 13:58:15</ns0:DATE><ns0:EXTREFNUM>d782fb37fbee4ac59ae61965f609030d</ns0:EXTREFNUM><ns0:TXNID>R170328.1358.130016</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 721799582 is successful. Your new balance is KSH 905</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 13:58:29,271 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 13:58:15</ns0:DATE><ns0:EXTREFNUM>d782fb37fbee4ac59ae61965f609030d</ns0:EXTREFNUM><ns0:TXNID>R170328.1358.130016</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 721799582 is successful. Your new balance is KSH 905</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 13:58:29,271 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------20-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-28 13:58:29,271 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-28 13:58:29,271 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------20-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------20-----------------------
2017-03-28 13:58:29,271 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-28 13:58:29,271 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-28 13:58:29,272 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 13:58:15
2017-03-28 13:58:29,272 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 13:58:15
DEBUG:handlers.result_handler.AirtimeHandler:28/03/17 13:58:15
2017-03-28 13:58:29,272 = handlers.result_handler.AirtimeHandler - DEBUG - d782fb37fbee4ac59ae61965f609030d
2017-03-28 13:58:29,272 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1358.130016
DEBUG:handlers.result_handler.AirtimeHandler:d782fb37fbee4ac59ae61965f609030d
DEBUG:handlers.result_handler.AirtimeHandler:R170328.1358.130016
2017-03-28 13:58:29,272 = handlers.result_handler.AirtimeHandler - DEBUG - d782fb37fbee4ac59ae61965f609030d
2017-03-28 13:58:29,272 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1358.130016
2017-03-28 13:58:29,273 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 13:58:15', 'amount': '20', 'external_ref': u'R170328.1358.130016', 'msisdn_2': u'0721799582', 'internal_ref': '57X6EH1WZ8'}
2017-03-28 13:58:29,273 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 13:58:15', 'amount': '20', 'external_ref': u'R170328.1358.130016', 'msisdn_2': u'0721799582', 'internal_ref': '57X6EH1WZ8'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'28/03/17 13:58:15', 'amount': '20', 'external_ref': u'R170328.1358.130016', 'msisdn_2': u'0721799582', 'internal_ref': '57X6EH1WZ8'}
2017-03-28 13:58:29,273 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-28 13:58:29,273 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-28 13:58:29,319 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-28 13:58:29,319 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-28 13:58:29,322 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 13:58:29,322 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-28 13:58:29,326 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-28 13:58:29,326 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 13:58:29,328 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-28 13:58:29,328 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 13:58:29,332 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 13:58:29,333 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-28 13:58:29,335 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 13:58:29,335 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-28 13:58:29,338 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-28 13:58:29,338 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-28 13:58:29,340 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-28 13:58:29,340 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 13:58:29,343 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-28 13:58:29,344 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 13:58:29,346 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-28 13:58:29,346 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 13:58:29,353 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f3589f0dd10>
2017-03-28 13:58:29,353 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-28 13:58:29,353 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-28 13:58:29,353 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-28 13:58:29,354 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 57X6EH1WZ8
2017-03-28 13:58:29,354 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 57X6EH1WZ8
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 57X6EH1WZ8
2017-03-28 13:58:29,354 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 57X6EH1WZ8 to 0721799582
2017-03-28 13:58:29,354 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 57X6EH1WZ8 to 0721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 57X6EH1WZ8 to 0721799582
2017-03-28 13:58:29,355 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-28 13:58:29,355 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-28 13:58:29,355 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 57X6EH1WZ8 to 8
2017-03-28 13:58:29,355 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 57X6EH1WZ8 to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 57X6EH1WZ8 to 8
2017-03-28 13:58:29,356 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 57X6EH1WZ8", "user": "8", "title": "Safaricom  Airtime"}
2017-03-28 13:58:29,356 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 57X6EH1WZ8", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 57X6EH1WZ8", "user": "8", "title": "Safaricom  Airtime"}
2017-03-28 13:58:29,356 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-28 13:58:29,356 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-28 13:58:29,356 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 57X6EH1WZ8
2017-03-28 13:58:29,356 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 57X6EH1WZ8
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 57X6EH1WZ8
2017-03-28 13:58:30,698 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":145,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 57X6EH1WZ8","image_url":"","date":"2017-03-28T13:58:17.327886Z"}
2017-03-28 13:58:30,698 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":145,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 57X6EH1WZ8","image_url":"","date":"2017-03-28T13:58:17.327886Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":145,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 57X6EH1WZ8","image_url":"","date":"2017-03-28T13:58:17.327886Z"}
2017-03-28 13:58:30,699 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-28 13:58:30,699 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":145,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 57X6EH1WZ8","image_url":"","date":"2017-03-28T13:58:17.327886Z"}
2017-03-28 13:58:30,699 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-28 13:58:30,699 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":145,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 57X6EH1WZ8","image_url":"","date":"2017-03-28T13:58:17.327886Z"}
2017-03-28 13:58:30,699 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-28 13:58:30,700 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:{"id":145,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 57X6EH1WZ8","image_url":"","date":"2017-03-28T13:58:17.327886Z"}
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-28 13:58:30,700 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-28 13:58:30,699 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-28 13:58:30,700 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-28 13:58:30,700 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-28 13:58:30,700 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:
DEBUG:handlers.result_handler.AirtimeHandler:null
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-28 13:58:30,700 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-28 13:58:30,700 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "1799582", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
2017-03-28 13:58:30,700 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "1799582", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "1799582", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
2017-03-28 13:58:30,701 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-28 13:58:30,701 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-28 13:58:31,760 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 13:58:31,760 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 13:58:31,760 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":112,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"1799582","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"id":112,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"1799582","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 13:58:31,761 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 13:58:31,760 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":112,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"1799582","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 13:58:31,761 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 13:58:31,761 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
2017-03-28 13:58:31,761 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": "LC323322"}
2017-03-28 13:58:33,056 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 13:58:33,056 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 13:58:33,056 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 13:58:33,056 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
{"status": 1, "message": "Transaction not found"}
2017-03-28 13:58:33,057 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 13:58:33,057 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:{"status": 1, "message": "Transaction not found"}
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 13:58:33,057 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
2017-03-28 13:58:33,057 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
DEBUG:handlers.result_handler.AirtimeHandler:Updating speadsheet......
/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
  InsecurePlatformWarning
2017-03-28 13:58:34,598 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-28 13:58:34,598 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-28 13:58:34,600 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 6056.36ms
2017-03-28 13:58:34,600 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 6056.36ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 6056.36ms
2017-03-28 13:59:30,290 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-28 13:59:30,290 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/2000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-28 13:59:30,290 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 13:59:30
2017-03-28 13:59:30,290 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-28 13:59:30,290 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 13:59:30,290 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 13:59:30
2017-03-28 13:59:30,290 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 13:59:30,290 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 13:59:30,291 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 28/03/2017 13:59:30
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-28 13:59:30,291 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 13:59:30,291 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 187e299a06cc4d54a2b0916fa9668607
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-28 13:59:30,291 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 13:59:30,291 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 187e299a06cc4d54a2b0916fa9668607
2017-03-28 13:59:30,291 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 187e299a06cc4d54a2b0916fa9668607
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-28 13:59:30,291 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'mobile_money_transaction_number': u'LC323322', u'service_type_id': 1, u'service_provider_id': 1, u'amount': u'20', u'mobile_money_provider_id': 2, u'account_number': u'1535654', u'mobile_number': u'0721799582', u'payment_method_id': u'1'}-----------------------------++++++++++++++
2017-03-28 13:59:30,291 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'mobile_money_transaction_number': u'LC323322', u'service_type_id': 1, u'service_provider_id': 1, u'amount': u'20', u'mobile_money_provider_id': 2, u'account_number': u'1535654', u'mobile_number': u'0721799582', u'payment_method_id': u'1'}-----------------------------++++++++++++++
2017-03-28 13:59:30,292 = handlers.result_handler.AirtimeHandler - DEBUG - LC323322
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 8, u'mobile_money_transaction_number': u'LC323322', u'service_type_id': 1, u'service_provider_id': 1, u'amount': u'20', u'mobile_money_provider_id': 2, u'account_number': u'1535654', u'mobile_number': u'0721799582', u'payment_method_id': u'1'}-----------------------------++++++++++++++
2017-03-28 13:59:30,292 = handlers.result_handler.AirtimeHandler - DEBUG - LC323322
2017-03-28 13:59:30,292 = handlers.result_handler.AirtimeHandler - INFO - Building XML
DEBUG:handlers.result_handler.AirtimeHandler:LC323322
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-28 13:59:30,292 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 13:59:30,292 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 13:59:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>187e299a06cc4d54a2b0916fa9668607</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 13:59:30,292 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 13:59:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>187e299a06cc4d54a2b0916fa9668607</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 13:59:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>187e299a06cc4d54a2b0916fa9668607</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 13:59:30,292 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-28 13:59:30,292 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 13:59:30,292 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 13:59:30,292 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-28 13:59:30,293 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 13:59:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>187e299a06cc4d54a2b0916fa9668607</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 13:59:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>187e299a06cc4d54a2b0916fa9668607</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 13:59:30,293 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-28 13:59:30,293 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 13:59:30</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>187e299a06cc4d54a2b0916fa9668607</ns0:EXTREFNUM><ns0:MSISDN2>0721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 13:59:30,293 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-28 13:59:30,813 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-28 13:59:30,814 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>28/03/17 13:59:17</ns0:DATE><ns0:EXTREFNUM>187e299a06cc4d54a2b0916fa9668607</ns0:EXTREFNUM><ns0:TXNID>R170328.1359.130020</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>28/03/17 13:59:17</ns0:DATE><ns0:EXTREFNUM>187e299a06cc4d54a2b0916fa9668607</ns0:EXTREFNUM><ns0:TXNID>R170328.1359.130020</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 13:59:30,813 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-28 13:59:30,814 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>28/03/17 13:59:17</ns0:DATE><ns0:EXTREFNUM>187e299a06cc4d54a2b0916fa9668607</ns0:EXTREFNUM><ns0:TXNID>R170328.1359.130020</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 13:59:30,815 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-28 13:59:30,815 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-28 13:59:30,815 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^20
2017-03-28 13:59:30,816 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
2017-03-28 13:59:30,816 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-28 13:59:30,817 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba to 8
2017-03-28 13:59:30,818 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-28 13:59:30,818 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-28 13:59:30,818 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^20
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba to 8
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
2017-03-28 13:59:30,815 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-28 13:59:30,815 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-28 13:59:30,815 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^20
2017-03-28 13:59:30,816 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
2017-03-28 13:59:30,816 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-28 13:59:30,817 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba to 8
2017-03-28 13:59:30,818 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-28 13:59:30,818 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-28 13:59:30,818 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
2017-03-28 13:59:30,894 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":146,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-28T13:59:17.520634Z"}
2017-03-28 13:59:30,894 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":146,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-28T13:59:17.520634Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":146,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-28T13:59:17.520634Z"}
2017-03-28 13:59:30,895 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-28 13:59:30,895 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-28 13:59:30,895 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-28 13:59:30,895 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-28 13:59:30,896 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-28 13:59:30,896 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-28 13:59:30,897 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "20", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-28 13:59:30,897 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "20", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "20", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-28 13:59:30,961 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 13:59:30,961 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 13:59:30,962 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":20.0,"balance":2435.0}
2017-03-28 13:59:30,962 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":20.0,"balance":2435.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":8,"user_credit_type":1,"debit":0.0,"credit":20.0,"balance":2435.0}
{"user":8,"user_credit_type":1,"debit":0.0,"credit":20.0,"balance":2435.0}
2017-03-28 13:59:30,963 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 13:59:30,963 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 13:59:30,964 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-28 13:59:30,964 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-28 13:59:30,964 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-28 13:59:30,964 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-28 13:59:30,965 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-28 13:59:30,965 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-28 13:59:30,966 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "1799582", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
2017-03-28 13:59:30,966 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "1799582", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "1799582", "user": 8, "transaction_status": 2, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
2017-03-28 13:59:30,966 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-28 13:59:30,966 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-28 13:59:31,085 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 13:59:31,085 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 13:59:31,086 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":113,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"1799582","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 13:59:31,086 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":113,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"1799582","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":113,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"1799582","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 13:59:31,087 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 13:59:31,087 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 13:59:31,088 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
2017-03-28 13:59:31,088 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": "LC323322"}
2017-03-28 13:59:31,177 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 13:59:31,177 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 13:59:31,178 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
2017-03-28 13:59:31,178 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
DEBUG:handlers.result_handler.AirtimeHandler:{"status": 1, "message": "Transaction not found"}
{"status": 1, "message": "Transaction not found"}
2017-03-28 13:59:31,179 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 13:59:31,179 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 13:59:31,179 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-28 13:59:31,179 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-28 13:59:31,181 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 892.02ms
2017-03-28 13:59:31,181 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 892.02ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 892.02ms
2017-03-28 14:00:51,776 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-28 14:00:51,776 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 14:00:51,777 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 14:00:51
2017-03-28 14:00:51,777 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 14:00:51,778 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 14:00:51,778 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 349f2527b8474fa0991b2a430ca1c59b
2017-03-28 14:00:51,779 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 14:00:51,779 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': u'N', u'mobile_money_transaction_number': None, u'amount': 10, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254721799582', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 14:00:51,779 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-28 14:00:51,780 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 14:00:51,780 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:00:51</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>349f2527b8474fa0991b2a430ca1c59b</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:00:51,780 = handlers.result_handler.AirtimeHandler - INFO - Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/1000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 28/03/2017 14:00:51
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 349f2527b8474fa0991b2a430ca1c59b
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': u'N', u'mobile_money_transaction_number': None, u'amount': 10, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254721799582', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:None
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:00:51</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>349f2527b8474fa0991b2a430ca1c59b</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-28 14:00:51,776 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/1000/-------------------
2017-03-28 14:00:51,776 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 14:00:51,777 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 14:00:51
2017-03-28 14:00:51,777 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 14:00:51,778 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 14:00:51,778 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 349f2527b8474fa0991b2a430ca1c59b
2017-03-28 14:00:51,779 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 14:00:51,779 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': u'N', u'mobile_money_transaction_number': None, u'amount': 10, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254721799582', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 14:00:51,779 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-28 14:00:51,780 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 14:00:51,780 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:00:51</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>349f2527b8474fa0991b2a430ca1c59b</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:00:51,780 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 14:00:51,781 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 14:00:51,782 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:00:51</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>349f2527b8474fa0991b2a430ca1c59b</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:00:51,782 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:00:51</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>349f2527b8474fa0991b2a430ca1c59b</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-28 14:00:51,781 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 14:00:51,782 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:00:51</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>349f2527b8474fa0991b2a430ca1c59b</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>1000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:00:51,782 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-28 14:00:52,300 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-28 14:00:52,300 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-28 14:00:52,302 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>28/03/17 14:00:38</ns0:DATE><ns0:EXTREFNUM>349f2527b8474fa0991b2a430ca1c59b</ns0:EXTREFNUM><ns0:TXNID>R170328.1400.130039</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 14:00:52,302 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>28/03/17 14:00:38</ns0:DATE><ns0:EXTREFNUM>349f2527b8474fa0991b2a430ca1c59b</ns0:EXTREFNUM><ns0:TXNID>R170328.1400.130039</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>28/03/17 14:00:38</ns0:DATE><ns0:EXTREFNUM>349f2527b8474fa0991b2a430ca1c59b</ns0:EXTREFNUM><ns0:TXNID>R170328.1400.130039</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 14:00:52,302 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-28 14:00:52,302 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-28 14:00:52,303 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-28 14:00:52,303 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-28 14:00:52,304 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^10
2017-03-28 14:00:52,304 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^10
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^10
2017-03-28 14:00:52,305 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-28 14:00:52,305 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-28 14:00:52,306 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-28 14:00:52,306 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-28 14:00:52,306 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 8
2017-03-28 14:00:52,306 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba to 8
2017-03-28 14:00:52,307 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-28 14:00:52,307 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-28 14:00:52,313 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-28 14:00:52,313 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-28 14:00:52,315 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-28 14:00:52,315 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba
2017-03-28 14:00:52,370 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":147,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-28T14:00:38.994964Z"}
2017-03-28 14:00:52,370 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":147,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-28T14:00:38.994964Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":147,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 10 has failed. Your account has been refunded with KES 10 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-28T14:00:38.994964Z"}
2017-03-28 14:00:52,371 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-28 14:00:52,371 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-28 14:00:52,372 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-28 14:00:52,372 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-28 14:00:52,373 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-28 14:00:52,373 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-28 14:00:52,373 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "10", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-28 14:00:52,373 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "10", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "10", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-28 14:00:52,435 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 14:00:52,435 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 14:00:52,437 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":2435.0}
2017-03-28 14:00:52,437 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":2435.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":8,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":2435.0}
{"user":8,"user_credit_type":1,"debit":0.0,"credit":10.0,"balance":2435.0}
2017-03-28 14:00:52,438 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 14:00:52,438 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 14:00:52,439 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-28 14:00:52,439 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-28 14:00:52,440 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-28 14:00:52,440 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-28 14:00:52,441 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-28 14:00:52,441 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-28 14:00:52,442 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-28 14:00:52,442 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "10", "service_provider_id": 1}
2017-03-28 14:00:52,443 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-28 14:00:52,443 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-28 14:00:52,504 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 14:00:52,504 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 14:00:52,507 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":114,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 14:00:52,507 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":114,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":114,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"721799582","request":null,"amount":10.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 14:00:52,509 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 14:00:52,509 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 14:00:52,512 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
2017-03-28 14:00:52,512 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": null}
2017-03-28 14:00:52,515 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 14:00:52,515 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 14:00:52,526 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-28 14:00:52,526 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-28 14:00:52,528 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 753.17ms
2017-03-28 14:00:52,528 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 753.17ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 753.17ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-28 14:01:20,537 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-28 14:01:20,538 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/2000/-------------------
2017-03-28 14:01:20,537 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-28 14:01:20,538 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 14:01:20,538 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 14:01:20
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-28 14:01:20,538 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 14:01:20
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 28/03/2017 14:01:20
2017-03-28 14:01:20,539 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 14:01:20,539 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-28 14:01:20,539 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 14:01:20,539 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-28 14:01:20,540 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = cfe616bb12a84b4aae92c6d2849f7017
2017-03-28 14:01:20,540 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = cfe616bb12a84b4aae92c6d2849f7017
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = cfe616bb12a84b4aae92c6d2849f7017
2017-03-28 14:01:20,540 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-28 14:01:20,540 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 14:01:20,540 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': u'B', u'mobile_money_transaction_number': None, u'amount': 20, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254721799582', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': u'B', u'mobile_money_transaction_number': None, u'amount': 20, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254721799582', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 14:01:20,541 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-28 14:01:20,540 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': u'B', u'mobile_money_transaction_number': None, u'amount': 20, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254721799582', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 14:01:20,541 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-28 14:01:20,541 = handlers.result_handler.AirtimeHandler - INFO - Building XML
DEBUG:handlers.result_handler.AirtimeHandler:None
2017-03-28 14:01:20,541 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-28 14:01:20,541 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:01:20</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>cfe616bb12a84b4aae92c6d2849f7017</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:01:20,541 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:01:20</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>cfe616bb12a84b4aae92c6d2849f7017</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:01:20,542 = handlers.result_handler.AirtimeHandler - INFO - Built XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:01:20</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>cfe616bb12a84b4aae92c6d2849f7017</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:01:20,542 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-28 14:01:20,542 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 14:01:20,542 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-28 14:01:20,543 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:01:20</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>cfe616bb12a84b4aae92c6d2849f7017</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:01:20,543 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:01:20</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>cfe616bb12a84b4aae92c6d2849f7017</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:01:20</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>cfe616bb12a84b4aae92c6d2849f7017</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:01:20,543 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-28 14:01:20,543 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-28 14:01:21,095 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-28 14:01:21,096 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>28/03/17 14:01:07</ns0:DATE><ns0:EXTREFNUM>cfe616bb12a84b4aae92c6d2849f7017</ns0:EXTREFNUM><ns0:TXNID>R170328.1401.130005</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 14:01:21,095 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-28 14:01:21,096 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>28/03/17 14:01:07</ns0:DATE><ns0:EXTREFNUM>cfe616bb12a84b4aae92c6d2849f7017</ns0:EXTREFNUM><ns0:TXNID>R170328.1401.130005</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 14:01:21,096 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>28/03/17 14:01:07</ns0:DATE><ns0:EXTREFNUM>cfe616bb12a84b4aae92c6d2849f7017</ns0:EXTREFNUM><ns0:TXNID>R170328.1401.130005</ns0:TXNID><ns0:MESSAGE>The mobile number 721799582 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-28 14:01:21,096 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-28 14:01:21,096 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-28 14:01:21,096 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-28 14:01:21,097 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^20
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^20
2017-03-28 14:01:21,097 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^20
2017-03-28 14:01:21,097 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
2017-03-28 14:01:21,097 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
2017-03-28 14:01:21,098 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-28 14:01:21,098 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-28 14:01:21,098 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba to 8
2017-03-28 14:01:21,098 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba to 8
2017-03-28 14:01:21,098 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-28 14:01:21,098 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba", "user": "8", "title": "Safaricom  Airtime"}
2017-03-28 14:01:21,099 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-28 14:01:21,099 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-28 14:01:21,099 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
2017-03-28 14:01:21,099 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
2017-03-28 14:01:21,149 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":148,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-28T14:01:07.773011Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":148,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-28T14:01:07.773011Z"}
2017-03-28 14:01:21,149 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":148,"user":8,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-28T14:01:07.773011Z"}
2017-03-28 14:01:21,150 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-28 14:01:21,150 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-28 14:01:21,151 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-28 14:01:21,151 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-28 14:01:21,151 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-28 14:01:21,151 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-28 14:01:21,152 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "20", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-28 14:01:21,152 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "20", "user": 8, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "20", "user": 8, "user_credit_type": 1, "debit": "0"}
2017-03-28 14:01:21,204 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 14:01:21,204 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 14:01:21,204 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":20.0,"balance":2435.0}
2017-03-28 14:01:21,204 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":8,"user_credit_type":1,"debit":0.0,"credit":20.0,"balance":2435.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":8,"user_credit_type":1,"debit":0.0,"credit":20.0,"balance":2435.0}
{"user":8,"user_credit_type":1,"debit":0.0,"credit":20.0,"balance":2435.0}
2017-03-28 14:01:21,206 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 14:01:21,206 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 14:01:21,207 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-28 14:01:21,207 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-28 14:01:21,207 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-28 14:01:21,207 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-28 14:01:21,208 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-28 14:01:21,208 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-28 14:01:21,208 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
2017-03-28 14:01:21,208 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "721799582", "user": 8, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
2017-03-28 14:01:21,209 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-28 14:01:21,209 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-28 14:01:21,261 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 14:01:21,261 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 14:01:21,261 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":115,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"721799582","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"id":115,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"721799582","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 14:01:21,262 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 14:01:21,261 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":115,"user":8,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"721799582","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 14:01:21,262 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 14:01:21,262 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": null}
2017-03-28 14:01:21,262 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
2017-03-28 14:01:21,262 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 14:01:21,262 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-28 14:01:21,269 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-28 14:01:21,269 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-28 14:01:21,270 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 733.13ms
2017-03-28 14:01:21,270 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 733.13ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 733.13ms
2017-03-28 14:02:58,105 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-28 14:02:58,105 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-28 14:02:58,106 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/2000/-------------------
2017-03-28 14:02:58,106 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-28 14:02:58,106 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 14:02:58
2017-03-28 14:02:58,106 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 14:02:58
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 28/03/2017 14:02:58
2017-03-28 14:02:58,107 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 14:02:58,107 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-28 14:02:58,107 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 14:02:58,107 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-28 14:02:58,108 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 5ac9cd8e4a9e4d0fa2e02fe0afe794b9
2017-03-28 14:02:58,108 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 5ac9cd8e4a9e4d0fa2e02fe0afe794b9
2017-03-28 14:02:58,108 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 5ac9cd8e4a9e4d0fa2e02fe0afe794b9
2017-03-28 14:02:58,108 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-28 14:02:58,108 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 20, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 14:02:58,108 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 20, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 20, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 14:02:58,109 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-28 14:02:58,109 = handlers.result_handler.AirtimeHandler - DEBUG - None
DEBUG:handlers.result_handler.AirtimeHandler:None
2017-03-28 14:02:58,109 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-28 14:02:58,109 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 14:02:58,109 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:02:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5ac9cd8e4a9e4d0fa2e02fe0afe794b9</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:02:58,109 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:02:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5ac9cd8e4a9e4d0fa2e02fe0afe794b9</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:02:58,110 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 14:02:58,110 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 14:02:58,110 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:02:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5ac9cd8e4a9e4d0fa2e02fe0afe794b9</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:02:58,111 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:02:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5ac9cd8e4a9e4d0fa2e02fe0afe794b9</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:02:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5ac9cd8e4a9e4d0fa2e02fe0afe794b9</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:02:58,110 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 14:02:58,110 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 14:02:58,110 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:02:58</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>5ac9cd8e4a9e4d0fa2e02fe0afe794b9</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:02:58,111 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-28 14:02:58,831 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-28 14:02:58,832 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 14:02:45</ns0:DATE><ns0:EXTREFNUM>5ac9cd8e4a9e4d0fa2e02fe0afe794b9</ns0:EXTREFNUM><ns0:TXNID>R170328.1402.130044</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 702935200 is successful. Your new balance is KSH 885</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 14:02:58,832 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-28 14:02:58,833 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------20-----------------------
2017-03-28 14:02:58,833 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-28 14:02:58,833 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 14:02:45
2017-03-28 14:02:58,834 = handlers.result_handler.AirtimeHandler - DEBUG - 5ac9cd8e4a9e4d0fa2e02fe0afe794b9
2017-03-28 14:02:58,834 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1402.130044
2017-03-28 14:02:58,834 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 14:02:45', 'amount': '20', 'external_ref': u'R170328.1402.130044', 'msisdn_2': u'254702935200', 'internal_ref': '3T2XSAO083'}
2017-03-28 14:02:58,834 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 14:02:45</ns0:DATE><ns0:EXTREFNUM>5ac9cd8e4a9e4d0fa2e02fe0afe794b9</ns0:EXTREFNUM><ns0:TXNID>R170328.1402.130044</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 702935200 is successful. Your new balance is KSH 885</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------20-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:28/03/17 14:02:45
DEBUG:handlers.result_handler.AirtimeHandler:5ac9cd8e4a9e4d0fa2e02fe0afe794b9
DEBUG:handlers.result_handler.AirtimeHandler:R170328.1402.130044
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'28/03/17 14:02:45', 'amount': '20', 'external_ref': u'R170328.1402.130044', 'msisdn_2': u'254702935200', 'internal_ref': '3T2XSAO083'}
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-28 14:02:58,831 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-28 14:02:58,832 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 14:02:45</ns0:DATE><ns0:EXTREFNUM>5ac9cd8e4a9e4d0fa2e02fe0afe794b9</ns0:EXTREFNUM><ns0:TXNID>R170328.1402.130044</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 702935200 is successful. Your new balance is KSH 885</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 14:02:58,832 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-28 14:02:58,833 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------20-----------------------
2017-03-28 14:02:58,833 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-28 14:02:58,833 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 14:02:45
2017-03-28 14:02:58,834 = handlers.result_handler.AirtimeHandler - DEBUG - 5ac9cd8e4a9e4d0fa2e02fe0afe794b9
2017-03-28 14:02:58,834 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1402.130044
2017-03-28 14:02:58,834 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 14:02:45', 'amount': '20', 'external_ref': u'R170328.1402.130044', 'msisdn_2': u'254702935200', 'internal_ref': '3T2XSAO083'}
2017-03-28 14:02:58,834 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-28 14:02:58,875 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-28 14:02:58,875 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-28 14:02:58,880 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 14:02:58,880 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-28 14:02:58,885 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-28 14:02:58,888 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 14:02:58,894 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 14:02:58,895 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-28 14:02:58,902 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-28 14:02:58,902 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-28 14:02:58,906 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-28 14:02:58,906 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 14:02:58,909 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-28 14:02:58,909 INFO sqlalchemy.engine.base.Engine {'table': 23559}
2017-03-28 14:02:58,911 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 14:02:58,911 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-28 14:02:58,916 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-28 14:02:58,917 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 14:02:58,919 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 14:02:58,919 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-28 14:02:58,926 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7f358e206750>
2017-03-28 14:02:58,926 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-28 14:02:58,927 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-28 14:02:58,927 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-28 14:02:58,927 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 3T2XSAO083
2017-03-28 14:02:58,927 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 3T2XSAO083
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 3T2XSAO083
2017-03-28 14:02:58,927 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 3T2XSAO083 to 254702935200
2017-03-28 14:02:58,927 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 3T2XSAO083 to 254702935200
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 3T2XSAO083 to 254702935200
2017-03-28 14:02:58,928 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-28 14:02:58,928 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-28 14:02:58,928 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 3T2XSAO083 to 8
2017-03-28 14:02:58,928 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 3T2XSAO083 to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 3T2XSAO083 to 8
2017-03-28 14:02:58,929 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 3T2XSAO083", "user": "8", "title": "Safaricom  Airtime"}
2017-03-28 14:02:58,929 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 3T2XSAO083", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 3T2XSAO083", "user": "8", "title": "Safaricom  Airtime"}
2017-03-28 14:02:58,929 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-28 14:02:58,929 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-28 14:02:58,929 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 3T2XSAO083
2017-03-28 14:02:58,929 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 3T2XSAO083
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 3T2XSAO083
2017-03-28 14:02:58,977 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":149,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 3T2XSAO083","image_url":"","date":"2017-03-28T14:02:45.597571Z"}
2017-03-28 14:02:58,977 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":149,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 3T2XSAO083","image_url":"","date":"2017-03-28T14:02:45.597571Z"}
2017-03-28 14:02:58,978 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-28 14:02:58,978 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":149,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 3T2XSAO083","image_url":"","date":"2017-03-28T14:02:45.597571Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":149,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 3T2XSAO083","image_url":"","date":"2017-03-28T14:02:45.597571Z"}
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-28 14:02:58,978 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-28 14:02:58,978 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":149,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 3T2XSAO083","image_url":"","date":"2017-03-28T14:02:45.597571Z"}
2017-03-28 14:02:58,978 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:{"id":149,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is 3T2XSAO083","image_url":"","date":"2017-03-28T14:02:45.597571Z"}
2017-03-28 14:02:58,978 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-28 14:02:58,979 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-28 14:02:58,979 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-28 14:02:58,979 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-28 14:02:58,979 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-28 14:02:58,979 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-28 14:02:58,979 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-28 14:02:58,979 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-28 14:02:58,979 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
2017-03-28 14:02:58,979 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
2017-03-28 14:02:58,979 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-28 14:02:59,029 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 14:02:59,029 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":116,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 14:02:59,029 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 14:02:59,029 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:{"id":116,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 14:02:59,029 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":116,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 14:02:59,029 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 14:02:59,030 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": null}
2017-03-28 14:02:59,030 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
2017-03-28 14:02:59,030 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
2017-03-28 14:02:59,030 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 14:02:59,034 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
2017-03-28 14:02:59,034 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
DEBUG:handlers.result_handler.AirtimeHandler:Updating speadsheet......
/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
  InsecurePlatformWarning
2017-03-28 14:03:00,615 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-28 14:03:00,616 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2511.77ms
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 2511.77ms
2017-03-28 14:03:00,615 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-28 14:03:00,616 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 2511.77ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-28 14:03:13,338 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-28 14:03:13,339 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 14:03:13,339 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 14:03:13
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/2000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-28 14:03:13,340 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 14:03:13,338 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-28 14:03:13,339 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 14:03:13,339 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 14:03:13
2017-03-28 14:03:13,340 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 28/03/2017 14:03:13
2017-03-28 14:03:13,341 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-28 14:03:13,341 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 14:03:13,342 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 27e2fad1dd494ac18c3846507b61661a
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-28 14:03:13,342 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = 27e2fad1dd494ac18c3846507b61661a
2017-03-28 14:03:13,342 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = 27e2fad1dd494ac18c3846507b61661a
2017-03-28 14:03:13,342 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 14:03:13,343 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 20, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-28 14:03:13,343 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 20, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 20, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 14:03:13,348 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-28 14:03:13,348 = handlers.result_handler.AirtimeHandler - DEBUG - None
DEBUG:handlers.result_handler.AirtimeHandler:None
2017-03-28 14:03:13,349 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 14:03:13,349 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-28 14:03:13,350 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:03:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>27e2fad1dd494ac18c3846507b61661a</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:03:13,350 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:03:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>27e2fad1dd494ac18c3846507b61661a</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:03:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>27e2fad1dd494ac18c3846507b61661a</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:03:13,351 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 14:03:13,351 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-28 14:03:13,352 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 14:03:13,352 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-28 14:03:13,352 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:03:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>27e2fad1dd494ac18c3846507b61661a</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:03:13,352 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:03:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>27e2fad1dd494ac18c3846507b61661a</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:03:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>27e2fad1dd494ac18c3846507b61661a</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:03:13,353 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-28 14:03:13,353 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-28 14:03:13,883 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-28 14:03:13,883 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-28 14:03:13,884 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>28/03/17 14:03:00</ns0:DATE><ns0:EXTREFNUM>27e2fad1dd494ac18c3846507b61661a</ns0:EXTREFNUM><ns0:TXNID>R170328.1403.130002</ns0:TXNID><ns0:MESSAGE>The mobile number 702935200 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 14:03:13,884 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>28/03/17 14:03:00</ns0:DATE><ns0:EXTREFNUM>27e2fad1dd494ac18c3846507b61661a</ns0:EXTREFNUM><ns0:TXNID>R170328.1403.130002</ns0:TXNID><ns0:MESSAGE>The mobile number 702935200 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>2050</ns0:TXNSTATUS><ns0:DATE>28/03/17 14:03:00</ns0:DATE><ns0:EXTREFNUM>27e2fad1dd494ac18c3846507b61661a</ns0:EXTREFNUM><ns0:TXNID>R170328.1403.130002</ns0:TXNID><ns0:MESSAGE>The mobile number 702935200 cannot use this service within 5.00 minutes of last successful transaction.</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 14:03:13,885 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-28 14:03:13,885 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-28 14:03:13,886 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-28 14:03:13,886 = handlers.result_handler.AirtimeHandler - DEBUG - {'status': 1, 'message': 'could not complete you request at this time please try again later'}
DEBUG:handlers.result_handler.AirtimeHandler:{'status': 1, 'message': 'could not complete you request at this time please try again later'}
2017-03-28 14:03:13,887 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^20
2017-03-28 14:03:13,887 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^^20
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^^20
2017-03-28 14:03:13,889 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
2017-03-28 14:03:13,889 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
2017-03-28 14:03:13,890 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-28 14:03:13,890 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-28 14:03:13,891 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba to 7
2017-03-28 14:03:13,891 = handlers.result_handler.AirtimeHandler - DEBUG - sending message Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba to 7
DEBUG:handlers.result_handler.AirtimeHandler:sending message Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba to 7
2017-03-28 14:03:13,893 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
2017-03-28 14:03:13,893 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba", "user": "7", "title": "Safaricom  Airtime"}
2017-03-28 14:03:13,894 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-28 14:03:13,894 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-28 14:03:13,895 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
2017-03-28 14:03:13,895 = handlers.result_handler.AirtimeHandler - DEBUG - Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
DEBUG:handlers.result_handler.AirtimeHandler:Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba
2017-03-28 14:03:13,947 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":150,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-28T14:03:00.568053Z"}
2017-03-28 14:03:13,947 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":150,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-28T14:03:00.568053Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":150,"user":7,"title":"Safaricom  Airtime","text":"Your purchase of Safaricom Airtime KES 20 has failed. Your account has been refunded with KES 20 Saiba Credits which can be used to transact on Saiba","image_url":"","date":"2017-03-28T14:03:00.568053Z"}
2017-03-28 14:03:13,949 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
2017-03-28 14:03:13,949 = handlers.result_handler.AirtimeHandler - DEBUG - ------------------------------------------------------ADDING CREDDITS------------------------
DEBUG:handlers.result_handler.AirtimeHandler:------------------------------------------------------ADDING CREDDITS------------------------
2017-03-28 14:03:13,950 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-28 14:03:13,950 = handlers.result_handler.AirtimeHandler - DEBUG - https://wallet.api.saiba.co.ke/v1/payment/user_credit/
DEBUG:handlers.result_handler.AirtimeHandler:https://wallet.api.saiba.co.ke/v1/payment/user_credit/
2017-03-28 14:03:13,951 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-28 14:03:13,951 = handlers.result_handler.AirtimeHandler - DEBUG - {'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
DEBUG:handlers.result_handler.AirtimeHandler:{'Content-Type': 'application/json', 'Authorization': 'Token 9993a236a2728d3a9a89f361a078f27384737db2'}
2017-03-28 14:03:13,952 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "20", "user": 7, "user_credit_type": 1, "debit": "0"}
2017-03-28 14:03:13,952 = handlers.result_handler.AirtimeHandler - DEBUG - {"credit": "20", "user": 7, "user_credit_type": 1, "debit": "0"}
DEBUG:handlers.result_handler.AirtimeHandler:{"credit": "20", "user": 7, "user_credit_type": 1, "debit": "0"}
2017-03-28 14:03:14,004 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 14:03:14,004 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 14:03:14,005 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":7,"user_credit_type":1,"debit":0.0,"credit":20.0,"balance":766.0}
2017-03-28 14:03:14,005 = handlers.result_handler.AirtimeHandler - DEBUG - {"user":7,"user_credit_type":1,"debit":0.0,"credit":20.0,"balance":766.0}
DEBUG:handlers.result_handler.AirtimeHandler:{"user":7,"user_credit_type":1,"debit":0.0,"credit":20.0,"balance":766.0}
{"user":7,"user_credit_type":1,"debit":0.0,"credit":20.0,"balance":766.0}
2017-03-28 14:03:14,006 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 14:03:14,006 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 14:03:14,007 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-28 14:03:14,007 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-28 14:03:14,008 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-28 14:03:14,008 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-28 14:03:14,008 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-28 14:03:14,008 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-28 14:03:14,009 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
2017-03-28 14:03:14,009 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 2, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
2017-03-28 14:03:14,010 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-28 14:03:14,010 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-28 14:03:14,069 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 14:03:14,069 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 14:03:14,070 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":117,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 14:03:14,070 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":117,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":117,"user":7,"receipt_number":"null","transaction_status":2,"destination_mobile_number":"702935200","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 14:03:14,073 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 14:03:14,073 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 14:03:14,074 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
2017-03-28 14:03:14,074 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": null}
2017-03-28 14:03:14,076 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 14:03:14,076 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-28 14:03:14,084 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-28 14:03:14,084 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-28 14:03:14,086 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 748.60ms
2017-03-28 14:03:14,086 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 748.60ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 748.60ms
2017-03-28 14:07:13,497 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-28 14:07:13,498 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 14:07:13,499 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 14:07:13
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/2000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-28 14:07:13,497 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-28 14:07:13,498 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 14:07:13,499 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 14:07:13
2017-03-28 14:07:13,499 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 28/03/2017 14:07:13
2017-03-28 14:07:13,499 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 14:07:13,500 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-28 14:07:13,500 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 14:07:13,501 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = a6253d214b2b485cbc11e345cd571c49
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-28 14:07:13,501 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = a6253d214b2b485cbc11e345cd571c49
2017-03-28 14:07:13,502 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = a6253d214b2b485cbc11e345cd571c49
2017-03-28 14:07:13,502 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 14:07:13,503 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 20, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254720384396', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-28 14:07:13,503 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 20, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254720384396', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 14:07:13,504 = handlers.result_handler.AirtimeHandler - DEBUG - None
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 20, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254720384396', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 14:07:13,504 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-28 14:07:13,505 = handlers.result_handler.AirtimeHandler - INFO - Building XML
DEBUG:handlers.result_handler.AirtimeHandler:None
2017-03-28 14:07:13,505 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 14:07:13,505 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:07:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a6253d214b2b485cbc11e345cd571c49</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-28 14:07:13,505 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:07:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a6253d214b2b485cbc11e345cd571c49</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:07:13,506 = handlers.result_handler.AirtimeHandler - INFO - Built XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:07:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a6253d214b2b485cbc11e345cd571c49</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:07:13,506 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 14:07:13,507 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-28 14:07:13,507 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 14:07:13,508 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:07:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a6253d214b2b485cbc11e345cd571c49</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-28 14:07:13,508 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:07:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a6253d214b2b485cbc11e345cd571c49</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:07:13,509 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:07:13</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>a6253d214b2b485cbc11e345cd571c49</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:07:13,509 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-28 14:07:14,134 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-28 14:07:14,134 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-28 14:07:14,137 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 14:07:00</ns0:DATE><ns0:EXTREFNUM>a6253d214b2b485cbc11e345cd571c49</ns0:EXTREFNUM><ns0:TXNID>R170328.1407.130001</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 720384396 is successful. Your new balance is KSH 865</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 14:07:14,137 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 14:07:00</ns0:DATE><ns0:EXTREFNUM>a6253d214b2b485cbc11e345cd571c49</ns0:EXTREFNUM><ns0:TXNID>R170328.1407.130001</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 720384396 is successful. Your new balance is KSH 865</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 14:07:00</ns0:DATE><ns0:EXTREFNUM>a6253d214b2b485cbc11e345cd571c49</ns0:EXTREFNUM><ns0:TXNID>R170328.1407.130001</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 720384396 is successful. Your new balance is KSH 865</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 14:07:14,138 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-28 14:07:14,138 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-28 14:07:14,139 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------20-----------------------
2017-03-28 14:07:14,139 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------20-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------20-----------------------
2017-03-28 14:07:14,140 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-28 14:07:14,140 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-28 14:07:14,140 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 14:07:00
2017-03-28 14:07:14,140 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 14:07:00
DEBUG:handlers.result_handler.AirtimeHandler:28/03/17 14:07:00
2017-03-28 14:07:14,141 = handlers.result_handler.AirtimeHandler - DEBUG - a6253d214b2b485cbc11e345cd571c49
2017-03-28 14:07:14,141 = handlers.result_handler.AirtimeHandler - DEBUG - a6253d214b2b485cbc11e345cd571c49
DEBUG:handlers.result_handler.AirtimeHandler:a6253d214b2b485cbc11e345cd571c49
2017-03-28 14:07:14,141 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1407.130001
2017-03-28 14:07:14,141 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1407.130001
DEBUG:handlers.result_handler.AirtimeHandler:R170328.1407.130001
2017-03-28 14:07:14,142 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 14:07:00', 'amount': '20', 'external_ref': u'R170328.1407.130001', 'msisdn_2': u'254720384396', 'internal_ref': 'G3WH3WFFJU'}
2017-03-28 14:07:14,142 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 14:07:00', 'amount': '20', 'external_ref': u'R170328.1407.130001', 'msisdn_2': u'254720384396', 'internal_ref': 'G3WH3WFFJU'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'28/03/17 14:07:00', 'amount': '20', 'external_ref': u'R170328.1407.130001', 'msisdn_2': u'254720384396', 'internal_ref': 'G3WH3WFFJU'}
2017-03-28 14:07:14,143 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-28 14:07:14,143 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-28 14:07:14,196 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-28 14:07:14,197 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-28 14:07:14,201 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-28 14:07:14,202 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 14:07:14,207 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-28 14:07:14,208 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 14:07:14,211 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-28 14:07:14,213 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 14:07:14,223 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-28 14:07:14,225 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 14:07:14,228 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-28 14:07:14,229 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 14:07:14,232 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-28 14:07:14,233 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-28 14:07:14,236 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-28 14:07:14,237 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 14:07:14,242 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-28 14:07:14,243 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 14:07:14,245 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-28 14:07:14,246 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f358e3f4790>
2017-03-28 14:07:14,254 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-28 14:07:14,254 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-28 14:07:14,255 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-28 14:07:14,255 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-28 14:07:14,256 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 20  Safaricom Airtime. Your transaction number is G3WH3WFFJU
2017-03-28 14:07:14,256 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 20  Safaricom Airtime. Your transaction number is G3WH3WFFJU
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 20  Safaricom Airtime. Your transaction number is G3WH3WFFJU
2017-03-28 14:07:14,257 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 20  Safaricom Airtime. Your transaction number is G3WH3WFFJU to 254720384396
2017-03-28 14:07:14,257 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 20  Safaricom Airtime. Your transaction number is G3WH3WFFJU to 254720384396
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 20  Safaricom Airtime. Your transaction number is G3WH3WFFJU to 254720384396
2017-03-28 14:07:14,257 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-28 14:07:14,257 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-28 14:07:14,259 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 20  Safaricom Airtime. Your transaction number is G3WH3WFFJU to 7
2017-03-28 14:07:14,259 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 20  Safaricom Airtime. Your transaction number is G3WH3WFFJU to 7
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 20  Safaricom Airtime. Your transaction number is G3WH3WFFJU to 7
2017-03-28 14:07:14,260 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 20  Safaricom Airtime. Your transaction number is G3WH3WFFJU", "user": "7", "title": "Safaricom  Airtime"}
2017-03-28 14:07:14,260 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 20  Safaricom Airtime. Your transaction number is G3WH3WFFJU", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 20  Safaricom Airtime. Your transaction number is G3WH3WFFJU", "user": "7", "title": "Safaricom  Airtime"}
2017-03-28 14:07:14,261 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-28 14:07:14,261 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-28 14:07:14,262 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 20  Safaricom Airtime. Your transaction number is G3WH3WFFJU
2017-03-28 14:07:14,262 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 20  Safaricom Airtime. Your transaction number is G3WH3WFFJU
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 20  Safaricom Airtime. Your transaction number is G3WH3WFFJU
2017-03-28 14:07:15,309 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":151,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is G3WH3WFFJU","image_url":"","date":"2017-03-28T14:07:01.917752Z"}
2017-03-28 14:07:15,309 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":151,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is G3WH3WFFJU","image_url":"","date":"2017-03-28T14:07:01.917752Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":151,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is G3WH3WFFJU","image_url":"","date":"2017-03-28T14:07:01.917752Z"}
2017-03-28 14:07:15,311 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-28 14:07:15,311 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-28 14:07:15,313 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":151,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is G3WH3WFFJU","image_url":"","date":"2017-03-28T14:07:01.917752Z"}
2017-03-28 14:07:15,313 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":151,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is G3WH3WFFJU","image_url":"","date":"2017-03-28T14:07:01.917752Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":151,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is G3WH3WFFJU","image_url":"","date":"2017-03-28T14:07:01.917752Z"}
2017-03-28 14:07:15,314 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-28 14:07:15,314 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-28 14:07:15,315 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-28 14:07:15,315 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-28 14:07:15,316 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-28 14:07:15,316 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-28 14:07:15,316 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-28 14:07:15,316 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-28 14:07:15,317 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "720384396", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
2017-03-28 14:07:15,317 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "720384396", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "720384396", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
2017-03-28 14:07:15,318 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-28 14:07:15,318 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-28 14:07:15,387 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 14:07:15,387 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 14:07:15,388 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":118,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"720384396","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 14:07:15,388 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":118,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"720384396","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":118,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"720384396","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 14:07:15,389 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 14:07:15,389 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 14:07:15,390 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
2017-03-28 14:07:15,390 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": null}
2017-03-28 14:07:15,391 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 14:07:15,391 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 14:07:15,399 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
2017-03-28 14:07:15,399 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
DEBUG:handlers.result_handler.AirtimeHandler:Updating speadsheet......
/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
  InsecurePlatformWarning
2017-03-28 14:07:16,816 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-28 14:07:16,816 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-28 14:07:16,818 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3321.27ms
2017-03-28 14:07:16,818 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3321.27ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3321.27ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-28 14:17:56,850 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/25000/-------------------
2017-03-28 14:17:56,851 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 14:17:56,851 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 14:17:56
2017-03-28 14:17:56,852 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 14:17:56,852 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 14:17:56,853 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = f5146f5131e3488bb418c48c058b749b
2017-03-28 14:17:56,853 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 14:17:56,854 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 250, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254720384396', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 14:17:56,854 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-28 14:17:56,858 = handlers.result_handler.AirtimeHandler - INFO - Building XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/25000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 28/03/2017 14:17:56
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = f5146f5131e3488bb418c48c058b749b
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 250, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254720384396', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:None
2017-03-28 14:17:56,850 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/25000/-------------------
2017-03-28 14:17:56,851 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 14:17:56,851 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 14:17:56
2017-03-28 14:17:56,852 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 14:17:56,852 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 14:17:56,853 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = f5146f5131e3488bb418c48c058b749b
2017-03-28 14:17:56,853 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 14:17:56,854 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 250, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254720384396', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 14:17:56,854 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-28 14:17:56,858 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-28 14:17:56,860 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:17:56</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f5146f5131e3488bb418c48c058b749b</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>25000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:17:56,860 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:17:56</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f5146f5131e3488bb418c48c058b749b</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>25000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:17:56</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f5146f5131e3488bb418c48c058b749b</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>25000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:17:56,862 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 14:17:56,862 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-28 14:17:56,863 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 14:17:56,863 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-28 14:17:56,864 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:17:56</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f5146f5131e3488bb418c48c058b749b</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>25000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:17:56,864 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:17:56</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f5146f5131e3488bb418c48c058b749b</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>25000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 14:17:56</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>f5146f5131e3488bb418c48c058b749b</ns0:EXTREFNUM><ns0:MSISDN2>254720384396</ns0:MSISDN2><ns0:AMOUNT>25000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 14:17:56,865 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-28 14:17:56,865 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-28 14:17:57,514 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-28 14:17:57,514 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-28 14:17:57,516 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 14:17:44</ns0:DATE><ns0:EXTREFNUM>f5146f5131e3488bb418c48c058b749b</ns0:EXTREFNUM><ns0:TXNID>R170328.1417.130047</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 250 to 720384396 is successful. Your new balance is KSH 615</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 14:17:57,516 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 14:17:44</ns0:DATE><ns0:EXTREFNUM>f5146f5131e3488bb418c48c058b749b</ns0:EXTREFNUM><ns0:TXNID>R170328.1417.130047</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 250 to 720384396 is successful. Your new balance is KSH 615</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 14:17:44</ns0:DATE><ns0:EXTREFNUM>f5146f5131e3488bb418c48c058b749b</ns0:EXTREFNUM><ns0:TXNID>R170328.1417.130047</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 250 to 720384396 is successful. Your new balance is KSH 615</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 14:17:57,517 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-28 14:17:57,517 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-28 14:17:57,517 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------250-----------------------
2017-03-28 14:17:57,517 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------250-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------250-----------------------
2017-03-28 14:17:57,518 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-28 14:17:57,518 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-28 14:17:57,519 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 14:17:44
2017-03-28 14:17:57,519 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 14:17:44
DEBUG:handlers.result_handler.AirtimeHandler:28/03/17 14:17:44
2017-03-28 14:17:57,519 = handlers.result_handler.AirtimeHandler - DEBUG - f5146f5131e3488bb418c48c058b749b
2017-03-28 14:17:57,519 = handlers.result_handler.AirtimeHandler - DEBUG - f5146f5131e3488bb418c48c058b749b
DEBUG:handlers.result_handler.AirtimeHandler:f5146f5131e3488bb418c48c058b749b
2017-03-28 14:17:57,520 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1417.130047
2017-03-28 14:17:57,520 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1417.130047
DEBUG:handlers.result_handler.AirtimeHandler:R170328.1417.130047
2017-03-28 14:17:57,521 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 14:17:44', 'amount': '250', 'external_ref': u'R170328.1417.130047', 'msisdn_2': u'254720384396', 'internal_ref': 'NL77MTY4QA'}
2017-03-28 14:17:57,521 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 14:17:44', 'amount': '250', 'external_ref': u'R170328.1417.130047', 'msisdn_2': u'254720384396', 'internal_ref': 'NL77MTY4QA'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'28/03/17 14:17:44', 'amount': '250', 'external_ref': u'R170328.1417.130047', 'msisdn_2': u'254720384396', 'internal_ref': 'NL77MTY4QA'}
2017-03-28 14:17:57,522 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-28 14:17:57,522 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-28 14:17:57,573 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-28 14:17:57,574 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-28 14:17:57,578 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-28 14:17:57,579 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 14:17:57,584 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-28 14:17:57,586 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 14:17:57,589 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-28 14:17:57,590 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 14:17:57,595 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-28 14:17:57,596 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 14:17:57,599 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-28 14:17:57,600 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 14:17:57,606 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-28 14:17:57,607 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-28 14:17:57,610 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-28 14:17:57,611 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 14:17:57,615 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-28 14:17:57,616 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 14:17:57,619 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-28 14:17:57,620 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f358e2842d0>
2017-03-28 14:17:57,628 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-28 14:17:57,628 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-28 14:17:57,629 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-28 14:17:57,629 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-28 14:17:57,630 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 250  Safaricom Airtime. Your transaction number is NL77MTY4QA
2017-03-28 14:17:57,630 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 250  Safaricom Airtime. Your transaction number is NL77MTY4QA
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 250  Safaricom Airtime. Your transaction number is NL77MTY4QA
2017-03-28 14:17:57,631 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 250  Safaricom Airtime. Your transaction number is NL77MTY4QA to 254720384396
2017-03-28 14:17:57,631 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 250  Safaricom Airtime. Your transaction number is NL77MTY4QA to 254720384396
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 250  Safaricom Airtime. Your transaction number is NL77MTY4QA to 254720384396
2017-03-28 14:17:57,631 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-28 14:17:57,631 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-28 14:17:57,632 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 250  Safaricom Airtime. Your transaction number is NL77MTY4QA to 7
2017-03-28 14:17:57,632 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 250  Safaricom Airtime. Your transaction number is NL77MTY4QA to 7
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 250  Safaricom Airtime. Your transaction number is NL77MTY4QA to 7
2017-03-28 14:17:57,633 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 250  Safaricom Airtime. Your transaction number is NL77MTY4QA", "user": "7", "title": "Safaricom  Airtime"}
2017-03-28 14:17:57,633 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 250  Safaricom Airtime. Your transaction number is NL77MTY4QA", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 250  Safaricom Airtime. Your transaction number is NL77MTY4QA", "user": "7", "title": "Safaricom  Airtime"}
2017-03-28 14:17:57,633 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-28 14:17:57,633 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-28 14:17:57,634 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 250  Safaricom Airtime. Your transaction number is NL77MTY4QA
2017-03-28 14:17:57,634 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 250  Safaricom Airtime. Your transaction number is NL77MTY4QA
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 250  Safaricom Airtime. Your transaction number is NL77MTY4QA
2017-03-28 14:17:58,948 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":152,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 250  Safaricom Airtime. Your transaction number is NL77MTY4QA","image_url":"","date":"2017-03-28T14:17:45.541230Z"}
2017-03-28 14:17:58,948 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":152,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 250  Safaricom Airtime. Your transaction number is NL77MTY4QA","image_url":"","date":"2017-03-28T14:17:45.541230Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":152,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 250  Safaricom Airtime. Your transaction number is NL77MTY4QA","image_url":"","date":"2017-03-28T14:17:45.541230Z"}
2017-03-28 14:17:58,950 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-28 14:17:58,950 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-28 14:17:58,951 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":152,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 250  Safaricom Airtime. Your transaction number is NL77MTY4QA","image_url":"","date":"2017-03-28T14:17:45.541230Z"}
2017-03-28 14:17:58,951 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":152,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 250  Safaricom Airtime. Your transaction number is NL77MTY4QA","image_url":"","date":"2017-03-28T14:17:45.541230Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":152,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 250  Safaricom Airtime. Your transaction number is NL77MTY4QA","image_url":"","date":"2017-03-28T14:17:45.541230Z"}
2017-03-28 14:17:58,952 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-28 14:17:58,952 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-28 14:17:58,953 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-28 14:17:58,953 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-28 14:17:58,954 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-28 14:17:58,954 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-28 14:17:58,955 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-28 14:17:58,955 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-28 14:17:58,956 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "720384396", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "250", "service_provider_id": 1}
2017-03-28 14:17:58,956 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "720384396", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "250", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "720384396", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "250", "service_provider_id": 1}
2017-03-28 14:17:58,957 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-28 14:17:58,957 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-28 14:18:00,156 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 14:18:00,156 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 14:18:00,158 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":119,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"720384396","request":null,"amount":250.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 14:18:00,158 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":119,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"720384396","request":null,"amount":250.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":119,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"720384396","request":null,"amount":250.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 14:18:00,158 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 14:18:00,158 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 14:18:00,159 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
2017-03-28 14:18:00,159 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": null}
2017-03-28 14:18:00,160 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 14:18:00,160 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 14:18:00,167 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
2017-03-28 14:18:00,167 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
DEBUG:handlers.result_handler.AirtimeHandler:Updating speadsheet......
/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
  InsecurePlatformWarning
2017-03-28 14:18:02,038 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-28 14:18:02,038 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-28 14:18:02,040 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 5191.32ms
2017-03-28 14:18:02,040 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 5191.32ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 5191.32ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-28 14:41:20,902 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.67ms
2017-03-28 14:41:20,902 = tornado.access - WARNING - 405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.67ms
WARNING:tornado.access:405 CONNECT lqak.euw1.lol.riotgames.com:443 (195.154.226.17) 0.67ms
2017-03-28 15:18:24,358 = tornado.access - WARNING - 404 GET /manager/html (123.249.79.179) 0.55ms
2017-03-28 15:18:24,358 = tornado.access - WARNING - 404 GET /manager/html (123.249.79.179) 0.55ms
WARNING:tornado.access:404 GET /manager/html (123.249.79.179) 0.55ms
2017-03-28 16:56:04,355 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-28 16:56:04,355 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/2000/-------------------
2017-03-28 16:56:04,355 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 16:56:04,355 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-28 16:56:04,355 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 16:56:04
2017-03-28 16:56:04,355 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 16:56:04
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 28/03/2017 16:56:04
2017-03-28 16:56:04,356 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 16:56:04,356 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-28 16:56:04,356 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 16:56:04,356 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-28 16:56:04,356 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = e1c5f255d9c54c33ab04ad318f44ff86
2017-03-28 16:56:04,356 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = e1c5f255d9c54c33ab04ad318f44ff86
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = e1c5f255d9c54c33ab04ad318f44ff86
2017-03-28 16:56:04,356 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 16:56:04,356 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-28 16:56:04,357 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': 12, u'note': None, u'mobile_money_transaction_number': None, u'amount': 20, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254721799582', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 16:56:04,357 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': 12, u'note': None, u'mobile_money_transaction_number': None, u'amount': 20, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254721799582', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': 12, u'note': None, u'mobile_money_transaction_number': None, u'amount': 20, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254721799582', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 16:56:04,357 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-28 16:56:04,357 = handlers.result_handler.AirtimeHandler - DEBUG - None
DEBUG:handlers.result_handler.AirtimeHandler:None
2017-03-28 16:56:04,357 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 16:56:04,357 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-28 16:56:04,357 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 16:56:04</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e1c5f255d9c54c33ab04ad318f44ff86</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 16:56:04,357 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 16:56:04</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e1c5f255d9c54c33ab04ad318f44ff86</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 16:56:04</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e1c5f255d9c54c33ab04ad318f44ff86</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 16:56:04,358 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 16:56:04,358 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-28 16:56:04,358 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 16:56:04,358 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-28 16:56:04,358 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 16:56:04</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e1c5f255d9c54c33ab04ad318f44ff86</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 16:56:04,358 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 16:56:04</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e1c5f255d9c54c33ab04ad318f44ff86</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 16:56:04</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>e1c5f255d9c54c33ab04ad318f44ff86</ns0:EXTREFNUM><ns0:MSISDN2>254721799582</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 16:56:04,358 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-28 16:56:04,358 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-28 16:56:04,944 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-28 16:56:04,944 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-28 16:56:04,945 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 16:55:51</ns0:DATE><ns0:EXTREFNUM>e1c5f255d9c54c33ab04ad318f44ff86</ns0:EXTREFNUM><ns0:TXNID>R170328.1655.130056</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 721799582 is successful. Your new balance is KSH 595</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 16:56:04,945 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 16:55:51</ns0:DATE><ns0:EXTREFNUM>e1c5f255d9c54c33ab04ad318f44ff86</ns0:EXTREFNUM><ns0:TXNID>R170328.1655.130056</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 721799582 is successful. Your new balance is KSH 595</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 16:55:51</ns0:DATE><ns0:EXTREFNUM>e1c5f255d9c54c33ab04ad318f44ff86</ns0:EXTREFNUM><ns0:TXNID>R170328.1655.130056</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 721799582 is successful. Your new balance is KSH 595</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 16:56:04,946 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-28 16:56:04,946 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-28 16:56:04,947 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------20-----------------------
2017-03-28 16:56:04,947 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------20-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------20-----------------------
2017-03-28 16:56:04,948 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-28 16:56:04,948 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-28 16:56:04,948 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 16:55:51
2017-03-28 16:56:04,948 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 16:55:51
DEBUG:handlers.result_handler.AirtimeHandler:28/03/17 16:55:51
2017-03-28 16:56:04,949 = handlers.result_handler.AirtimeHandler - DEBUG - e1c5f255d9c54c33ab04ad318f44ff86
2017-03-28 16:56:04,949 = handlers.result_handler.AirtimeHandler - DEBUG - e1c5f255d9c54c33ab04ad318f44ff86
DEBUG:handlers.result_handler.AirtimeHandler:e1c5f255d9c54c33ab04ad318f44ff86
2017-03-28 16:56:04,949 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1655.130056
2017-03-28 16:56:04,949 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1655.130056
DEBUG:handlers.result_handler.AirtimeHandler:R170328.1655.130056
2017-03-28 16:56:04,950 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 16:55:51', 'amount': '20', 'external_ref': u'R170328.1655.130056', 'msisdn_2': u'254721799582', 'internal_ref': 'MPPLJHJXV8'}
2017-03-28 16:56:04,950 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 16:55:51', 'amount': '20', 'external_ref': u'R170328.1655.130056', 'msisdn_2': u'254721799582', 'internal_ref': 'MPPLJHJXV8'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'28/03/17 16:55:51', 'amount': '20', 'external_ref': u'R170328.1655.130056', 'msisdn_2': u'254721799582', 'internal_ref': 'MPPLJHJXV8'}
2017-03-28 16:56:04,950 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-28 16:56:04,950 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-28 16:56:04,989 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-28 16:56:04,990 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-28 16:56:04,993 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-28 16:56:04,993 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 16:56:04,996 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-28 16:56:04,997 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 16:56:04,999 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-28 16:56:05,000 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 16:56:05,004 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-28 16:56:05,005 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 16:56:05,007 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-28 16:56:05,007 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 16:56:05,010 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-28 16:56:05,010 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-28 16:56:05,012 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-28 16:56:05,013 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 16:56:05,016 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-28 16:56:05,017 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 16:56:05,019 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-28 16:56:05,019 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f358a06bf10>
2017-03-28 16:56:05,025 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-28 16:56:05,025 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-28 16:56:05,026 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-28 16:56:05,026 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-28 16:56:05,026 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 20  Safaricom Airtime. Your transaction number is MPPLJHJXV8
2017-03-28 16:56:05,026 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 20  Safaricom Airtime. Your transaction number is MPPLJHJXV8
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 20  Safaricom Airtime. Your transaction number is MPPLJHJXV8
2017-03-28 16:56:05,027 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 20  Safaricom Airtime. Your transaction number is MPPLJHJXV8 to 254721799582
2017-03-28 16:56:05,027 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 20  Safaricom Airtime. Your transaction number is MPPLJHJXV8 to 254721799582
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 20  Safaricom Airtime. Your transaction number is MPPLJHJXV8 to 254721799582
2017-03-28 16:56:05,027 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-28 16:56:05,027 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-28 16:56:05,027 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 20  Safaricom Airtime. Your transaction number is MPPLJHJXV8 to 7
2017-03-28 16:56:05,027 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 20  Safaricom Airtime. Your transaction number is MPPLJHJXV8 to 7
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 20  Safaricom Airtime. Your transaction number is MPPLJHJXV8 to 7
2017-03-28 16:56:05,028 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 20  Safaricom Airtime. Your transaction number is MPPLJHJXV8", "user": "7", "title": "Safaricom  Airtime"}
2017-03-28 16:56:05,028 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 20  Safaricom Airtime. Your transaction number is MPPLJHJXV8", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 20  Safaricom Airtime. Your transaction number is MPPLJHJXV8", "user": "7", "title": "Safaricom  Airtime"}
2017-03-28 16:56:05,029 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-28 16:56:05,029 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-28 16:56:05,029 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 20  Safaricom Airtime. Your transaction number is MPPLJHJXV8
2017-03-28 16:56:05,029 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 20  Safaricom Airtime. Your transaction number is MPPLJHJXV8
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 20  Safaricom Airtime. Your transaction number is MPPLJHJXV8
2017-03-28 16:56:06,379 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":153,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is MPPLJHJXV8","image_url":"","date":"2017-03-28T16:55:52.679718Z"}
2017-03-28 16:56:06,379 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":153,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is MPPLJHJXV8","image_url":"","date":"2017-03-28T16:55:52.679718Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":153,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is MPPLJHJXV8","image_url":"","date":"2017-03-28T16:55:52.679718Z"}
2017-03-28 16:56:06,381 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-28 16:56:06,381 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-28 16:56:06,381 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":153,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is MPPLJHJXV8","image_url":"","date":"2017-03-28T16:55:52.679718Z"}
2017-03-28 16:56:06,381 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":153,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is MPPLJHJXV8","image_url":"","date":"2017-03-28T16:55:52.679718Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":153,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is MPPLJHJXV8","image_url":"","date":"2017-03-28T16:55:52.679718Z"}
2017-03-28 16:56:06,382 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-28 16:56:06,382 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-28 16:56:06,383 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-28 16:56:06,383 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-28 16:56:06,383 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-28 16:56:06,383 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-28 16:56:06,384 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-28 16:56:06,384 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-28 16:56:06,385 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
2017-03-28 16:56:06,385 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "721799582", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "721799582", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
2017-03-28 16:56:06,386 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-28 16:56:06,386 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-28 16:56:07,524 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 16:56:07,524 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 16:56:07,525 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":127,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 16:56:07,525 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":127,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":127,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"721799582","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 16:56:07,526 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 16:56:07,526 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 16:56:07,526 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
2017-03-28 16:56:07,526 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": null}
2017-03-28 16:56:07,527 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 16:56:07,527 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 16:56:07,533 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
2017-03-28 16:56:07,533 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
DEBUG:handlers.result_handler.AirtimeHandler:Updating speadsheet......
/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
  InsecurePlatformWarning
2017-03-28 16:56:09,087 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-28 16:56:09,087 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-28 16:56:09,089 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4734.76ms
2017-03-28 16:56:09,089 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4734.76ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 4734.76ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-28 16:58:09,210 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-28 16:58:09,211 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 16:58:09,211 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 16:58:09
2017-03-28 16:58:09,211 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 16:58:09,212 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 16:58:09,212 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = b4167e527f064f20ac841f88da3f09f8
2017-03-28 16:58:09,212 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 16:58:09,212 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': 13, u'note': None, u'mobile_money_transaction_number': None, u'amount': 20, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 16:58:09,213 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-28 16:58:09,213 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 16:58:09,213 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 16:58:09</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>b4167e527f064f20ac841f88da3f09f8</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 16:58:09,213 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 16:58:09,214 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 16:58:09,214 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 16:58:09</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>b4167e527f064f20ac841f88da3f09f8</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 16:58:09,214 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/2000/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 28/03/2017 16:58:09
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = b4167e527f064f20ac841f88da3f09f8
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': 13, u'note': None, u'mobile_money_transaction_number': None, u'amount': 20, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:None
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 16:58:09</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>b4167e527f064f20ac841f88da3f09f8</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 16:58:09</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>b4167e527f064f20ac841f88da3f09f8</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-28 16:58:09,210 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/2000/-------------------
2017-03-28 16:58:09,211 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 16:58:09,211 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 16:58:09
2017-03-28 16:58:09,211 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 16:58:09,212 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 16:58:09,212 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = b4167e527f064f20ac841f88da3f09f8
2017-03-28 16:58:09,212 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 16:58:09,212 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': 13, u'note': None, u'mobile_money_transaction_number': None, u'amount': 20, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-28 16:58:09,213 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-28 16:58:09,213 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 16:58:09,213 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 16:58:09</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>b4167e527f064f20ac841f88da3f09f8</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 16:58:09,213 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 16:58:09,214 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 16:58:09,214 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 16:58:09</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>b4167e527f064f20ac841f88da3f09f8</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>2000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 16:58:09,214 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-28 16:58:09,883 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-28 16:58:09,883 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-28 16:58:09,884 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 16:57:56</ns0:DATE><ns0:EXTREFNUM>b4167e527f064f20ac841f88da3f09f8</ns0:EXTREFNUM><ns0:TXNID>R170328.1657.130071</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 702935200 is successful. Your new balance is KSH 575</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 16:58:09,884 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 16:57:56</ns0:DATE><ns0:EXTREFNUM>b4167e527f064f20ac841f88da3f09f8</ns0:EXTREFNUM><ns0:TXNID>R170328.1657.130071</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 702935200 is successful. Your new balance is KSH 575</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 16:57:56</ns0:DATE><ns0:EXTREFNUM>b4167e527f064f20ac841f88da3f09f8</ns0:EXTREFNUM><ns0:TXNID>R170328.1657.130071</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 20 to 702935200 is successful. Your new balance is KSH 575</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 16:58:09,885 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-28 16:58:09,885 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-28 16:58:09,886 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------20-----------------------
2017-03-28 16:58:09,886 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------20-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------20-----------------------
2017-03-28 16:58:09,886 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-28 16:58:09,886 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-28 16:58:09,887 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 16:57:56
2017-03-28 16:58:09,887 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 16:57:56
DEBUG:handlers.result_handler.AirtimeHandler:28/03/17 16:57:56
2017-03-28 16:58:09,888 = handlers.result_handler.AirtimeHandler - DEBUG - b4167e527f064f20ac841f88da3f09f8
2017-03-28 16:58:09,888 = handlers.result_handler.AirtimeHandler - DEBUG - b4167e527f064f20ac841f88da3f09f8
DEBUG:handlers.result_handler.AirtimeHandler:b4167e527f064f20ac841f88da3f09f8
2017-03-28 16:58:09,889 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1657.130071
2017-03-28 16:58:09,889 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1657.130071
DEBUG:handlers.result_handler.AirtimeHandler:R170328.1657.130071
2017-03-28 16:58:09,889 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 16:57:56', 'amount': '20', 'external_ref': u'R170328.1657.130071', 'msisdn_2': u'254702935200', 'internal_ref': 'Q5RH4ZDYNJ'}
2017-03-28 16:58:09,889 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 16:57:56', 'amount': '20', 'external_ref': u'R170328.1657.130071', 'msisdn_2': u'254702935200', 'internal_ref': 'Q5RH4ZDYNJ'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'28/03/17 16:57:56', 'amount': '20', 'external_ref': u'R170328.1657.130071', 'msisdn_2': u'254702935200', 'internal_ref': 'Q5RH4ZDYNJ'}
2017-03-28 16:58:09,890 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-28 16:58:09,890 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-28 16:58:09,935 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-28 16:58:09,936 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-28 16:58:09,940 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-28 16:58:09,941 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 16:58:09,945 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-28 16:58:09,945 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 16:58:09,948 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-28 16:58:09,948 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 16:58:09,951 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-28 16:58:09,952 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 16:58:09,955 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-28 16:58:09,956 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 16:58:09,958 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-28 16:58:09,959 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-28 16:58:09,961 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-28 16:58:09,962 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 16:58:09,967 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-28 16:58:09,968 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 16:58:09,971 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-28 16:58:09,971 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7f3589f16410>
2017-03-28 16:58:09,978 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-28 16:58:09,978 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-28 16:58:09,979 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-28 16:58:09,979 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-28 16:58:09,979 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 20  Safaricom Airtime. Your transaction number is Q5RH4ZDYNJ
2017-03-28 16:58:09,979 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 20  Safaricom Airtime. Your transaction number is Q5RH4ZDYNJ
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 20  Safaricom Airtime. Your transaction number is Q5RH4ZDYNJ
2017-03-28 16:58:09,980 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 20  Safaricom Airtime. Your transaction number is Q5RH4ZDYNJ to 254702935200
2017-03-28 16:58:09,980 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 20  Safaricom Airtime. Your transaction number is Q5RH4ZDYNJ to 254702935200
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 20  Safaricom Airtime. Your transaction number is Q5RH4ZDYNJ to 254702935200
2017-03-28 16:58:09,981 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-28 16:58:09,981 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-28 16:58:09,981 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 20  Safaricom Airtime. Your transaction number is Q5RH4ZDYNJ to 8
2017-03-28 16:58:09,981 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 20  Safaricom Airtime. Your transaction number is Q5RH4ZDYNJ to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 20  Safaricom Airtime. Your transaction number is Q5RH4ZDYNJ to 8
2017-03-28 16:58:09,982 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 20  Safaricom Airtime. Your transaction number is Q5RH4ZDYNJ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-28 16:58:09,982 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 20  Safaricom Airtime. Your transaction number is Q5RH4ZDYNJ", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 20  Safaricom Airtime. Your transaction number is Q5RH4ZDYNJ", "user": "8", "title": "Safaricom  Airtime"}
2017-03-28 16:58:09,983 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-28 16:58:09,983 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-28 16:58:09,983 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 20  Safaricom Airtime. Your transaction number is Q5RH4ZDYNJ
2017-03-28 16:58:09,983 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 20  Safaricom Airtime. Your transaction number is Q5RH4ZDYNJ
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 20  Safaricom Airtime. Your transaction number is Q5RH4ZDYNJ
2017-03-28 16:58:10,029 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":154,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is Q5RH4ZDYNJ","image_url":"","date":"2017-03-28T16:57:56.325719Z"}
2017-03-28 16:58:10,029 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":154,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is Q5RH4ZDYNJ","image_url":"","date":"2017-03-28T16:57:56.325719Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":154,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is Q5RH4ZDYNJ","image_url":"","date":"2017-03-28T16:57:56.325719Z"}
2017-03-28 16:58:10,030 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-28 16:58:10,030 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-28 16:58:10,030 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":154,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is Q5RH4ZDYNJ","image_url":"","date":"2017-03-28T16:57:56.325719Z"}
2017-03-28 16:58:10,030 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":154,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is Q5RH4ZDYNJ","image_url":"","date":"2017-03-28T16:57:56.325719Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":154,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 20  Safaricom Airtime. Your transaction number is Q5RH4ZDYNJ","image_url":"","date":"2017-03-28T16:57:56.325719Z"}
2017-03-28 16:58:10,031 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-28 16:58:10,031 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-28 16:58:10,032 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-28 16:58:10,032 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-28 16:58:10,032 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-28 16:58:10,032 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-28 16:58:10,033 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-28 16:58:10,033 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-28 16:58:10,033 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
2017-03-28 16:58:10,033 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 8, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "20", "service_provider_id": 1}
2017-03-28 16:58:10,034 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-28 16:58:10,034 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-28 16:58:10,087 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 16:58:10,087 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 16:58:10,088 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":128,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 16:58:10,088 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":128,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":128,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":20.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 16:58:10,089 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 16:58:10,089 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 16:58:10,090 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
2017-03-28 16:58:10,090 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": null}
2017-03-28 16:58:10,091 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 16:58:10,091 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-28 16:58:10,101 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
2017-03-28 16:58:10,101 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
DEBUG:handlers.result_handler.AirtimeHandler:Updating speadsheet......
/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
  InsecurePlatformWarning
2017-03-28 16:58:12,562 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-28 16:58:12,562 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-28 16:58:12,564 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3353.75ms
2017-03-28 16:58:12,564 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 3353.75ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 3353.75ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
2017-03-28 17:40:12,656 = __main__ - INFO - Creating server
2017-03-28 17:40:12,661 = __main__ - INFO - Created server
2017-03-28 17:40:12,661 = __main__ - INFO - Listening on port 8080
2017-03-28 17:40:35,206 = __main__ - INFO - Creating server
2017-03-28 17:40:35,206 = __main__ - INFO - Creating server
2017-03-28 17:40:35,211 = __main__ - INFO - Created server
2017-03-28 17:40:35,211 = __main__ - INFO - Created server
2017-03-28 17:40:35,211 = __main__ - INFO - Listening on port 8080
2017-03-28 17:40:35,211 = __main__ - INFO - Listening on port 8080
2017-03-28 17:40:35,212 = __main__ - INFO - Starting event loop
2017-03-28 17:40:35,212 = __main__ - INFO - Starting event loop
2017-03-28 17:41:24,082 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
2017-03-28 17:41:24,082 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/5000/-------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/5000/-------------------
2017-03-28 17:41:24,082 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-28 17:41:24,082 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
2017-03-28 17:41:24,083 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 17:41:24
2017-03-28 17:41:24,083 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 28/03/2017 17:41:24
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 28/03/2017 17:41:24
2017-03-28 17:41:24,083 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-28 17:41:24,083 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
2017-03-28 17:41:24,084 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-28 17:41:24,084 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
2017-03-28 17:41:24,084 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = bf8fca8439044736812d9c4b1b154d39
2017-03-28 17:41:24,084 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = bf8fca8439044736812d9c4b1b154d39
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = bf8fca8439044736812d9c4b1b154d39
2017-03-28 17:41:24,085 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-28 17:41:24,085 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
2017-03-28 17:41:24,086 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'mobile_money_transaction_number': u'LC323322', u'service_type_id': 1, u'service_provider_id': 1, u'amount': u'50', u'mobile_money_provider_id': 2, u'account_number': u'1535654', u'mobile_number': u'0701585831', u'payment_method_id': u'1'}-----------------------------++++++++++++++
2017-03-28 17:41:24,086 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 8, u'mobile_money_transaction_number': u'LC323322', u'service_type_id': 1, u'service_provider_id': 1, u'amount': u'50', u'mobile_money_provider_id': 2, u'account_number': u'1535654', u'mobile_number': u'0701585831', u'payment_method_id': u'1'}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 8, u'mobile_money_transaction_number': u'LC323322', u'service_type_id': 1, u'service_provider_id': 1, u'amount': u'50', u'mobile_money_provider_id': 2, u'account_number': u'1535654', u'mobile_number': u'0701585831', u'payment_method_id': u'1'}-----------------------------++++++++++++++
2017-03-28 17:41:24,086 = handlers.result_handler.AirtimeHandler - DEBUG - LC323322
2017-03-28 17:41:24,086 = handlers.result_handler.AirtimeHandler - DEBUG - LC323322
DEBUG:handlers.result_handler.AirtimeHandler:LC323322
2017-03-28 17:41:24,087 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-28 17:41:24,087 = handlers.result_handler.AirtimeHandler - INFO - Building XML
INFO:handlers.result_handler.AirtimeHandler:Building XML
2017-03-28 17:41:24,087 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 17:41:24</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>bf8fca8439044736812d9c4b1b154d39</ns0:EXTREFNUM><ns0:MSISDN2>0701585831</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 17:41:24,087 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 17:41:24</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>bf8fca8439044736812d9c4b1b154d39</ns0:EXTREFNUM><ns0:MSISDN2>0701585831</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 17:41:24</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>bf8fca8439044736812d9c4b1b154d39</ns0:EXTREFNUM><ns0:MSISDN2>0701585831</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 17:41:24,088 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-28 17:41:24,088 = handlers.result_handler.AirtimeHandler - INFO - Built XML
INFO:handlers.result_handler.AirtimeHandler:Built XML
2017-03-28 17:41:24,088 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-28 17:41:24,088 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
2017-03-28 17:41:24,089 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 17:41:24</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>bf8fca8439044736812d9c4b1b154d39</ns0:EXTREFNUM><ns0:MSISDN2>0701585831</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 17:41:24,089 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 17:41:24</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>bf8fca8439044736812d9c4b1b154d39</ns0:EXTREFNUM><ns0:MSISDN2>0701585831</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>28/03/2017 17:41:24</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>bf8fca8439044736812d9c4b1b154d39</ns0:EXTREFNUM><ns0:MSISDN2>0701585831</ns0:MSISDN2><ns0:AMOUNT>5000</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-28 17:41:24,089 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-28 17:41:24,089 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-28 17:41:24,753 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-28 17:41:24,753 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-28 17:41:24,754 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 17:41:10</ns0:DATE><ns0:EXTREFNUM>bf8fca8439044736812d9c4b1b154d39</ns0:EXTREFNUM><ns0:TXNID>R170328.1741.130011</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 701585831 is successful. Your new balance is KSH 525</ns0:MESSAGE></ns0:COMMAND>
2017-03-28 17:41:24,754 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 17:41:10</ns0:DATE><ns0:EXTREFNUM>bf8fca8439044736812d9c4b1b154d39</ns0:EXTREFNUM><ns0:TXNID>R170328.1741.130011</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 701585831 is successful. Your new balance is KSH 525</ns0:MESSAGE></ns0:COMMAND>


DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>28/03/17 17:41:10</ns0:DATE><ns0:EXTREFNUM>bf8fca8439044736812d9c4b1b154d39</ns0:EXTREFNUM><ns0:TXNID>R170328.1741.130011</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 50 to 701585831 is successful. Your new balance is KSH 525</ns0:MESSAGE></ns0:COMMAND>

2017-03-28 17:41:24,754 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-28 17:41:24,754 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-28 17:41:24,755 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
2017-03-28 17:41:24,755 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------50-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------50-----------------------
2017-03-28 17:41:24,755 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-28 17:41:24,755 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-28 17:41:24,756 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 17:41:10
2017-03-28 17:41:24,756 = handlers.result_handler.AirtimeHandler - DEBUG - 28/03/17 17:41:10
DEBUG:handlers.result_handler.AirtimeHandler:28/03/17 17:41:10
2017-03-28 17:41:24,756 = handlers.result_handler.AirtimeHandler - DEBUG - bf8fca8439044736812d9c4b1b154d39
2017-03-28 17:41:24,756 = handlers.result_handler.AirtimeHandler - DEBUG - bf8fca8439044736812d9c4b1b154d39
DEBUG:handlers.result_handler.AirtimeHandler:bf8fca8439044736812d9c4b1b154d39
2017-03-28 17:41:24,757 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1741.130011
2017-03-28 17:41:24,757 = handlers.result_handler.AirtimeHandler - DEBUG - R170328.1741.130011
DEBUG:handlers.result_handler.AirtimeHandler:R170328.1741.130011
2017-03-28 17:41:24,758 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 17:41:10', 'amount': '50', 'external_ref': u'R170328.1741.130011', 'msisdn_2': u'0701585831', 'internal_ref': 'CSYJG3FKBE'}
2017-03-28 17:41:24,758 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'28/03/17 17:41:10', 'amount': '50', 'external_ref': u'R170328.1741.130011', 'msisdn_2': u'0701585831', 'internal_ref': 'CSYJG3FKBE'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'28/03/17 17:41:10', 'amount': '50', 'external_ref': u'R170328.1741.130011', 'msisdn_2': u'0701585831', 'internal_ref': 'CSYJG3FKBE'}
2017-03-28 17:41:24,758 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-28 17:41:24,758 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-28 17:41:24,899 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-28 17:41:24,900 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
2017-03-28 17:41:24,903 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 17:41:24,904 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
2017-03-28 17:41:24,908 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 17:41:24,909 INFO sqlalchemy.engine.base.Engine {}
2017-03-28 17:41:24,913 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-28 17:41:24,913 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-28 17:41:24,917 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-28 17:41:24,917 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 17:41:24,920 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-28 17:41:24,920 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-28 17:41:24,924 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-28 17:41:24,924 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-28 17:41:24,928 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-28 17:41:24,928 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 17:41:24,932 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 17:41:24,932 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-28 17:41:24,934 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-28 17:41:24,934 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-28 17:41:24,940 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
<sqlalchemy.engine.result.ResultProxy object at 0x7ff2c6201950>
2017-03-28 17:41:24,940 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-28 17:41:24,940 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-28 17:41:24,940 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-28 17:41:24,941 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 50  Safaricom Airtime. Your transaction number is CSYJG3FKBE
2017-03-28 17:41:24,941 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 50  Safaricom Airtime. Your transaction number is CSYJG3FKBE
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 50  Safaricom Airtime. Your transaction number is CSYJG3FKBE
2017-03-28 17:41:24,942 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 50  Safaricom Airtime. Your transaction number is CSYJG3FKBE to 0701585831
2017-03-28 17:41:24,942 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 50  Safaricom Airtime. Your transaction number is CSYJG3FKBE to 0701585831
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 50  Safaricom Airtime. Your transaction number is CSYJG3FKBE to 0701585831
2017-03-28 17:41:24,942 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-28 17:41:24,942 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-28 17:41:24,943 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 50  Safaricom Airtime. Your transaction number is CSYJG3FKBE to 8
2017-03-28 17:41:24,943 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 50  Safaricom Airtime. Your transaction number is CSYJG3FKBE to 8
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 50  Safaricom Airtime. Your transaction number is CSYJG3FKBE to 8
2017-03-28 17:41:24,943 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 50  Safaricom Airtime. Your transaction number is CSYJG3FKBE", "user": "8", "title": "Safaricom  Airtime"}
2017-03-28 17:41:24,943 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 50  Safaricom Airtime. Your transaction number is CSYJG3FKBE", "user": "8", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 50  Safaricom Airtime. Your transaction number is CSYJG3FKBE", "user": "8", "title": "Safaricom  Airtime"}
2017-03-28 17:41:24,943 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-28 17:41:24,943 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-28 17:41:24,944 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 50  Safaricom Airtime. Your transaction number is CSYJG3FKBE
2017-03-28 17:41:24,944 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 50  Safaricom Airtime. Your transaction number is CSYJG3FKBE
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 50  Safaricom Airtime. Your transaction number is CSYJG3FKBE
2017-03-28 17:41:26,067 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":155,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 50  Safaricom Airtime. Your transaction number is CSYJG3FKBE","image_url":"","date":"2017-03-28T17:41:12.280859Z"}
2017-03-28 17:41:26,067 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":155,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 50  Safaricom Airtime. Your transaction number is CSYJG3FKBE","image_url":"","date":"2017-03-28T17:41:12.280859Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":155,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 50  Safaricom Airtime. Your transaction number is CSYJG3FKBE","image_url":"","date":"2017-03-28T17:41:12.280859Z"}
2017-03-28 17:41:26,068 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-28 17:41:26,068 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-28 17:41:26,068 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":155,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 50  Safaricom Airtime. Your transaction number is CSYJG3FKBE","image_url":"","date":"2017-03-28T17:41:12.280859Z"}
2017-03-28 17:41:26,068 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":155,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 50  Safaricom Airtime. Your transaction number is CSYJG3FKBE","image_url":"","date":"2017-03-28T17:41:12.280859Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":155,"user":8,"title":"Safaricom  Airtime","text":"You have successfully bought KES 50  Safaricom Airtime. Your transaction number is CSYJG3FKBE","image_url":"","date":"2017-03-28T17:41:12.280859Z"}
2017-03-28 17:41:26,069 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-28 17:41:26,069 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-28 17:41:26,070 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-28 17:41:26,070 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-28 17:41:26,070 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-28 17:41:26,070 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-28 17:41:26,071 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-28 17:41:26,071 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-28 17:41:26,072 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "1585831", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "50", "service_provider_id": 1}
2017-03-28 17:41:26,072 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "1585831", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "50", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "1585831", "user": 8, "transaction_status": 1, "payment_method": "1", "receipt_number": "null", "service_type_id": 1, "amount": "50", "service_provider_id": 1}
2017-03-28 17:41:26,072 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-28 17:41:26,072 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-28 17:41:26,125 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 17:41:26,125 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 17:41:26,126 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":133,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"1585831","request":null,"amount":50.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 17:41:26,126 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":133,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"1585831","request":null,"amount":50.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":133,"user":8,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"1585831","request":null,"amount":50.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-28 17:41:26,126 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 17:41:26,126 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 17:41:26,127 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
2017-03-28 17:41:26,127 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": "LC323322"}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": "LC323322"}
2017-03-28 17:41:27,394 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-28 17:41:27,394 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-28 17:41:27,394 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
2017-03-28 17:41:27,394 = handlers.result_handler.AirtimeHandler - DEBUG - {"status": 1, "message": "Transaction not found"}
DEBUG:handlers.result_handler.AirtimeHandler:{"status": 1, "message": "Transaction not found"}
{"status": 1, "message": "Transaction not found"}
2017-03-28 17:41:27,395 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 17:41:27,395 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-28 17:41:27,396 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:Updating speadsheet......
2017-03-28 17:41:27,396 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/util/ssl_.py:334: SNIMissingWarning: An HTTPS request has been made, but the SNI (Subject Name Indication) extension to TLS is not available on this platform. This may cause the server to present an incorrect TLS certificate, which can cause validation failures. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
  SNIMissingWarning
/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
  InsecurePlatformWarning
2017-03-28 17:41:29,434 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-28 17:41:29,434 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-28 17:41:29,435 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 5354.86ms
2017-03-28 17:41:29,435 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 5354.86ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 5354.86ms
2017-03-28 18:08:12,688 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.52ms
2017-03-28 18:08:12,688 = tornado.access - WARNING - 404 GET /setup.cgi (191.96.249.97) 0.52ms
WARNING:tornado.access:404 GET /setup.cgi (191.96.249.97) 0.52ms
2017-03-28 19:49:04,006 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.70.63) 0.46ms
2017-03-28 19:49:04,006 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.70.63) 0.46ms
WARNING:tornado.access:404 GET http://www.baidu.com/favicon.ico (123.59.70.63) 0.46ms
2017-03-28 21:30:05,245 = tornado.access - WARNING - 404 GET /script (103.200.30.200) 0.52ms
2017-03-28 21:30:05,245 = tornado.access - WARNING - 404 GET /script (103.200.30.200) 0.52ms
WARNING:tornado.access:404 GET /script (103.200.30.200) 0.52ms
2017-03-28 21:52:00,702 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.73ms
2017-03-28 21:52:00,702 = tornado.access - WARNING - 404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.73ms
WARNING:tornado.access:404 GET http://www.baidu.com/cache/global/img/gs.gif (93.174.93.136) 0.73ms
2017-03-28 23:59:35,151 = tornado.access - WARNING - 404 GET / (139.162.111.98) 0.58ms
WARNING:tornado.access:404 GET / (139.162.111.98) 0.58ms
2017-03-28 23:59:35,151 = tornado.access - WARNING - 404 GET / (139.162.111.98) 0.58ms
2017-03-29 00:59:24,509 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.82.147) 0.71ms
WARNING:tornado.access:404 GET http://www.baidu.com/favicon.ico (123.59.82.147) 0.71ms
2017-03-29 00:59:24,509 = tornado.access - WARNING - 404 GET http://www.baidu.com/favicon.ico (123.59.82.147) 0.71ms
2017-03-29 01:56:17,097 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.69ms
2017-03-29 01:56:17,097 = tornado.access - WARNING - 404 GET http://www.google.com/ (91.236.75.4) 0.69ms
WARNING:tornado.access:404 GET http://www.google.com/ (91.236.75.4) 0.69ms
2017-03-29 04:56:32,045 = tornado.access - WARNING - 404 GET / (106.75.81.67) 0.73ms
2017-03-29 04:56:32,045 = tornado.access - WARNING - 404 GET / (106.75.81.67) 0.73ms
WARNING:tornado.access:404 GET / (106.75.81.67) 0.73ms
2017-03-29 04:58:35,806 = tornado.access - WARNING - 404 GET / (180.150.177.188) 0.47ms
2017-03-29 04:58:35,806 = tornado.access - WARNING - 404 GET / (180.150.177.188) 0.47ms
WARNING:tornado.access:404 GET / (180.150.177.188) 0.47ms
2017-03-29 05:44:20,504 = tornado.access - WARNING - 404 GET / (196.52.43.51) 0.58ms
2017-03-29 05:44:20,504 = tornado.access - WARNING - 404 GET / (196.52.43.51) 0.58ms
WARNING:tornado.access:404 GET / (196.52.43.51) 0.58ms
2017-03-29 07:40:49,023 = tornado.access - WARNING - 404 GET http://www.server110.com/ (61.164.149.128) 0.54ms
WARNING:tornado.access:404 GET http://www.server110.com/ (61.164.149.128) 0.54ms
2017-03-29 07:40:49,023 = tornado.access - WARNING - 404 GET http://www.server110.com/ (61.164.149.128) 0.54ms
2017-03-29 07:40:49,569 = tornado.access - WARNING - 405 CONNECT www.linode.com:443 (61.164.149.128) 0.49ms
WARNING:tornado.access:405 CONNECT www.linode.com:443 (61.164.149.128) 0.49ms
2017-03-29 07:40:49,569 = tornado.access - WARNING - 405 CONNECT www.linode.com:443 (61.164.149.128) 0.49ms
2017-03-29 07:40:50,106 = tornado.access - WARNING - 405 CONNECT www.linode.com:443 (61.164.149.128) 0.75ms
WARNING:tornado.access:405 CONNECT www.linode.com:443 (61.164.149.128) 0.75ms
2017-03-29 07:40:50,106 = tornado.access - WARNING - 405 CONNECT www.linode.com:443 (61.164.149.128) 0.75ms
2017-03-29 07:40:50,649 = tornado.access - WARNING - 405 CONNECT www.linode.com:443 (61.164.149.128) 0.44ms
2017-03-29 07:40:50,649 = tornado.access - WARNING - 405 CONNECT www.linode.com:443 (61.164.149.128) 0.44ms
WARNING:tornado.access:405 CONNECT www.linode.com:443 (61.164.149.128) 0.44ms
2017-03-29 10:02:24,385 = tornado.access - WARNING - 404 GET /script (222.186.56.121) 0.49ms
WARNING:tornado.access:404 GET /script (222.186.56.121) 0.49ms
2017-03-29 10:02:24,385 = tornado.access - WARNING - 404 GET /script (222.186.56.121) 0.49ms
2017-03-29 12:32:32,746 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-29 12:32:32,746 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-29 12:32:32,747 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 29/03/2017 12:32:32
2017-03-29 12:32:32,747 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-29 12:32:32,747 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-29 12:32:32,748 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = c88e1151ce444b92b527c0ef4d72f8be
2017-03-29 12:32:32,748 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-29 12:32:32,748 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-29 12:32:32,748 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-29 12:32:32,749 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-29 12:32:32,750 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>29/03/2017 12:32:32</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c88e1151ce444b92b527c0ef4d72f8be</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-29 12:32:32,750 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-29 12:32:32,750 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-29 12:32:32,751 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>29/03/2017 12:32:32</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c88e1151ce444b92b527c0ef4d72f8be</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-29 12:32:32,751 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------/500/-------------------
INFO:handlers.result_handler.AirtimeHandler:Generating Date Time
DEBUG:handlers.result_handler.AirtimeHandler:Date Time = 29/03/2017 12:32:32
INFO:handlers.result_handler.AirtimeHandler:Generated Date Time
INFO:handlers.result_handler.AirtimeHandler:Generating External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:External Reference Number = c88e1151ce444b92b527c0ef4d72f8be
INFO:handlers.result_handler.AirtimeHandler:Generated External Reference Number
DEBUG:handlers.result_handler.AirtimeHandler:--------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
DEBUG:handlers.result_handler.AirtimeHandler:None
INFO:handlers.result_handler.AirtimeHandler:Building XML
DEBUG:handlers.result_handler.AirtimeHandler:XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>29/03/2017 12:32:32</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c88e1151ce444b92b527c0ef4d72f8be</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
INFO:handlers.result_handler.AirtimeHandler:Built XML
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------------/business process/---------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>29/03/2017 12:32:32</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c88e1151ce444b92b527c0ef4d72f8be</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
DEBUG:handlers.result_handler.AirtimeHandler:intialized airtime purchase
2017-03-29 12:32:32,746 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------/500/-------------------
2017-03-29 12:32:32,746 = handlers.result_handler.AirtimeHandler - INFO - Generating Date Time
2017-03-29 12:32:32,747 = handlers.result_handler.AirtimeHandler - DEBUG - Date Time = 29/03/2017 12:32:32
2017-03-29 12:32:32,747 = handlers.result_handler.AirtimeHandler - INFO - Generated Date Time
2017-03-29 12:32:32,747 = handlers.result_handler.AirtimeHandler - INFO - Generating External Reference Number
2017-03-29 12:32:32,748 = handlers.result_handler.AirtimeHandler - DEBUG - External Reference Number = c88e1151ce444b92b527c0ef4d72f8be
2017-03-29 12:32:32,748 = handlers.result_handler.AirtimeHandler - INFO - Generated External Reference Number
2017-03-29 12:32:32,748 = handlers.result_handler.AirtimeHandler - DEBUG - --------------------------{u'user_id': 7, u'promo_code': None, u'service_type_id': 1, u'service_provider_id': 1, u'request_id': None, u'note': None, u'mobile_money_transaction_number': None, u'amount': 5, u'mobile_money_provider_id': None, u'account_number': None, u'mobile_number': u'254702935200', u'bundle_id': None, u'payment_method_id': 1}-----------------------------++++++++++++++
2017-03-29 12:32:32,748 = handlers.result_handler.AirtimeHandler - DEBUG - None
2017-03-29 12:32:32,749 = handlers.result_handler.AirtimeHandler - INFO - Building XML
2017-03-29 12:32:32,750 = handlers.result_handler.AirtimeHandler - DEBUG - XML = <?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>29/03/2017 12:32:32</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c88e1151ce444b92b527c0ef4d72f8be</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-29 12:32:32,750 = handlers.result_handler.AirtimeHandler - INFO - Built XML
2017-03-29 12:32:32,750 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------------/business process/---------------------------------
2017-03-29 12:32:32,751 = handlers.result_handler.AirtimeHandler - DEBUG - http://196.201.214.53:5660/?VENDOR=D-C101&REQTYPE=EXRCTRFREQ&DATA=<?xml version="1.0"?><ns0:COMMAND xmlns:ns0="http://safaricom.co.ke/Pinless/keyaccounts/"><ns0:TYPE>EXRCTRFREQ</ns0:TYPE><ns0:DATE>29/03/2017 12:32:32</ns0:DATE><ns0:EXTNWCODE>SA</ns0:EXTNWCODE><ns0:MSISDN>700945099</ns0:MSISDN><ns0:PIN>4370</ns0:PIN><ns0:LOGINID>D-C101</ns0:LOGINID><ns0:PASSWORD>C3HrucQT</ns0:PASSWORD><ns0:EXTCODE>D-C101</ns0:EXTCODE><ns0:EXTREFNUM>c88e1151ce444b92b527c0ef4d72f8be</ns0:EXTREFNUM><ns0:MSISDN2>254702935200</ns0:MSISDN2><ns0:AMOUNT>500</ns0:AMOUNT><ns0:LANGUAGE1></ns0:LANGUAGE1><ns0:LANGUAGE2></ns0:LANGUAGE2><ns0:SELECTOR></ns0:SELECTOR></ns0:COMMAND>
2017-03-29 12:32:32,751 = handlers.result_handler.AirtimeHandler - DEBUG - intialized airtime purchase
2017-03-29 12:32:33,466 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
2017-03-29 12:32:33,466 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent payload to safaricom airtime servers
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent payload to safaricom airtime servers
2017-03-29 12:32:33,467 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>29/03/17 12:32:17</ns0:DATE><ns0:EXTREFNUM>c88e1151ce444b92b527c0ef4d72f8be</ns0:EXTREFNUM><ns0:TXNID>R170329.1232.130025</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 520</ns0:MESSAGE></ns0:COMMAND>

2017-03-29 12:32:33,467 = handlers.result_handler.AirtimeHandler - DEBUG - <?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>29/03/17 12:32:17</ns0:DATE><ns0:EXTREFNUM>c88e1151ce444b92b527c0ef4d72f8be</ns0:EXTREFNUM><ns0:TXNID>R170329.1232.130025</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 520</ns0:MESSAGE></ns0:COMMAND>

DEBUG:handlers.result_handler.AirtimeHandler:<?xml version="1.0" encoding="UTF-16"?><ns0:COMMAND xmlns:ns0="http://www.tibco.com/schemas/pinless/PINLESS.core/C2STransferBillPayment/Schema.xsd9"><ns0:TYPE>EXRCTRFRESP</ns0:TYPE><ns0:TXNSTATUS>200</ns0:TXNSTATUS><ns0:DATE>29/03/17 12:32:17</ns0:DATE><ns0:EXTREFNUM>c88e1151ce444b92b527c0ef4d72f8be</ns0:EXTREFNUM><ns0:TXNID>R170329.1232.130025</ns0:TXNID><ns0:MESSAGE>Request to recharge KSH 5 to 702935200 is successful. Your new balance is KSH 520</ns0:MESSAGE></ns0:COMMAND>

2017-03-29 12:32:33,468 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
2017-03-29 12:32:33,468 = handlers.result_handler.AirtimeHandler - DEBUG - initialized parsing transaction.......
DEBUG:handlers.result_handler.AirtimeHandler:initialized parsing transaction.......
2017-03-29 12:32:33,468 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
2017-03-29 12:32:33,468 = handlers.result_handler.AirtimeHandler - DEBUG - ---------------------------5-----------------------
DEBUG:handlers.result_handler.AirtimeHandler:---------------------------5-----------------------
2017-03-29 12:32:33,469 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
2017-03-29 12:32:33,469 = handlers.result_handler.AirtimeHandler - DEBUG - -----------parsed data-----------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------parsed data-----------------
2017-03-29 12:32:33,469 = handlers.result_handler.AirtimeHandler - DEBUG - 29/03/17 12:32:17
2017-03-29 12:32:33,469 = handlers.result_handler.AirtimeHandler - DEBUG - 29/03/17 12:32:17
DEBUG:handlers.result_handler.AirtimeHandler:29/03/17 12:32:17
2017-03-29 12:32:33,470 = handlers.result_handler.AirtimeHandler - DEBUG - c88e1151ce444b92b527c0ef4d72f8be
2017-03-29 12:32:33,470 = handlers.result_handler.AirtimeHandler - DEBUG - c88e1151ce444b92b527c0ef4d72f8be
DEBUG:handlers.result_handler.AirtimeHandler:c88e1151ce444b92b527c0ef4d72f8be
2017-03-29 12:32:33,470 = handlers.result_handler.AirtimeHandler - DEBUG - R170329.1232.130025
2017-03-29 12:32:33,470 = handlers.result_handler.AirtimeHandler - DEBUG - R170329.1232.130025
DEBUG:handlers.result_handler.AirtimeHandler:R170329.1232.130025
2017-03-29 12:32:33,471 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'29/03/17 12:32:17', 'amount': '5', 'external_ref': u'R170329.1232.130025', 'msisdn_2': u'254702935200', 'internal_ref': 'H25OK8UKF1'}
2017-03-29 12:32:33,471 = handlers.result_handler.AirtimeHandler - DEBUG - {'date': u'29/03/17 12:32:17', 'amount': '5', 'external_ref': u'R170329.1232.130025', 'msisdn_2': u'254702935200', 'internal_ref': 'H25OK8UKF1'}
DEBUG:handlers.result_handler.AirtimeHandler:{'date': u'29/03/17 12:32:17', 'amount': '5', 'external_ref': u'R170329.1232.130025', 'msisdn_2': u'254702935200', 'internal_ref': 'H25OK8UKF1'}
2017-03-29 12:32:33,472 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
2017-03-29 12:32:33,472 = handlers.result_handler.AirtimeHandler - DEBUG - initialized database call........
DEBUG:handlers.result_handler.AirtimeHandler:initialized database call........
2017-03-29 12:32:33,523 INFO sqlalchemy.engine.base.Engine 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in ('r', 'v', 'm', 'f')
        
2017-03-29 12:32:33,524 INFO sqlalchemy.engine.base.Engine {'table_name': u'safaricom_airtime'}
INFO:sqlalchemy.engine.base.Engine:{'table_name': u'safaricom_airtime'}
2017-03-29 12:32:33,528 INFO sqlalchemy.engine.base.Engine 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
               WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
               AND a.atthasdef)
              AS DEFAULT,
              a.attnotnull, a.attnum, a.attrelid as table_oid
            FROM pg_catalog.pg_attribute a
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
2017-03-29 12:32:33,529 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-29 12:32:33,533 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
2017-03-29 12:32:33,533 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-29 12:32:33,537 INFO sqlalchemy.engine.base.Engine 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
INFO:sqlalchemy.engine.base.Engine:
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
2017-03-29 12:32:33,537 INFO sqlalchemy.engine.base.Engine {}
INFO:sqlalchemy.engine.base.Engine:{}
2017-03-29 12:32:33,542 INFO sqlalchemy.engine.base.Engine 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
INFO:sqlalchemy.engine.base.Engine:
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
2017-03-29 12:32:33,543 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-29 12:32:33,546 INFO sqlalchemy.engine.base.Engine 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
2017-03-29 12:32:33,547 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-29 12:32:33,549 INFO sqlalchemy.engine.base.Engine 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
INFO:sqlalchemy.engine.base.Engine:
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
2017-03-29 12:32:33,550 INFO sqlalchemy.engine.base.Engine {'table': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table': 23559}
2017-03-29 12:32:33,553 INFO sqlalchemy.engine.base.Engine 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
INFO:sqlalchemy.engine.base.Engine:
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs, ix.indpred,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  i.reloptions, am.amname
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
2017-03-29 12:32:33,554 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-29 12:32:33,558 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
2017-03-29 12:32:33,559 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
2017-03-29 12:32:33,561 INFO sqlalchemy.engine.base.Engine 
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
INFO:sqlalchemy.engine.base.Engine:
            SELECT
                cons.conname as name,
                cons.consrc as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
2017-03-29 12:32:33,561 INFO sqlalchemy.engine.base.Engine {'table_oid': 23559}
INFO:sqlalchemy.engine.base.Engine:{'table_oid': 23559}
<sqlalchemy.engine.result.ResultProxy object at 0x7ff2c5ed5550>
2017-03-29 12:32:33,567 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
2017-03-29 12:32:33,567 = handlers.result_handler.AirtimeHandler - DEBUG - completed saving record to database
DEBUG:handlers.result_handler.AirtimeHandler:completed saving record to database
2017-03-29 12:32:33,568 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
2017-03-29 12:32:33,568 = handlers.result_handler.AirtimeHandler - DEBUG - sending notification to user
DEBUG:handlers.result_handler.AirtimeHandler:sending notification to user
2017-03-29 12:32:33,569 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is H25OK8UKF1
2017-03-29 12:32:33,569 = handlers.result_handler.AirtimeHandler - DEBUG - ^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is H25OK8UKF1
DEBUG:handlers.result_handler.AirtimeHandler:^^^^^^^^^^^^^^^^^^^^^^^^^You have successfully bought KES 5  Safaricom Airtime. Your transaction number is H25OK8UKF1
2017-03-29 12:32:33,570 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is H25OK8UKF1 to 254702935200
2017-03-29 12:32:33,570 = handlers.result_handler.AirtimeHandler - DEBUG - sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is H25OK8UKF1 to 254702935200
DEBUG:handlers.result_handler.AirtimeHandler:sending You have successfully bought KES 5  Safaricom Airtime. Your transaction number is H25OK8UKF1 to 254702935200
2017-03-29 12:32:33,571 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
2017-03-29 12:32:33,571 = handlers.result_handler.AirtimeHandler - DEBUG - sending app notification........
DEBUG:handlers.result_handler.AirtimeHandler:sending app notification........
2017-03-29 12:32:33,571 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is H25OK8UKF1 to 7
2017-03-29 12:32:33,571 = handlers.result_handler.AirtimeHandler - DEBUG - sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is H25OK8UKF1 to 7
DEBUG:handlers.result_handler.AirtimeHandler:sending message You have successfully bought KES 5  Safaricom Airtime. Your transaction number is H25OK8UKF1 to 7
2017-03-29 12:32:33,572 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is H25OK8UKF1", "user": "7", "title": "Safaricom  Airtime"}
2017-03-29 12:32:33,572 = handlers.result_handler.AirtimeHandler - DEBUG - {"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is H25OK8UKF1", "user": "7", "title": "Safaricom  Airtime"}
DEBUG:handlers.result_handler.AirtimeHandler:{"text": "You have successfully bought KES 5  Safaricom Airtime. Your transaction number is H25OK8UKF1", "user": "7", "title": "Safaricom  Airtime"}
2017-03-29 12:32:33,573 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
2017-03-29 12:32:33,573 = handlers.result_handler.AirtimeHandler - DEBUG - sending payload to app notification server server
DEBUG:handlers.result_handler.AirtimeHandler:sending payload to app notification server server
2017-03-29 12:32:33,573 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 5  Safaricom Airtime. Your transaction number is H25OK8UKF1
2017-03-29 12:32:33,573 = handlers.result_handler.AirtimeHandler - DEBUG - You have successfully bought KES 5  Safaricom Airtime. Your transaction number is H25OK8UKF1
DEBUG:handlers.result_handler.AirtimeHandler:You have successfully bought KES 5  Safaricom Airtime. Your transaction number is H25OK8UKF1
2017-03-29 12:32:34,044 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":156,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is H25OK8UKF1","image_url":"","date":"2017-03-29T12:32:18.143034Z"}
2017-03-29 12:32:34,044 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":156,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is H25OK8UKF1","image_url":"","date":"2017-03-29T12:32:18.143034Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":156,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is H25OK8UKF1","image_url":"","date":"2017-03-29T12:32:18.143034Z"}
2017-03-29 12:32:34,045 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
2017-03-29 12:32:34,045 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully sent notification to user
DEBUG:handlers.result_handler.AirtimeHandler:succesfully sent notification to user
2017-03-29 12:32:34,046 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":156,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is H25OK8UKF1","image_url":"","date":"2017-03-29T12:32:18.143034Z"}
2017-03-29 12:32:34,046 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":156,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is H25OK8UKF1","image_url":"","date":"2017-03-29T12:32:18.143034Z"}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":156,"user":7,"title":"Safaricom  Airtime","text":"You have successfully bought KES 5  Safaricom Airtime. Your transaction number is H25OK8UKF1","image_url":"","date":"2017-03-29T12:32:18.143034Z"}
2017-03-29 12:32:34,046 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
2017-03-29 12:32:34,046 = handlers.result_handler.AirtimeHandler - DEBUG - updating transactions........
DEBUG:handlers.result_handler.AirtimeHandler:updating transactions........
2017-03-29 12:32:34,047 = handlers.result_handler.AirtimeHandler - DEBUG - 
2017-03-29 12:32:34,047 = handlers.result_handler.AirtimeHandler - DEBUG - 
DEBUG:handlers.result_handler.AirtimeHandler:
2017-03-29 12:32:34,047 = handlers.result_handler.AirtimeHandler - DEBUG - null
2017-03-29 12:32:34,047 = handlers.result_handler.AirtimeHandler - DEBUG - null
DEBUG:handlers.result_handler.AirtimeHandler:null
2017-03-29 12:32:34,047 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
2017-03-29 12:32:34,047 = handlers.result_handler.AirtimeHandler - DEBUG - initializing update transaction table............
DEBUG:handlers.result_handler.AirtimeHandler:initializing update transaction table............
2017-03-29 12:32:34,048 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-29 12:32:34,048 = handlers.result_handler.AirtimeHandler - DEBUG - {"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
DEBUG:handlers.result_handler.AirtimeHandler:{"note": "null", "destination_mobile_number": "702935200", "user": 7, "transaction_status": 1, "payment_method": 1, "receipt_number": "null", "service_type_id": 1, "amount": "5", "service_provider_id": 1}
2017-03-29 12:32:34,048 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
2017-03-29 12:32:34,048 = handlers.result_handler.AirtimeHandler - DEBUG - preparing to update transactions  table ..........
DEBUG:handlers.result_handler.AirtimeHandler:preparing to update transactions  table ..........
2017-03-29 12:32:35,254 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
2017-03-29 12:32:35,254 = handlers.result_handler.AirtimeHandler - DEBUG - succesfully updated transaction table.........
DEBUG:handlers.result_handler.AirtimeHandler:succesfully updated transaction table.........
2017-03-29 12:32:35,255 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":134,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-29 12:32:35,255 = handlers.result_handler.AirtimeHandler - DEBUG - {"id":134,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
DEBUG:handlers.result_handler.AirtimeHandler:{"id":134,"user":7,"receipt_number":"null","transaction_status":1,"destination_mobile_number":"702935200","request":null,"amount":5.0,"payment_method":1,"note":"null","bundle":null,"account_number":null}
2017-03-29 12:32:35,256 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-29 12:32:35,256 = handlers.result_handler.AirtimeHandler - DEBUG - -----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
DEBUG:handlers.result_handler.AirtimeHandler:-----------------------------------------------------------------/transaction succesfully completed/-------------------------------------------------------------------
2017-03-29 12:32:35,257 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
2017-03-29 12:32:35,257 = handlers.result_handler.AirtimeHandler - DEBUG - {"transaction_number": null}
DEBUG:handlers.result_handler.AirtimeHandler:{"transaction_number": null}
2017-03-29 12:32:35,257 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-29 12:32:35,257 = handlers.result_handler.AirtimeHandler - ERROR - local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
ERROR:handlers.result_handler.AirtimeHandler:local variable 'url' referenced before assignment
Traceback (most recent call last):
  File "/opt/saiba/ke-safaricom-airtime-integration/app/handlers/airtime_handler.py", line 326, in nullify_transaction_number
    req = tornado.httpclient.HTTPRequest(url, 'POST', body=payload)
UnboundLocalError: local variable 'url' referenced before assignment
2017-03-29 12:32:35,266 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
2017-03-29 12:32:35,266 = handlers.result_handler.AirtimeHandler - DEBUG - Updating speadsheet......
DEBUG:handlers.result_handler.AirtimeHandler:Updating speadsheet......
/usr/local/lib/python2.7/dist-packages/requests/packages/urllib3/util/ssl_.py:132: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
  InsecurePlatformWarning
2017-03-29 12:32:37,238 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
2017-03-29 12:32:37,238 = handlers.result_handler.AirtimeHandler - DEBUG - transaction was parsed succesfully
DEBUG:handlers.result_handler.AirtimeHandler:transaction was parsed succesfully
2017-03-29 12:32:37,240 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4494.69ms
2017-03-29 12:32:37,240 = tornado.access - INFO - 200 POST /v1/airtime/buy (127.0.0.1) 4494.69ms
INFO:tornado.access:200 POST /v1/airtime/buy (127.0.0.1) 4494.69ms
ERROR:sentry.errors.uncaught:[u"local variable 'url' referenced before assignment"]
